var op=Object.defineProperty;var sp=(r,o,i)=>o in r?op(r,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[o]=i;var lp=(r,o)=>()=>(o||r((o={exports:{}}).exports,o),o.exports);var re=(r,o,i)=>(sp(r,typeof o!="symbol"?o+"":o,i),i);var wb=lp(Wa=>{(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();function ll(r,o){const i=Object.create(null),t=r.split(",");for(let e=0;e<t.length;e++)i[t[e]]=!0;return o?e=>!!i[e.toLowerCase()]:e=>!!i[e]}const cp="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",up=ll(cp);function r_(r){return!!r||r===""}function Xa(r){if(Ee(r)){const o={};for(let i=0;i<r.length;i++){const t=r[i],e=At(t)?dp(t):Xa(t);if(e)for(const n in e)o[n]=e[n]}return o}else{if(At(r))return r;if(ot(r))return r}}const hp=/;(?![^(]*\))/g,fp=/:(.+)/;function dp(r){const o={};return r.split(hp).forEach(i=>{if(i){const t=i.split(fp);t.length>1&&(o[t[0].trim()]=t[1].trim())}}),o}function cl(r){let o="";if(At(r))o=r;else if(Ee(r))for(let i=0;i<r.length;i++){const t=cl(r[i]);t&&(o+=t+" ")}else if(ot(r))for(const i in r)r[i]&&(o+=i+" ");return o.trim()}const Ke={},Ni=[],zr=()=>{},_p=()=>!1,vp=/^on[^a-z]/,No=r=>vp.test(r),ul=r=>r.startsWith("onUpdate:"),Ft=Object.assign,hl=(r,o)=>{const i=r.indexOf(o);i>-1&&r.splice(i,1)},pp=Object.prototype.hasOwnProperty,Ue=(r,o)=>pp.call(r,o),Ee=Array.isArray,ba=r=>Uo(r)==="[object Map]",gp=r=>Uo(r)==="[object Set]",Be=r=>typeof r=="function",At=r=>typeof r=="string",fl=r=>typeof r=="symbol",ot=r=>r!==null&&typeof r=="object",n_=r=>ot(r)&&Be(r.then)&&Be(r.catch),mp=Object.prototype.toString,Uo=r=>mp.call(r),yp=r=>Uo(r).slice(8,-1),xp=r=>Uo(r)==="[object Object]",dl=r=>At(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,uo=ll(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Vo=r=>{const o=Object.create(null);return i=>o[i]||(o[i]=r(i))},wp=/-(\w)/g,ji=Vo(r=>r.replace(wp,(o,i)=>i?i.toUpperCase():"")),bp=/\B([A-Z])/g,aa=Vo(r=>r.replace(bp,"-$1").toLowerCase()),i_=Vo(r=>r.charAt(0).toUpperCase()+r.slice(1)),vs=Vo(r=>r?`on${i_(r)}`:""),Ra=(r,o)=>!Object.is(r,o),ps=(r,o)=>{for(let i=0;i<r.length;i++)r[i](o)},xo=(r,o,i)=>{Object.defineProperty(r,o,{configurable:!0,enumerable:!1,value:i})},Sp=r=>{const o=parseFloat(r);return isNaN(o)?r:o};let ic;const Cp=()=>ic||(ic=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Hr;class Ap{constructor(o=!1){this.detached=o,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Hr,!o&&Hr&&(this.index=(Hr.scopes||(Hr.scopes=[])).push(this)-1)}run(o){if(this.active){const i=Hr;try{return Hr=this,o()}finally{Hr=i}}}on(){Hr=this}off(){Hr=this.parent}stop(o){if(this.active){let i,t;for(i=0,t=this.effects.length;i<t;i++)this.effects[i].stop();for(i=0,t=this.cleanups.length;i<t;i++)this.cleanups[i]();if(this.scopes)for(i=0,t=this.scopes.length;i<t;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!o){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0,this.active=!1}}}function Pp(r,o=Hr){o&&o.active&&o.effects.push(r)}const _l=r=>{const o=new Set(r);return o.w=0,o.n=0,o},a_=r=>(r.w&Nn)>0,o_=r=>(r.n&Nn)>0,Tp=({deps:r})=>{if(r.length)for(let o=0;o<r.length;o++)r[o].w|=Nn},Mp=r=>{const{deps:o}=r;if(o.length){let i=0;for(let t=0;t<o.length;t++){const e=o[t];a_(e)&&!o_(e)?e.delete(r):o[i++]=e,e.w&=~Nn,e.n&=~Nn}o.length=i}},Is=new WeakMap;let ma=0,Nn=1;const zs=30;let Mr;const _i=Symbol(""),Ds=Symbol("");class vl{constructor(o,i=null,t){this.fn=o,this.scheduler=i,this.active=!0,this.deps=[],this.parent=void 0,Pp(this,t)}run(){if(!this.active)return this.fn();let o=Mr,i=zn;for(;o;){if(o===this)return;o=o.parent}try{return this.parent=Mr,Mr=this,zn=!0,Nn=1<<++ma,ma<=zs?Tp(this):ac(this),this.fn()}finally{ma<=zs&&Mp(this),Nn=1<<--ma,Mr=this.parent,zn=i,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Mr===this?this.deferStop=!0:this.active&&(ac(this),this.onStop&&this.onStop(),this.active=!1)}}function ac(r){const{deps:o}=r;if(o.length){for(let i=0;i<o.length;i++)o[i].delete(r);o.length=0}}let zn=!0;const s_=[];function oa(){s_.push(zn),zn=!1}function sa(){const r=s_.pop();zn=r===void 0?!0:r}function ir(r,o,i){if(zn&&Mr){let t=Is.get(r);t||Is.set(r,t=new Map);let e=t.get(i);e||t.set(i,e=_l()),l_(e)}}function l_(r,o){let i=!1;ma<=zs?o_(r)||(r.n|=Nn,i=!a_(r)):i=!r.has(Mr),i&&(r.add(Mr),Mr.deps.push(r))}function fn(r,o,i,t,e,n){const a=Is.get(r);if(!a)return;let s=[];if(o==="clear")s=[...a.values()];else if(i==="length"&&Ee(r))a.forEach((l,c)=>{(c==="length"||c>=t)&&s.push(l)});else switch(i!==void 0&&s.push(a.get(i)),o){case"add":Ee(r)?dl(i)&&s.push(a.get("length")):(s.push(a.get(_i)),ba(r)&&s.push(a.get(Ds)));break;case"delete":Ee(r)||(s.push(a.get(_i)),ba(r)&&s.push(a.get(Ds)));break;case"set":ba(r)&&s.push(a.get(_i));break}if(s.length===1)s[0]&&Ls(s[0]);else{const l=[];for(const c of s)c&&l.push(...c);Ls(_l(l))}}function Ls(r,o){const i=Ee(r)?r:[...r];for(const t of i)t.computed&&oc(t);for(const t of i)t.computed||oc(t)}function oc(r,o){(r!==Mr||r.allowRecurse)&&(r.scheduler?r.scheduler():r.run())}const Ep=ll("__proto__,__v_isRef,__isVue"),c_=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(fl)),Rp=pl(),Fp=pl(!1,!0),Bp=pl(!0),sc=Ip();function Ip(){const r={};return["includes","indexOf","lastIndexOf"].forEach(o=>{r[o]=function(...i){const t=je(this);for(let n=0,a=this.length;n<a;n++)ir(t,"get",n+"");const e=t[o](...i);return e===-1||e===!1?t[o](...i.map(je)):e}}),["push","pop","shift","unshift","splice"].forEach(o=>{r[o]=function(...i){oa();const t=je(this)[o].apply(this,i);return sa(),t}}),r}function pl(r=!1,o=!1){return function(t,e,n){if(e==="__v_isReactive")return!r;if(e==="__v_isReadonly")return r;if(e==="__v_isShallow")return o;if(e==="__v_raw"&&n===(r?o?Yp:__:o?d_:f_).get(t))return t;const a=Ee(t);if(!r&&a&&Ue(sc,e))return Reflect.get(sc,e,n);const s=Reflect.get(t,e,n);return(fl(e)?c_.has(e):Ep(e))||(r||ir(t,"get",e),o)?s:Ct(s)?a&&dl(e)?s:s.value:ot(s)?r?v_(s):Un(s):s}}const zp=u_(),Dp=u_(!0);function u_(r=!1){return function(i,t,e,n){let a=i[t];if($i(a)&&Ct(a)&&!Ct(e))return!1;if(!r&&(!wo(e)&&!$i(e)&&(a=je(a),e=je(e)),!Ee(i)&&Ct(a)&&!Ct(e)))return a.value=e,!0;const s=Ee(i)&&dl(t)?Number(t)<i.length:Ue(i,t),l=Reflect.set(i,t,e,n);return i===je(n)&&(s?Ra(e,a)&&fn(i,"set",t,e):fn(i,"add",t,e)),l}}function Lp(r,o){const i=Ue(r,o);r[o];const t=Reflect.deleteProperty(r,o);return t&&i&&fn(r,"delete",o,void 0),t}function Op(r,o){const i=Reflect.has(r,o);return(!fl(o)||!c_.has(o))&&ir(r,"has",o),i}function Np(r){return ir(r,"iterate",Ee(r)?"length":_i),Reflect.ownKeys(r)}const h_={get:Rp,set:zp,deleteProperty:Lp,has:Op,ownKeys:Np},Up={get:Bp,set(r,o){return!0},deleteProperty(r,o){return!0}},Vp=Ft({},h_,{get:Fp,set:Dp}),gl=r=>r,ko=r=>Reflect.getPrototypeOf(r);function Ka(r,o,i=!1,t=!1){r=r.__v_raw;const e=je(r),n=je(o);i||(o!==n&&ir(e,"get",o),ir(e,"get",n));const{has:a}=ko(e),s=t?gl:i?xl:Fa;if(a.call(e,o))return s(r.get(o));if(a.call(e,n))return s(r.get(n));r!==e&&r.get(o)}function Za(r,o=!1){const i=this.__v_raw,t=je(i),e=je(r);return o||(r!==e&&ir(t,"has",r),ir(t,"has",e)),r===e?i.has(r):i.has(r)||i.has(e)}function eo(r,o=!1){return r=r.__v_raw,!o&&ir(je(r),"iterate",_i),Reflect.get(r,"size",r)}function lc(r){r=je(r);const o=je(this);return ko(o).has.call(o,r)||(o.add(r),fn(o,"add",r,r)),this}function cc(r,o){o=je(o);const i=je(this),{has:t,get:e}=ko(i);let n=t.call(i,r);n||(r=je(r),n=t.call(i,r));const a=e.call(i,r);return i.set(r,o),n?Ra(o,a)&&fn(i,"set",r,o):fn(i,"add",r,o),this}function uc(r){const o=je(this),{has:i,get:t}=ko(o);let e=i.call(o,r);e||(r=je(r),e=i.call(o,r)),t&&t.call(o,r);const n=o.delete(r);return e&&fn(o,"delete",r,void 0),n}function hc(){const r=je(this),o=r.size!==0,i=r.clear();return o&&fn(r,"clear",void 0,void 0),i}function to(r,o){return function(t,e){const n=this,a=n.__v_raw,s=je(a),l=o?gl:r?xl:Fa;return!r&&ir(s,"iterate",_i),a.forEach((c,u)=>t.call(e,l(c),l(u),n))}}function ro(r,o,i){return function(...t){const e=this.__v_raw,n=je(e),a=ba(n),s=r==="entries"||r===Symbol.iterator&&a,l=r==="keys"&&a,c=e[r](...t),u=i?gl:o?xl:Fa;return!o&&ir(n,"iterate",l?Ds:_i),{next(){const{value:h,done:f}=c.next();return f?{value:h,done:f}:{value:s?[u(h[0]),u(h[1])]:u(h),done:f}},[Symbol.iterator](){return this}}}}function bn(r){return function(...o){return r==="delete"?!1:this}}function kp(){const r={get(n){return Ka(this,n)},get size(){return eo(this)},has:Za,add:lc,set:cc,delete:uc,clear:hc,forEach:to(!1,!1)},o={get(n){return Ka(this,n,!1,!0)},get size(){return eo(this)},has:Za,add:lc,set:cc,delete:uc,clear:hc,forEach:to(!1,!0)},i={get(n){return Ka(this,n,!0)},get size(){return eo(this,!0)},has(n){return Za.call(this,n,!0)},add:bn("add"),set:bn("set"),delete:bn("delete"),clear:bn("clear"),forEach:to(!0,!1)},t={get(n){return Ka(this,n,!0,!0)},get size(){return eo(this,!0)},has(n){return Za.call(this,n,!0)},add:bn("add"),set:bn("set"),delete:bn("delete"),clear:bn("clear"),forEach:to(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(n=>{r[n]=ro(n,!1,!1),i[n]=ro(n,!0,!1),o[n]=ro(n,!1,!0),t[n]=ro(n,!0,!0)}),[r,i,o,t]}const[Gp,Hp,Wp,Xp]=kp();function ml(r,o){const i=o?r?Xp:Wp:r?Hp:Gp;return(t,e,n)=>e==="__v_isReactive"?!r:e==="__v_isReadonly"?r:e==="__v_raw"?t:Reflect.get(Ue(i,e)&&e in t?i:t,e,n)}const jp={get:ml(!1,!1)},$p={get:ml(!1,!0)},qp={get:ml(!0,!1)},f_=new WeakMap,d_=new WeakMap,__=new WeakMap,Yp=new WeakMap;function Qp(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Jp(r){return r.__v_skip||!Object.isExtensible(r)?0:Qp(yp(r))}function Un(r){return $i(r)?r:yl(r,!1,h_,jp,f_)}function Kp(r){return yl(r,!1,Vp,$p,d_)}function v_(r){return yl(r,!0,Up,qp,__)}function yl(r,o,i,t,e){if(!ot(r)||r.__v_raw&&!(o&&r.__v_isReactive))return r;const n=e.get(r);if(n)return n;const a=Jp(r);if(a===0)return r;const s=new Proxy(r,a===2?t:i);return e.set(r,s),s}function Ui(r){return $i(r)?Ui(r.__v_raw):!!(r&&r.__v_isReactive)}function $i(r){return!!(r&&r.__v_isReadonly)}function wo(r){return!!(r&&r.__v_isShallow)}function p_(r){return Ui(r)||$i(r)}function je(r){const o=r&&r.__v_raw;return o?je(o):r}function g_(r){return xo(r,"__v_skip",!0),r}const Fa=r=>ot(r)?Un(r):r,xl=r=>ot(r)?v_(r):r;function m_(r){zn&&Mr&&(r=je(r),l_(r.dep||(r.dep=_l())))}function y_(r,o){r=je(r),r.dep&&Ls(r.dep)}function Ct(r){return!!(r&&r.__v_isRef===!0)}function Mt(r){return Zp(r,!1)}function Zp(r,o){return Ct(r)?r:new eg(r,o)}class eg{constructor(o,i){this.__v_isShallow=i,this.dep=void 0,this.__v_isRef=!0,this._rawValue=i?o:je(o),this._value=i?o:Fa(o)}get value(){return m_(this),this._value}set value(o){const i=this.__v_isShallow||wo(o)||$i(o);o=i?o:je(o),Ra(o,this._rawValue)&&(this._rawValue=o,this._value=i?o:Fa(o),y_(this))}}function qi(r){return Ct(r)?r.value:r}const tg={get:(r,o,i)=>qi(Reflect.get(r,o,i)),set:(r,o,i,t)=>{const e=r[o];return Ct(e)&&!Ct(i)?(e.value=i,!0):Reflect.set(r,o,i,t)}};function x_(r){return Ui(r)?r:new Proxy(r,tg)}var w_;class rg{constructor(o,i,t,e){this._setter=i,this.dep=void 0,this.__v_isRef=!0,this[w_]=!1,this._dirty=!0,this.effect=new vl(o,()=>{this._dirty||(this._dirty=!0,y_(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!e,this.__v_isReadonly=t}get value(){const o=je(this);return m_(o),(o._dirty||!o._cacheable)&&(o._dirty=!1,o._value=o.effect.run()),o._value}set value(o){this._setter(o)}}w_="__v_isReadonly";function ng(r,o,i=!1){let t,e;const n=Be(r);return n?(t=r,e=zr):(t=r.get,e=r.set),new rg(t,e,n||!e,i)}function Dn(r,o,i,t){let e;try{e=t?r(...t):r()}catch(n){Go(n,o,i)}return e}function vr(r,o,i,t){if(Be(r)){const n=Dn(r,o,i,t);return n&&n_(n)&&n.catch(a=>{Go(a,o,i)}),n}const e=[];for(let n=0;n<r.length;n++)e.push(vr(r[n],o,i,t));return e}function Go(r,o,i,t=!0){const e=o?o.vnode:null;if(o){let n=o.parent;const a=o.proxy,s=i;for(;n;){const c=n.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](r,a,s)===!1)return}n=n.parent}const l=o.appContext.config.errorHandler;if(l){Dn(l,null,10,[r,a,s]);return}}ig(r,i,e,t)}function ig(r,o,i,t=!0){console.error(r)}let Ba=!1,Os=!1;const Et=[];let $r=0;const Vi=[];let an=null,ri=0;const b_=Promise.resolve();let wl=null;function Fi(r){const o=wl||b_;return r?o.then(this?r.bind(this):r):o}function ag(r){let o=$r+1,i=Et.length;for(;o<i;){const t=o+i>>>1;Ia(Et[t])<r?o=t+1:i=t}return o}function bl(r){(!Et.length||!Et.includes(r,Ba&&r.allowRecurse?$r+1:$r))&&(r.id==null?Et.push(r):Et.splice(ag(r.id),0,r),S_())}function S_(){!Ba&&!Os&&(Os=!0,wl=b_.then(A_))}function og(r){const o=Et.indexOf(r);o>$r&&Et.splice(o,1)}function sg(r){Ee(r)?Vi.push(...r):(!an||!an.includes(r,r.allowRecurse?ri+1:ri))&&Vi.push(r),S_()}function fc(r,o=Ba?$r+1:0){for(;o<Et.length;o++){const i=Et[o];i&&i.pre&&(Et.splice(o,1),o--,i())}}function C_(r){if(Vi.length){const o=[...new Set(Vi)];if(Vi.length=0,an){an.push(...o);return}for(an=o,an.sort((i,t)=>Ia(i)-Ia(t)),ri=0;ri<an.length;ri++)an[ri]();an=null,ri=0}}const Ia=r=>r.id==null?1/0:r.id,lg=(r,o)=>{const i=Ia(r)-Ia(o);if(i===0){if(r.pre&&!o.pre)return-1;if(o.pre&&!r.pre)return 1}return i};function A_(r){Os=!1,Ba=!0,Et.sort(lg);const o=zr;try{for($r=0;$r<Et.length;$r++){const i=Et[$r];i&&i.active!==!1&&Dn(i,null,14)}}finally{$r=0,Et.length=0,C_(),Ba=!1,wl=null,(Et.length||Vi.length)&&A_()}}function cg(r,o,...i){if(r.isUnmounted)return;const t=r.vnode.props||Ke;let e=i;const n=o.startsWith("update:"),a=n&&o.slice(7);if(a&&a in t){const u=`${a==="modelValue"?"model":a}Modifiers`,{number:h,trim:f}=t[u]||Ke;f&&(e=i.map(d=>d.trim())),h&&(e=i.map(Sp))}let s,l=t[s=vs(o)]||t[s=vs(ji(o))];!l&&n&&(l=t[s=vs(aa(o))]),l&&vr(l,r,6,e);const c=t[s+"Once"];if(c){if(!r.emitted)r.emitted={};else if(r.emitted[s])return;r.emitted[s]=!0,vr(c,r,6,e)}}function P_(r,o,i=!1){const t=o.emitsCache,e=t.get(r);if(e!==void 0)return e;const n=r.emits;let a={},s=!1;if(!Be(r)){const l=c=>{const u=P_(c,o,!0);u&&(s=!0,Ft(a,u))};!i&&o.mixins.length&&o.mixins.forEach(l),r.extends&&l(r.extends),r.mixins&&r.mixins.forEach(l)}return!n&&!s?(ot(r)&&t.set(r,null),null):(Ee(n)?n.forEach(l=>a[l]=null):Ft(a,n),ot(r)&&t.set(r,a),a)}function Ho(r,o){return!r||!No(o)?!1:(o=o.slice(2).replace(/Once$/,""),Ue(r,o[0].toLowerCase()+o.slice(1))||Ue(r,aa(o))||Ue(r,o))}let qr=null,Wo=null;function bo(r){const o=qr;return qr=r,Wo=r&&r.type.__scopeId||null,o}function ug(r){Wo=r}function hg(){Wo=null}function ho(r,o=qr,i){if(!o||r._n)return r;const t=(...e)=>{t._d&&bc(-1);const n=bo(o);let a;try{a=r(...e)}finally{bo(n),t._d&&bc(1)}return a};return t._n=!0,t._c=!0,t._d=!0,t}function gs(r){const{type:o,vnode:i,proxy:t,withProxy:e,props:n,propsOptions:[a],slots:s,attrs:l,emit:c,render:u,renderCache:h,data:f,setupState:d,ctx:_,inheritAttrs:p}=r;let v,g;const m=bo(r);try{if(i.shapeFlag&4){const w=e||t;v=jr(u.call(w,w,h,n,d,f,_)),g=l}else{const w=o;v=jr(w.length>1?w(n,{attrs:l,slots:s,emit:c}):w(n,null)),g=o.props?l:fg(l)}}catch(w){Ca.length=0,Go(w,r,1),v=de(cn)}let x=v;if(g&&p!==!1){const w=Object.keys(g),{shapeFlag:C}=x;w.length&&C&7&&(a&&w.some(ul)&&(g=dg(g,a)),x=Vn(x,g))}return i.dirs&&(x=Vn(x),x.dirs=x.dirs?x.dirs.concat(i.dirs):i.dirs),i.transition&&(x.transition=i.transition),v=x,bo(m),v}const fg=r=>{let o;for(const i in r)(i==="class"||i==="style"||No(i))&&((o||(o={}))[i]=r[i]);return o},dg=(r,o)=>{const i={};for(const t in r)(!ul(t)||!(t.slice(9)in o))&&(i[t]=r[t]);return i};function _g(r,o,i){const{props:t,children:e,component:n}=r,{props:a,children:s,patchFlag:l}=o,c=n.emitsOptions;if(o.dirs||o.transition)return!0;if(i&&l>=0){if(l&1024)return!0;if(l&16)return t?dc(t,a,c):!!a;if(l&8){const u=o.dynamicProps;for(let h=0;h<u.length;h++){const f=u[h];if(a[f]!==t[f]&&!Ho(c,f))return!0}}}else return(e||s)&&(!s||!s.$stable)?!0:t===a?!1:t?a?dc(t,a,c):!0:!!a;return!1}function dc(r,o,i){const t=Object.keys(o);if(t.length!==Object.keys(r).length)return!0;for(let e=0;e<t.length;e++){const n=t[e];if(o[n]!==r[n]&&!Ho(i,n))return!0}return!1}function vg({vnode:r,parent:o},i){for(;o&&o.subTree===r;)(r=o.vnode).el=i,o=o.parent}const pg=r=>r.__isSuspense;function gg(r,o){o&&o.pendingBranch?Ee(r)?o.effects.push(...r):o.effects.push(r):sg(r)}function Xo(r,o){if(bt){let i=bt.provides;const t=bt.parent&&bt.parent.provides;t===i&&(i=bt.provides=Object.create(t)),i[r]=o}}function Sa(r,o,i=!1){const t=bt||qr;if(t){const e=t.parent==null?t.vnode.appContext&&t.vnode.appContext.provides:t.parent.provides;if(e&&r in e)return e[r];if(arguments.length>1)return i&&Be(o)?o.call(t.proxy):o}}function mg(r,o){return Sl(r,null,o)}const _c={};function ki(r,o,i){return Sl(r,o,i)}function Sl(r,o,{immediate:i,deep:t,flush:e,onTrack:n,onTrigger:a}=Ke){const s=bt;let l,c=!1,u=!1;if(Ct(r)?(l=()=>r.value,c=wo(r)):Ui(r)?(l=()=>r,t=!0):Ee(r)?(u=!0,c=r.some(g=>Ui(g)||wo(g)),l=()=>r.map(g=>{if(Ct(g))return g.value;if(Ui(g))return Bi(g);if(Be(g))return Dn(g,s,2)})):Be(r)?o?l=()=>Dn(r,s,2):l=()=>{if(!(s&&s.isUnmounted))return h&&h(),vr(r,s,3,[f])}:l=zr,o&&t){const g=l;l=()=>Bi(g())}let h,f=g=>{h=v.onStop=()=>{Dn(g,s,4)}};if(Da)return f=zr,o?i&&vr(o,s,3,[l(),u?[]:void 0,f]):l(),zr;let d=u?[]:_c;const _=()=>{if(!!v.active)if(o){const g=v.run();(t||c||(u?g.some((m,x)=>Ra(m,d[x])):Ra(g,d)))&&(h&&h(),vr(o,s,3,[g,d===_c?void 0:d,f]),d=g)}else v.run()};_.allowRecurse=!!o;let p;e==="sync"?p=_:e==="post"?p=()=>Xt(_,s&&s.suspense):(_.pre=!0,s&&(_.id=s.uid),p=()=>bl(_));const v=new vl(l,p);return o?i?_():d=v.run():e==="post"?Xt(v.run.bind(v),s&&s.suspense):v.run(),()=>{v.stop(),s&&s.scope&&hl(s.scope.effects,v)}}function yg(r,o,i){const t=this.proxy,e=At(r)?r.includes(".")?T_(t,r):()=>t[r]:r.bind(t,t);let n;Be(o)?n=o:(n=o.handler,i=o);const a=bt;Ji(this);const s=Sl(e,n.bind(t),i);return a?Ji(a):vi(),s}function T_(r,o){const i=o.split(".");return()=>{let t=r;for(let e=0;e<i.length&&t;e++)t=t[i[e]];return t}}function Bi(r,o){if(!ot(r)||r.__v_skip||(o=o||new Set,o.has(r)))return r;if(o.add(r),Ct(r))Bi(r.value,o);else if(Ee(r))for(let i=0;i<r.length;i++)Bi(r[i],o);else if(gp(r)||ba(r))r.forEach(i=>{Bi(i,o)});else if(xp(r))for(const i in r)Bi(r[i],o);return r}function xg(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Si(()=>{r.isMounted=!0}),I_(()=>{r.isUnmounting=!0}),r}const sr=[Function,Array],wg={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:sr,onEnter:sr,onAfterEnter:sr,onEnterCancelled:sr,onBeforeLeave:sr,onLeave:sr,onAfterLeave:sr,onLeaveCancelled:sr,onBeforeAppear:sr,onAppear:sr,onAfterAppear:sr,onAppearCancelled:sr},setup(r,{slots:o}){const i=la(),t=xg();let e;return()=>{const n=o.default&&E_(o.default(),!0);if(!n||!n.length)return;let a=n[0];if(n.length>1){for(const p of n)if(p.type!==cn){a=p;break}}const s=je(r),{mode:l}=s;if(t.isLeaving)return ms(a);const c=vc(a);if(!c)return ms(a);const u=Ns(c,s,t,i);Us(c,u);const h=i.subTree,f=h&&vc(h);let d=!1;const{getTransitionKey:_}=c.type;if(_){const p=_();e===void 0?e=p:p!==e&&(e=p,d=!0)}if(f&&f.type!==cn&&(!ni(c,f)||d)){const p=Ns(f,s,t,i);if(Us(f,p),l==="out-in")return t.isLeaving=!0,p.afterLeave=()=>{t.isLeaving=!1,i.update()},ms(a);l==="in-out"&&c.type!==cn&&(p.delayLeave=(v,g,m)=>{const x=M_(t,f);x[String(f.key)]=f,v._leaveCb=()=>{g(),v._leaveCb=void 0,delete u.delayedLeave},u.delayedLeave=m})}return a}}},bg=wg;function M_(r,o){const{leavingVNodes:i}=r;let t=i.get(o.type);return t||(t=Object.create(null),i.set(o.type,t)),t}function Ns(r,o,i,t){const{appear:e,mode:n,persisted:a=!1,onBeforeEnter:s,onEnter:l,onAfterEnter:c,onEnterCancelled:u,onBeforeLeave:h,onLeave:f,onAfterLeave:d,onLeaveCancelled:_,onBeforeAppear:p,onAppear:v,onAfterAppear:g,onAppearCancelled:m}=o,x=String(r.key),w=M_(i,r),C=(M,I)=>{M&&vr(M,t,9,I)},T=(M,I)=>{const E=I[1];C(M,I),Ee(M)?M.every(B=>B.length<=1)&&E():M.length<=1&&E()},b={mode:n,persisted:a,beforeEnter(M){let I=s;if(!i.isMounted)if(e)I=p||s;else return;M._leaveCb&&M._leaveCb(!0);const E=w[x];E&&ni(r,E)&&E.el._leaveCb&&E.el._leaveCb(),C(I,[M])},enter(M){let I=l,E=c,B=u;if(!i.isMounted)if(e)I=v||l,E=g||c,B=m||u;else return;let S=!1;const A=M._enterCb=R=>{S||(S=!0,R?C(B,[M]):C(E,[M]),b.delayedLeave&&b.delayedLeave(),M._enterCb=void 0)};I?T(I,[M,A]):A()},leave(M,I){const E=String(r.key);if(M._enterCb&&M._enterCb(!0),i.isUnmounting)return I();C(h,[M]);let B=!1;const S=M._leaveCb=A=>{B||(B=!0,I(),A?C(_,[M]):C(d,[M]),M._leaveCb=void 0,w[E]===r&&delete w[E])};w[E]=r,f?T(f,[M,S]):S()},clone(M){return Ns(M,o,i,t)}};return b}function ms(r){if(jo(r))return r=Vn(r),r.children=null,r}function vc(r){return jo(r)?r.children?r.children[0]:void 0:r}function Us(r,o){r.shapeFlag&6&&r.component?Us(r.component.subTree,o):r.shapeFlag&128?(r.ssContent.transition=o.clone(r.ssContent),r.ssFallback.transition=o.clone(r.ssFallback)):r.transition=o}function E_(r,o=!1,i){let t=[],e=0;for(let n=0;n<r.length;n++){let a=r[n];const s=i==null?a.key:String(i)+String(a.key!=null?a.key:n);a.type===hr?(a.patchFlag&128&&e++,t=t.concat(E_(a.children,o,s))):(o||a.type!==cn)&&t.push(s!=null?Vn(a,{key:s}):a)}if(e>1)for(let n=0;n<t.length;n++)t[n].patchFlag=-2;return t}function Qt(r){return Be(r)?{setup:r,name:r.name}:r}const fo=r=>!!r.type.__asyncLoader,jo=r=>r.type.__isKeepAlive;function R_(r,o){B_(r,"a",o)}function F_(r,o){B_(r,"da",o)}function B_(r,o,i=bt){const t=r.__wdc||(r.__wdc=()=>{let e=i;for(;e;){if(e.isDeactivated)return;e=e.parent}return r()});if($o(o,t,i),i){let e=i.parent;for(;e&&e.parent;)jo(e.parent.vnode)&&Sg(t,o,i,e),e=e.parent}}function Sg(r,o,i,t){const e=$o(o,r,t,!0);qo(()=>{hl(t[o],e)},i)}function $o(r,o,i=bt,t=!1){if(i){const e=i[r]||(i[r]=[]),n=o.__weh||(o.__weh=(...a)=>{if(i.isUnmounted)return;oa(),Ji(i);const s=vr(o,i,r,a);return vi(),sa(),s});return t?e.unshift(n):e.push(n),n}}const _n=r=>(o,i=bt)=>(!Da||r==="sp")&&$o(r,(...t)=>o(...t),i),Cg=_n("bm"),Si=_n("m"),Ag=_n("bu"),Pg=_n("u"),I_=_n("bum"),qo=_n("um"),Tg=_n("sp"),Mg=_n("rtg"),Eg=_n("rtc");function Rg(r,o=bt){$o("ec",r,o)}function Wn(r,o,i,t){const e=r.dirs,n=o&&o.dirs;for(let a=0;a<e.length;a++){const s=e[a];n&&(s.oldValue=n[a].value);let l=s.dir[t];l&&(oa(),vr(l,i,8,[r.el,s,r,o]),sa())}}const Fg=Symbol();function Bg(r,o,i,t){let e;const n=i&&i[t];if(Ee(r)||At(r)){e=new Array(r.length);for(let a=0,s=r.length;a<s;a++)e[a]=o(r[a],a,void 0,n&&n[a])}else if(typeof r=="number"){e=new Array(r);for(let a=0;a<r;a++)e[a]=o(a+1,a,void 0,n&&n[a])}else if(ot(r))if(r[Symbol.iterator])e=Array.from(r,(a,s)=>o(a,s,void 0,n&&n[s]));else{const a=Object.keys(r);e=new Array(a.length);for(let s=0,l=a.length;s<l;s++){const c=a[s];e[s]=o(r[c],c,s,n&&n[s])}}else e=[];return i&&(i[t]=e),e}const Vs=r=>r?W_(r)?El(r)||r.proxy:Vs(r.parent):null,So=Ft(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>Vs(r.parent),$root:r=>Vs(r.root),$emit:r=>r.emit,$options:r=>Cl(r),$forceUpdate:r=>r.f||(r.f=()=>bl(r.update)),$nextTick:r=>r.n||(r.n=Fi.bind(r.proxy)),$watch:r=>yg.bind(r)}),Ig={get({_:r},o){const{ctx:i,setupState:t,data:e,props:n,accessCache:a,type:s,appContext:l}=r;let c;if(o[0]!=="$"){const d=a[o];if(d!==void 0)switch(d){case 1:return t[o];case 2:return e[o];case 4:return i[o];case 3:return n[o]}else{if(t!==Ke&&Ue(t,o))return a[o]=1,t[o];if(e!==Ke&&Ue(e,o))return a[o]=2,e[o];if((c=r.propsOptions[0])&&Ue(c,o))return a[o]=3,n[o];if(i!==Ke&&Ue(i,o))return a[o]=4,i[o];ks&&(a[o]=0)}}const u=So[o];let h,f;if(u)return o==="$attrs"&&ir(r,"get",o),u(r);if((h=s.__cssModules)&&(h=h[o]))return h;if(i!==Ke&&Ue(i,o))return a[o]=4,i[o];if(f=l.config.globalProperties,Ue(f,o))return f[o]},set({_:r},o,i){const{data:t,setupState:e,ctx:n}=r;return e!==Ke&&Ue(e,o)?(e[o]=i,!0):t!==Ke&&Ue(t,o)?(t[o]=i,!0):Ue(r.props,o)||o[0]==="$"&&o.slice(1)in r?!1:(n[o]=i,!0)},has({_:{data:r,setupState:o,accessCache:i,ctx:t,appContext:e,propsOptions:n}},a){let s;return!!i[a]||r!==Ke&&Ue(r,a)||o!==Ke&&Ue(o,a)||(s=n[0])&&Ue(s,a)||Ue(t,a)||Ue(So,a)||Ue(e.config.globalProperties,a)},defineProperty(r,o,i){return i.get!=null?r._.accessCache[o]=0:Ue(i,"value")&&this.set(r,o,i.value,null),Reflect.defineProperty(r,o,i)}};let ks=!0;function zg(r){const o=Cl(r),i=r.proxy,t=r.ctx;ks=!1,o.beforeCreate&&pc(o.beforeCreate,r,"bc");const{data:e,computed:n,methods:a,watch:s,provide:l,inject:c,created:u,beforeMount:h,mounted:f,beforeUpdate:d,updated:_,activated:p,deactivated:v,beforeDestroy:g,beforeUnmount:m,destroyed:x,unmounted:w,render:C,renderTracked:T,renderTriggered:b,errorCaptured:M,serverPrefetch:I,expose:E,inheritAttrs:B,components:S,directives:A,filters:R}=o;if(c&&Dg(c,t,null,r.appContext.config.unwrapInjectedRef),a)for(const U in a){const V=a[U];Be(V)&&(t[U]=V.bind(i))}if(e){const U=e.call(i,i);ot(U)&&(r.data=Un(U))}if(ks=!0,n)for(const U in n){const V=n[U],L=Be(V)?V.bind(i,i):Be(V.get)?V.get.bind(i,i):zr,J=!Be(V)&&Be(V.set)?V.set.bind(i):zr,oe=Er({get:L,set:J});Object.defineProperty(t,U,{enumerable:!0,configurable:!0,get:()=>oe.value,set:le=>oe.value=le})}if(s)for(const U in s)z_(s[U],t,i,U);if(l){const U=Be(l)?l.call(i):l;Reflect.ownKeys(U).forEach(V=>{Xo(V,U[V])})}u&&pc(u,r,"c");function z(U,V){Ee(V)?V.forEach(L=>U(L.bind(i))):V&&U(V.bind(i))}if(z(Cg,h),z(Si,f),z(Ag,d),z(Pg,_),z(R_,p),z(F_,v),z(Rg,M),z(Eg,T),z(Mg,b),z(I_,m),z(qo,w),z(Tg,I),Ee(E))if(E.length){const U=r.exposed||(r.exposed={});E.forEach(V=>{Object.defineProperty(U,V,{get:()=>i[V],set:L=>i[V]=L})})}else r.exposed||(r.exposed={});C&&r.render===zr&&(r.render=C),B!=null&&(r.inheritAttrs=B),S&&(r.components=S),A&&(r.directives=A)}function Dg(r,o,i=zr,t=!1){Ee(r)&&(r=Gs(r));for(const e in r){const n=r[e];let a;ot(n)?"default"in n?a=Sa(n.from||e,n.default,!0):a=Sa(n.from||e):a=Sa(n),Ct(a)&&t?Object.defineProperty(o,e,{enumerable:!0,configurable:!0,get:()=>a.value,set:s=>a.value=s}):o[e]=a}}function pc(r,o,i){vr(Ee(r)?r.map(t=>t.bind(o.proxy)):r.bind(o.proxy),o,i)}function z_(r,o,i,t){const e=t.includes(".")?T_(i,t):()=>i[t];if(At(r)){const n=o[r];Be(n)&&ki(e,n)}else if(Be(r))ki(e,r.bind(i));else if(ot(r))if(Ee(r))r.forEach(n=>z_(n,o,i,t));else{const n=Be(r.handler)?r.handler.bind(i):o[r.handler];Be(n)&&ki(e,n,r)}}function Cl(r){const o=r.type,{mixins:i,extends:t}=o,{mixins:e,optionsCache:n,config:{optionMergeStrategies:a}}=r.appContext,s=n.get(o);let l;return s?l=s:!e.length&&!i&&!t?l=o:(l={},e.length&&e.forEach(c=>Co(l,c,a,!0)),Co(l,o,a)),ot(o)&&n.set(o,l),l}function Co(r,o,i,t=!1){const{mixins:e,extends:n}=o;n&&Co(r,n,i,!0),e&&e.forEach(a=>Co(r,a,i,!0));for(const a in o)if(!(t&&a==="expose")){const s=Lg[a]||i&&i[a];r[a]=s?s(r[a],o[a]):o[a]}return r}const Lg={data:gc,props:Kn,emits:Kn,methods:Kn,computed:Kn,beforeCreate:Dt,created:Dt,beforeMount:Dt,mounted:Dt,beforeUpdate:Dt,updated:Dt,beforeDestroy:Dt,beforeUnmount:Dt,destroyed:Dt,unmounted:Dt,activated:Dt,deactivated:Dt,errorCaptured:Dt,serverPrefetch:Dt,components:Kn,directives:Kn,watch:Ng,provide:gc,inject:Og};function gc(r,o){return o?r?function(){return Ft(Be(r)?r.call(this,this):r,Be(o)?o.call(this,this):o)}:o:r}function Og(r,o){return Kn(Gs(r),Gs(o))}function Gs(r){if(Ee(r)){const o={};for(let i=0;i<r.length;i++)o[r[i]]=r[i];return o}return r}function Dt(r,o){return r?[...new Set([].concat(r,o))]:o}function Kn(r,o){return r?Ft(Ft(Object.create(null),r),o):o}function Ng(r,o){if(!r)return o;if(!o)return r;const i=Ft(Object.create(null),r);for(const t in o)i[t]=Dt(r[t],o[t]);return i}function Ug(r,o,i,t=!1){const e={},n={};xo(n,Yo,1),r.propsDefaults=Object.create(null),D_(r,o,e,n);for(const a in r.propsOptions[0])a in e||(e[a]=void 0);i?r.props=t?e:Kp(e):r.type.props?r.props=e:r.props=n,r.attrs=n}function Vg(r,o,i,t){const{props:e,attrs:n,vnode:{patchFlag:a}}=r,s=je(e),[l]=r.propsOptions;let c=!1;if((t||a>0)&&!(a&16)){if(a&8){const u=r.vnode.dynamicProps;for(let h=0;h<u.length;h++){let f=u[h];if(Ho(r.emitsOptions,f))continue;const d=o[f];if(l)if(Ue(n,f))d!==n[f]&&(n[f]=d,c=!0);else{const _=ji(f);e[_]=Hs(l,s,_,d,r,!1)}else d!==n[f]&&(n[f]=d,c=!0)}}}else{D_(r,o,e,n)&&(c=!0);let u;for(const h in s)(!o||!Ue(o,h)&&((u=aa(h))===h||!Ue(o,u)))&&(l?i&&(i[h]!==void 0||i[u]!==void 0)&&(e[h]=Hs(l,s,h,void 0,r,!0)):delete e[h]);if(n!==s)for(const h in n)(!o||!Ue(o,h)&&!0)&&(delete n[h],c=!0)}c&&fn(r,"set","$attrs")}function D_(r,o,i,t){const[e,n]=r.propsOptions;let a=!1,s;if(o)for(let l in o){if(uo(l))continue;const c=o[l];let u;e&&Ue(e,u=ji(l))?!n||!n.includes(u)?i[u]=c:(s||(s={}))[u]=c:Ho(r.emitsOptions,l)||(!(l in t)||c!==t[l])&&(t[l]=c,a=!0)}if(n){const l=je(i),c=s||Ke;for(let u=0;u<n.length;u++){const h=n[u];i[h]=Hs(e,l,h,c[h],r,!Ue(c,h))}}return a}function Hs(r,o,i,t,e,n){const a=r[i];if(a!=null){const s=Ue(a,"default");if(s&&t===void 0){const l=a.default;if(a.type!==Function&&Be(l)){const{propsDefaults:c}=e;i in c?t=c[i]:(Ji(e),t=c[i]=l.call(null,o),vi())}else t=l}a[0]&&(n&&!s?t=!1:a[1]&&(t===""||t===aa(i))&&(t=!0))}return t}function L_(r,o,i=!1){const t=o.propsCache,e=t.get(r);if(e)return e;const n=r.props,a={},s=[];let l=!1;if(!Be(r)){const u=h=>{l=!0;const[f,d]=L_(h,o,!0);Ft(a,f),d&&s.push(...d)};!i&&o.mixins.length&&o.mixins.forEach(u),r.extends&&u(r.extends),r.mixins&&r.mixins.forEach(u)}if(!n&&!l)return ot(r)&&t.set(r,Ni),Ni;if(Ee(n))for(let u=0;u<n.length;u++){const h=ji(n[u]);mc(h)&&(a[h]=Ke)}else if(n)for(const u in n){const h=ji(u);if(mc(h)){const f=n[u],d=a[h]=Ee(f)||Be(f)?{type:f}:f;if(d){const _=wc(Boolean,d.type),p=wc(String,d.type);d[0]=_>-1,d[1]=p<0||_<p,(_>-1||Ue(d,"default"))&&s.push(h)}}}const c=[a,s];return ot(r)&&t.set(r,c),c}function mc(r){return r[0]!=="$"}function yc(r){const o=r&&r.toString().match(/^\s*function (\w+)/);return o?o[1]:r===null?"null":""}function xc(r,o){return yc(r)===yc(o)}function wc(r,o){return Ee(o)?o.findIndex(i=>xc(i,r)):Be(o)&&xc(o,r)?0:-1}const O_=r=>r[0]==="_"||r==="$stable",Al=r=>Ee(r)?r.map(jr):[jr(r)],kg=(r,o,i)=>{if(o._n)return o;const t=ho((...e)=>Al(o(...e)),i);return t._c=!1,t},N_=(r,o,i)=>{const t=r._ctx;for(const e in r){if(O_(e))continue;const n=r[e];if(Be(n))o[e]=kg(e,n,t);else if(n!=null){const a=Al(n);o[e]=()=>a}}},U_=(r,o)=>{const i=Al(o);r.slots.default=()=>i},Gg=(r,o)=>{if(r.vnode.shapeFlag&32){const i=o._;i?(r.slots=je(o),xo(o,"_",i)):N_(o,r.slots={})}else r.slots={},o&&U_(r,o);xo(r.slots,Yo,1)},Hg=(r,o,i)=>{const{vnode:t,slots:e}=r;let n=!0,a=Ke;if(t.shapeFlag&32){const s=o._;s?i&&s===1?n=!1:(Ft(e,o),!i&&s===1&&delete e._):(n=!o.$stable,N_(o,e)),a=o}else o&&(U_(r,o),a={default:1});if(n)for(const s in e)!O_(s)&&!(s in a)&&delete e[s]};function V_(){return{app:null,config:{isNativeTag:_p,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Wg=0;function Xg(r,o){return function(t,e=null){Be(t)||(t=Object.assign({},t)),e!=null&&!ot(e)&&(e=null);const n=V_(),a=new Set;let s=!1;const l=n.app={_uid:Wg++,_component:t,_props:e,_container:null,_context:n,_instance:null,version:c0,get config(){return n.config},set config(c){},use(c,...u){return a.has(c)||(c&&Be(c.install)?(a.add(c),c.install(l,...u)):Be(c)&&(a.add(c),c(l,...u))),l},mixin(c){return n.mixins.includes(c)||n.mixins.push(c),l},component(c,u){return u?(n.components[c]=u,l):n.components[c]},directive(c,u){return u?(n.directives[c]=u,l):n.directives[c]},mount(c,u,h){if(!s){const f=de(t,e);return f.appContext=n,u&&o?o(f,c):r(f,c,h),s=!0,l._container=c,c.__vue_app__=l,El(f.component)||f.component.proxy}},unmount(){s&&(r(null,l._container),delete l._container.__vue_app__)},provide(c,u){return n.provides[c]=u,l}};return l}}function Ws(r,o,i,t,e=!1){if(Ee(r)){r.forEach((f,d)=>Ws(f,o&&(Ee(o)?o[d]:o),i,t,e));return}if(fo(t)&&!e)return;const n=t.shapeFlag&4?El(t.component)||t.component.proxy:t.el,a=e?null:n,{i:s,r:l}=r,c=o&&o.r,u=s.refs===Ke?s.refs={}:s.refs,h=s.setupState;if(c!=null&&c!==l&&(At(c)?(u[c]=null,Ue(h,c)&&(h[c]=null)):Ct(c)&&(c.value=null)),Be(l))Dn(l,s,12,[a,u]);else{const f=At(l),d=Ct(l);if(f||d){const _=()=>{if(r.f){const p=f?Ue(h,l)?h[l]:u[l]:l.value;e?Ee(p)&&hl(p,n):Ee(p)?p.includes(n)||p.push(n):f?(u[l]=[n],Ue(h,l)&&(h[l]=u[l])):(l.value=[n],r.k&&(u[r.k]=l.value))}else f?(u[l]=a,Ue(h,l)&&(h[l]=a)):d&&(l.value=a,r.k&&(u[r.k]=a))};a?(_.id=-1,Xt(_,i)):_()}}}const Xt=gg;function jg(r){return $g(r)}function $g(r,o){const i=Cp();i.__VUE__=!0;const{insert:t,remove:e,patchProp:n,createElement:a,createText:s,createComment:l,setText:c,setElementText:u,parentNode:h,nextSibling:f,setScopeId:d=zr,insertStaticContent:_}=r,p=(P,F,O,W=null,H=null,Y=null,ee=!1,K=null,q=!!F.dynamicChildren)=>{if(P===F)return;P&&!ni(P,F)&&(W=ce(P),le(P,H,Y,!0),P=null),F.patchFlag===-2&&(q=!1,F.dynamicChildren=null);const{type:$,ref:_e,shapeFlag:ue}=F;switch($){case Pl:v(P,F,O,W);break;case cn:g(P,F,O,W);break;case _o:P==null&&m(F,O,W,ee);break;case hr:S(P,F,O,W,H,Y,ee,K,q);break;default:ue&1?C(P,F,O,W,H,Y,ee,K,q):ue&6?A(P,F,O,W,H,Y,ee,K,q):(ue&64||ue&128)&&$.process(P,F,O,W,H,Y,ee,K,q,Pe)}_e!=null&&H&&Ws(_e,P&&P.ref,Y,F||P,!F)},v=(P,F,O,W)=>{if(P==null)t(F.el=s(F.children),O,W);else{const H=F.el=P.el;F.children!==P.children&&c(H,F.children)}},g=(P,F,O,W)=>{P==null?t(F.el=l(F.children||""),O,W):F.el=P.el},m=(P,F,O,W)=>{[P.el,P.anchor]=_(P.children,F,O,W,P.el,P.anchor)},x=({el:P,anchor:F},O,W)=>{let H;for(;P&&P!==F;)H=f(P),t(P,O,W),P=H;t(F,O,W)},w=({el:P,anchor:F})=>{let O;for(;P&&P!==F;)O=f(P),e(P),P=O;e(F)},C=(P,F,O,W,H,Y,ee,K,q)=>{ee=ee||F.type==="svg",P==null?T(F,O,W,H,Y,ee,K,q):I(P,F,H,Y,ee,K,q)},T=(P,F,O,W,H,Y,ee,K)=>{let q,$;const{type:_e,props:ue,shapeFlag:ve,transition:ye,dirs:we}=P;if(q=P.el=a(P.type,Y,ue&&ue.is,ue),ve&8?u(q,P.children):ve&16&&M(P.children,q,null,W,H,Y&&_e!=="foreignObject",ee,K),we&&Wn(P,null,W,"created"),ue){for(const Oe in ue)Oe!=="value"&&!uo(Oe)&&n(q,Oe,null,ue[Oe],Y,P.children,W,H,G);"value"in ue&&n(q,"value",null,ue.value),($=ue.onVnodeBeforeMount)&&kr($,W,P)}b(q,P,P.scopeId,ee,W),we&&Wn(P,null,W,"beforeMount");const Ge=(!H||H&&!H.pendingBranch)&&ye&&!ye.persisted;Ge&&ye.beforeEnter(q),t(q,F,O),(($=ue&&ue.onVnodeMounted)||Ge||we)&&Xt(()=>{$&&kr($,W,P),Ge&&ye.enter(q),we&&Wn(P,null,W,"mounted")},H)},b=(P,F,O,W,H)=>{if(O&&d(P,O),W)for(let Y=0;Y<W.length;Y++)d(P,W[Y]);if(H){let Y=H.subTree;if(F===Y){const ee=H.vnode;b(P,ee,ee.scopeId,ee.slotScopeIds,H.parent)}}},M=(P,F,O,W,H,Y,ee,K,q=0)=>{for(let $=q;$<P.length;$++){const _e=P[$]=K?Mn(P[$]):jr(P[$]);p(null,_e,F,O,W,H,Y,ee,K)}},I=(P,F,O,W,H,Y,ee)=>{const K=F.el=P.el;let{patchFlag:q,dynamicChildren:$,dirs:_e}=F;q|=P.patchFlag&16;const ue=P.props||Ke,ve=F.props||Ke;let ye;O&&Xn(O,!1),(ye=ve.onVnodeBeforeUpdate)&&kr(ye,O,F,P),_e&&Wn(F,P,O,"beforeUpdate"),O&&Xn(O,!0);const we=H&&F.type!=="foreignObject";if($?E(P.dynamicChildren,$,K,O,W,we,Y):ee||V(P,F,K,null,O,W,we,Y,!1),q>0){if(q&16)B(K,F,ue,ve,O,W,H);else if(q&2&&ue.class!==ve.class&&n(K,"class",null,ve.class,H),q&4&&n(K,"style",ue.style,ve.style,H),q&8){const Ge=F.dynamicProps;for(let Oe=0;Oe<Ge.length;Oe++){const Qe=Ge[Oe],ut=ue[Qe],Ur=ve[Qe];(Ur!==ut||Qe==="value")&&n(K,Qe,ut,Ur,H,P.children,O,W,G)}}q&1&&P.children!==F.children&&u(K,F.children)}else!ee&&$==null&&B(K,F,ue,ve,O,W,H);((ye=ve.onVnodeUpdated)||_e)&&Xt(()=>{ye&&kr(ye,O,F,P),_e&&Wn(F,P,O,"updated")},W)},E=(P,F,O,W,H,Y,ee)=>{for(let K=0;K<F.length;K++){const q=P[K],$=F[K],_e=q.el&&(q.type===hr||!ni(q,$)||q.shapeFlag&70)?h(q.el):O;p(q,$,_e,null,W,H,Y,ee,!0)}},B=(P,F,O,W,H,Y,ee)=>{if(O!==W){if(O!==Ke)for(const K in O)!uo(K)&&!(K in W)&&n(P,K,O[K],null,ee,F.children,H,Y,G);for(const K in W){if(uo(K))continue;const q=W[K],$=O[K];q!==$&&K!=="value"&&n(P,K,$,q,ee,F.children,H,Y,G)}"value"in W&&n(P,"value",O.value,W.value)}},S=(P,F,O,W,H,Y,ee,K,q)=>{const $=F.el=P?P.el:s(""),_e=F.anchor=P?P.anchor:s("");let{patchFlag:ue,dynamicChildren:ve,slotScopeIds:ye}=F;ye&&(K=K?K.concat(ye):ye),P==null?(t($,O,W),t(_e,O,W),M(F.children,O,_e,H,Y,ee,K,q)):ue>0&&ue&64&&ve&&P.dynamicChildren?(E(P.dynamicChildren,ve,O,H,Y,ee,K),(F.key!=null||H&&F===H.subTree)&&k_(P,F,!0)):V(P,F,O,_e,H,Y,ee,K,q)},A=(P,F,O,W,H,Y,ee,K,q)=>{F.slotScopeIds=K,P==null?F.shapeFlag&512?H.ctx.activate(F,O,W,ee,q):R(F,O,W,H,Y,ee,q):D(P,F,q)},R=(P,F,O,W,H,Y,ee)=>{const K=P.component=r0(P,W,H);if(jo(P)&&(K.ctx.renderer=Pe),n0(K),K.asyncDep){if(H&&H.registerDep(K,z),!P.el){const q=K.subTree=de(cn);g(null,q,F,O)}return}z(K,P,F,O,H,Y,ee)},D=(P,F,O)=>{const W=F.component=P.component;if(_g(P,F,O))if(W.asyncDep&&!W.asyncResolved){U(W,F,O);return}else W.next=F,og(W.update),W.update();else F.el=P.el,W.vnode=F},z=(P,F,O,W,H,Y,ee)=>{const K=()=>{if(P.isMounted){let{next:_e,bu:ue,u:ve,parent:ye,vnode:we}=P,Ge=_e,Oe;Xn(P,!1),_e?(_e.el=we.el,U(P,_e,ee)):_e=we,ue&&ps(ue),(Oe=_e.props&&_e.props.onVnodeBeforeUpdate)&&kr(Oe,ye,_e,we),Xn(P,!0);const Qe=gs(P),ut=P.subTree;P.subTree=Qe,p(ut,Qe,h(ut.el),ce(ut),P,H,Y),_e.el=Qe.el,Ge===null&&vg(P,Qe.el),ve&&Xt(ve,H),(Oe=_e.props&&_e.props.onVnodeUpdated)&&Xt(()=>kr(Oe,ye,_e,we),H)}else{let _e;const{el:ue,props:ve}=F,{bm:ye,m:we,parent:Ge}=P,Oe=fo(F);if(Xn(P,!1),ye&&ps(ye),!Oe&&(_e=ve&&ve.onVnodeBeforeMount)&&kr(_e,Ge,F),Xn(P,!0),ue&&Ye){const Qe=()=>{P.subTree=gs(P),Ye(ue,P.subTree,P,H,null)};Oe?F.type.__asyncLoader().then(()=>!P.isUnmounted&&Qe()):Qe()}else{const Qe=P.subTree=gs(P);p(null,Qe,O,W,P,H,Y),F.el=Qe.el}if(we&&Xt(we,H),!Oe&&(_e=ve&&ve.onVnodeMounted)){const Qe=F;Xt(()=>kr(_e,Ge,Qe),H)}(F.shapeFlag&256||Ge&&fo(Ge.vnode)&&Ge.vnode.shapeFlag&256)&&P.a&&Xt(P.a,H),P.isMounted=!0,F=O=W=null}},q=P.effect=new vl(K,()=>bl($),P.scope),$=P.update=()=>q.run();$.id=P.uid,Xn(P,!0),$()},U=(P,F,O)=>{F.component=P;const W=P.vnode.props;P.vnode=F,P.next=null,Vg(P,F.props,W,O),Hg(P,F.children,O),oa(),fc(),sa()},V=(P,F,O,W,H,Y,ee,K,q=!1)=>{const $=P&&P.children,_e=P?P.shapeFlag:0,ue=F.children,{patchFlag:ve,shapeFlag:ye}=F;if(ve>0){if(ve&128){J($,ue,O,W,H,Y,ee,K,q);return}else if(ve&256){L($,ue,O,W,H,Y,ee,K,q);return}}ye&8?(_e&16&&G($,H,Y),ue!==$&&u(O,ue)):_e&16?ye&16?J($,ue,O,W,H,Y,ee,K,q):G($,H,Y,!0):(_e&8&&u(O,""),ye&16&&M(ue,O,W,H,Y,ee,K,q))},L=(P,F,O,W,H,Y,ee,K,q)=>{P=P||Ni,F=F||Ni;const $=P.length,_e=F.length,ue=Math.min($,_e);let ve;for(ve=0;ve<ue;ve++){const ye=F[ve]=q?Mn(F[ve]):jr(F[ve]);p(P[ve],ye,O,null,H,Y,ee,K,q)}$>_e?G(P,H,Y,!0,!1,ue):M(F,O,W,H,Y,ee,K,q,ue)},J=(P,F,O,W,H,Y,ee,K,q)=>{let $=0;const _e=F.length;let ue=P.length-1,ve=_e-1;for(;$<=ue&&$<=ve;){const ye=P[$],we=F[$]=q?Mn(F[$]):jr(F[$]);if(ni(ye,we))p(ye,we,O,null,H,Y,ee,K,q);else break;$++}for(;$<=ue&&$<=ve;){const ye=P[ue],we=F[ve]=q?Mn(F[ve]):jr(F[ve]);if(ni(ye,we))p(ye,we,O,null,H,Y,ee,K,q);else break;ue--,ve--}if($>ue){if($<=ve){const ye=ve+1,we=ye<_e?F[ye].el:W;for(;$<=ve;)p(null,F[$]=q?Mn(F[$]):jr(F[$]),O,we,H,Y,ee,K,q),$++}}else if($>ve)for(;$<=ue;)le(P[$],H,Y,!0),$++;else{const ye=$,we=$,Ge=new Map;for($=we;$<=ve;$++){const Kt=F[$]=q?Mn(F[$]):jr(F[$]);Kt.key!=null&&Ge.set(Kt.key,$)}let Oe,Qe=0;const ut=ve-we+1;let Ur=!1,tc=0;const da=new Array(ut);for($=0;$<ut;$++)da[$]=0;for($=ye;$<=ue;$++){const Kt=P[$];if(Qe>=ut){le(Kt,H,Y,!0);continue}let Vr;if(Kt.key!=null)Vr=Ge.get(Kt.key);else for(Oe=we;Oe<=ve;Oe++)if(da[Oe-we]===0&&ni(Kt,F[Oe])){Vr=Oe;break}Vr===void 0?le(Kt,H,Y,!0):(da[Vr-we]=$+1,Vr>=tc?tc=Vr:Ur=!0,p(Kt,F[Vr],O,null,H,Y,ee,K,q),Qe++)}const rc=Ur?qg(da):Ni;for(Oe=rc.length-1,$=ut-1;$>=0;$--){const Kt=we+$,Vr=F[Kt],nc=Kt+1<_e?F[Kt+1].el:W;da[$]===0?p(null,Vr,O,nc,H,Y,ee,K,q):Ur&&(Oe<0||$!==rc[Oe]?oe(Vr,O,nc,2):Oe--)}}},oe=(P,F,O,W,H=null)=>{const{el:Y,type:ee,transition:K,children:q,shapeFlag:$}=P;if($&6){oe(P.component.subTree,F,O,W);return}if($&128){P.suspense.move(F,O,W);return}if($&64){ee.move(P,F,O,Pe);return}if(ee===hr){t(Y,F,O);for(let ue=0;ue<q.length;ue++)oe(q[ue],F,O,W);t(P.anchor,F,O);return}if(ee===_o){x(P,F,O);return}if(W!==2&&$&1&&K)if(W===0)K.beforeEnter(Y),t(Y,F,O),Xt(()=>K.enter(Y),H);else{const{leave:ue,delayLeave:ve,afterLeave:ye}=K,we=()=>t(Y,F,O),Ge=()=>{ue(Y,()=>{we(),ye&&ye()})};ve?ve(Y,we,Ge):Ge()}else t(Y,F,O)},le=(P,F,O,W=!1,H=!1)=>{const{type:Y,props:ee,ref:K,children:q,dynamicChildren:$,shapeFlag:_e,patchFlag:ue,dirs:ve}=P;if(K!=null&&Ws(K,null,O,P,!0),_e&256){F.ctx.deactivate(P);return}const ye=_e&1&&ve,we=!fo(P);let Ge;if(we&&(Ge=ee&&ee.onVnodeBeforeUnmount)&&kr(Ge,F,P),_e&6)Ie(P.component,O,W);else{if(_e&128){P.suspense.unmount(O,W);return}ye&&Wn(P,null,F,"beforeUnmount"),_e&64?P.type.remove(P,F,O,H,Pe,W):$&&(Y!==hr||ue>0&&ue&64)?G($,F,O,!1,!0):(Y===hr&&ue&384||!H&&_e&16)&&G(q,F,O),W&&te(P)}(we&&(Ge=ee&&ee.onVnodeUnmounted)||ye)&&Xt(()=>{Ge&&kr(Ge,F,P),ye&&Wn(P,null,F,"unmounted")},O)},te=P=>{const{type:F,el:O,anchor:W,transition:H}=P;if(F===hr){Ae(O,W);return}if(F===_o){w(P);return}const Y=()=>{e(O),H&&!H.persisted&&H.afterLeave&&H.afterLeave()};if(P.shapeFlag&1&&H&&!H.persisted){const{leave:ee,delayLeave:K}=H,q=()=>ee(O,Y);K?K(P.el,Y,q):q()}else Y()},Ae=(P,F)=>{let O;for(;P!==F;)O=f(P),e(P),P=O;e(F)},Ie=(P,F,O)=>{const{bum:W,scope:H,update:Y,subTree:ee,um:K}=P;W&&ps(W),H.stop(),Y&&(Y.active=!1,le(ee,P,F,O)),K&&Xt(K,F),Xt(()=>{P.isUnmounted=!0},F),F&&F.pendingBranch&&!F.isUnmounted&&P.asyncDep&&!P.asyncResolved&&P.suspenseId===F.pendingId&&(F.deps--,F.deps===0&&F.resolve())},G=(P,F,O,W=!1,H=!1,Y=0)=>{for(let ee=Y;ee<P.length;ee++)le(P[ee],F,O,W,H)},ce=P=>P.shapeFlag&6?ce(P.component.subTree):P.shapeFlag&128?P.suspense.next():f(P.anchor||P.el),pe=(P,F,O)=>{P==null?F._vnode&&le(F._vnode,null,null,!0):p(F._vnode||null,P,F,null,null,null,O),fc(),C_(),F._vnode=P},Pe={p,um:le,m:oe,r:te,mt:R,mc:M,pc:V,pbc:E,n:ce,o:r};let Te,Ye;return o&&([Te,Ye]=o(Pe)),{render:pe,hydrate:Te,createApp:Xg(pe,Te)}}function Xn({effect:r,update:o},i){r.allowRecurse=o.allowRecurse=i}function k_(r,o,i=!1){const t=r.children,e=o.children;if(Ee(t)&&Ee(e))for(let n=0;n<t.length;n++){const a=t[n];let s=e[n];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=e[n]=Mn(e[n]),s.el=a.el),i||k_(a,s))}}function qg(r){const o=r.slice(),i=[0];let t,e,n,a,s;const l=r.length;for(t=0;t<l;t++){const c=r[t];if(c!==0){if(e=i[i.length-1],r[e]<c){o[t]=e,i.push(t);continue}for(n=0,a=i.length-1;n<a;)s=n+a>>1,r[i[s]]<c?n=s+1:a=s;c<r[i[n]]&&(n>0&&(o[t]=i[n-1]),i[n]=t)}}for(n=i.length,a=i[n-1];n-- >0;)i[n]=a,a=o[a];return i}const Yg=r=>r.__isTeleport,hr=Symbol(void 0),Pl=Symbol(void 0),cn=Symbol(void 0),_o=Symbol(void 0),Ca=[];let Rr=null;function Yi(r=!1){Ca.push(Rr=r?null:[])}function Qg(){Ca.pop(),Rr=Ca[Ca.length-1]||null}let za=1;function bc(r){za+=r}function Jg(r){return r.dynamicChildren=za>0?Rr||Ni:null,Qg(),za>0&&Rr&&Rr.push(r),r}function Qi(r,o,i,t,e,n){return Jg(fr(r,o,i,t,e,n,!0))}function Ao(r){return r?r.__v_isVNode===!0:!1}function ni(r,o){return r.type===o.type&&r.key===o.key}const Yo="__vInternal",G_=({key:r})=>r!=null?r:null,vo=({ref:r,ref_key:o,ref_for:i})=>r!=null?At(r)||Ct(r)||Be(r)?{i:qr,r,k:o,f:!!i}:r:null;function fr(r,o=null,i=null,t=0,e=null,n=r===hr?0:1,a=!1,s=!1){const l={__v_isVNode:!0,__v_skip:!0,type:r,props:o,key:o&&G_(o),ref:o&&vo(o),scopeId:Wo,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:t,dynamicProps:e,dynamicChildren:null,appContext:null};return s?(Ml(l,i),n&128&&r.normalize(l)):i&&(l.shapeFlag|=At(i)?8:16),za>0&&!a&&Rr&&(l.patchFlag>0||n&6)&&l.patchFlag!==32&&Rr.push(l),l}const de=Kg;function Kg(r,o=null,i=null,t=0,e=null,n=!1){if((!r||r===Fg)&&(r=cn),Ao(r)){const s=Vn(r,o,!0);return i&&Ml(s,i),za>0&&!n&&Rr&&(s.shapeFlag&6?Rr[Rr.indexOf(r)]=s:Rr.push(s)),s.patchFlag|=-2,s}if(s0(r)&&(r=r.__vccOpts),o){o=Zg(o);let{class:s,style:l}=o;s&&!At(s)&&(o.class=cl(s)),ot(l)&&(p_(l)&&!Ee(l)&&(l=Ft({},l)),o.style=Xa(l))}const a=At(r)?1:pg(r)?128:Yg(r)?64:ot(r)?4:Be(r)?2:0;return fr(r,o,i,t,e,a,n,!0)}function Zg(r){return r?p_(r)||Yo in r?Ft({},r):r:null}function Vn(r,o,i=!1){const{props:t,ref:e,patchFlag:n,children:a}=r,s=o?Qo(t||{},o):t;return{__v_isVNode:!0,__v_skip:!0,type:r.type,props:s,key:s&&G_(s),ref:o&&o.ref?i&&e?Ee(e)?e.concat(vo(o)):[e,vo(o)]:vo(o):e,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:a,target:r.target,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:o&&r.type!==hr?n===-1?16:n|16:n,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:r.transition,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&Vn(r.ssContent),ssFallback:r.ssFallback&&Vn(r.ssFallback),el:r.el,anchor:r.anchor}}function Tl(r=" ",o=0){return de(Pl,null,r,o)}function H_(r,o){const i=de(_o,null,r);return i.staticCount=o,i}function jr(r){return r==null||typeof r=="boolean"?de(cn):Ee(r)?de(hr,null,r.slice()):typeof r=="object"?Mn(r):de(Pl,null,String(r))}function Mn(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:Vn(r)}function Ml(r,o){let i=0;const{shapeFlag:t}=r;if(o==null)o=null;else if(Ee(o))i=16;else if(typeof o=="object")if(t&65){const e=o.default;e&&(e._c&&(e._d=!1),Ml(r,e()),e._c&&(e._d=!0));return}else{i=32;const e=o._;!e&&!(Yo in o)?o._ctx=qr:e===3&&qr&&(qr.slots._===1?o._=1:(o._=2,r.patchFlag|=1024))}else Be(o)?(o={default:o,_ctx:qr},i=32):(o=String(o),t&64?(i=16,o=[Tl(o)]):i=8);r.children=o,r.shapeFlag|=i}function Qo(...r){const o={};for(let i=0;i<r.length;i++){const t=r[i];for(const e in t)if(e==="class")o.class!==t.class&&(o.class=cl([o.class,t.class]));else if(e==="style")o.style=Xa([o.style,t.style]);else if(No(e)){const n=o[e],a=t[e];a&&n!==a&&!(Ee(n)&&n.includes(a))&&(o[e]=n?[].concat(n,a):a)}else e!==""&&(o[e]=t[e])}return o}function kr(r,o,i,t=null){vr(r,o,7,[i,t])}const e0=V_();let t0=0;function r0(r,o,i){const t=r.type,e=(o?o.appContext:r.appContext)||e0,n={uid:t0++,vnode:r,type:t,parent:o,appContext:e,root:null,next:null,subTree:null,effect:null,update:null,scope:new Ap(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:o?o.provides:Object.create(e.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:L_(t,e),emitsOptions:P_(t,e),emit:null,emitted:null,propsDefaults:Ke,inheritAttrs:t.inheritAttrs,ctx:Ke,data:Ke,props:Ke,attrs:Ke,slots:Ke,refs:Ke,setupState:Ke,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=o?o.root:n,n.emit=cg.bind(null,n),r.ce&&r.ce(n),n}let bt=null;const la=()=>bt||qr,Ji=r=>{bt=r,r.scope.on()},vi=()=>{bt&&bt.scope.off(),bt=null};function W_(r){return r.vnode.shapeFlag&4}let Da=!1;function n0(r,o=!1){Da=o;const{props:i,children:t}=r.vnode,e=W_(r);Ug(r,i,e,o),Gg(r,t);const n=e?i0(r,o):void 0;return Da=!1,n}function i0(r,o){const i=r.type;r.accessCache=Object.create(null),r.proxy=g_(new Proxy(r.ctx,Ig));const{setup:t}=i;if(t){const e=r.setupContext=t.length>1?o0(r):null;Ji(r),oa();const n=Dn(t,r,0,[r.props,e]);if(sa(),vi(),n_(n)){if(n.then(vi,vi),o)return n.then(a=>{Sc(r,a,o)}).catch(a=>{Go(a,r,0)});r.asyncDep=n}else Sc(r,n,o)}else X_(r,o)}function Sc(r,o,i){Be(o)?r.type.__ssrInlineRender?r.ssrRender=o:r.render=o:ot(o)&&(r.setupState=x_(o)),X_(r,i)}let Cc;function X_(r,o,i){const t=r.type;if(!r.render){if(!o&&Cc&&!t.render){const e=t.template||Cl(r).template;if(e){const{isCustomElement:n,compilerOptions:a}=r.appContext.config,{delimiters:s,compilerOptions:l}=t,c=Ft(Ft({isCustomElement:n,delimiters:s},a),l);t.render=Cc(e,c)}}r.render=t.render||zr}Ji(r),oa(),zg(r),sa(),vi()}function a0(r){return new Proxy(r.attrs,{get(o,i){return ir(r,"get","$attrs"),o[i]}})}function o0(r){const o=t=>{r.exposed=t||{}};let i;return{get attrs(){return i||(i=a0(r))},slots:r.slots,emit:r.emit,expose:o}}function El(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(x_(g_(r.exposed)),{get(o,i){if(i in o)return o[i];if(i in So)return So[i](r)}}))}function s0(r){return Be(r)&&"__vccOpts"in r}const Er=(r,o)=>ng(r,o,Da);function l0(r,o,i){const t=arguments.length;return t===2?ot(o)&&!Ee(o)?Ao(o)?de(r,null,[o]):de(r,o):de(r,null,o):(t>3?i=Array.prototype.slice.call(arguments,2):t===3&&Ao(i)&&(i=[i]),de(r,o,i))}const c0="3.2.41",u0="http://www.w3.org/2000/svg",ii=typeof document<"u"?document:null,Ac=ii&&ii.createElement("template"),h0={insert:(r,o,i)=>{o.insertBefore(r,i||null)},remove:r=>{const o=r.parentNode;o&&o.removeChild(r)},createElement:(r,o,i,t)=>{const e=o?ii.createElementNS(u0,r):ii.createElement(r,i?{is:i}:void 0);return r==="select"&&t&&t.multiple!=null&&e.setAttribute("multiple",t.multiple),e},createText:r=>ii.createTextNode(r),createComment:r=>ii.createComment(r),setText:(r,o)=>{r.nodeValue=o},setElementText:(r,o)=>{r.textContent=o},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>ii.querySelector(r),setScopeId(r,o){r.setAttribute(o,"")},insertStaticContent(r,o,i,t,e,n){const a=i?i.previousSibling:o.lastChild;if(e&&(e===n||e.nextSibling))for(;o.insertBefore(e.cloneNode(!0),i),!(e===n||!(e=e.nextSibling)););else{Ac.innerHTML=t?`<svg>${r}</svg>`:r;const s=Ac.content;if(t){const l=s.firstChild;for(;l.firstChild;)s.appendChild(l.firstChild);s.removeChild(l)}o.insertBefore(s,i)}return[a?a.nextSibling:o.firstChild,i?i.previousSibling:o.lastChild]}};function f0(r,o,i){const t=r._vtc;t&&(o=(o?[o,...t]:[...t]).join(" ")),o==null?r.removeAttribute("class"):i?r.setAttribute("class",o):r.className=o}function d0(r,o,i){const t=r.style,e=At(i);if(i&&!e){for(const n in i)Xs(t,n,i[n]);if(o&&!At(o))for(const n in o)i[n]==null&&Xs(t,n,"")}else{const n=t.display;e?o!==i&&(t.cssText=i):o&&r.removeAttribute("style"),"_vod"in r&&(t.display=n)}}const Pc=/\s*!important$/;function Xs(r,o,i){if(Ee(i))i.forEach(t=>Xs(r,o,t));else if(i==null&&(i=""),o.startsWith("--"))r.setProperty(o,i);else{const t=_0(r,o);Pc.test(i)?r.setProperty(aa(t),i.replace(Pc,""),"important"):r[t]=i}}const Tc=["Webkit","Moz","ms"],ys={};function _0(r,o){const i=ys[o];if(i)return i;let t=ji(o);if(t!=="filter"&&t in r)return ys[o]=t;t=i_(t);for(let e=0;e<Tc.length;e++){const n=Tc[e]+t;if(n in r)return ys[o]=n}return o}const Mc="http://www.w3.org/1999/xlink";function v0(r,o,i,t,e){if(t&&o.startsWith("xlink:"))i==null?r.removeAttributeNS(Mc,o.slice(6,o.length)):r.setAttributeNS(Mc,o,i);else{const n=up(o);i==null||n&&!r_(i)?r.removeAttribute(o):r.setAttribute(o,n?"":i)}}function p0(r,o,i,t,e,n,a){if(o==="innerHTML"||o==="textContent"){t&&a(t,e,n),r[o]=i==null?"":i;return}if(o==="value"&&r.tagName!=="PROGRESS"&&!r.tagName.includes("-")){r._value=i;const l=i==null?"":i;(r.value!==l||r.tagName==="OPTION")&&(r.value=l),i==null&&r.removeAttribute(o);return}let s=!1;if(i===""||i==null){const l=typeof r[o];l==="boolean"?i=r_(i):i==null&&l==="string"?(i="",s=!0):l==="number"&&(i=0,s=!0)}try{r[o]=i}catch{}s&&r.removeAttribute(o)}function g0(r,o,i,t){r.addEventListener(o,i,t)}function m0(r,o,i,t){r.removeEventListener(o,i,t)}function y0(r,o,i,t,e=null){const n=r._vei||(r._vei={}),a=n[o];if(t&&a)a.value=t;else{const[s,l]=x0(o);if(t){const c=n[o]=S0(t,e);g0(r,s,c,l)}else a&&(m0(r,s,a,l),n[o]=void 0)}}const Ec=/(?:Once|Passive|Capture)$/;function x0(r){let o;if(Ec.test(r)){o={};let t;for(;t=r.match(Ec);)r=r.slice(0,r.length-t[0].length),o[t[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):aa(r.slice(2)),o]}let xs=0;const w0=Promise.resolve(),b0=()=>xs||(w0.then(()=>xs=0),xs=Date.now());function S0(r,o){const i=t=>{if(!t._vts)t._vts=Date.now();else if(t._vts<=i.attached)return;vr(C0(t,i.value),o,5,[t])};return i.value=r,i.attached=b0(),i}function C0(r,o){if(Ee(o)){const i=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{i.call(r),r._stopped=!0},o.map(t=>e=>!e._stopped&&t&&t(e))}else return o}const Rc=/^on[a-z]/,A0=(r,o,i,t,e=!1,n,a,s,l)=>{o==="class"?f0(r,t,e):o==="style"?d0(r,i,t):No(o)?ul(o)||y0(r,o,i,t,a):(o[0]==="."?(o=o.slice(1),!0):o[0]==="^"?(o=o.slice(1),!1):P0(r,o,t,e))?p0(r,o,t,n,a,s,l):(o==="true-value"?r._trueValue=t:o==="false-value"&&(r._falseValue=t),v0(r,o,t,e))};function P0(r,o,i,t){return t?!!(o==="innerHTML"||o==="textContent"||o in r&&Rc.test(o)&&Be(i)):o==="spellcheck"||o==="draggable"||o==="translate"||o==="form"||o==="list"&&r.tagName==="INPUT"||o==="type"&&r.tagName==="TEXTAREA"||Rc.test(o)&&At(i)?!1:o in r}const T0={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};bg.props;const M0=["ctrl","shift","alt","meta"],E0={stop:r=>r.stopPropagation(),prevent:r=>r.preventDefault(),self:r=>r.target!==r.currentTarget,ctrl:r=>!r.ctrlKey,shift:r=>!r.shiftKey,alt:r=>!r.altKey,meta:r=>!r.metaKey,left:r=>"button"in r&&r.button!==0,middle:r=>"button"in r&&r.button!==1,right:r=>"button"in r&&r.button!==2,exact:(r,o)=>M0.some(i=>r[`${i}Key`]&&!o.includes(i))},ws=(r,o)=>(i,...t)=>{for(let e=0;e<o.length;e++){const n=E0[o[e]];if(n&&n(i,o))return}return r(i,...t)},R0=Ft({patchProp:A0},h0);let Fc;function F0(){return Fc||(Fc=jg(R0))}const j_=(...r)=>{const o=F0().createApp(...r),{mount:i}=o;return o.mount=t=>{const e=B0(t);if(!e)return;const n=o._component;!Be(n)&&!n.render&&!n.template&&(n.template=e.innerHTML),e.innerHTML="";const a=i(e,!1,e instanceof SVGElement);return e instanceof Element&&(e.removeAttribute("v-cloak"),e.setAttribute("data-v-app","")),a},o};function B0(r){return At(r)?document.querySelector(r):r}const _r=r=>r!=null,Po=r=>typeof r=="function",Jo=r=>r!==null&&typeof r=="object",I0=r=>Jo(r)&&Po(r.then)&&Po(r.catch),$_=r=>typeof r=="number"||/^\d+(\.\d+)?$/.test(r),z0=()=>D0?/ios|iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase()):!1,ja=Object.assign,D0=typeof window<"u";function Bc(r,o){const i=o.split(".");let t=r;return i.forEach(e=>{var n;t=Jo(t)&&(n=t[e])!=null?n:""}),t}const Ic=r=>Array.isArray(r)?r:[r],po=null,Gt=[Number,String],La={type:Boolean,default:!0},L0=r=>({type:Gt,default:r}),$t=r=>({type:String,default:r});var q_=typeof window<"u";function O0(r){const o=Sa(r,null);if(o){const i=la(),{link:t,unlink:e,internalChildren:n}=o;t(i),qo(()=>e(i));const a=Er(()=>n.indexOf(i));return{parent:o,index:a}}return{parent:null,index:Mt(-1)}}function N0(r){const o=[],i=t=>{Array.isArray(t)&&t.forEach(e=>{var n;Ao(e)&&(o.push(e),(n=e.component)!=null&&n.subTree&&(o.push(e.component.subTree),i(e.component.subTree.children)),e.children&&i(e.children))})};return i(r),o}function U0(r,o,i){const t=N0(r.subTree.children);i.sort((n,a)=>t.indexOf(n.vnode)-t.indexOf(a.vnode));const e=i.map(n=>n.proxy);o.sort((n,a)=>{const s=e.indexOf(n),l=e.indexOf(a);return s-l})}function V0(r){const o=Un([]),i=Un([]),t=la();return{children:o,linkChildren:n=>{Xo(r,Object.assign({link:l=>{l.proxy&&(i.push(l),o.push(l.proxy),U0(t,o,i))},unlink:l=>{const c=i.indexOf(l);o.splice(c,1),i.splice(c,1)},children:o,internalChildren:i},n))}}}function k0(r){let o;Si(()=>{r(),Fi(()=>{o=!0})}),R_(()=>{o&&r()})}function G0(r,o,i={}){if(!q_)return;const{target:t=window,passive:e=!1,capture:n=!1}=i;let a;const s=c=>{const u=qi(c);u&&!a&&(u.addEventListener(r,o,{capture:n,passive:e}),a=!0)},l=c=>{const u=qi(c);u&&a&&(u.removeEventListener(r,o,n),a=!1)};qo(()=>l(t)),F_(()=>l(t)),k0(()=>s(t)),Ct(t)&&ki(t,(c,u)=>{l(u),s(c)})}var no,bs;function H0(){if(!no&&(no=Mt(0),bs=Mt(0),q_)){const r=()=>{no.value=window.innerWidth,bs.value=window.innerHeight};r(),window.addEventListener("resize",r,{passive:!0}),window.addEventListener("orientationchange",r,{passive:!0})}return{width:no,height:bs}}var W0=Symbol("van-field");function zc(r,o){"scrollTop"in r?r.scrollTop=o:r.scrollTo(r.scrollX,o)}function Y_(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}function Q_(r){zc(window,r),zc(document.body,r)}const X0=z0();function j0(){X0&&Q_(Y_())}const $0=r=>r.stopPropagation();function To(r,o){(typeof r.cancelable!="boolean"||r.cancelable)&&r.preventDefault(),o&&$0(r)}H0();function Yr(r){if(_r(r))return $_(r)?`${r}px`:String(r)}function q0(r){if(_r(r)){if(Array.isArray(r))return{width:Yr(r[0]),height:Yr(r[1])};const o=Yr(r);return{width:o,height:o}}}const Y0=/-(\w)/g,J_=r=>r.replace(Y0,(o,i)=>i.toUpperCase()),Q0=r=>r.replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^-/,"");function Dc(r,o,i){const t=r.indexOf(o);return t===-1?r:o==="-"&&t!==0?r.slice(0,t):r.slice(0,t+1)+r.slice(t).replace(i,"")}function J0(r,o=!0,i=!0){o?r=Dc(r,".",/\./g):r=r.split(".")[0],i?r=Dc(r,"-",/-/g):r=r.replace(/-/,"");const t=o?/[^-0-9.]/g:/[^-0-9]/g;return r.replace(t,"")}const{hasOwnProperty:K0}=Object.prototype;function Z0(r,o,i){const t=o[i];!_r(t)||(!K0.call(r,i)||!Jo(t)?r[i]=t:r[i]=K_(Object(r[i]),t))}function K_(r,o){return Object.keys(o).forEach(i=>{Z0(r,o,i)}),r}var em={name:"\u59D3\u540D",tel:"\u7535\u8BDD",save:"\u4FDD\u5B58",confirm:"\u786E\u8BA4",cancel:"\u53D6\u6D88",delete:"\u5220\u9664",loading:"\u52A0\u8F7D\u4E2D...",noCoupon:"\u6682\u65E0\u4F18\u60E0\u5238",nameEmpty:"\u8BF7\u586B\u5199\u59D3\u540D",addContact:"\u6DFB\u52A0\u8054\u7CFB\u4EBA",telInvalid:"\u8BF7\u586B\u5199\u6B63\u786E\u7684\u7535\u8BDD",vanCalendar:{end:"\u7ED3\u675F",start:"\u5F00\u59CB",title:"\u65E5\u671F\u9009\u62E9",weekdays:["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],monthTitle:(r,o)=>`${r}\u5E74${o}\u6708`,rangePrompt:r=>`\u6700\u591A\u9009\u62E9 ${r} \u5929`},vanCascader:{select:"\u8BF7\u9009\u62E9"},vanPagination:{prev:"\u4E0A\u4E00\u9875",next:"\u4E0B\u4E00\u9875"},vanPullRefresh:{pulling:"\u4E0B\u62C9\u5373\u53EF\u5237\u65B0...",loosing:"\u91CA\u653E\u5373\u53EF\u5237\u65B0..."},vanSubmitBar:{label:"\u5408\u8BA1:"},vanCoupon:{unlimited:"\u65E0\u95E8\u69DB",discount:r=>`${r}\u6298`,condition:r=>`\u6EE1${r}\u5143\u53EF\u7528`},vanCouponCell:{title:"\u4F18\u60E0\u5238",count:r=>`${r}\u5F20\u53EF\u7528`},vanCouponList:{exchange:"\u5151\u6362",close:"\u4E0D\u4F7F\u7528",enable:"\u53EF\u7528",disabled:"\u4E0D\u53EF\u7528",placeholder:"\u8F93\u5165\u4F18\u60E0\u7801"},vanAddressEdit:{area:"\u5730\u533A",postal:"\u90AE\u653F\u7F16\u7801",areaEmpty:"\u8BF7\u9009\u62E9\u5730\u533A",addressEmpty:"\u8BF7\u586B\u5199\u8BE6\u7EC6\u5730\u5740",postalEmpty:"\u90AE\u653F\u7F16\u7801\u4E0D\u6B63\u786E",addressDetail:"\u8BE6\u7EC6\u5730\u5740",defaultAddress:"\u8BBE\u4E3A\u9ED8\u8BA4\u6536\u8D27\u5730\u5740"},vanAddressList:{add:"\u65B0\u589E\u5730\u5740"}};const Lc=Mt("zh-CN"),Oc=Un({"zh-CN":em}),tm={messages(){return Oc[Lc.value]},use(r,o){Lc.value=r,this.add({[r]:o})},add(r={}){K_(Oc,r)}};var rm=tm;function nm(r){const o=J_(r)+".";return(i,...t)=>{const e=rm.messages(),n=Bc(e,o+i)||Bc(e,i);return Po(n)?n(...t):n}}function js(r,o){return o?typeof o=="string"?` ${r}--${o}`:Array.isArray(o)?o.reduce((i,t)=>i+js(r,t),""):Object.keys(o).reduce((i,t)=>i+(o[t]?js(r,t):""),""):""}function im(r){return(o,i)=>(o&&typeof o!="string"&&(i=o,o=""),o=o?`${r}__${o}`:r,`${o}${js(o,i)}`)}function vn(r){const o=`van-${r}`;return[o,im(o),nm(o)]}const Z_="van-hairline",am=`${Z_}--surround`,om=`${Z_}--top-bottom`,ev=Symbol("van-form");function Gn(r){return r.install=o=>{const{name:i}=r;i&&(o.component(i,r),o.component(J_(`-${i}`),r))},r}function tv(r){const o=la();o&&ja(o.proxy,r)}const rv={to:[String,Object],url:String,replace:Boolean};function sm({to:r,url:o,replace:i,$router:t}){r&&t?t[i?"replace":"push"](r):o&&(i?location.replace(o):location.href=o)}function nv(){const r=la().proxy;return()=>sm(r)}const[lm,Nc]=vn("badge"),cm={dot:Boolean,max:Gt,tag:$t("div"),color:String,offset:Array,content:Gt,showZero:La,position:$t("top-right")};var um=Qt({name:lm,props:cm,setup(r,{slots:o}){const i=()=>{if(o.content)return!0;const{content:a,showZero:s}=r;return _r(a)&&a!==""&&(s||a!==0&&a!=="0")},t=()=>{const{dot:a,max:s,content:l}=r;if(!a&&i())return o.content?o.content():_r(s)&&$_(l)&&+l>s?`${s}+`:l},e=Er(()=>{const a={background:r.color};if(r.offset){const[s,l]=r.offset;o.default?(a.top=Yr(l),typeof s=="number"?a.right=Yr(-s):a.right=s.startsWith("-")?s.replace("-",""):`-${s}`):(a.marginTop=Yr(l),a.marginLeft=Yr(s))}return a}),n=()=>{if(i()||r.dot)return de("div",{class:Nc([r.position,{dot:r.dot,fixed:!!o.default}]),style:e.value},[t()])};return()=>{if(o.default){const{tag:a}=r;return de(a,{class:Nc("wrapper")},{default:()=>[o.default(),n()]})}return n()}}});const hm=Gn(um),fm=r=>{},[iv,dm]=vn("config-provider"),av=Symbol(iv),_m={tag:$t("div"),zIndex:Number,themeVars:Object,iconPrefix:String};function vm(r){const o={};return Object.keys(r).forEach(i=>{o[`--van-${Q0(i)}`]=r[i]}),o}Qt({name:iv,props:_m,setup(r,{slots:o}){const i=Er(()=>{if(r.themeVars)return vm(r.themeVars)});return Xo(av,r),mg(()=>{r.zIndex!==void 0&&fm(r.zIndex)}),()=>de(r.tag,{class:dm(),style:i.value},{default:()=>{var t;return[(t=o.default)==null?void 0:t.call(o)]}})}});const[pm,Uc]=vn("icon"),gm=r=>r==null?void 0:r.includes("/"),mm={dot:Boolean,tag:$t("i"),name:String,size:Gt,badge:Gt,color:String,badgeProps:Object,classPrefix:String};var ym=Qt({name:pm,props:mm,setup(r,{slots:o}){const i=Sa(av,null),t=Er(()=>r.classPrefix||(i==null?void 0:i.iconPrefix)||Uc());return()=>{const{tag:e,dot:n,name:a,size:s,badge:l,color:c}=r,u=gm(a);return de(hm,Qo({dot:n,tag:e,class:[t.value,u?"":`${t.value}-${a}`],style:{color:c,fontSize:Yr(s)},content:l},r.badgeProps),{default:()=>{var h;return[(h=o.default)==null?void 0:h.call(o),u&&de("img",{class:Uc("image"),src:a},null)]}})}}});const Gi=Gn(ym),[xm,Aa]=vn("loading"),wm=Array(12).fill(null).map((r,o)=>de("i",{class:Aa("line",String(o+1))},null)),bm=de("svg",{class:Aa("circular"),viewBox:"25 25 50 50"},[de("circle",{cx:"50",cy:"50",r:"20",fill:"none"},null)]),Sm={size:Gt,type:$t("circular"),color:String,vertical:Boolean,textSize:Gt,textColor:String};var Cm=Qt({name:xm,props:Sm,setup(r,{slots:o}){const i=Er(()=>ja({color:r.color},q0(r.size))),t=()=>{var e;if(o.default)return de("span",{class:Aa("text"),style:{fontSize:Yr(r.textSize),color:(e=r.textColor)!=null?e:r.color}},[o.default()])};return()=>{const{type:e,vertical:n}=r;return de("div",{class:Aa([e,{vertical:n}]),"aria-live":"polite","aria-busy":!0},[de("span",{class:Aa("spinner",e),style:i.value},[e==="spinner"?wm:bm]),t()])}}});const Am=Gn(Cm),[Pm,Ai]=vn("button"),Tm=ja({},rv,{tag:$t("button"),text:String,icon:String,type:$t("default"),size:$t("normal"),color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:$t("button"),loadingSize:Gt,loadingText:String,loadingType:String,iconPosition:$t("left")});var Mm=Qt({name:Pm,props:Tm,emits:["click"],setup(r,{emit:o,slots:i}){const t=nv(),e=()=>i.loading?i.loading():de(Am,{size:r.loadingSize,type:r.loadingType,class:Ai("loading")},null),n=()=>{if(r.loading)return e();if(i.icon)return de("div",{class:Ai("icon")},[i.icon()]);if(r.icon)return de(Gi,{name:r.icon,class:Ai("icon"),classPrefix:r.iconPrefix},null)},a=()=>{let c;if(r.loading?c=r.loadingText:c=i.default?i.default():r.text,c)return de("span",{class:Ai("text")},[c])},s=()=>{const{color:c,plain:u}=r;if(c){const h={color:u?c:"white"};return u||(h.background=c),c.includes("gradient")?h.border=0:h.borderColor=c,h}},l=c=>{r.loading?To(c):r.disabled||(o("click",c),t())};return()=>{const{tag:c,type:u,size:h,block:f,round:d,plain:_,square:p,loading:v,disabled:g,hairline:m,nativeType:x,iconPosition:w}=r,C=[Ai([u,h,{plain:_,block:f,round:d,square:p,loading:v,disabled:g,hairline:m}]),{[am]:m}];return de(c,{type:x,class:C,style:s(),disabled:g,onClick:l},{default:()=>[de("div",{class:Ai("content")},[w==="left"&&n(),a(),w==="right"&&n()])]})}}});const Em=Gn(Mm),[Rm,Pi]=vn("cell"),ov={icon:String,size:String,title:Gt,value:Gt,label:Gt,center:Boolean,isLink:Boolean,border:La,required:Boolean,iconPrefix:String,valueClass:po,labelClass:po,titleClass:po,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}},Fm=ja({},ov,rv);var Bm=Qt({name:Rm,props:Fm,setup(r,{slots:o}){const i=nv(),t=()=>{if(o.label||_r(r.label))return de("div",{class:[Pi("label"),r.labelClass]},[o.label?o.label():r.label])},e=()=>{if(o.title||_r(r.title))return de("div",{class:[Pi("title"),r.titleClass],style:r.titleStyle},[o.title?o.title():de("span",null,[r.title]),t()])},n=()=>{const l=o.value||o.default;if(l||_r(r.value)){const u=o.title||_r(r.title);return de("div",{class:[Pi("value",{alone:!u}),r.valueClass]},[l?l():de("span",null,[r.value])])}},a=()=>{if(o.icon)return o.icon();if(r.icon)return de(Gi,{name:r.icon,class:Pi("left-icon"),classPrefix:r.iconPrefix},null)},s=()=>{if(o["right-icon"])return o["right-icon"]();if(r.isLink){const l=r.arrowDirection?`arrow-${r.arrowDirection}`:"arrow";return de(Gi,{name:l,class:Pi("right-icon")},null)}};return()=>{var l,c;const{size:u,center:h,border:f,isLink:d,required:_}=r,p=(l=r.clickable)!=null?l:d,v={center:h,required:_,clickable:p,borderless:!f};return u&&(v[u]=!!u),de("div",{class:Pi(v),role:p?"button":void 0,tabindex:p?0:void 0,onClick:i},[a(),e(),n(),s(),(c=o.extra)==null?void 0:c.call(o)])}}});const Im=Gn(Bm),[zm,Dm]=vn("form"),Lm={colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:Gt,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:La,showErrorMessage:La,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Om=Qt({name:zm,props:Lm,emits:["submit","failed"],setup(r,{emit:o,slots:i}){const{children:t,linkChildren:e}=V0(ev),n=v=>v?t.filter(g=>v.includes(g.name)):t,a=v=>new Promise((g,m)=>{const x=[];n(v).reduce((C,T)=>C.then(()=>{if(!x.length)return T.validate().then(b=>{b&&x.push(b)})}),Promise.resolve()).then(()=>{x.length?m(x):g()})}),s=v=>new Promise((g,m)=>{const x=n(v);Promise.all(x.map(w=>w.validate())).then(w=>{w=w.filter(Boolean),w.length?m(w):g()})}),l=v=>{const g=t.find(m=>m.name===v);return g?new Promise((m,x)=>{g.validate().then(w=>{w?x(w):m()})}):Promise.reject()},c=v=>typeof v=="string"?l(v):r.validateFirst?a(v):s(v),u=v=>{typeof v=="string"&&(v=[v]),n(v).forEach(m=>{m.resetValidation()})},h=()=>t.reduce((v,g)=>(v[g.name]=g.getValidationStatus(),v),{}),f=(v,g)=>{t.some(m=>m.name===v?(m.$el.scrollIntoView(g),!0):!1)},d=()=>t.reduce((v,g)=>(v[g.name]=g.formValue.value,v),{}),_=()=>{const v=d();c().then(()=>o("submit",v)).catch(g=>{o("failed",{values:v,errors:g}),r.scrollToError&&g[0].name&&f(g[0].name)})},p=v=>{To(v),_()};return e({props:r}),tv({submit:_,validate:c,getValues:d,scrollToField:f,resetValidation:u,getValidationStatus:h}),()=>{var v;return de("form",{class:Dm(),onSubmit:p},[(v=i.default)==null?void 0:v.call(i)])}}});const Nm=Gn(Om);function sv(r){return Array.isArray(r)?!r.length:r===0?!1:!r}function Um(r,o){if(sv(r)){if(o.required)return!1;if(o.validateEmpty===!1)return!0}return!(o.pattern&&!o.pattern.test(String(r)))}function Vm(r,o){return new Promise(i=>{const t=o.validator(r,o);if(I0(t)){t.then(i);return}i(t)})}function Vc(r,o){const{message:i}=o;return Po(i)?i(r,o):i||""}function km({target:r}){r.composing=!0}function kc({target:r}){r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}function Gm(r,o){const i=Y_();r.style.height="auto";let t=r.scrollHeight;if(Jo(o)){const{maxHeight:e,minHeight:n}=o;e!==void 0&&(t=Math.min(t,e)),n!==void 0&&(t=Math.max(t,n))}t&&(r.style.height=`${t}px`,Q_(i))}function Hm(r){return r==="number"?{type:"text",inputmode:"decimal"}:r==="digit"?{type:"tel",inputmode:"numeric"}:{type:r}}function Ss(r){return[...r].length}function Wm(r,o){return[...r].slice(0,o).join("")}let Xm=0;function jm(){const r=la(),{name:o="unknown"}=(r==null?void 0:r.type)||{};return`${o}-${++Xm}`}const[$m,lr]=vn("field"),qm={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:Gt,formatter:Function,clearIcon:$t("clear"),modelValue:L0(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:$t("focus"),formatTrigger:$t("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},Ym=ja({},ov,qm,{rows:Gt,type:$t("text"),rules:Array,autosize:[Boolean,Object],labelWidth:Gt,labelClass:po,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var Qm=Qt({name:$m,props:Ym,emits:["blur","focus","clear","keypress","click-input","end-validate","start-validate","click-left-icon","click-right-icon","update:modelValue"],setup(r,{emit:o,slots:i}){const t=jm(),e=Un({status:"unvalidated",focused:!1,validateMessage:""}),n=Mt(),a=Mt(),s=Mt(),{parent:l}=O0(ev),c=()=>{var G;return String((G=r.modelValue)!=null?G:"")},u=G=>{if(_r(r[G]))return r[G];if(l&&_r(l.props[G]))return l.props[G]},h=Er(()=>{const G=u("readonly");if(r.clearable&&!G){const ce=c()!=="",pe=r.clearTrigger==="always"||r.clearTrigger==="focus"&&e.focused;return ce&&pe}return!1}),f=Er(()=>s.value&&i.input?s.value():r.modelValue),d=G=>G.reduce((ce,pe)=>ce.then(()=>{if(e.status==="failed")return;let{value:Pe}=f;if(pe.formatter&&(Pe=pe.formatter(Pe,pe)),!Um(Pe,pe)){e.status="failed",e.validateMessage=Vc(Pe,pe);return}if(pe.validator)return sv(Pe)&&pe.validateEmpty===!1?void 0:Vm(Pe,pe).then(Te=>{Te&&typeof Te=="string"?(e.status="failed",e.validateMessage=Te):Te===!1&&(e.status="failed",e.validateMessage=Vc(Pe,pe))})}),Promise.resolve()),_=()=>{e.status="unvalidated",e.validateMessage=""},p=()=>o("end-validate",{status:e.status}),v=(G=r.rules)=>new Promise(ce=>{_(),G?(o("start-validate"),d(G).then(()=>{e.status==="failed"?(ce({name:r.name,message:e.validateMessage}),p()):(e.status="passed",ce(),p())})):ce()}),g=G=>{if(l&&r.rules){const{validateTrigger:ce}=l.props,pe=Ic(ce).includes(G),Pe=r.rules.filter(Te=>Te.trigger?Ic(Te.trigger).includes(G):pe);Pe.length&&v(Pe)}},m=G=>{const{maxlength:ce}=r;if(_r(ce)&&Ss(G)>ce){const pe=c();return pe&&Ss(pe)===+ce?pe:Wm(G,+ce)}return G},x=(G,ce="onChange")=>{if(G=m(G),r.type==="number"||r.type==="digit"){const pe=r.type==="number";G=J0(G,pe,pe)}r.formatter&&ce===r.formatTrigger&&(G=r.formatter(G)),n.value&&n.value.value!==G&&(n.value.value=G),G!==r.modelValue&&o("update:modelValue",G)},w=G=>{G.target.composing||x(G.target.value)},C=()=>{var G;return(G=n.value)==null?void 0:G.blur()},T=()=>{var G;return(G=n.value)==null?void 0:G.focus()},b=()=>{const G=n.value;r.type==="textarea"&&r.autosize&&G&&Gm(G,r.autosize)},M=G=>{e.focused=!0,o("focus",G),Fi(b),u("readonly")&&C()},I=G=>{u("readonly")||(e.focused=!1,x(c(),"onBlur"),o("blur",G),g("onBlur"),Fi(b),j0())},E=G=>o("click-input",G),B=G=>o("click-left-icon",G),S=G=>o("click-right-icon",G),A=G=>{To(G),o("update:modelValue",""),o("clear",G)},R=Er(()=>{if(typeof r.error=="boolean")return r.error;if(l&&l.props.showError&&e.status==="failed")return!0}),D=Er(()=>{const G=u("labelWidth");if(G)return{width:Yr(G)}}),z=G=>{G.keyCode===13&&(!(l&&l.props.submitOnEnter)&&r.type!=="textarea"&&To(G),r.type==="search"&&C()),o("keypress",G)},U=()=>r.id||`${t}-input`,V=()=>e.status,L=()=>{const G=lr("control",[u("inputAlign"),{error:R.value,custom:!!i.input,"min-height":r.type==="textarea"&&!r.autosize}]);if(i.input)return de("div",{class:G,onClick:E},[i.input()]);const ce={id:U(),ref:n,name:r.name,rows:r.rows!==void 0?+r.rows:void 0,class:G,disabled:u("disabled"),readonly:u("readonly"),autofocus:r.autofocus,placeholder:r.placeholder,autocomplete:r.autocomplete,enterkeyhint:r.enterkeyhint,"aria-labelledby":r.label?`${t}-label`:void 0,onBlur:I,onFocus:M,onInput:w,onClick:E,onChange:kc,onKeypress:z,onCompositionend:kc,onCompositionstart:km};return r.type==="textarea"?de("textarea",ce,null):de("input",Qo(Hm(r.type),ce),null)},J=()=>{const G=i["left-icon"];if(r.leftIcon||G)return de("div",{class:lr("left-icon"),onClick:B},[G?G():de(Gi,{name:r.leftIcon,classPrefix:r.iconPrefix},null)])},oe=()=>{const G=i["right-icon"];if(r.rightIcon||G)return de("div",{class:lr("right-icon"),onClick:S},[G?G():de(Gi,{name:r.rightIcon,classPrefix:r.iconPrefix},null)])},le=()=>{if(r.showWordLimit&&r.maxlength){const G=Ss(c());return de("div",{class:lr("word-limit")},[de("span",{class:lr("word-num")},[G]),Tl("/"),r.maxlength])}},te=()=>{if(l&&l.props.showErrorMessage===!1)return;const G=r.errorMessage||e.validateMessage;if(G){const ce=i["error-message"],pe=u("errorMessageAlign");return de("div",{class:lr("error-message",pe)},[ce?ce({message:G}):G])}},Ae=()=>{const G=u("colon")?":":"";if(i.label)return[i.label(),G];if(r.label)return de("label",{id:`${t}-label`,for:U()},[r.label+G])},Ie=()=>[de("div",{class:lr("body")},[L(),h.value&&de(Gi,{ref:a,name:r.clearIcon,class:lr("clear")},null),oe(),i.button&&de("div",{class:lr("button")},[i.button()])]),le(),te()];return tv({blur:C,focus:T,validate:v,formValue:f,resetValidation:_,getValidationStatus:V}),Xo(W0,{customValue:s,resetValidation:_,validateWithTrigger:g}),ki(()=>r.modelValue,()=>{x(c()),_(),g("onChange"),Fi(b)}),Si(()=>{x(c(),r.formatTrigger),Fi(b)}),G0("touchstart",A,{target:Er(()=>{var G;return(G=a.value)==null?void 0:G.$el})}),()=>{const G=u("disabled"),ce=u("labelAlign"),pe=Ae(),Pe=J();return de(Im,{size:r.size,icon:r.leftIcon,class:lr({error:R.value,disabled:G,[`label-${ce}`]:ce}),center:r.center,border:r.border,isLink:r.isLink,clickable:r.clickable,titleStyle:D.value,valueClass:lr("value"),titleClass:[lr("label",[ce,{required:r.required}]),r.labelClass],arrowDirection:r.arrowDirection},{icon:Pe?()=>Pe:null,title:pe?()=>pe:null,value:Ie,extra:i.extra})}}});const Jm=Gn(Qm),[Km,Gc]=vn("cell-group"),Zm={title:String,inset:Boolean,border:La};var ey=Qt({name:Km,inheritAttrs:!1,props:Zm,setup(r,{slots:o,attrs:i}){const t=()=>{var n;return de("div",Qo({class:[Gc({inset:r.inset}),{[om]:r.border&&!r.inset}]},i),[(n=o.default)==null?void 0:n.call(o)])},e=()=>de("div",{class:Gc("title",{inset:r.inset})},[o.title?o.title():r.title]);return()=>r.title||o.title?de(hr,null,[e(),t()]):t()}});const ty=Gn(ey),ry={style:{margin:"16px"}},ny=Qt({__name:"dialog",emits:["onload"],setup(r,{expose:o,emit:i}){const t=Mt(""),e=Mt(""),n=l=>{console.log("submit",l)};let a=Mt(null);return Si(()=>{i("onload")}),o({getDom:()=>a.value}),(l,c)=>{const u=Jm,h=ty,f=Em,d=Nm;return Yi(),Qi("div",{class:"tip",ref_key:"divDom",ref:a},[de(d,{onSubmit:n},{default:ho(()=>[de(h,{inset:""},{default:ho(()=>[de(u,{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=_=>t.value=_),name:"\u7528\u6237\u540D",label:"\u7528\u6237\u540D",placeholder:"\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u7528\u6237\u540D"}]},null,8,["modelValue"]),de(u,{modelValue:e.value,"onUpdate:modelValue":c[1]||(c[1]=_=>e.value=_),name:"\u624B\u673A\u53F7",label:"\u624B\u673A\u53F7",placeholder:"\u624B\u673A\u53F7",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u624B\u673A\u53F7"}]},null,8,["modelValue"])]),_:1}),fr("div",ry,[de(f,{round:"",block:"",type:"primary","native-type":"submit"},{default:ho(()=>[Tl(" \u63D0\u4EA4 ")]),_:1})])]),_:1})],512)}}}),Ko=(r,o)=>{const i=r.__vccOpts||r;for(const[t,e]of o)i[t]=e;return i},iy=Ko(ny,[["__scopeId","data-v-33a87b36"]]);var on;(function(r){r[r.Disjoint=0]="Disjoint",r[r.Contains=1]="Contains",r[r.Intersects=2]="Intersects"})(on||(on={}));var Lt;(function(r){r[r.Back=0]="Back",r[r.Front=1]="Front",r[r.Intersecting=2]="Intersecting"})(Lt||(Lt={}));function Hc(r,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Zo(r,o,i){return o&&Hc(r.prototype,o),i&&Hc(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}var Q=function(){function r(){}return r.clamp=function(i,t,e){return Math.max(t,Math.min(e,i))},r.equals=function(i,t){return Math.abs(i-t)<=r.zeroTolerance},r.isPowerOf2=function(i){return(i&i-1)===0},r.radianToDegree=function(i){return i*r.radToDegreeFactor},r.degreeToRadian=function(i){return i*r.degreeToRadFactor},r}();Q.zeroTolerance=1e-6;Q.radToDegreeFactor=180/Math.PI;Q.degreeToRadFactor=Math.PI/180;var y=function(){r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._z=t._z+e._z,n._onValueChanged&&n._onValueChanged()},r.subtract=function(t,e,n){n._x=t._x-e._x,n._y=t._y-e._y,n._z=t._z-e._z,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){n._x=t._x*e._x,n._y=t._y*e._y,n._z=t._z*e._z,n._onValueChanged&&n._onValueChanged()},r.divide=function(t,e,n){n._x=t._x/e._x,n._y=t._y/e._y,n._z=t._z/e._z,n._onValueChanged&&n._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z},r.cross=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=e._x,u=e._y,h=e._z;n.set(s*h-l*u,l*c-a*h,a*u-s*c)},r.distance=function(t,e){var n=e._x-t._x,a=e._y-t._y,s=e._z-t._z;return Math.sqrt(n*n+a*a+s*s)},r.distanceSquared=function(t,e){var n=e._x-t._x,a=e._y-t._y,s=e._z-t._z;return n*n+a*a+s*s},r.equals=function(t,e){return Q.equals(t._x,e._x)&&Q.equals(t._y,e._y)&&Q.equals(t._z,e._z)},r.lerp=function(t,e,n,a){var s=t._x,l=t._y,c=t._z;a._x=s+(e._x-s)*n,a._y=l+(e._y-l)*n,a._z=c+(e._z-c)*n,a._onValueChanged&&a._onValueChanged()},r.max=function(t,e,n){n._x=Math.max(t._x,e._x),n._y=Math.max(t._y,e._y),n._z=Math.max(t._z,e._z),n._onValueChanged&&n._onValueChanged()},r.min=function(t,e,n){n._x=Math.min(t._x,e._x),n._y=Math.min(t._y,e._y),n._z=Math.min(t._z,e._z),n._onValueChanged&&n._onValueChanged()},r.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._onValueChanged&&e._onValueChanged()},r.normalize=function(t,e){var n=t._x,a=t._y,s=t._z,l=Math.sqrt(n*n+a*a+s*s);l>Q.zeroTolerance&&(l=1/l,e.set(n*l,a*l,s*l))},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._z=t._z*e,n._onValueChanged&&n._onValueChanged()},r.transformNormal=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=e.elements;n._x=a*c[0]+s*c[4]+l*c[8],n._y=a*c[1]+s*c[5]+l*c[9],n._z=a*c[2]+s*c[6]+l*c[10],n._onValueChanged&&n._onValueChanged()},r.transformToVec3=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=e.elements;n._x=a*c[0]+s*c[4]+l*c[8]+c[12],n._y=a*c[1]+s*c[5]+l*c[9]+c[13],n._z=a*c[2]+s*c[6]+l*c[10]+c[14],n._onValueChanged&&n._onValueChanged()},r.transformToVec4=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=e.elements;n._x=a*c[0]+s*c[4]+l*c[8]+c[12],n._y=a*c[1]+s*c[5]+l*c[9]+c[13],n._z=a*c[2]+s*c[6]+l*c[10]+c[14],n._w=a*c[3]+s*c[7]+l*c[11]+c[15],n._onValueChanged&&n._onValueChanged()},r.transformCoordinate=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=e.elements,u=a*c[3]+s*c[7]+l*c[11]+c[15];u=1/u,n._x=(a*c[0]+s*c[4]+l*c[8]+c[12])*u,n._y=(a*c[1]+s*c[5]+l*c[9]+c[13])*u,n._z=(a*c[2]+s*c[6]+l*c[10]+c[14])*u,n._onValueChanged&&n._onValueChanged()},r.transformByQuat=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=e._x,u=e._y,h=e._z,f=e._w,d=f*a+u*l-h*s,_=f*s+h*a-c*l,p=f*l+c*s-u*a,v=-c*a-u*s-h*l;n._x=d*f-v*c-_*h+p*u,n._y=_*f-v*u-p*c+d*h,n._z=p*f-v*h-d*u+_*c,n._onValueChanged&&n._onValueChanged()};function r(i,t,e){i===void 0&&(i=0),t===void 0&&(t=0),e===void 0&&(e=0),this._x=void 0,this._y=void 0,this._z=void 0,this._onValueChanged=null,this._x=i,this._y=t,this._z=e}var o=r.prototype;return o.set=function(t,e,n){return this._x=t,this._y=e,this._z=n,this._onValueChanged&&this._onValueChanged(),this},o.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._onValueChanged&&this._onValueChanged(),this},o.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._onValueChanged&&this._onValueChanged(),this},o.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._onValueChanged&&this._onValueChanged(),this},o.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._onValueChanged&&this._onValueChanged(),this},o.length=function(){var t=this._x,e=this._y,n=this._z;return Math.sqrt(t*t+e*e+n*n)},o.lengthSquared=function(){var t=this._x,e=this._y,n=this._z;return t*t+e*e+n*n},o.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._onValueChanged&&this._onValueChanged(),this},o.normalize=function(){return r.normalize(this,this),this},o.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._onValueChanged&&this._onValueChanged(),this},o.transformNormal=function(t){return r.transformNormal(this,t,this),this},o.transformToVec3=function(t){return r.transformToVec3(this,t,this),this},o.transformCoordinate=function(t){return r.transformCoordinate(this,t,this),this},o.transformByQuat=function(t){return r.transformByQuat(this,t,this),this},o.clone=function(){return new r(this._x,this._y,this._z)},o.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._onValueChanged&&this._onValueChanged(),this},o.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._onValueChanged&&this._onValueChanged(),this},o.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z},Zo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}}]),r}();y._zero=new y(0,0,0);y._one=new y(1,1,1);new y;var tn=function(){r.fromCenterAndExtent=function(t,e,n){y.subtract(t,e,n.min),y.add(t,e,n.max)},r.fromPoints=function(t,e){if(!t||t.length===0)throw new Error("points must be array and length must > 0");var n=e.min,a=e.max;n.x=n.y=n.z=Number.MAX_VALUE,a.x=a.y=a.z=-Number.MAX_VALUE;for(var s=0,l=t.length;s<l;++s){var c=t[s];y.min(n,c,n),y.max(a,c,a)}},r.fromSphere=function(t,e){var n=t.center,a=t.radius,s=e.min,l=e.max;s.x=n.x-a,s.y=n.y-a,s.z=n.z-a,l.x=n.x+a,l.y=n.y+a,l.z=n.z+a},r.transform=function(t,e,n){var a=r._tempVec30,s=r._tempVec31;t.getCenter(a),t.getExtent(s),y.transformCoordinate(a,e,a);var l=s.x,c=s.y,u=s.z,h=e.elements;s.x=Math.abs(l*h[0])+Math.abs(c*h[4])+Math.abs(u*h[8]),s.y=Math.abs(l*h[1])+Math.abs(c*h[5])+Math.abs(u*h[9]),s.z=Math.abs(l*h[2])+Math.abs(c*h[6])+Math.abs(u*h[10]),y.subtract(a,s,n.min),y.add(a,s,n.max)},r.merge=function(t,e,n){return y.min(t.min,e.min,n.min),y.max(t.max,e.max,n.max),n};function r(i,t){i===void 0&&(i=null),t===void 0&&(t=null),this.min=new y,this.max=new y,i&&this.min.copyFrom(i),t&&this.max.copyFrom(t)}var o=r.prototype;return o.getCenter=function(t){return y.add(this.min,this.max,t),y.scale(t,.5,t),t},o.getExtent=function(t){return y.subtract(this.max,this.min,t),y.scale(t,.5,t),t},o.getCorners=function(t){t===void 0&&(t=[]);var e=this.min,n=this.max,a=e.x,s=e.y,l=e.z,c=n.x,u=n.y,h=n.z,f=t.length;if(f<8)for(var d=0,_=8-f;d<_;++d)t[f+d]=new y;return t[0].set(a,u,h),t[1].set(c,u,h),t[2].set(c,s,h),t[3].set(a,s,h),t[4].set(a,u,l),t[5].set(c,u,l),t[6].set(c,s,l),t[7].set(a,s,l),t},o.transform=function(t){return r.transform(this,t,this),this},o.clone=function(){return new r(this.min,this.max)},o.copyFrom=function(t){return this.min.copyFrom(t.min),this.max.copyFrom(t.max),this},r}();tn._tempVec30=new y;tn._tempVec31=new y;var pi=function(){function r(){}return r.distancePlaneAndPoint=function(i,t){return y.dot(i.normal,t)+i.distance},r.intersectsPlaneAndPoint=function(i,t){var e=r.distancePlaneAndPoint(i,t);return e>0?Lt.Front:e<0?Lt.Back:Lt.Intersecting},r.intersectsPlaneAndBox=function(i,t){var e=t.min,n=t.max,a=i.normal,s=r._tempVec30,l=r._tempVec31;return a.x>=0?(s.x=n.x,l.x=e.x):(s.x=e.x,l.x=n.x),a.y>=0?(s.y=n.y,l.y=e.y):(s.y=e.y,l.y=n.y),a.z>=0?(s.z=n.z,l.z=e.z):(s.z=e.z,l.z=n.z),r.distancePlaneAndPoint(i,s)<0?Lt.Back:r.distancePlaneAndPoint(i,l)>0?Lt.Front:Lt.Intersecting},r.intersectsPlaneAndSphere=function(i,t){var e=t.center,n=t.radius,a=r.distancePlaneAndPoint(i,e);return a>n?Lt.Front:a<-n?Lt.Back:Lt.Intersecting},r.intersectsRayAndPlane=function(i,t){var e=t.normal,n=Q.zeroTolerance,a=y.dot(e,i.direction);if(Math.abs(a)<n)return-1;var s=y.dot(e,i.origin),l=(-t.distance-s)/a;if(l<0){if(l<-n)return-1;l=0}return l},r.intersectsRayAndBox=function(i,t){var e=Q.zeroTolerance,n=i.origin,a=i.direction,s=t.min,l=t.max,c=a.x,u=a.y,h=a.z,f=n.x,d=n.y,_=n.z,p=0,v=Number.MAX_VALUE;if(Math.abs(c)<e){if(f<s.x||f>l.x)return-1}else{var g=1/c,m=(s.x-f)*g,x=(l.x-f)*g;if(m>x){var w=m;m=x,x=w}if(p=Math.max(m,p),v=Math.min(x,v),p>v)return-1}if(Math.abs(u)<e){if(d<s.y||d>l.y)return-1}else{var C=1/u,T=(s.y-d)*C,b=(l.y-d)*C;if(T>b){var M=T;T=b,b=M}if(p=Math.max(T,p),v=Math.min(b,v),p>v)return-1}if(Math.abs(h)<e){if(_<s.z||_>l.z)return-1}else{var I=1/h,E=(s.z-_)*I,B=(l.z-_)*I;if(E>B){var S=E;E=B,B=S}if(p=Math.max(E,p),v=Math.min(B,v),p>v)return-1}return p},r.intersectsRayAndSphere=function(i,t){var e=i.origin,n=i.direction,a=t.center,s=t.radius,l=r._tempVec30;y.subtract(e,a,l);var c=y.dot(l,n),u=y.dot(l,l)-s*s;if(c>0&&u>0)return-1;var h=c*c-u;if(h<0)return-1;var f=-c-Math.sqrt(h);return f<0&&(f=0),f},r.intersectsBoxAndBox=function(i,t){return i.min.x>t.max.x||t.min.x>i.max.x||i.min.y>t.max.y||t.min.y>i.max.y?!1:!(i.min.z>t.max.z||t.min.z>i.max.z)},r.intersectsSphereAndSphere=function(i,t){var e=i.radius+t.radius;return y.distanceSquared(i.center,t.center)<e*e},r.intersectsSphereAndBox=function(i,t){var e=i.center,n=t.max,a=t.min,s=r._tempVec30;s.set(Math.max(a.x,Math.min(e.x,n.x)),Math.max(a.y,Math.min(e.y,n.y)),Math.max(a.z,Math.min(e.z,n.z)));var l=y.distanceSquared(e,s);return l<=i.radius*i.radius},r.intersectsFrustumAndBox=function(i,t){for(var e=t.min,n=t.max,a=r._tempVec30,s=0;s<6;++s){var l=i.getPlane(s),c=l.normal;if(a.set(c.x>=0?e.x:n.x,c.y>=0?e.y:n.y,c.z>=0?e.z:n.z),y.dot(c,a)>-l.distance)return!1}return!0},r.frustumContainsBox=function(i,t){for(var e=t.min,n=t.max,a=r._tempVec30,s=r._tempVec31,l=on.Contains,c=0;c<6;++c){var u=i.getPlane(c),h=u.normal;if(h.x>=0?(a.x=n.x,s.x=e.x):(a.x=e.x,s.x=n.x),h.y>=0?(a.y=n.y,s.y=e.y):(a.y=e.y,s.y=n.y),h.z>=0?(a.z=n.z,s.z=e.z):(a.z=e.z,s.z=n.z),r.intersectsPlaneAndPoint(u,s)===Lt.Front)return on.Disjoint;r.intersectsPlaneAndPoint(u,a)===Lt.Front&&(l=on.Intersects)}return l},r.frustumContainsSphere=function(i,t){for(var e=on.Contains,n=0;n<6;++n){var a=i.getPlane(n),s=r.intersectsPlaneAndSphere(a,t);if(s===Lt.Front)return on.Disjoint;if(s===Lt.Intersecting){e=on.Intersects;break}}return e},r}();pi._tempVec30=new y;pi._tempVec31=new y;var Ti=function(){r.normalize=function(t,e){var n=t.normal,a=1/n.length();y.scale(n,a,e.normal),e.distance=t.distance*a},r.fromPoints=function(t,e,n,a){var s=t.x,l=t.y,c=t.z,u=e.x-s,h=e.y-l,f=e.z-c,d=n.x-s,_=n.y-l,p=n.z-c,v=h*p-f*_,g=f*d-u*p,m=u*_-h*d,x=1/Math.sqrt(v*v+g*g+m*m),w=v*x,C=g*x,T=m*x,b=a.normal;b.x=w,b.y=C,b.z=T,a.distance=-(w*s+C*l+T*c)};function r(i,t){i===void 0&&(i=null),t===void 0&&(t=0),this.normal=new y,this.distance=0,i&&this.normal.copyFrom(i),this.distance=t}var o=r.prototype;return o.normalize=function(){return r.normalize(this,this),this},o.clone=function(){var t=new r;return t.copyFrom(this),t},o.copyFrom=function(t){return this.normal.copyFrom(t.normal),this.distance=t.distance,this},r}(),ay=function(){function r(i){i===void 0&&(i=null),this.near=void 0,this.far=void 0,this.left=void 0,this.right=void 0,this.top=void 0,this.bottom=void 0,this.near=new Ti,this.far=new Ti,this.left=new Ti,this.right=new Ti,this.top=new Ti,this.bottom=new Ti,i&&this.calculateFromMatrix(i)}var o=r.prototype;return o.getPlane=function(t){switch(t){case 0:return this.near;case 1:return this.far;case 2:return this.left;case 3:return this.right;case 4:return this.top;case 5:return this.bottom;default:return null}},o.calculateFromMatrix=function(t){var e=t.elements,n=e[0],a=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],f=e[7],d=e[8],_=e[9],p=e[10],v=e[11],g=e[12],m=e[13],x=e[14],w=e[15],C=this.near.normal;C.set(-l-s,-f-h,-v-p),this.near.distance=-w-x,this.near.normalize();var T=this.far.normal;T.set(s-l,h-f,p-v),this.far.distance=x-w,this.far.normalize();var b=this.left.normal;b.set(-l-n,-f-c,-v-d),this.left.distance=-w-g,this.left.normalize();var M=this.right.normal;M.set(n-l,c-f,d-v),this.right.distance=g-w,this.right.normalize();var I=this.top.normal;I.set(a-l,u-f,_-v),this.top.distance=m-w,this.top.normalize();var E=this.bottom.normal;E.set(-l-a,-f-u,-v-_),this.bottom.distance=-w-m,this.bottom.normalize()},o.intersectsBox=function(t){return pi.intersectsFrustumAndBox(this,t)},o.intersectsSphere=function(t){return pi.frustumContainsSphere(this,t)!==on.Disjoint},o.clone=function(){var t=new r;return t.copyFrom(this),t},o.copyFrom=function(t){return this.near.copyFrom(t.near),this.far.copyFrom(t.far),this.left.copyFrom(t.left),this.right.copyFrom(t.right),this.top.copyFrom(t.top),this.bottom.copyFrom(t.bottom),this},r}(),Ri=function(){r.add=function(t,e,n){var a=t.elements,s=e.elements,l=n.elements;l[0]=a[0]+s[0],l[1]=a[1]+s[1],l[2]=a[2]+s[2],l[3]=a[3]+s[3],l[4]=a[4]+s[4],l[5]=a[5]+s[5],l[6]=a[6]+s[6],l[7]=a[7]+s[7],l[8]=a[8]+s[8]},r.subtract=function(t,e,n){var a=t.elements,s=e.elements,l=n.elements;l[0]=a[0]-s[0],l[1]=a[1]-s[1],l[2]=a[2]-s[2],l[3]=a[3]-s[3],l[4]=a[4]-s[4],l[5]=a[5]-s[5],l[6]=a[6]-s[6],l[7]=a[7]-s[7],l[8]=a[8]-s[8]},r.multiply=function(t,e,n){var a=t.elements,s=e.elements,l=n.elements,c=a[0],u=a[1],h=a[2],f=a[3],d=a[4],_=a[5],p=a[6],v=a[7],g=a[8],m=s[0],x=s[1],w=s[2],C=s[3],T=s[4],b=s[5],M=s[6],I=s[7],E=s[8];l[0]=c*m+f*x+p*w,l[1]=u*m+d*x+v*w,l[2]=h*m+_*x+g*w,l[3]=c*C+f*T+p*b,l[4]=u*C+d*T+v*b,l[5]=h*C+_*T+g*b,l[6]=c*M+f*I+p*E,l[7]=u*M+d*I+v*E,l[8]=h*M+_*I+g*E},r.equals=function(t,e){var n=t.elements,a=e.elements;return Q.equals(n[0],a[0])&&Q.equals(n[1],a[1])&&Q.equals(n[2],a[2])&&Q.equals(n[3],a[3])&&Q.equals(n[4],a[4])&&Q.equals(n[5],a[5])&&Q.equals(n[6],a[6])&&Q.equals(n[7],a[7])&&Q.equals(n[8],a[8])},r.lerp=function(t,e,n,a){var s=t.elements,l=e.elements,c=a.elements,u=1-n;c[0]=s[0]*u+l[0]*n,c[1]=s[1]*u+l[1]*n,c[2]=s[2]*u+l[2]*n,c[3]=s[3]*u+l[3]*n,c[4]=s[4]*u+l[4]*n,c[5]=s[5]*u+l[5]*n,c[6]=s[6]*u+l[6]*n,c[7]=s[7]*u+l[7]*n,c[8]=s[8]*u+l[8]*n},r.rotationQuaternion=function(t,e){var n=e.elements,a=t._x,s=t._y,l=t._z,c=t._w,u=a+a,h=s+s,f=l+l,d=a*u,_=s*u,p=s*h,v=l*u,g=l*h,m=l*f,x=c*u,w=c*h,C=c*f;n[0]=1-p-m,n[3]=_-C,n[6]=v+w,n[1]=_+C,n[4]=1-d-m,n[7]=g-x,n[2]=v-w,n[5]=g+x,n[8]=1-d-p},r.scaling=function(t,e){var n=e.elements;n[0]=t._x,n[1]=0,n[2]=0,n[3]=0,n[4]=t._y,n[5]=0,n[6]=0,n[7]=0,n[8]=1},r.translation=function(t,e){var n=e.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=t._x,n[7]=t._y,n[8]=1},r.invert=function(t,e){var n=t.elements,a=e.elements,s=n[0],l=n[1],c=n[2],u=n[3],h=n[4],f=n[5],d=n[6],_=n[7],p=n[8],v=p*h-f*_,g=-p*u+f*d,m=_*u-h*d,x=s*v+l*g+c*m;!x||(x=1/x,a[0]=v*x,a[1]=(-p*l+c*_)*x,a[2]=(f*l-c*h)*x,a[3]=g*x,a[4]=(p*s-c*d)*x,a[5]=(-f*s+c*u)*x,a[6]=m*x,a[7]=(-_*s+l*d)*x,a[8]=(h*s-l*u)*x)},r.normalMatrix=function(t,e){var n=t.elements,a=e.elements,s=n[0],l=n[1],c=n[2],u=n[3],h=n[4],f=n[5],d=n[6],_=n[7],p=n[8],v=n[9],g=n[10],m=n[11],x=n[12],w=n[13],C=n[14],T=n[15],b=s*f-l*h,M=s*d-c*h,I=s*_-u*h,E=l*d-c*f,B=l*_-u*f,S=c*_-u*d,A=p*w-v*x,R=p*C-g*x,D=p*T-m*x,z=v*C-g*w,U=v*T-m*w,V=g*T-m*C,L=b*V-M*U+I*z+E*D-B*R+S*A;if(!L)return null;L=1/L,a[0]=(f*V-d*U+_*z)*L,a[1]=(d*D-h*V-_*R)*L,a[2]=(h*U-f*D+_*A)*L,a[3]=(c*U-l*V-u*z)*L,a[4]=(s*V-c*D+u*R)*L,a[5]=(l*D-s*U-u*A)*L,a[6]=(w*S-C*B+T*E)*L,a[7]=(C*I-x*S-T*M)*L,a[8]=(x*B-w*I+T*b)*L},r.rotate=function(t,e,n){var a=t.elements,s=n.elements,l=Math.sin(e),c=Math.cos(e),u=a[0],h=a[1],f=a[2],d=a[3],_=a[4],p=a[5],v=a[6],g=a[7],m=a[8];s[0]=c*u+l*d,s[1]=c*h+l*_,s[2]=c*f+l*p,s[3]=c*d-l*u,s[4]=c*_-l*h,s[5]=c*p-l*f,s[6]=v,s[7]=g,s[8]=m},r.scale=function(t,e,n){var a=e._x,s=e._y,l=t.elements,c=n.elements;c[0]=a*l[0],c[1]=a*l[1],c[2]=a*l[2],c[3]=s*l[3],c[4]=s*l[4],c[5]=s*l[5],c[6]=l[6],c[7]=l[7],c[8]=l[8]},r.translate=function(t,e,n){var a=e._x,s=e._y,l=t.elements,c=n.elements,u=l[0],h=l[1],f=l[2],d=l[3],_=l[4],p=l[5],v=l[6],g=l[7],m=l[8];c[0]=u,c[1]=h,c[2]=f,c[3]=d,c[4]=_,c[5]=p,c[6]=a*u+s*d+v,c[7]=a*h+s*_+g,c[8]=a*f+s*p+m},r.transpose=function(t,e){var n=t.elements,a=e.elements;if(e===t){var s=n[1],l=n[2],c=n[5];a[1]=n[3],a[2]=n[6],a[3]=s,a[5]=n[7],a[6]=l,a[7]=c}else a[0]=n[0],a[1]=n[3],a[2]=n[6],a[3]=n[1],a[4]=n[4],a[5]=n[7],a[6]=n[2],a[7]=n[5],a[8]=n[8]};function r(i,t,e,n,a,s,l,c,u){i===void 0&&(i=1),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),a===void 0&&(a=1),s===void 0&&(s=0),l===void 0&&(l=0),c===void 0&&(c=0),u===void 0&&(u=1),this.elements=new Float32Array(9);var h=this.elements;h[0]=i,h[1]=t,h[2]=e,h[3]=n,h[4]=a,h[5]=s,h[6]=l,h[7]=c,h[8]=u}var o=r.prototype;return o.set=function(t,e,n,a,s,l,c,u,h){var f=this.elements;return f[0]=t,f[1]=e,f[2]=n,f[3]=a,f[4]=s,f[5]=l,f[6]=c,f[7]=u,f[8]=h,this},o.add=function(t){return r.add(this,t,this),this},o.subtract=function(t){return r.subtract(this,t,this),this},o.multiply=function(t){return r.multiply(this,t,this),this},o.determinant=function(){var t=this.elements,e=t[0],n=t[1],a=t[2],s=t[3],l=t[4],c=t[5],u=t[6],h=t[7],f=t[8],d=f*l-c*h,_=-f*s+c*u,p=h*s-l*u;return e*d+n*_+a*p},o.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},o.invert=function(){return r.invert(this,this),this},o.rotate=function(t){return r.rotate(this,t,this),this},o.scale=function(t){return r.scale(this,t,this),this},o.translate=function(t){return r.translate(this,t,this),this},o.transpose=function(){return r.transpose(this,this),this},o.clone=function(){var t=this.elements,e=new r(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);return e},o.copyFrom=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},o.copyFromArray=function(t,e){e===void 0&&(e=0);for(var n=this.elements,a=0;a<12;a++)n[a]=t[a+e];return this},o.copyToArray=function(t,e){e===void 0&&(e=0);var n=this.elements;t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8]},o.copyFromMatrix=function(t){var e=t.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],this},r}(),Me=function(){r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._z=t._z+e._z,n._w=t._w+e._w,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=t._w,u=e._x,h=e._y,f=e._z,d=e._w;n._x=a*d+c*u+s*f-l*h,n._y=s*d+c*h+l*u-a*f,n._z=l*d+c*f+a*h-s*u,n._w=c*d-a*u-s*h-l*f,n._onValueChanged&&n._onValueChanged()},r.conjugate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=t._w,e._onValueChanged&&e._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},r.equals=function(t,e){return Q.equals(t._x,e._x)&&Q.equals(t._y,e._y)&&Q.equals(t._z,e._z)&&Q.equals(t._w,e._w)},r.rotationAxisAngle=function(t,e,n){var a=r._tempVector3;y.normalize(t,a),e*=.5;var s=Math.sin(e);n._x=a._x*s,n._y=a._y*s,n._z=a._z*s,n._w=Math.cos(e),n._onValueChanged&&n._onValueChanged()},r.rotationEuler=function(t,e,n,a){r.rotationYawPitchRoll(e,t,n,a)},r.rotationYawPitchRoll=function(t,e,n,a){var s=n*.5,l=e*.5,c=t*.5,u=Math.sin(s),h=Math.cos(s),f=Math.sin(l),d=Math.cos(l),_=Math.sin(c),p=Math.cos(c),v=p*d,g=_*f;a._x=p*f*h+_*d*u,a._y=_*d*h-p*f*u,a._z=v*u-g*h,a._w=v*h+g*u,a._onValueChanged&&a._onValueChanged()},r.rotationMatrix3x3=function(t,e){var n=t.elements,a=n[0],s=n[1],l=n[2],c=n[3],u=n[4],h=n[5],f=n[6],d=n[7],_=n[8],p=a+u+_,v,g;p>0?(v=Math.sqrt(p+1),e._w=v*.5,v=.5/v,e._x=(h-d)*v,e._y=(f-l)*v,e._z=(s-c)*v):a>=u&&a>=_?(v=Math.sqrt(1+a-u-_),g=.5/v,e._x=.5*v,e._y=(s+c)*g,e._z=(l+f)*g,e._w=(h-d)*g):u>_?(v=Math.sqrt(1+u-a-_),g=.5/v,e._x=(c+s)*g,e._y=.5*v,e._z=(d+h)*g,e._w=(f-l)*g):(v=Math.sqrt(1+_-a-u),g=.5/v,e._x=(l+f)*g,e._y=(h+d)*g,e._z=.5*v,e._w=(s-c)*g),e._onValueChanged&&e._onValueChanged()},r.invert=function(t,e){var n=t._x,a=t._y,s=t._z,l=t._w,c=n*n+a*a+s*s+l*l;if(c>Q.zeroTolerance){var u=1/c;e._x=-n*u,e._y=-a*u,e._z=-s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged()}},r.lerp=function(t,e,n,a){var s=1-n;r.dot(t,e)>=0?(a._x=t._x*s+e._x*n,a._y=t._y*s+e._y*n,a._z=t._z*s+e._z*n,a._w=t._w*s+e._w*n):(a._x=t._x*s-e._x*n,a._y=t._y*s-e._y*n,a._z=t._z*s-e._z*n,a._w=t._w*s-e._w*n),a.normalize()},r.slerp=function(t,e,n,a){var s=t._x,l=t._y,c=t._z,u=t._w,h=e._x,f=e._y,d=e._z,_=e._w,p,v,g=s*h+l*f+c*d+u*_;if(g<0&&(g=-g,h=-h,f=-f,d=-d,_=-_),1-g>Q.zeroTolerance){var m=Math.acos(g),x=Math.sin(m);p=Math.sin((1-n)*m)/x,v=Math.sin(n*m)/x}else p=1-n,v=n;a._x=p*s+v*h,a._y=p*l+v*f,a._z=p*c+v*d,a._w=p*u+v*_,a._onValueChanged&&a._onValueChanged()},r.normalize=function(t,e){var n=t._x,a=t._y,s=t._z,l=t._w,c=Math.sqrt(n*n+a*a+s*s+l*l);c>Q.zeroTolerance&&(c=1/c,e._x=n*c,e._y=a*c,e._z=s*c,e._w=l*c,e._onValueChanged&&e._onValueChanged())},r.rotationX=function(t,e){t*=.5;var n=Math.sin(t),a=Math.cos(t);e._x=n,e._y=0,e._z=0,e._w=a,e._onValueChanged&&e._onValueChanged()},r.rotationY=function(t,e){t*=.5;var n=Math.sin(t),a=Math.cos(t);e._x=0,e._y=n,e._z=0,e._w=a,e._onValueChanged&&e._onValueChanged()},r.rotationZ=function(t,e){t*=.5;var n=Math.sin(t),a=Math.cos(t);e._x=0,e._y=0,e._z=n,e._w=a,e._onValueChanged&&e._onValueChanged()},r.rotateX=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=t._w;e*=.5;var u=Math.sin(e),h=Math.cos(e);n._x=a*h+c*u,n._y=s*h+l*u,n._z=l*h-s*u,n._w=c*h-a*u,n._onValueChanged&&n._onValueChanged()},r.rotateY=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=t._w;e*=.5;var u=Math.sin(e),h=Math.cos(e);n._x=a*h-l*u,n._y=s*h+c*u,n._z=l*h+a*u,n._w=c*h-s*u,n._onValueChanged&&n._onValueChanged()},r.rotateZ=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=t._w;e*=.5;var u=Math.sin(e),h=Math.cos(e);n._x=a*h+s*u,n._y=s*h-a*u,n._z=l*h+c*u,n._w=c*h-l*u,n._onValueChanged&&n._onValueChanged()},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._z=t._z*e,n._w=t._w*e,n._onValueChanged&&n._onValueChanged()};function r(i,t,e,n){i===void 0&&(i=0),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=1),this._x=void 0,this._y=void 0,this._z=void 0,this._w=void 0,this._onValueChanged=null,this._x=i,this._y=t,this._z=e,this._w=n}var o=r.prototype;return o.set=function(t,e,n,a){return this._x=t,this._y=e,this._z=n,this._w=a,this._onValueChanged&&this._onValueChanged(),this},o.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onValueChanged&&this._onValueChanged(),this},o.getAxisAngle=function(t){var e=this._x,n=this._y,a=this._z,s=e*e+n*n+a*a;if(s<Q.zeroTolerance)return t._x=1,t._y=0,t._z=0,0;var l=1/s;return t._x=this._x*l,t._y=this._y*l,t._z=this._z*l,Math.acos(this._w)*2},o.identity=function(){return this._x=0,this._y=0,this._z=0,this._w=1,this._onValueChanged&&this._onValueChanged(),this},o.length=function(){var t=this._x,e=this._y,n=this._z,a=this._w;return Math.sqrt(t*t+e*e+n*n+a*a)},o.lengthSquared=function(){var t=this._x,e=this._y,n=this._z,a=this._w;return t*t+e*e+n*n+a*a},o.normalize=function(){return r.normalize(this,this),this},o.toEuler=function(t){this._toYawPitchRoll(t);var e=t._x;return t._x=t._y,t._y=e,t._onValueChanged&&t._onValueChanged(),t},o.toYawPitchRoll=function(t){return this._toYawPitchRoll(t),t._onValueChanged&&t._onValueChanged(),t},o.rotateX=function(t){return r.rotateX(this,t,this),this},o.rotateY=function(t){return r.rotateY(this,t,this),this},o.rotateZ=function(t){return r.rotateZ(this,t,this),this},o.rotationAxisAngle=function(t,e){return r.rotationAxisAngle(t,e,this),this},o.multiply=function(t){return r.multiply(this,t,this),this},o.invert=function(){return r.invert(this,this),this},o.dot=function(t){return r.dot(this,t)},o.lerp=function(t,e){return r.lerp(this,t,e,this),this},o.rotateAxisAngle=function(t,e){return r._tempQuat1.rotationAxisAngle(t,e),this.multiply(r._tempQuat1),this},o.clone=function(){return new r(this._x,this._y,this._z,this._w)},o.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},o.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},o.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},o._toYawPitchRoll=function(t){var e=this._x,n=this._y,a=this._z,s=this._w,l=e*e,c=n*n,u=a*a,h=e*n,f=a*s,d=a*e,_=n*s,p=n*a,v=e*s;return t._y=Math.asin(2*(v-p)),Math.cos(t.y)>Q.zeroTolerance?(t._z=Math.atan2(2*(h+f),1-2*(u+l)),t._x=Math.atan2(2*(d+_),1-2*(c+l))):(t._z=Math.atan2(-2*(h-f),1-2*(c+u)),t._x=0),t},Zo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"normalized",get:function(){return Math.abs(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w-1)<Q.zeroTolerance}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),r}();Me._tempVector3=new y;Me._tempQuat1=new Me;var ge=function(){r.multiply=function(t,e,n){var a=t.elements,s=e.elements,l=n.elements,c=a[0],u=a[1],h=a[2],f=a[3],d=a[4],_=a[5],p=a[6],v=a[7],g=a[8],m=a[9],x=a[10],w=a[11],C=a[12],T=a[13],b=a[14],M=a[15],I=s[0],E=s[1],B=s[2],S=s[3],A=s[4],R=s[5],D=s[6],z=s[7],U=s[8],V=s[9],L=s[10],J=s[11],oe=s[12],le=s[13],te=s[14],Ae=s[15];l[0]=c*I+d*E+g*B+C*S,l[1]=u*I+_*E+m*B+T*S,l[2]=h*I+p*E+x*B+b*S,l[3]=f*I+v*E+w*B+M*S,l[4]=c*A+d*R+g*D+C*z,l[5]=u*A+_*R+m*D+T*z,l[6]=h*A+p*R+x*D+b*z,l[7]=f*A+v*R+w*D+M*z,l[8]=c*U+d*V+g*L+C*J,l[9]=u*U+_*V+m*L+T*J,l[10]=h*U+p*V+x*L+b*J,l[11]=f*U+v*V+w*L+M*J,l[12]=c*oe+d*le+g*te+C*Ae,l[13]=u*oe+_*le+m*te+T*Ae,l[14]=h*oe+p*le+x*te+b*Ae,l[15]=f*oe+v*le+w*te+M*Ae},r.equals=function(t,e){var n=t.elements,a=e.elements;return Q.equals(n[0],a[0])&&Q.equals(n[1],a[1])&&Q.equals(n[2],a[2])&&Q.equals(n[3],a[3])&&Q.equals(n[4],a[4])&&Q.equals(n[5],a[5])&&Q.equals(n[6],a[6])&&Q.equals(n[7],a[7])&&Q.equals(n[8],a[8])&&Q.equals(n[9],a[9])&&Q.equals(n[10],a[10])&&Q.equals(n[11],a[11])&&Q.equals(n[12],a[12])&&Q.equals(n[13],a[13])&&Q.equals(n[14],a[14])&&Q.equals(n[15],a[15])},r.lerp=function(t,e,n,a){var s=t.elements,l=e.elements,c=a.elements,u=1-n;c[0]=s[0]*u+l[0]*n,c[1]=s[1]*u+l[1]*n,c[2]=s[2]*u+l[2]*n,c[3]=s[3]*u+l[3]*n,c[4]=s[4]*u+l[4]*n,c[5]=s[5]*u+l[5]*n,c[6]=s[6]*u+l[6]*n,c[7]=s[7]*u+l[7]*n,c[8]=s[8]*u+l[8]*n,c[9]=s[9]*u+l[9]*n,c[10]=s[10]*u+l[10]*n,c[11]=s[11]*u+l[11]*n,c[12]=s[12]*u+l[12]*n,c[13]=s[13]*u+l[13]*n,c[14]=s[14]*u+l[14]*n,c[15]=s[15]*u+l[15]*n},r.rotationQuaternion=function(t,e){var n=e.elements,a=t._x,s=t._y,l=t._z,c=t._w,u=a+a,h=s+s,f=l+l,d=a*u,_=s*u,p=s*h,v=l*u,g=l*h,m=l*f,x=c*u,w=c*h,C=c*f;n[0]=1-p-m,n[1]=_+C,n[2]=v-w,n[3]=0,n[4]=_-C,n[5]=1-d-m,n[6]=g+x,n[7]=0,n[8]=v+w,n[9]=g-x,n[10]=1-d-p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},r.rotationAxisAngle=function(t,e,n){var a=n.elements,s=t._x,l=t._y,c=t._z,u=Math.sqrt(s*s+l*l+c*c),h,f,d;Math.abs(u)<Q.zeroTolerance||(u=1/u,s*=u,l*=u,c*=u,h=Math.sin(e),f=Math.cos(e),d=1-f,a[0]=s*s*d+f,a[1]=l*s*d+c*h,a[2]=c*s*d-l*h,a[3]=0,a[4]=s*l*d-c*h,a[5]=l*l*d+f,a[6]=c*l*d+s*h,a[7]=0,a[8]=s*c*d+l*h,a[9]=l*c*d-s*h,a[10]=c*c*d+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1)},r.rotationTranslation=function(t,e,n){r.rotationQuaternion(t,n);var a=n.elements;a[12]=e._x,a[13]=e._y,a[14]=e._z},r.affineTransformation=function(t,e,n,a){var s=a.elements,l=e._x,c=e._y,u=e._z,h=e._w,f=l+l,d=c+c,_=u+u,p=l*f,v=l*d,g=l*_,m=c*d,x=c*_,w=u*_,C=h*f,T=h*d,b=h*_,M=t._x,I=t._y,E=t._z;s[0]=(1-(m+w))*M,s[1]=(v+b)*M,s[2]=(g-T)*M,s[3]=0,s[4]=(v-b)*I,s[5]=(1-(p+w))*I,s[6]=(x+C)*I,s[7]=0,s[8]=(g+T)*E,s[9]=(x-C)*E,s[10]=(1-(p+m))*E,s[11]=0,s[12]=n._x,s[13]=n._y,s[14]=n._z,s[15]=1},r.scaling=function(t,e){var n=e.elements;n[0]=t._x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t._y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t._z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},r.translation=function(t,e){var n=e.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t._x,n[13]=t._y,n[14]=t._z,n[15]=1},r.invert=function(t,e){var n=t.elements,a=e.elements,s=n[0],l=n[1],c=n[2],u=n[3],h=n[4],f=n[5],d=n[6],_=n[7],p=n[8],v=n[9],g=n[10],m=n[11],x=n[12],w=n[13],C=n[14],T=n[15],b=s*f-l*h,M=s*d-c*h,I=s*_-u*h,E=l*d-c*f,B=l*_-u*f,S=c*_-u*d,A=p*w-v*x,R=p*C-g*x,D=p*T-m*x,z=v*C-g*w,U=v*T-m*w,V=g*T-m*C,L=b*V-M*U+I*z+E*D-B*R+S*A;if(!L)return null;L=1/L,a[0]=(f*V-d*U+_*z)*L,a[1]=(c*U-l*V-u*z)*L,a[2]=(w*S-C*B+T*E)*L,a[3]=(g*B-v*S-m*E)*L,a[4]=(d*D-h*V-_*R)*L,a[5]=(s*V-c*D+u*R)*L,a[6]=(C*I-x*S-T*M)*L,a[7]=(p*S-g*I+m*M)*L,a[8]=(h*U-f*D+_*A)*L,a[9]=(l*D-s*U-u*A)*L,a[10]=(x*B-w*I+T*b)*L,a[11]=(v*I-p*B-m*b)*L,a[12]=(f*R-h*z-d*A)*L,a[13]=(s*z-l*R+c*A)*L,a[14]=(w*M-x*E-C*b)*L,a[15]=(p*E-v*M+g*b)*L},r.lookAt=function(t,e,n,a){var s=a.elements,l=r._tempVec30,c=r._tempVec31,u=r._tempVec32;y.subtract(t,e,u),u.normalize(),y.cross(n,u,l),l.normalize(),y.cross(u,l,c),s[0]=l._x,s[1]=c._x,s[2]=u._x,s[3]=0,s[4]=l._y,s[5]=c._y,s[6]=u._y,s[7]=0,s[8]=l._z,s[9]=c._z,s[10]=u._z,s[11]=0,s[12]=-y.dot(l,t),s[13]=-y.dot(c,t),s[14]=-y.dot(u,t),s[15]=1},r.ortho=function(t,e,n,a,s,l,c){var u=c.elements,h=1/(t-e),f=1/(n-a),d=1/(s-l);u[0]=-2*h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*f,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*d,u[11]=0,u[12]=(t+e)*h,u[13]=(a+n)*f,u[14]=(l+s)*d,u[15]=1},r.perspective=function(t,e,n,a,s){var l=s.elements,c=1/Math.tan(t/2),u=1/(n-a);l[0]=c/e,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=c,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=(a+n)*u,l[11]=-1,l[12]=0,l[13]=0,l[14]=2*a*n*u,l[15]=0},r.rotateAxisAngle=function(t,e,n,a){var s=e._x,l=e._y,c=e._z,u=Math.sqrt(s*s+l*l+c*c);if(!(Math.abs(u)<Q.zeroTolerance)){var h=t.elements,f=a.elements,d,_,p;u=1/u,s*=u,l*=u,c*=u,d=Math.sin(n),_=Math.cos(n),p=1-_;var v=h[0],g=h[1],m=h[2],x=h[3],w=h[4],C=h[5],T=h[6],b=h[7],M=h[8],I=h[9],E=h[10],B=h[11],S=s*s*p+_,A=l*s*p+c*d,R=c*s*p-l*d,D=s*l*p-c*d,z=l*l*p+_,U=c*l*p+s*d,V=s*c*p+l*d,L=l*c*p-s*d,J=c*c*p+_;f[0]=v*S+w*A+M*R,f[1]=g*S+C*A+I*R,f[2]=m*S+T*A+E*R,f[3]=x*S+b*A+B*R,f[4]=v*D+w*z+M*U,f[5]=g*D+C*z+I*U,f[6]=m*D+T*z+E*U,f[7]=x*D+b*z+B*U,f[8]=v*V+w*L+M*J,f[9]=g*V+C*L+I*J,f[10]=m*V+T*L+E*J,f[11]=x*V+b*L+B*J,t!==a&&(f[12]=h[12],f[13]=h[13],f[14]=h[14],f[15]=h[15])}},r.scale=function(t,e,n){var a=t.elements,s=n.elements,l=e._x,c=e._y,u=e._z;s[0]=a[0]*l,s[1]=a[1]*l,s[2]=a[2]*l,s[3]=a[3]*l,s[4]=a[4]*c,s[5]=a[5]*c,s[6]=a[6]*c,s[7]=a[7]*c,s[8]=a[8]*u,s[9]=a[9]*u,s[10]=a[10]*u,s[11]=a[11]*u,s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15]},r.translate=function(t,e,n){var a=t.elements,s=n.elements,l=e._x,c=e._y,u=e._z;if(t===n)s[12]=a[0]*l+a[4]*c+a[8]*u+a[12],s[13]=a[1]*l+a[5]*c+a[9]*u+a[13],s[14]=a[2]*l+a[6]*c+a[10]*u+a[14],s[15]=a[3]*l+a[7]*c+a[11]*u+a[15];else{var h=a[0],f=a[1],d=a[2],_=a[3],p=a[4],v=a[5],g=a[6],m=a[7],x=a[8],w=a[9],C=a[10],T=a[11];s[0]=h,s[1]=f,s[2]=d,s[3]=_,s[4]=p,s[5]=v,s[6]=g,s[7]=m,s[8]=x,s[9]=w,s[10]=C,s[11]=T,s[12]=h*l+p*c+x*u+a[12],s[13]=f*l+v*c+w*u+a[13],s[14]=d*l+g*c+C*u+a[14],s[15]=_*l+m*c+T*u+a[15]}},r.transpose=function(t,e){var n=t.elements,a=e.elements;if(e===t){var s=n[1],l=n[2],c=n[3],u=n[6],h=n[7],f=n[11];a[1]=n[4],a[2]=n[8],a[3]=n[12],a[4]=s,a[6]=n[9],a[7]=n[13],a[8]=l,a[9]=u,a[11]=n[14],a[12]=c,a[13]=h,a[14]=f}else a[0]=n[0],a[1]=n[4],a[2]=n[8],a[3]=n[12],a[4]=n[1],a[5]=n[5],a[6]=n[9],a[7]=n[13],a[8]=n[2],a[9]=n[6],a[10]=n[10],a[11]=n[14],a[12]=n[3],a[13]=n[7],a[14]=n[11],a[15]=n[15]};function r(i,t,e,n,a,s,l,c,u,h,f,d,_,p,v,g){i===void 0&&(i=1),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),a===void 0&&(a=0),s===void 0&&(s=1),l===void 0&&(l=0),c===void 0&&(c=0),u===void 0&&(u=0),h===void 0&&(h=0),f===void 0&&(f=1),d===void 0&&(d=0),_===void 0&&(_=0),p===void 0&&(p=0),v===void 0&&(v=0),g===void 0&&(g=1),this.elements=new Float32Array(16);var m=this.elements;m[0]=i,m[1]=t,m[2]=e,m[3]=n,m[4]=a,m[5]=s,m[6]=l,m[7]=c,m[8]=u,m[9]=h,m[10]=f,m[11]=d,m[12]=_,m[13]=p,m[14]=v,m[15]=g}var o=r.prototype;return o.set=function(t,e,n,a,s,l,c,u,h,f,d,_,p,v,g,m){var x=this.elements;return x[0]=t,x[1]=e,x[2]=n,x[3]=a,x[4]=s,x[5]=l,x[6]=c,x[7]=u,x[8]=h,x[9]=f,x[10]=d,x[11]=_,x[12]=p,x[13]=v,x[14]=g,x[15]=m,this},o.multiply=function(t){return r.multiply(this,t,this),this},o.determinant=function(){var t=this.elements,e=t[0],n=t[1],a=t[2],s=t[3],l=t[4],c=t[5],u=t[6],h=t[7],f=t[8],d=t[9],_=t[10],p=t[11],v=t[12],g=t[13],m=t[14],x=t[15],w=e*c-n*l,C=e*u-a*l,T=e*h-s*l,b=n*u-a*c,M=n*h-s*c,I=a*h-s*u,E=f*g-d*v,B=f*m-_*v,S=f*x-p*v,A=d*m-_*g,R=d*x-p*g,D=_*x-p*m;return w*D-C*R+T*A+b*S-M*B+I*E},o.decompose=function(t,e,n){var a=r._tempMat30,s=this.elements,l=a.elements,c=s[0],u=s[1],h=s[2],f=s[3],d=s[4],_=s[5],p=s[6],v=s[7],g=s[8],m=s[9],x=s[10],w=s[11];t.set(s[12],s[13],s[14]);var C=Math.sign(c*u*h*f)<0?-1:1,T=Math.sign(d*_*p*v)<0?-1:1,b=Math.sign(g*m*x*w)<0?-1:1,M=C*Math.sqrt(c*c+u*u+h*h),I=T*Math.sqrt(d*d+_*_+p*p),E=b*Math.sqrt(g*g+m*m+x*x);if(n.set(M,I,E),Math.abs(M)<Q.zeroTolerance||Math.abs(I)<Q.zeroTolerance||Math.abs(E)<Q.zeroTolerance)return e.identity(),!1;var B=1/M,S=1/I,A=1/E;return l[0]=c*B,l[1]=u*B,l[2]=h*B,l[3]=d*S,l[4]=_*S,l[5]=p*S,l[6]=g*A,l[7]=m*A,l[8]=x*A,Me.rotationMatrix3x3(a,e),!0},o.getRotation=function(t){var e=this.elements,n=e[0]+e[5]+e[10];if(n>Q.zeroTolerance){var a=Math.sqrt(n+1)*2;t._w=.25*a,t._x=(e[6]-e[9])/a,t._y=(e[8]-e[2])/a,t._z=(e[1]-e[4])/a}else if(e[0]>e[5]&&e[0]>e[10]){var s=Math.sqrt(1+e[0]-e[5]-e[10])*2;t._w=(e[6]-e[9])/s,t._x=.25*s,t._y=(e[1]+e[4])/s,t._z=(e[8]+e[2])/s}else if(e[5]>e[10]){var l=Math.sqrt(1+e[5]-e[0]-e[10])*2;t._w=(e[8]-e[2])/l,t._x=(e[1]+e[4])/l,t._y=.25*l,t._z=(e[6]+e[9])/l}else{var c=Math.sqrt(1+e[10]-e[0]-e[5])*2;t._w=(e[1]-e[4])/c,t._x=(e[8]+e[2])/c,t._y=(e[6]+e[9])/c,t._z=.25*c}return t._onValueChanged&&t._onValueChanged(),t},o.getScaling=function(t){var e=this.elements,n=e[0],a=e[1],s=e[2],l=e[4],c=e[5],u=e[6],h=e[8],f=e[9],d=e[10];return t.set(Math.sqrt(n*n+a*a+s*s),Math.sqrt(l*l+c*c+u*u),Math.sqrt(h*h+f*f+d*d)),t},o.getTranslation=function(t){var e=this.elements;return t.set(e[12],e[13],e[14]),t},o.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},o.invert=function(){return r.invert(this,this),this},o.rotateAxisAngle=function(t,e){return r.rotateAxisAngle(this,t,e,this),this},o.scale=function(t){return r.scale(this,t,this),this},o.translate=function(t){return r.translate(this,t,this),this},o.transpose=function(){return r.transpose(this,this),this},o.clone=function(){var t=this.elements,e=new r(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);return e},o.copyFrom=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},o.copyFromArray=function(t,e){e===void 0&&(e=0);for(var n=this.elements,a=0;a<16;a++)n[a]=t[a+e];return this},o.copyToArray=function(t,e){e===void 0&&(e=0);var n=this.elements;t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15]},r}();ge._tempVec30=new y;ge._tempVec31=new y;ge._tempVec32=new y;ge._tempMat30=new Ri;ge._identity=new ge(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);var Rl=function(){function r(i,t){i===void 0&&(i=null),t===void 0&&(t=null),this.origin=new y,this.direction=new y,i&&this.origin.copyFrom(i),t&&this.direction.copyFrom(t)}var o=r.prototype;return o.intersectPlane=function(t){return pi.intersectsRayAndPlane(this,t)},o.intersectSphere=function(t){return pi.intersectsRayAndSphere(this,t)},o.intersectBox=function(t){return pi.intersectsRayAndBox(this,t)},o.getPoint=function(t,e){return y.scale(this.direction,t,e),e.add(this.origin)},r}(),Z=function(){r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._onValueChanged&&n._onValueChanged()},r.subtract=function(t,e,n){n._x=t._x-e._x,n._y=t._y-e._y,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){n._x=t._x*e._x,n._y=t._y*e._y,n._onValueChanged&&n._onValueChanged()},r.divide=function(t,e,n){n._x=t._x/e._x,n._y=t._y/e._y,n._onValueChanged&&n._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y},r.distance=function(t,e){var n=e._x-t._x,a=e._y-t._y;return Math.sqrt(n*n+a*a)},r.distanceSquared=function(t,e){var n=e._x-t._x,a=e._y-t._y;return n*n+a*a},r.equals=function(t,e){return Q.equals(t._x,e._x)&&Q.equals(t._y,e._y)},r.lerp=function(t,e,n,a){var s=t._x,l=t._y;a._x=s+(e._x-s)*n,a._y=l+(e._y-l)*n,a._onValueChanged&&a._onValueChanged()},r.max=function(t,e,n){n._x=Math.max(t._x,e._x),n._y=Math.max(t._y,e._y),n._onValueChanged&&n._onValueChanged()},r.min=function(t,e,n){n._x=Math.min(t._x,e._x),n._y=Math.min(t._y,e._y),n._onValueChanged&&n._onValueChanged()},r.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._onValueChanged&&e._onValueChanged()},r.normalize=function(t,e){var n=t._x,a=t._y,s=Math.sqrt(n*n+a*a);s>Q.zeroTolerance&&(s=1/s,e._x=n*s,e._y=a*s,e._onValueChanged&&e._onValueChanged())},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._onValueChanged&&n._onValueChanged()};function r(i,t){i===void 0&&(i=0),t===void 0&&(t=0),this._x=void 0,this._y=void 0,this._onValueChanged=null,this._x=i,this._y=t}var o=r.prototype;return o.set=function(t,e){return this._x=t,this._y=e,this._onValueChanged&&this._onValueChanged(),this},o.add=function(t){return this._x+=t._x,this._y+=t._y,this._onValueChanged&&this._onValueChanged(),this},o.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._onValueChanged&&this._onValueChanged(),this},o.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._onValueChanged&&this._onValueChanged(),this},o.divide=function(t){return this._x/=t._x,this._y/=t._y,this._onValueChanged&&this._onValueChanged(),this},o.length=function(){var t=this._x,e=this._y;return Math.sqrt(t*t+e*e)},o.lengthSquared=function(){var t=this._x,e=this._y;return t*t+e*e},o.negate=function(){return this._x=-this._x,this._y=-this._y,this._onValueChanged&&this._onValueChanged(),this},o.normalize=function(){return r.normalize(this,this),this},o.scale=function(t){return this._x*=t,this._y*=t,this._onValueChanged&&this._onValueChanged(),this},o.clone=function(){return new r(this._x,this._y)},o.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._onValueChanged&&this._onValueChanged(),this},o.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._onValueChanged&&this._onValueChanged(),this},o.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y},Zo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}}]),r}();Z._zero=new Z(0,0);Z._one=new Z(1,1);var qe=function(){r.add=function(t,e,n){n._x=t._x+e._x,n._y=t._y+e._y,n._z=t._z+e._z,n._w=t._w+e._w,n._onValueChanged&&n._onValueChanged()},r.subtract=function(t,e,n){n._x=t._x-e._x,n._y=t._y-e._y,n._z=t._z-e._z,n._w=t._w-e._w,n._onValueChanged&&n._onValueChanged()},r.multiply=function(t,e,n){n._x=t._x*e._x,n._y=t._y*e._y,n._z=t._z*e._z,n._w=t._w*e._w,n._onValueChanged&&n._onValueChanged()},r.divide=function(t,e,n){n._x=t._x/e._x,n._y=t._y/e._y,n._z=t._z/e._z,n._w=t._w/e._w,n._onValueChanged&&n._onValueChanged()},r.dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},r.distance=function(t,e){var n=e._x-t._x,a=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return Math.sqrt(n*n+a*a+s*s+l*l)},r.distanceSquared=function(t,e){var n=e._x-t._x,a=e._y-t._y,s=e._z-t._z,l=e._w-t._w;return n*n+a*a+s*s+l*l},r.equals=function(t,e){return Q.equals(t._x,e._x)&&Q.equals(t._y,e._y)&&Q.equals(t._z,e._z)&&Q.equals(t._w,e._w)},r.lerp=function(t,e,n,a){var s=t._x,l=t._y,c=t._z,u=t._w;a._x=s+(e._x-s)*n,a._y=l+(e._y-l)*n,a._z=c+(e._z-c)*n,a._w=u+(e._w-u)*n,a._onValueChanged&&a._onValueChanged()},r.max=function(t,e,n){n._x=Math.max(t._x,e._x),n._y=Math.max(t._y,e._y),n._z=Math.max(t._z,e._z),n._w=Math.max(t._w,e._w),n._onValueChanged&&n._onValueChanged()},r.min=function(t,e,n){n._x=Math.min(t._x,e._x),n._y=Math.min(t._y,e._y),n._z=Math.min(t._z,e._z),n._w=Math.min(t._w,e._w),n._onValueChanged&&n._onValueChanged()},r.negate=function(t,e){e._x=-t._x,e._y=-t._y,e._z=-t._z,e._w=-t._w,e._onValueChanged&&e._onValueChanged()},r.normalize=function(t,e){var n=t._x,a=t._y,s=t._z,l=t._w,c=Math.sqrt(n*n+a*a+s*s+l*l);c>Q.zeroTolerance&&(c=1/c,e._x=n*c,e._y=a*c,e._z=s*c,e._w=l*c,e._onValueChanged&&e._onValueChanged())},r.scale=function(t,e,n){n._x=t._x*e,n._y=t._y*e,n._z=t._z*e,n._w=t._w*e,n._onValueChanged&&n._onValueChanged()},r.transform=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=t._w,u=e.elements;n._x=a*u[0]+s*u[4]+l*u[8]+c*u[12],n._y=a*u[1]+s*u[5]+l*u[9]+c*u[13],n._z=a*u[2]+s*u[6]+l*u[10]+c*u[14],n._w=a*u[3]+s*u[7]+l*u[11]+c*u[15],n._onValueChanged&&n._onValueChanged()},r.transformByQuat=function(t,e,n){var a=t._x,s=t._y,l=t._z,c=t._w,u=e._x,h=e._y,f=e._z,d=e._w,_=d*a+h*l-f*s,p=d*s+f*a-u*l,v=d*l+u*s-h*a,g=-u*a-h*s-f*l;n._x=_*d-g*u-p*f+v*h,n._y=p*d-g*h-v*u+_*f,n._z=v*d-g*f-_*h+p*u,n._w=c,n._onValueChanged&&n._onValueChanged()};function r(i,t,e,n){i===void 0&&(i=0),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),this._x=void 0,this._y=void 0,this._z=void 0,this._w=void 0,this._onValueChanged=null,this._x=i,this._y=t,this._z=e,this._w=n}var o=r.prototype;return o.set=function(t,e,n,a){return this._x=t,this._y=e,this._z=n,this._w=a,this._onValueChanged&&this._onValueChanged(),this},o.add=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this._onValueChanged&&this._onValueChanged(),this},o.subtract=function(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._w-=t._w,this._onValueChanged&&this._onValueChanged(),this},o.multiply=function(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._w*=t._w,this._onValueChanged&&this._onValueChanged(),this},o.divide=function(t){return this._x/=t._x,this._y/=t._y,this._z/=t._z,this._w/=t._w,this._onValueChanged&&this._onValueChanged(),this},o.length=function(){var t=this._x,e=this._y,n=this._z,a=this._w;return Math.sqrt(t*t+e*e+n*n+a*a)},o.lengthSquared=function(){var t=this._x,e=this._y,n=this._z,a=this._w;return t*t+e*e+n*n+a*a},o.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._onValueChanged&&this._onValueChanged(),this},o.normalize=function(){return r.normalize(this,this),this},o.scale=function(t){return this._x*=t,this._y*=t,this._z*=t,this._w*=t,this._onValueChanged&&this._onValueChanged(),this},o.clone=function(){var t=new r(this._x,this._y,this._z,this._w);return t},o.copyFrom=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onValueChanged&&this._onValueChanged(),this},o.copyFromArray=function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onValueChanged&&this._onValueChanged(),this},o.copyToArray=function(t,e){e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w},Zo(r,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onValueChanged&&this._onValueChanged()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onValueChanged&&this._onValueChanged()}}]),r}();qe._zero=new qe(0,0,0,0);qe._one=new qe(1,1,1,1);var me=function(){r.gammaToLinearSpace=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},r.linearToGammaSpace=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},r.equals=function(t,e){return Q.equals(t.r,e.r)&&Q.equals(t.g,e.g)&&Q.equals(t.b,e.b)&&Q.equals(t.a,e.a)},r.add=function(t,e,n){return n.r=t.r+e.r,n.g=t.g+e.g,n.b=t.b+e.b,n.a=t.a+e.a,n},r.scale=function(t,e,n){return n.r=t.r*e,n.g=t.g*e,n.b=t.b*e,n.a=t.a*e,n};function r(i,t,e,n){i===void 0&&(i=1),t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0,this.r=i,this.g=t,this.b=e,this.a=n}var o=r.prototype;return o.set=function(t,e,n,a){return this.r=t,this.g=e,this.b=n,this.a=a,this},o.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},o.scale=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},o.clone=function(){var t=new r(this.r,this.g,this.b,this.a);return t},o.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},o.toLinear=function(t){return t.r=r.gammaToLinearSpace(this.r),t.g=r.gammaToLinearSpace(this.g),t.b=r.gammaToLinearSpace(this.b),t},o.toGamma=function(t){return t.r=r.linearToGammaSpace(this.r),t.g=r.linearToGammaSpace(this.g),t.b=r.linearToGammaSpace(this.b),t},r}(),$s=function(){function r(i,t,e,n){i===void 0&&(i=0),t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.x=i,this.y=t,this.width=e,this.height=n}var o=r.prototype;return o.set=function(t,e,n,a){return this.x=t,this.y=e,this.width=n,this.height=a,this},o.clone=function(){return new r(this.x,this.y,this.width,this.height)},o.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},r}(),oy=function(){function r(){this.coefficients=new Float32Array(27)}var o=r.prototype;return o.addLight=function(t,e,n){e.scale(n);var a=this.coefficients,s=t._x,l=t._y,c=t._z,u=e.r,h=e.g,f=e.b,d=.282095,_=-.488603*l,p=.488603*c,v=-.488603*s,g=1.092548*(s*l),m=-1.092548*(l*c),x=.315392*(3*c*c-1),w=-1.092548*(s*c),C=.546274*(s*s-l*l);a[0]+=u*d,a[1]+=h*d,a[2]+=f*d,a[3]+=u*_,a[4]+=h*_,a[5]+=f*_,a[6]+=u*p,a[7]+=h*p,a[8]+=f*p,a[9]+=u*v,a[10]+=h*v,a[11]+=f*v,a[12]+=u*g,a[13]+=h*g,a[14]+=f*g,a[15]+=u*m,a[16]+=h*m,a[17]+=f*m,a[18]+=u*x,a[19]+=h*x,a[20]+=f*x,a[21]+=u*w,a[22]+=h*w,a[23]+=f*w,a[24]+=u*C,a[25]+=h*C,a[26]+=f*C},o.evaluate=function(t,e){var n=this.coefficients,a=t._x,s=t._y,l=t._z,c=.886227,u=-1.023327*s,h=1.023327*l,f=-1.023327*a,d=.858086*s*a,_=-.858086*s*l,p=.247708*(3*l*l-1),v=-.858086*l*a,g=.429042*(a*a-s*s),m=n[0]*c,x=n[1]*c,w=n[2]*c;return m+=n[3]*u+n[6]*h+n[9]*f,x+=n[4]*u+n[7]*h+n[10]*f,w+=n[5]*u+n[8]*h+n[11]*f,m+=n[12]*d+n[15]*_+n[18]*p+n[21]*v+n[24]*g,x+=n[13]*d+n[16]*_+n[19]*p+n[22]*v+n[25]*g,w+=n[14]*d+n[17]*_+n[20]*p+n[23]*v+n[26]*g,e.set(m,x,w,1),e},o.scale=function(t){var e=this.coefficients;e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e[12]*=t,e[13]*=t,e[14]*=t,e[15]*=t,e[16]*=t,e[17]*=t,e[18]*=t,e[19]*=t,e[20]*=t,e[21]*=t,e[22]*=t,e[23]*=t,e[24]*=t,e[25]*=t,e[26]*=t},o.clone=function(){var t=new r;return t.copyFrom(this),t},o.copyFrom=function(t){return t.copyToArray(this.coefficients),this},o.copyFromArray=function(t,e){e===void 0&&(e=0);var n=this.coefficients;n[0]=t[e],n[1]=t[1+e],n[2]=t[2+e],n[3]=t[3+e],n[4]=t[4+e],n[5]=t[5+e],n[6]=t[6+e],n[7]=t[7+e],n[8]=t[8+e],n[9]=t[9+e],n[10]=t[10+e],n[11]=t[11+e],n[12]=t[12+e],n[13]=t[13+e],n[14]=t[14+e],n[15]=t[15+e],n[16]=t[16+e],n[17]=t[17+e],n[18]=t[18+e],n[19]=t[19+e],n[20]=t[20+e],n[21]=t[21+e],n[22]=t[22+e],n[23]=t[23+e],n[24]=t[24+e],n[25]=t[25+e],n[26]=t[26+e]},o.copyToArray=function(t,e){e===void 0&&(e=0);var n=this.coefficients;t[0+e]=n[0],t[1+e]=n[1],t[2+e]=n[2],t[3+e]=n[3],t[4+e]=n[4],t[5+e]=n[5],t[6+e]=n[6],t[7+e]=n[7],t[8+e]=n[8],t[9+e]=n[9],t[10+e]=n[10],t[11+e]=n[11],t[12+e]=n[12],t[13+e]=n[13],t[14+e]=n[14],t[15+e]=n[15],t[16+e]=n[16],t[17+e]=n[17],t[18+e]=n[18],t[19+e]=n[19],t[20+e]=n[20],t[21+e]=n[21],t[22+e]=n[22],t[23+e]=n[23],t[24+e]=n[24],t[25+e]=n[25],t[26+e]=n[26]},r}();function Wc(r,o){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),i.push.apply(i,t)}return i}function Xc(r){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?Wc(Object(i),!0).forEach(function(t){sy(r,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Wc(Object(i)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}function jc(r,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function ie(r,o,i){return o&&jc(r.prototype,o),i&&jc(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function sy(r,o,i){return o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,r}function Oa(){return Oa=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var i=arguments[o];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(r[t]=i[t])}return r},Oa.apply(this,arguments)}function ne(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Na(r,o)}function qs(r){return qs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},qs(r)}function Na(r,o){return Na=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Na(r,o)}function ly(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function go(r,o,i){return ly()?go=Reflect.construct.bind():go=function(e,n,a){var s=[null];s.push.apply(s,n);var l=Function.bind.apply(e,s),c=new l;return a&&Na(c,a.prototype),c},go.apply(null,arguments)}function cy(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function Ys(r){var o=typeof Map=="function"?new Map:void 0;return Ys=function(t){if(t===null||!cy(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o<"u"){if(o.has(t))return o.get(t);o.set(t,e)}function e(){return go(t,arguments,qs(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Na(e,t)},Ys(r)}function N(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function uy(r,o){if(!!r){if(typeof r=="string")return $c(r,o);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $c(r,o)}}function $c(r,o){(o==null||o>r.length)&&(o=r.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=r[i];return t}function hy(r,o){var i=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i)return(i=i.call(r)).next.bind(i);if(Array.isArray(r)||(i=uy(r))||o&&r&&typeof r.length=="number"){i&&(r=i);var t=0;return function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X(r,o,i,t){!i||Object.defineProperty(r,o,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(t):void 0})}function j(r,o,i,t,e){var n={};return Object.keys(t).forEach(function(a){n[a]=t[a]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(a,s){return s(r,o,a)||a},n),e&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(e):void 0,n.initializer=void 0),n.initializer===void 0&&(Object.defineProperty(r,o,n),n=null),n}var mo={isArray:"isArray"in Array?Array.isArray:function(r){return toString.call(r)==="[object Array]"},isArrayLike:function(o){return!!o&&typeof o.length=="number"&&typeof o!="function"},clone:function(o){if(typeof o!="object"||o===null)return o;var i;if(mo.isArrayLike(o)){i=o.slice();for(var t=0,e=o.length;t<e;t++)i[t]=mo.clone(o[t])}else{i={};for(var n in o)o.hasOwnProperty(n)&&(i[n]=mo.clone(o[n]))}return i},downloadBlob:function(o,i){i===void 0&&(i="");var t=window.URL.createObjectURL(o),e=document.createElement("a");document.body.appendChild(e),e.style.display="none",e.href=t,e.download=i,e.addEventListener("click",function(){e.parentElement&&e.parentElement.removeChild(e)}),e.click(),window.URL.revokeObjectURL(t)}};function fy(r,o){var i=r.indexOf(o);if(i<0)return!1;var t=r.length-1;if(i!==t){var e=r[t];r[i]=e}return r.length--,!0}function Qs(r){return Object.keys(r).map(function(o){return r[o]})}var dy=function(){function r(){}return r._reflectGet=function(i,t){for(var e=this._stringToPath(t),n=i,a=0,s=e.length;n!=null&&a<s;)n=n[e[a++]];return a&&a==s?n:void 0},r._stringToPath=function(i){var t=[];return i.charCodeAt(0)===_y&&t.push(""),i.replace(py,function(e,n,a,s){var l=e;a?l=s.replace(vy,"$1"):n&&(l=n.trim()),t.push(l)}),t},r}(),_y=".".charCodeAt(0),vy=/\\(\\)?/g,py=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),li;(function(r){r[r.Success=0]="Success",r[r.Pending=1]="Pending",r[r.Failed=2]="Failed"})(li||(li={}));var st=function(r){ne(i,r),i.all=function(e){return new i(function(n,a,s){if(!Array.isArray(e))return n([e]);var l=0,c=e.length,u=new Array(c);e.forEach(function(h,f){Promise.resolve(h).then(function(d){u[f]=d,l+=1,s(l/c),l==c&&n(u)}).catch(function(d){return a(d)})})})};var o=i.prototype;o.onProgress=function(e){return this._listeners.add(e),this},o.cancel=function(){return this._status!==li.Pending?this:(this._reject("Promise Canceled"),this)};function i(t){var e,n,a=function(l){if(!(l<=e._progress)){e._progress=l;for(var c=hy(e._listeners),u;!(u=c()).done;){var h=u.value;h(l)}}};return e=r.call(this,function(s,l){n=function(u){Promise.resolve().then(function(){e._status=li.Failed,l(u)})},t(function(c){Promise.resolve().then(function(){a(1),e._status=li.Success,s(c)})},n,function(c){Promise.resolve().then(function(){a(c)})})})||this,e._status=void 0,e._progress=void 0,e._reject=void 0,e._listeners=void 0,e._reject=n,e._listeners=new Set,e._progress=0,e._status=li.Pending,e}return ie(i,[{key:"status",get:function(){return this._status}},{key:"progress",get:function(){return this._progress}}]),i}(Ys(Promise)),$a=function(){r._addLoader=function(t,e,n){this._loaders[t]=e;for(var a=0,s=n.length;a<s;a++)this._extTypeMapping[n[a]]=t},r._getTypeByUrl=function(t){var e=t.split("?")[0];return this._extTypeMapping[e.substring(e.lastIndexOf(".")+1)]};function r(i){this.engine=i,this.retryCount=1,this.retryInterval=0,this.timeout=1/0,this._objectPool=Object.create(null),this._editorResourceConfig=Object.create(null),this._virtualPathMap=Object.create(null),this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._refObjectPool=Object.create(null),this._loadingPromises={}}var o=r.prototype;return o.load=function(t){var e=this;if(!Array.isArray(t))return this._loadSingleItem(t);var n=t.map(function(a){return e._loadSingleItem(a)});return st.all(n)},o.cancelNotLoaded=function(t){var e=this;if(!t)Qs(this._loadingPromises).forEach(function(a){a.cancel()});else if(typeof t=="string"){var n;(n=this._loadingPromises[t])===null||n===void 0||n.cancel()}else t.forEach(function(a){var s;(s=e._loadingPromises[a])===null||s===void 0||s.cancel()})},o.gc=function(){this._gc(!1)},o.getAssetPath=function(t){return this._assetPool[t]},o.getResourceByRef=function(t){var e=t.refId,n=t.key,a=t.isClone,s=this._objectPool[e],l=s?Promise.resolve(s):this.load({type:this._editorResourceConfig[e].type,url:this._editorResourceConfig[e].path});return l.then(function(c){return n?dy._reflectGet(c,n):c}).then(function(c){return a?c.clone():c})},o.initVirtualResources=function(t){var e=this;t.forEach(function(n){e._virtualPathMap[n.virtualPath]=n.path,e._editorResourceConfig[n.id]=n})},o._addAsset=function(t,e){this._assetPool[e.instanceId]=t,this._assetUrlPool[t]=e},o._deleteAsset=function(t){var e=t.instanceId,n=this._assetPool[e];n&&(delete this._assetPool[e],delete this._assetUrlPool[n])},o._addRefObject=function(t,e){this._refObjectPool[t]=e},o._deleteRefObject=function(t){delete this._refObjectPool[t]},o._destroy=function(){this.cancelNotLoaded(),this._gc(!0),this._assetPool=null,this._assetUrlPool=null,this._refObjectPool=null,this._loadingPromises=null},o._assignDefaultOptions=function(t){var e,n,a,s,l;if(t.type=(e=t.type)!=null?e:r._getTypeByUrl(t.url),t.type===void 0)throw"asset type should be specified: "+t.url;return t.retryCount=(n=t.retryCount)!=null?n:this.retryCount,t.timeout=(a=t.timeout)!=null?a:this.timeout,t.retryInterval=(s=t.retryInterval)!=null?s:this.retryInterval,t.url=(l=t.url)!=null?l:t.urls.join(","),t},o._loadSingleItem=function(t){var e=this,n=this._assignDefaultOptions(typeof t=="string"?{url:t}:t),a=n.url,s=this._virtualPathMap[a]?this._virtualPathMap[a]:a;if(this._assetUrlPool[s])return new st(function(u){u(e._assetUrlPool[s])});if(this._loadingPromises[s])return this._loadingPromises[n.url];var l=r._loaders[n.type];if(!l)throw"loader not found: "+n.type;n.url=s;var c=l.load(n,this);return this._loadingPromises[s]=c,c.then(function(u){l.useCache&&e._addAsset(s,u),e._loadingPromises&&delete e._loadingPromises[s]}).catch(function(u){Promise.reject(u),e._loadingPromises&&delete e._loadingPromises[s]}),c},o._gc=function(t){for(var e=Qs(this._refObjectPool),n=0,a=e.length;n<a;n++)(!e[n].isGCIgnored||t)&&e[n].destroy()},r}();$a._loaders={};$a._extTypeMapping={};function mt(r,o,i){return i===void 0&&(i=!0),function(t){var e=new t(i);$a._addLoader(r,e,o)}}var Js=function(){function r(i,t,e,n){t===void 0&&(t=null),e===void 0&&(e={}),n===void 0&&(n=!0),this.data=void 0,this._timeStamp=void 0,this._target=void 0,this._currentTarget=void 0,this._bubbles=void 0,this._propagationStopped=void 0,this._type=void 0,this._timeStamp=new Date().getTime(),this._target=t,this.data=e,this._currentTarget=null,this._bubbles=n,this._propagationStopped=!1,this._type=i}var o=r.prototype;return o.stopPropagation=function(){this._propagationStopped=!0},ie(r,[{key:"propagationStopped",get:function(){return this._propagationStopped}},{key:"target",get:function(){return this._target},set:function(t){this._target=t}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"currentTarget",get:function(){return this._currentTarget},set:function(t){this._currentTarget=t}},{key:"bubbles",get:function(){return this._bubbles}},{key:"type",get:function(){return this._type}}]),r}(),un;(function(r){r[r.Ignore=0]="Ignore",r[r.Assignment=1]="Assignment",r[r.Shallow=2]="Shallow",r[r.Deep=3]="Deep"})(un||(un={}));function ae(r,o){mr.registerCloneMode(r,o,un.Ignore)}function Ze(r,o){mr.registerCloneMode(r,o,un.Assignment)}function lv(r,o){mr.registerCloneMode(r,o,un.Shallow)}function it(r,o){mr.registerCloneMode(r,o,un.Deep)}var mr=function(){function r(){}return r.registerCloneMode=function(i,t,e){var n=r._subCloneModeMap.get(i.constructor);n||(n=Object.create(null),r._subCloneModeMap.set(i.constructor,n)),n[t]=e},r.getCloneMode=function(i){var t=r._cloneModeMap.get(i);if(!t){t=Object.create(null),r._cloneModeMap.set(i,t);for(var e=r._objectType,n=r._subCloneModeMap;i!==e;){var a=n.get(i);a&&Oa(t,a),i=Object.getPrototypeOf(i)}}return t},r.deepCloneObject=function(i,t){var e=i.constructor;switch(e){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:t.set(i);break;case Array:for(var n=0,a=i.length;n<a;n++)r._deepCloneObjectItem(i,t,n);break;default:var s=i;if(s.clone&&s.cloneTo)s.cloneTo(t);else for(var l=Object.keys(i),c=0,u=l.length;c<u;c++)r._deepCloneObjectItem(i,t,l[c])}},r._deepCloneObjectItem=function(i,t,e){var n=i[e];if(n instanceof Object){var a=n.constructor;switch(a){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:var s=n,l=t[e];l==null?t[e]=s.slice():l.set(s);break;case Array:var c=n,u=t[e];u==null?t[e]=new Array(c.length):u.length=c.length,r.deepCloneObject(c,u);break;default:if(n.clone&&n.cloneTo){var h=n,f=t[e];f?h.cloneTo(f):t[e]=h.clone()}else{var d=t[e];d==null&&(t[e]=d=new n.constructor),r.deepCloneObject(n,d);break}}}else t[e]=n},r}();mr._subCloneModeMap=new Map;mr._cloneModeMap=new Map;mr._objectType=Object.getPrototypeOf(Object);var Cs,qc,cv=(Cs=function(){function r(){X(this,"_evts",qc,this),this._evtCount=0}var o=r.prototype;return o.hasEvent=function(t){return this._evts[t]!=null},o.eventNames=function(){return this._evtCount===0?[]:Object.keys(this._evts)},o.listenerCount=function(t){var e=this._evts[t];return e?e.fn?1:e.length:0},o.dispatch=function(t,e){if(!this._evts[t])return!1;var n=this._evts[t];if(n.fn)n.once&&this.removeEventListener(t,n.fn),n.fn(e);else for(var a=n.length,s=0;s<a;s++)n[s].once&&this.removeEventListener(t,n[s].fn),n[s].fn(e);return!0},o.on=function(t,e){return this.addEventListener(t,e)},o.once=function(t,e){return this.addEventListener(t,e,!0)},o.addEventListener=function(t,e,n){var a={fn:e,once:n},s=this._evts;return s[t]?s[t].fn?s[t]=[s[t],a]:s[t].push(a):(s[t]=a,this._evtCount++),this},o.off=function(t,e){if(!this._evts[t])return this;if(!e)return this._clearEvent(t),this;var n=this._evts[t];if(n.fn&&n.fn===e)this._clearEvent(t);else{var a=n.indexOf(e);if(a>-1){var s=n[n.length-1];n[a]=s,n.length--,n.length===1&&(this._evts[t]=n[0])}}return this},o.removeEventListener=function(t,e){return this.off(t,e)},o.removeAllEventListeners=function(t){t?this._evts[t]&&this._clearEvent(t):(this._evts=Object.create(null),this._evtCount=0)},o.trigger=function(t){this.dispatch(t.type,t.data)},o._clearEvent=function(t){--this._evtCount===0?this._evts=Object.create(null):delete this._evts[t]},r}(),qc=j(Cs.prototype,"_evts",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Object.create(null)}}),Cs),Sn=function(o){},gy=console.log.bind(console),my=console.info.bind(console),yy=console.warn.bind(console),xy=console.error.bind(console),Fe={debug:Sn,info:Sn,warn:Sn,error:Sn,isEnabled:!1,enable:function(){this.debug=gy,this.info=my,this.warn=yy,this.error=xy,this.isEnabled=!0},disable:function(){this.debug=Sn,this.info=Sn,this.warn=Sn,this.error=Sn,this.isEnabled=!1}},uv=function(){function r(){this._clock=void 0,this._timeScale=void 0,this._deltaTime=void 0,this._startTime=void 0,this._lastTickTime=void 0,this._clock=performance||Date,this._timeScale=1,this._deltaTime=1e-4;var i=this._clock.now();this._startTime=i,this._lastTickTime=i}var o=r.prototype;return o.reset=function(){this._lastTickTime=this._clock.now()},o.tick=function(){var t=this.nowTime;this._deltaTime=(t-this._lastTickTime)*this._timeScale,this._lastTickTime=t},ie(r,[{key:"nowTime",get:function(){return this._clock.now()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){this._timeScale=t}},{key:"unscaledDeltaTime",get:function(){return this._deltaTime/this._timeScale}},{key:"timeSinceStartup",get:function(){return this.nowTime-this._startTime}}]),r}(),io,Yc,Qc,As,pn=(io=(As=function(){function r(i){X(this,"instanceId",Yc,this),X(this,"_engine",Qc,this),this._destroyed=!1,this._engine=i}var o=r.prototype;return o.destroy=function(){var t;this._destroyed||((t=this._engine.resourceManager)===null||t===void 0||t._deleteAsset(this),this._destroyed=!0)},ie(r,[{key:"engine",get:function(){return this._engine}},{key:"destroyed",get:function(){return this._destroyed}}]),r}(),As._instanceIdCounter=0,As),Yc=j(io.prototype,"instanceId",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return++pn._instanceIdCounter}}),Qc=j(io.prototype,"_engine",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io),nt;(function(r){r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT=5124]="INT",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.FLOAT_ARRAY=35677]="FLOAT_ARRAY",r[r.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",r[r.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",r[r.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",r[r.INT_ARRAY=100003]="INT_ARRAY",r[r.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",r[r.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",r[r.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",r[r.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",r[r.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",r[r.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",r[r.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",r[r.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT"})(nt||(nt={}));var he;(function(r){r.shaderVertexID="shaderVertexID",r.standardDerivatives="OES_standard_derivatives",r.shaderTextureLod="EXT_shader_texture_lod",r.elementIndexUint="OES_element_index_uint",r.depthTexture="WEBGL_depth_texture",r.drawBuffers="WEBGL_draw_buffers",r.vertexArrayObject="OES_vertex_array_object",r.instancedArrays="ANGLE_instanced_arrays",r.multipleSample="multipleSampleOnlySupportedInWebGL2",r.textureFloat="OES_texture_float",r.textureFloatLinear="OES_texture_float_linear",r.textureHalfFloat="OES_texture_half_float",r.textureHalfFloatLinear="OES_texture_half_float_linear",r.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",r.colorBufferFloat="EXT_color_buffer_float",r.colorBufferHalfFloat="EXT_color_buffer_half_float",r.textureFilterAnisotropic="EXT_texture_filter_anisotropic",r.blendMinMax="EXT_blend_minmax",r.astc="WEBGL_compressed_texture_astc",r.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",r.etc="WEBGL_compressed_texture_etc",r.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",r.etc1="WEBGL_compressed_texture_etc1",r.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",r.pvrtc="WEBGL_compressed_texture_pvrtc",r.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",r.s3tc="WEBGL_compressed_texture_s3tc",r.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc"})(he||(he={}));var kt=function(){function r(i){i===void 0&&(i=0),this._elements=void 0,this.length=0,this._elements=new Array(i)}var o=r.prototype;return o.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},o.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},o.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},o.deleteByIndex=function(t){var e=this._elements,n=null,a=this.length-1;return t!==a&&(n=e[a],e[t]=n),this.length--,n},o.garbageCollection=function(){this._elements.length=this.length},r}(),ar=function(){function r(){this._mask=[],this._length=0}r.unionCollection=function(t,e,n){var a=n._mask,s,l,c,u;t._length<e._length?(s=t._length,l=e._length,c=t._mask,u=e._mask):(s=e._length,l=t._length,c=e._mask,u=t._mask);var h=0;for(a.length<l&&(a.length=l);h<s;h++)a[h]=c[h]|u[h];for(;h<l;h++)a[h]=u[h];n._length=l};var o=r.prototype;return o.enable=function(t){var e=t._maskIndex,n=e+1,a=this._mask,s=this._length;if(s<n){for(a.length<n&&(a.length=n);s<e;s++)a[s]=0;a[e]=t._maskValue,this._length=n}else a[e]|=t._maskValue},o.disable=function(t){var e=t._maskIndex,n=this._mask,a=this._length-1;if(!(e>a)){var s=n[e]&~t._maskValue;e==a&&s===0?this._length--:n[e]=s}},o.unionCollection=function(t){var e=t._mask,n=t._length,a=this._mask,s=this._length;if(s<n){a.length<n&&(a.length=n);for(var l=0;l<s;l++)a[l]|=e[l];for(;l<n;l++)a[l]=e[l];this._length=n}else for(var c=0;c<n;c++)a[c]|=e[c]},o.complementaryCollection=function(t){for(var e=t._mask,n=this._mask,a=this._length-1,s=Math.min(t._length-1,a);s>=0;s--){var l=n[s]&~e[s];s==a&&l===0?(a--,this._length--):n[s]=l}},o.intersectionCollection=function(t){for(var e=t._mask,n=this._mask,a=this._length-1;a>=0;a--){var s=n[a]&e[a];s==0&&a==this._length-1?this._length--:n[a]=s}},o.isEnable=function(t){var e=t._maskIndex;return e>=this._length?!1:(this._mask[e]&t._maskValue)!==0},o.clear=function(){this._length=0},r}(),Fl=function(){function r(){this._onStartScripts=new kt,this._onUpdateScripts=new kt,this._onLateUpdateScripts=new kt,this._onPhysicsUpdateScripts=new kt,this._disableScripts=[],this._destroyScripts=[],this._onUpdateAnimations=new kt,this._renderers=new kt,this._onUpdateRenderers=new kt,this._componentsContainerPool=[]}var o=r.prototype;return o.addRenderer=function(t){t._rendererIndex=this._renderers.length,this._renderers.add(t)},o.removeRenderer=function(t){var e=this._renderers.deleteByIndex(t._rendererIndex);e&&(e._rendererIndex=t._rendererIndex),t._rendererIndex=-1},o.addOnStartScript=function(t){t._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(t)},o.removeOnStartScript=function(t){var e=this._onStartScripts.deleteByIndex(t._onStartIndex);e&&(e._onStartIndex=t._onStartIndex),t._onStartIndex=-1},o.addOnUpdateScript=function(t){t._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(t)},o.removeOnUpdateScript=function(t){var e=this._onUpdateScripts.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},o.addOnLateUpdateScript=function(t){t._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(t)},o.removeOnLateUpdateScript=function(t){var e=this._onLateUpdateScripts.deleteByIndex(t._onLateUpdateIndex);e&&(e._onLateUpdateIndex=t._onLateUpdateIndex),t._onLateUpdateIndex=-1},o.addOnPhysicsUpdateScript=function(t){t._onPhysicsUpdateIndex=this._onPhysicsUpdateScripts.length,this._onPhysicsUpdateScripts.add(t)},o.removeOnPhysicsUpdateScript=function(t){var e=this._onPhysicsUpdateScripts.deleteByIndex(t._onPhysicsUpdateIndex);e&&(e._onPhysicsUpdateIndex=t._onPhysicsUpdateIndex),t._onPhysicsUpdateIndex=-1},o.addOnUpdateAnimations=function(t){t._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(t)},o.removeOnUpdateAnimations=function(t){var e=this._onUpdateAnimations.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},o.addOnUpdateRenderers=function(t){t._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(t)},o.removeOnUpdateRenderers=function(t){var e=this._onUpdateRenderers.deleteByIndex(t._onUpdateIndex);e&&(e._onUpdateIndex=t._onUpdateIndex),t._onUpdateIndex=-1},o.addDisableScript=function(t){this._disableScripts.push(t)},o.addDestroyScript=function(t){this._destroyScripts.push(t)},o.callScriptOnStart=function(){var t=this._onStartScripts;if(t.length>0){for(var e=t._elements,n=0;n<t.length;n++){var a=e[n];a._waitHandlingInValid||(a._started=!0,a._onStartIndex=-1,a.onStart())}t.length=0}},o.callScriptOnUpdate=function(t){for(var e=this._onUpdateScripts._elements,n=this._onUpdateScripts.length-1;n>=0;--n){var a=e[n];!a._waitHandlingInValid&&a._started&&a.onUpdate(t)}},o.callScriptOnLateUpdate=function(t){for(var e=this._onLateUpdateScripts._elements,n=this._onLateUpdateScripts.length-1;n>=0;--n){var a=e[n];!a._waitHandlingInValid&&a._started&&a.onLateUpdate(t)}},o.callScriptOnPhysicsUpdate=function(){for(var t=this._onPhysicsUpdateScripts._elements,e=this._onPhysicsUpdateScripts.length-1;e>=0;--e){var n=t[e];!n._waitHandlingInValid&&n._started&&n.onPhysicsUpdate()}},o.callAnimationUpdate=function(t){for(var e=this._onUpdateAnimations._elements,n=this._onUpdateAnimations.length-1;n>=0;--n)e[n].update(t)},o.callRendererOnUpdate=function(t){for(var e=this._onUpdateRenderers._elements,n=this._onUpdateRenderers.length-1;n>=0;--n)e[n].update(t)},o.callRender=function(t){for(var e=t._camera,n=this._renderers._elements,a=this._renderers.length-1;a>=0;--a){var s=n[a];if(!!(e.cullingMask&s._entity.layer)&&!(e.enableFrustumCulling&&(s.isCulled=!e._frustum.intersectsBox(s.bounds),s.isCulled))){var l=e.entity.transform,c=l.worldPosition,u=s.bounds.getCenter(r._tempVector0);if(e.isOrthographic){var h=l.getWorldForward(r._tempVector1);y.subtract(u,c,u),s._distanceForSort=y.dot(u,h)}else s._distanceForSort=y.distanceSquared(u,c);s._updateShaderData(t),s._render(e),ar.unionCollection(e._globalShaderMacro,s.shaderData._macroCollection,s._globalShaderMacro)}}},o.handlingInvalidScripts=function(){var t=this._disableScripts,e=this._destroyScripts,n=t.length;if(n>0){for(var a=n-1;a>=0;a--){var s=t[a];s._waitHandlingInValid&&s._handlingInValid()}t.length=0}if(n=e.length,n>0){for(var l=n-1;l>=0;l--)e[l].onDestroy();e.length=0}},o.callCameraOnBeginRender=function(t){for(var e=t.entity._scripts,n=e.length-1;n>=0;--n){var a=e.get(n);a._waitHandlingInValid||a.onBeginRender(t)}},o.callCameraOnEndRender=function(t){for(var e=t.entity._scripts,n=e.length-1;n>=0;--n){var a=e.get(n);a._waitHandlingInValid||a.onEndRender(t)}},o.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},o.putActiveChangedTempList=function(t){t.length=0,this._componentsContainerPool.push(t)},r}();Fl._tempVector0=new y;Fl._tempVector1=new y;var wy=function(){function r(){}return r.cloneComponent=function(i,t){for(var e=mr.getCloneMode(i.constructor),n=Object.keys(i),a=0,s=n.length;a<s;a++){var l=n[a],c=e[l];switch(c){case void 0:case un.Assignment:t[l]=i[l];break;case un.Shallow:var u=i[l];if(u instanceof Object){var h=t[l];h==null&&(h=t[l]=u.constructor()),Oa(h,u)}else t[l]=u;break;case un.Deep:var f=i[l];if(f instanceof Object){var d=t[l];d==null&&(d=t[l]=f.constructor()),mr.deepCloneObject(f,d)}else t[l]=f;break}}i._cloneTo&&i._cloneTo(t)},r}(),Ua=function(){r._register=function(i,t){this._addDependency(i,t,this._dependenciesMap),this._addDependency(t,i,this._invDependenciesMap)},r._addCheck=function(i,t){var e=r._dependenciesMap.get(t);if(e)for(var n=0,a=e.length;n<a;n++){var s=e[n];i.getComponent(s)||i.addComponent(s)}},r._removeCheck=function(i,t){var e=r._invDependenciesMap.get(t);if(e){for(var n=0,a=e.length;n<a;n++)if(i.getComponent(e[n]))throw"you should remove "+e[n]+" before adding "+t}},r._addDependency=function(i,t,e){var n=e.get(i);n||(n=[],e.set(i,n)),n.indexOf(t)===-1&&n.push(t)};function r(){}return r}();Ua._dependenciesMap=new Map;Ua._invDependenciesMap=new Map;function ca(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return function(t){o.forEach(function(e){return Ua._register(t,e)})}}var Tt;(function(r){r[r.Layer0=1]="Layer0",r[r.Layer1=2]="Layer1",r[r.Layer2=4]="Layer2",r[r.Layer3=8]="Layer3",r[r.Layer4=16]="Layer4",r[r.Layer5=32]="Layer5",r[r.Layer6=64]="Layer6",r[r.Layer7=128]="Layer7",r[r.Layer8=256]="Layer8",r[r.Layer9=512]="Layer9",r[r.Layer10=1024]="Layer10",r[r.Layer11=2048]="Layer11",r[r.Layer12=4096]="Layer12",r[r.Layer13=8192]="Layer13",r[r.Layer14=16384]="Layer14",r[r.Layer15=32768]="Layer15",r[r.Layer16=65536]="Layer16",r[r.Layer17=131072]="Layer17",r[r.Layer18=262144]="Layer18",r[r.Layer19=524288]="Layer19",r[r.Layer20=1048576]="Layer20",r[r.Layer21=2097152]="Layer21",r[r.Layer22=4194304]="Layer22",r[r.Layer23=8388608]="Layer23",r[r.Layer24=16777216]="Layer24",r[r.Layer25=33554432]="Layer25",r[r.Layer26=67108864]="Layer26",r[r.Layer27=134217728]="Layer27",r[r.Layer28=268435456]="Layer28",r[r.Layer29=536870912]="Layer29",r[r.Layer30=1073741824]="Layer30",r[r.Layer31=2147483648]="Layer31",r[r.Everything=4294967295]="Everything",r[r.Nothing=0]="Nothing"})(Tt||(Tt={}));var hv=function(){function r(){this._flagManagers=[]}var o=r.prototype;return o.clearFromManagers=function(){this._removeFromManagers(),this._flagManagers.length=0},o.destroy=function(){this._removeFromManagers(),this._flagManagers=null},o._removeFromManagers=function(){for(var t=this._flagManagers,e=0,n=t.length;e<n;e++)fy(t[e]._updateFlags,this)},r}(),qa=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.flag=!0,t}var i=o.prototype;return i.dispatch=function(){this.flag=!0},o}(hv),jn,Jc,Kc,Zc,eu,tu,wr=(jn=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t.engine)||this,X(e,"_entity",Jc,N(e)),X(e,"_awoken",Kc,N(e)),X(e,"_destroyed",Zc,N(e)),X(e,"_phasedActive",eu,N(e)),X(e,"_enabled",tu,N(e)),e._entity=t,e}var i=o.prototype;return i.destroy=function(){this._destroyed||(this._entity._removeComponent(this),this._entity.isActiveInHierarchy&&this._enabled&&this._onDisable(),this._destroyed=!0,this._onDestroy())},i._onAwake=function(){},i._onEnable=function(){},i._onDisable=function(){},i._onDestroy=function(){},i._setActive=function(e){var n=this._entity;e?(!this._awoken&&n._isActiveInHierarchy&&(this._awoken=!0,this._onAwake()),!this._phasedActive&&n._isActiveInHierarchy&&this._enabled&&(this._phasedActive=!0,this._onEnable())):this._phasedActive&&!(n._isActiveInHierarchy&&this._enabled)&&(this._phasedActive=!1,this._onDisable())},ie(o,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,this._entity.isActiveInHierarchy&&(e?(this._phasedActive=!0,this._onEnable()):(this._phasedActive=!1,this._onDisable())))}},{key:"destroyed",get:function(){return this._destroyed}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}}]),o}(pn),Jc=j(jn.prototype,"_entity",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kc=j(jn.prototype,"_awoken",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zc=j(jn.prototype,"_destroyed",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eu=j(jn.prototype,"_phasedActive",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tu=j(jn.prototype,"_enabled",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),jn),es=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.listener=void 0,t}var i=o.prototype;return i.dispatch=function(e){this.listener&&this.listener(e)},o}(hv),Ki=function(){function r(){this._updateFlags=[]}var o=r.prototype;return o.createFlag=function(t){var e=new t;return this.addFlag(e),e},o.addFlag=function(t){this._updateFlags.push(t),t._flagManagers.push(this)},o.dispatch=function(t){for(var e=this._updateFlags,n=e.length-1;n>=0;n--)e[n].dispatch(t)},r}(),It,ru,nu,iu,au,ou,su,lu,cu,uu,hu,fu,du,_u,br,rr=(It=(br=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,X(e,"_position",ru,N(e)),X(e,"_rotation",nu,N(e)),X(e,"_rotationQuaternion",iu,N(e)),X(e,"_scale",au,N(e)),X(e,"_worldPosition",ou,N(e)),X(e,"_worldRotation",su,N(e)),X(e,"_worldRotationQuaternion",lu,N(e)),X(e,"_lossyWorldScale",cu,N(e)),X(e,"_localMatrix",uu,N(e)),X(e,"_worldMatrix",hu,N(e)),X(e,"_updateFlagManager",fu,N(e)),X(e,"_isParentDirty",du,N(e)),X(e,"_parentTransformCache",_u,N(e)),e._dirtyFlag=Ce.WmWpWeWqWs,e._onPositionChanged=e._onPositionChanged.bind(N(e)),e._onWorldPositionChanged=e._onWorldPositionChanged.bind(N(e)),e._onRotationChanged=e._onRotationChanged.bind(N(e)),e._onWorldRotationChanged=e._onWorldRotationChanged.bind(N(e)),e._onRotationQuaternionChanged=e._onRotationQuaternionChanged.bind(N(e)),e._onWorldRotationQuaternionChanged=e._onWorldRotationQuaternionChanged.bind(N(e)),e._onScaleChanged=e._onScaleChanged.bind(N(e)),e._position._onValueChanged=e._onPositionChanged,e._worldPosition._onValueChanged=e._onWorldPositionChanged,e._rotation._onValueChanged=e._onRotationChanged,e._worldRotation._onValueChanged=e._onWorldRotationChanged,e._rotationQuaternion._onValueChanged=e._onRotationQuaternionChanged,e._worldRotationQuaternion._onValueChanged=e._onWorldRotationQuaternionChanged,e._scale._onValueChanged=e._onScaleChanged,e}var i=o.prototype;return i.setPosition=function(e,n,a){this._position.set(e,n,a)},i.setRotation=function(e,n,a){this._rotation.set(e,n,a)},i.setRotationQuaternion=function(e,n,a,s){this._rotationQuaternion.set(e,n,a,s)},i.setScale=function(e,n,a){this._scale.set(e,n,a)},i.setWorldPosition=function(e,n,a){this._worldPosition.set(e,n,a)},i.setWorldRotation=function(e,n,a){this._worldRotation.set(e,n,a)},i.setWorldRotationQuaternion=function(e,n,a,s){this._worldRotationQuaternion.set(e,n,a,s)},i.getWorldForward=function(e){var n=this.worldMatrix.elements;return e.set(-n[8],-n[9],-n[10]),e.normalize()},i.getWorldRight=function(e){var n=this.worldMatrix.elements;return e.set(n[0],n[1],n[2]),e.normalize()},i.getWorldUp=function(e){var n=this.worldMatrix.elements;return e.set(n[4],n[5],n[6]),e.normalize()},i.translate=function(e,n,a,s){if(typeof e=="number"){var l=o._tempVec30;l.set(e,n,a),this._translate(l,s)}else this._translate(e,n)},i.rotate=function(e,n,a,s){typeof e=="number"?this._rotateXYZ(e,n,a,s):this._rotateXYZ(e.x,e.y,e.z,n)},i.rotateByAxis=function(e,n,a){a===void 0&&(a=!0);var s=n*Q.degreeToRadFactor;Me.rotationAxisAngle(e,s,o._tempQuat0),this._rotateByQuat(o._tempQuat0,a)},i.lookAt=function(e,n){var a=o._tempVec30;y.subtract(this.worldPosition,e,a);var s=a.length();if(!(s<=Q.zeroTolerance)){a.scale(1/s);var l=o._tempVec31;if(n?y.cross(n,a,l):l.set(a.z,0,-a.x),s=l.length(),!(s<=Q.zeroTolerance)){l.scale(1/s);var c=o._tempVec32;y.cross(a,l,c);var u=o._tempMat41,h=u.elements;h[0]=l.x,h[1]=l.y,h[2]=l.z,h[4]=c.x,h[5]=c.y,h[6]=c.z,h[8]=a.x,h[9]=a.y,h[10]=a.z,u.getRotation(this._worldRotationQuaternion)}}},i.registerWorldChangeFlag=function(){return this._updateFlagManager.createFlag(qa)},i._registerWorldChangeListener=function(){return this._updateFlagManager.createFlag(es)},i._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},i._isFrontFaceInvert=function(){var e=this.lossyWorldScale,n=e.x<0;return e.y<0&&(n=!n),e.z<0&&(n=!n),n},i._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(Ce.WmWp)){this._worldAssociatedChange(Ce.WmWp);for(var e=this._entity._children,n=0,a=e.length;n<a;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionFlag()}}},i._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(Ce.WmWeWq)){this._worldAssociatedChange(Ce.WmWeWq);for(var e=this._entity._children,n=0,a=e.length;n<a;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndRotationFlag()}}},i._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(Ce.WmWpWeWq)){this._worldAssociatedChange(Ce.WmWpWeWq);for(var e=this._entity._children,n=0,a=e.length;n<a;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndRotationFlag()}}},i._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(Ce.WmWs)){this._worldAssociatedChange(Ce.WmWs);for(var e=this._entity._children,n=0,a=e.length;n<a;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndScaleFlag()}}},i._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(Ce.WmWpWs)){this._worldAssociatedChange(Ce.WmWpWs);for(var e=this._entity._children,n=0,a=e.length;n<a;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndScaleFlag()}}},i._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(Ce.WmWpWeWqWs)){this._worldAssociatedChange(Ce.WmWpWeWqWs);for(var e=this._entity._children,n=0,a=e.length;n<a;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateAllWorldFlag()}}},i._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,n=this._entity.parent;n;){var a=n.transform;if(a){e=a;break}else n=n.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},i._getScaleMatrix=function(){var e=o._tempQuat0,n=o._tempMat30,a=o._tempMat31,s=o._tempMat32;return a.copyFromMatrix(this.worldMatrix),Me.invert(this.worldRotationQuaternion,e),Ri.rotationQuaternion(e,n),Ri.multiply(n,a,s),s},i._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},i._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},i._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},i._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},i._worldAssociatedChange=function(e){this._dirtyFlag|=e,this._updateFlagManager.dispatch()},i._rotateByQuat=function(e,n){n?Me.multiply(this.rotationQuaternion,e,this._rotationQuaternion):Me.multiply(e,this.worldRotationQuaternion,this._worldRotationQuaternion)},i._translate=function(e,n){if(n===void 0&&(n=!0),n){var a=o._tempVec30;y.transformByQuat(e,this.worldRotationQuaternion,a),this._worldPosition.add(a)}else this._worldPosition.add(e)},i._rotateXYZ=function(e,n,a,s){s===void 0&&(s=!0);var l=Q.degreeToRadFactor,c=o._tempQuat0;Me.rotationEuler(e*l,n*l,a*l,c),this._rotateByQuat(c,s)},i._onPositionChanged=function(){this._setDirtyFlagTrue(Ce.LocalMatrix),this._updateWorldPositionFlag()},i._onWorldPositionChanged=function(){var e=this._worldPosition,n=this._getParentTransform();n?(ge.invert(n.worldMatrix,o._tempMat41),y.transformCoordinate(e,o._tempMat41,this._position)):this._position.copyFrom(e),this._setDirtyFlagFalse(Ce.WorldPosition)},i._onRotationChanged=function(){this._setDirtyFlagTrue(Ce.LocalMatrix|Ce.LocalQuat),this._setDirtyFlagFalse(Ce.LocalEuler),this._updateWorldRotationFlag()},i._onWorldRotationChanged=function(){var e=this._worldRotation;Me.rotationEuler(Q.degreeToRadian(e.x),Q.degreeToRadian(e.y),Q.degreeToRadian(e.z),this._worldRotationQuaternion),this._setDirtyFlagFalse(Ce.WorldEuler)},i._onRotationQuaternionChanged=function(){this._setDirtyFlagTrue(Ce.LocalMatrix|Ce.LocalEuler),this._setDirtyFlagFalse(Ce.LocalQuat),this._updateWorldRotationFlag()},i._onWorldRotationQuaternionChanged=function(){var e=this._worldRotationQuaternion,n=this._getParentTransform();if(n){var a=o._tempQuat0;Me.invert(n.worldRotationQuaternion,a),Me.multiply(a,e,this._rotationQuaternion)}else this._rotationQuaternion.copyFrom(e);this._setDirtyFlagFalse(Ce.WorldQuat)},i._onScaleChanged=function(){this._setDirtyFlagTrue(Ce.LocalMatrix),this._updateWorldScaleFlag()},ie(o,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&this._position.copyFrom(e)}},{key:"worldPosition",get:function(){var e=this._worldPosition;return this._isContainDirtyFlag(Ce.WorldPosition)&&(e._onValueChanged=null,this._getParentTransform()?this.worldMatrix.getTranslation(e):e.copyFrom(this._position),e._onValueChanged=this._onWorldPositionChanged,this._setDirtyFlagFalse(Ce.WorldPosition)),e},set:function(e){this._worldPosition!==e&&this._worldPosition.copyFrom(e)}},{key:"rotation",get:function(){var e=this._rotation;return this._isContainDirtyFlag(Ce.LocalEuler)&&(e._onValueChanged=null,this._rotationQuaternion.toEuler(e),e._onValueChanged=this._onRotationChanged,e.scale(Q.radToDegreeFactor),this._setDirtyFlagFalse(Ce.LocalEuler)),e},set:function(e){this._rotation!==e&&this._rotation.copyFrom(e)}},{key:"worldRotation",get:function(){var e=this._worldRotation;return this._isContainDirtyFlag(Ce.WorldEuler)&&(e._onValueChanged=null,this.worldRotationQuaternion.toEuler(e),e.scale(Q.radToDegreeFactor),e._onValueChanged=this._onWorldRotationChanged,this._setDirtyFlagFalse(Ce.WorldEuler)),e},set:function(e){this._worldRotation!==e&&this._worldRotation.copyFrom(e)}},{key:"rotationQuaternion",get:function(){var e=this._rotationQuaternion;return this._isContainDirtyFlag(Ce.LocalQuat)&&(e._onValueChanged=null,Me.rotationEuler(Q.degreeToRadian(this._rotation.x),Q.degreeToRadian(this._rotation.y),Q.degreeToRadian(this._rotation.z),e),e._onValueChanged=this._onRotationQuaternionChanged,this._setDirtyFlagFalse(Ce.LocalQuat)),e},set:function(e){this._rotationQuaternion!==e?e.normalized?this._rotationQuaternion.copyFrom(e):Me.normalize(e,this._rotationQuaternion):e.normalized||e.normalize()}},{key:"worldRotationQuaternion",get:function(){var e=this._worldRotationQuaternion;if(this._isContainDirtyFlag(Ce.WorldQuat)){e._onValueChanged=null;var n=this._getParentTransform();n!=null?Me.multiply(n.worldRotationQuaternion,this.rotationQuaternion,e):e.copyFrom(this.rotationQuaternion),e._onValueChanged=this._onWorldRotationQuaternionChanged,this._setDirtyFlagFalse(Ce.WorldQuat)}return e},set:function(e){this._worldRotationQuaternion!==e&&(e.normalized?this._worldRotationQuaternion.copyFrom(e):Me.normalize(e,this._worldRotationQuaternion)),e.normalized||e.normalize()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&this._scale.copyFrom(e)}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(Ce.WorldScale)){if(this._getParentTransform()){var e=this._getScaleMatrix(),n=e.elements;this._lossyWorldScale.set(n[0],n[4],n[8])}else this._lossyWorldScale.copyFrom(this._scale);this._setDirtyFlagFalse(Ce.WorldScale)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(Ce.LocalMatrix)&&(ge.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(Ce.LocalMatrix)),this._localMatrix},set:function(e){this._localMatrix!==e&&this._localMatrix.copyFrom(e),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(Ce.LocalEuler),this._setDirtyFlagFalse(Ce.LocalMatrix),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(Ce.WorldMatrix)){var e=this._getParentTransform();e?ge.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(Ce.WorldMatrix)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&this._worldMatrix.copyFrom(e);var n=this._getParentTransform();n?(ge.invert(n.worldMatrix,o._tempMat42),ge.multiply(o._tempMat42,e,this._localMatrix)):this._localMatrix.copyFrom(e),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(Ce.WorldMatrix)}}]),o}(wr),br._tempQuat0=new Me,br._tempVec30=new y,br._tempVec31=new y,br._tempVec32=new y,br._tempMat30=new Ri,br._tempMat31=new Ri,br._tempMat32=new Ri,br._tempMat41=new ge,br._tempMat42=new ge,br),ru=j(It.prototype,"_position",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y}}),nu=j(It.prototype,"_rotation",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y}}),iu=j(It.prototype,"_rotationQuaternion",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Me}}),au=j(It.prototype,"_scale",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y(1,1,1)}}),ou=j(It.prototype,"_worldPosition",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y}}),su=j(It.prototype,"_worldRotation",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y}}),lu=j(It.prototype,"_worldRotationQuaternion",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Me}}),cu=j(It.prototype,"_lossyWorldScale",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y(1,1,1)}}),uu=j(It.prototype,"_localMatrix",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),hu=j(It.prototype,"_worldMatrix",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),fu=j(It.prototype,"_updateFlagManager",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ki}}),du=j(It.prototype,"_isParentDirty",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_u=j(It.prototype,"_parentTransformCache",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),It),Ce;(function(r){r[r.LocalEuler=1]="LocalEuler",r[r.LocalQuat=2]="LocalQuat",r[r.WorldPosition=4]="WorldPosition",r[r.WorldEuler=8]="WorldEuler",r[r.WorldQuat=16]="WorldQuat",r[r.WorldScale=32]="WorldScale",r[r.LocalMatrix=64]="LocalMatrix",r[r.WorldMatrix=128]="WorldMatrix",r[r.WmWp=132]="WmWp",r[r.WmWeWq=152]="WmWeWq",r[r.WmWpWeWq=156]="WmWpWeWq",r[r.WmWs=160]="WmWs",r[r.WmWpWs=164]="WmWpWs",r[r.WmWpWeWqWs=188]="WmWpWeWqWs"})(Ce||(Ce={}));var Qr=function(r){ne(o,r),o._findChildByName=function(e,n){for(var a=e._children,s=a.length-1;s>=0;s--){var l=a[s];if(l.name===n)return l}return null},o._traverseSetOwnerScene=function(e,n){e._scene=n;for(var a=e._children,s=e.childCount-1;s>=0;s--)this._traverseSetOwnerScene(a[s],n)};function o(t,e){var n;return n=r.call(this,t)||this,n.name=void 0,n.layer=Tt.Layer0,n.transform=void 0,n._isActiveInHierarchy=!1,n._components=[],n._scripts=new kt,n._children=[],n._scene=void 0,n._isRoot=!1,n._isActive=!0,n._siblingIndex=-1,n._parent=null,n._activeChangedComponents=void 0,n._invModelMatrix=new ge,n._inverseWorldMatFlag=void 0,n.name=e,n.transform=n.addComponent(rr),n._inverseWorldMatFlag=n.transform.registerWorldChangeFlag(),n}var i=o.prototype;return i.addComponent=function(e){Ua._addCheck(this,e);var n=new e(this);return this._components.push(n),n._setActive(!0),n},i.getComponent=function(e){for(var n=this._components.length-1;n>=0;n--){var a=this._components[n];if(a instanceof e)return a}},i.getComponents=function(e,n){n.length=0;for(var a=this._components.length-1;a>=0;a--){var s=this._components[a];s instanceof e&&n.push(s)}return n},i.getComponentsIncludeChildren=function(e,n){return n.length=0,this._getComponentsInChildren(e,n),n},i.addChild=function(e,n){var a;if(typeof e=="number"?a=e:(a=void 0,n=e),n._isRoot){n._scene._removeFromEntityList(n),n._isRoot=!1,this._addToChildrenList(a,n),n._parent=this;var s=this._scene;n._scene!==s&&o._traverseSetOwnerScene(n,s),this._isActiveInHierarchy?!n._isActiveInHierarchy&&n._isActive&&n._processActive():n._isActiveInHierarchy&&n._processInActive(),n._setTransformDirty()}else n._setParent(this,a)},i.removeChild=function(e){e._setParent(null)},i.getChild=function(e){return this._children[e]},i.findByName=function(e){var n=this._children,a=o._findChildByName(this,e);if(a)return a;for(var s=n.length-1;s>=0;s--){var l=n[s],c=l.findByName(e);if(c)return c}return null},i.findByPath=function(e){for(var n=e.split("/"),a=this,s=0,l=n.length;s<l;++s){var c=n[s];if(c&&(a=o._findChildByName(a,c),!a))return null}return a},i.createChild=function(e){var n=new o(this.engine,e);return n.layer=this.layer,n.parent=this,n},i.clearChildren=function(){for(var e=this._children,n=e.length-1;n>=0;n--){var a=e[n];a._parent=null,a._isActiveInHierarchy&&a._processInActive(),o._traverseSetOwnerScene(a,null)}e.length=0},i.clone=function(){var e=new o(this._engine,this.name);e._isActive=this._isActive,e.transform.localMatrix=this.transform.localMatrix;for(var n=this._children,a=0,s=this._children.length;a<s;a++){var l=n[a];e.addChild(l.clone())}for(var c=this._components,u=0,h=c.length;u<h;u++){var f=c[u];if(!(f instanceof rr)){var d=e.addComponent(f.constructor);wy.cloneComponent(f,d)}}return e},i.destroy=function(){if(!this._destroyed){r.prototype.destroy.call(this);for(var e=this._components,n=e.length-1;n>=0;n--)e[n].destroy();this._components.length=0;for(var a=this._children,s=a.length-1;s>=0;s--)a[s].destroy();this._children.length=0,this._isRoot?(this._scene._removeFromEntityList(this),this._isRoot=!1):this._removeFromParent()}},i._removeComponent=function(e){Ua._removeCheck(this,e.constructor);var n=this._components;n.splice(n.indexOf(e),1)},i._addScript=function(e){e._entityScriptsIndex=this._scripts.length,this._scripts.add(e)},i._removeScript=function(e){var n=this._scripts.deleteByIndex(e._entityScriptsIndex);n&&(n._entityScriptsIndex=e._entityScriptsIndex),e._entityScriptsIndex=-1},i._removeFromParent=function(){var e=this._parent;if(e!=null){var n=e._children,a=this._siblingIndex;n.splice(a,1);for(var s=n.length;a<s;a++)n[a]._siblingIndex--;this._parent=null,this._siblingIndex=-1}},i._processActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!0)},i._processInActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!1)},i._addToChildrenList=function(e,n){var a=this._children,s=a.length;if(e===void 0)n._siblingIndex=s,a.push(n);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;n._siblingIndex=e,a.splice(e,0,n);for(var l=e+1,c=s+1;l<c;l++)a[l]._siblingIndex++}},i._setParent=function(e,n){var a=this._parent;if(e!==a){if(this._removeFromParent(),this._parent=e,e){e._addToChildrenList(n,this);var s=e._scene;this._scene!==s&&o._traverseSetOwnerScene(this,s),e._isActiveInHierarchy?!this._isActiveInHierarchy&&this._isActive&&this._processActive():this._isActiveInHierarchy&&this._processInActive()}else this._isActiveInHierarchy&&this._processInActive(),a&&o._traverseSetOwnerScene(this,null);this._setTransformDirty()}},i._getComponentsInChildren=function(e,n){for(var a=this._components.length-1;a>=0;a--){var s=this._components[a];s instanceof e&&n.push(s)}for(var l=this._children.length-1;l>=0;l--)this._children[l]._getComponentsInChildren(e,n)},i._setActiveComponents=function(e){for(var n=this._activeChangedComponents,a=0,s=n.length;a<s;++a)n[a]._setActive(e);this._engine._componentsManager.putActiveChangedTempList(n),this._activeChangedComponents=null},i._setActiveInHierarchy=function(e){this._isActiveInHierarchy=!0;for(var n=this._components,a=n.length-1;a>=0;a--){var s=n[a];(s.enabled||!s._awoken)&&e.push(s)}for(var l=this._children,c=l.length-1;c>=0;c--){var u=l[c];u.isActive&&u._setActiveInHierarchy(e)}},i._setInActiveInHierarchy=function(e){this._isActiveInHierarchy=!1;for(var n=this._components,a=n.length-1;a>=0;a--){var s=n[a];s.enabled&&e.push(s)}for(var l=this._children,c=l.length-1;c>=0;c--){var u=l[c];u.isActive&&u._setInActiveInHierarchy(e)}},i._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,n=this._children.length;e<n;e++)this._children[e]._setTransformDirty()},i._setSiblingIndex=function(e,n){if(n=Math.min(n,e.length-1),n<0)throw"Sibling index "+n+" should large than 0";if(this._siblingIndex!==n){var a=this._siblingIndex;if(n<a)for(var s=a;s>=n;s--){var l=s==n?this:e[s-1];e[s]=l,l._siblingIndex=s}else for(var c=a;c<=n;c++){var u=c==n?this:e[c+1];e[c]=u,u._siblingIndex=c}}},i.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&(ge.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},ie(o,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var n=this._parent;(n!=null&&n._isActiveInHierarchy||this._isRoot&&this._scene._isActiveInEngine)&&this._processActive()}else this._isActiveInHierarchy&&this._processInActive()}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this._setParent(e)}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(e){if(this._siblingIndex===-1)throw"The entity "+this.name+" is not in the hierarchy";this._setSiblingIndex(this._isRoot?this._scene._rootEntities:this._parent._children,e)}}]),o}(pn),fv=function(){function r(){this._features=[],this._objects=[]}var o=r.prototype;return o.registerFeature=function(t){for(var e=this._features,n=0,a=e.length;n<a;n++)if(e[n]===t)return;e.push(t);for(var s=this._objects,l=0,c=s.length;l<c;l++)s[l].features.push(new t)},o.addObject=function(t){t.features=[];for(var e=0,n=this._features.length;e<n;e++){var a;t.features.push(new this._features[e]((a=t.engine)!=null?a:t))}this._objects.push(t)},o.callFeatureMethod=function(t,e,n){for(var a=t.features,s=a.length,l=0;l<s;l++){var c=a[l];c[e]&&c[e].apply(c,n)}},o.findFeature=function(t,e){for(var n=t.features,a=n.length,s=0;s<a;s++){var l=n[s];if(l.constructor===e)return l}},r}(),yt;(function(r){r[r.Backquote=0]="Backquote",r[r.Backslash=1]="Backslash",r[r.Backspace=2]="Backspace",r[r.BracketLeft=3]="BracketLeft",r[r.BracketRight=4]="BracketRight",r[r.Comma=5]="Comma",r[r.Digit0=6]="Digit0",r[r.Digit1=7]="Digit1",r[r.Digit2=8]="Digit2",r[r.Digit3=9]="Digit3",r[r.Digit4=10]="Digit4",r[r.Digit5=11]="Digit5",r[r.Digit6=12]="Digit6",r[r.Digit7=13]="Digit7",r[r.Digit8=14]="Digit8",r[r.Digit9=15]="Digit9",r[r.Equal=16]="Equal",r[r.IntlBackslash=17]="IntlBackslash",r[r.IntlRo=18]="IntlRo",r[r.IntlYen=19]="IntlYen",r[r.KeyA=20]="KeyA",r[r.KeyB=21]="KeyB",r[r.KeyC=22]="KeyC",r[r.KeyD=23]="KeyD",r[r.KeyE=24]="KeyE",r[r.KeyF=25]="KeyF",r[r.KeyG=26]="KeyG",r[r.KeyH=27]="KeyH",r[r.KeyI=28]="KeyI",r[r.KeyJ=29]="KeyJ",r[r.KeyK=30]="KeyK",r[r.KeyL=31]="KeyL",r[r.KeyM=32]="KeyM",r[r.KeyN=33]="KeyN",r[r.KeyO=34]="KeyO",r[r.KeyP=35]="KeyP",r[r.KeyQ=36]="KeyQ",r[r.KeyR=37]="KeyR",r[r.KeyS=38]="KeyS",r[r.KeyT=39]="KeyT",r[r.KeyU=40]="KeyU",r[r.KeyV=41]="KeyV",r[r.KeyW=42]="KeyW",r[r.KeyX=43]="KeyX",r[r.KeyY=44]="KeyY",r[r.KeyZ=45]="KeyZ",r[r.Minus=46]="Minus",r[r.Period=47]="Period",r[r.Quote=48]="Quote",r[r.Semicolon=49]="Semicolon",r[r.Slash=50]="Slash",r[r.AltLeft=51]="AltLeft",r[r.AltRight=52]="AltRight",r[r.CapsLock=53]="CapsLock",r[r.ContextMenu=54]="ContextMenu",r[r.ControlLeft=55]="ControlLeft",r[r.ControlRight=56]="ControlRight",r[r.Enter=57]="Enter",r[r.MetaLeft=58]="MetaLeft",r[r.MetaRight=59]="MetaRight",r[r.ShiftLeft=60]="ShiftLeft",r[r.ShiftRight=61]="ShiftRight",r[r.Space=62]="Space",r[r.Tab=63]="Tab",r[r.Convert=64]="Convert",r[r.KanaMode=65]="KanaMode",r[r.Lang1=66]="Lang1",r[r.Lang2=67]="Lang2",r[r.Lang3=68]="Lang3",r[r.Lang4=69]="Lang4",r[r.Lang5=70]="Lang5",r[r.NonConvert=71]="NonConvert",r[r.Delete=72]="Delete",r[r.End=73]="End",r[r.Help=74]="Help",r[r.Home=75]="Home",r[r.Insert=76]="Insert",r[r.PageDown=77]="PageDown",r[r.PageUp=78]="PageUp",r[r.ArrowDown=79]="ArrowDown",r[r.ArrowLeft=80]="ArrowLeft",r[r.ArrowRight=81]="ArrowRight",r[r.ArrowUp=82]="ArrowUp",r[r.NumLock=83]="NumLock",r[r.Numpad0=84]="Numpad0",r[r.Numpad1=85]="Numpad1",r[r.Numpad2=86]="Numpad2",r[r.Numpad3=87]="Numpad3",r[r.Numpad4=88]="Numpad4",r[r.Numpad5=89]="Numpad5",r[r.Numpad6=90]="Numpad6",r[r.Numpad7=91]="Numpad7",r[r.Numpad8=92]="Numpad8",r[r.Numpad9=93]="Numpad9",r[r.NumpadAdd=94]="NumpadAdd",r[r.NumpadBackspace=95]="NumpadBackspace",r[r.NumpadClear=96]="NumpadClear",r[r.NumpadClearEntry=97]="NumpadClearEntry",r[r.NumpadComma=98]="NumpadComma",r[r.NumpadDecimal=99]="NumpadDecimal",r[r.NumpadDivide=100]="NumpadDivide",r[r.NumpadEnter=101]="NumpadEnter",r[r.NumpadEqual=102]="NumpadEqual",r[r.NumpadHash=103]="NumpadHash",r[r.NumpadMemoryAdd=104]="NumpadMemoryAdd",r[r.NumpadMemoryClear=105]="NumpadMemoryClear",r[r.NumpadMemoryRecall=106]="NumpadMemoryRecall",r[r.NumpadMemoryStore=107]="NumpadMemoryStore",r[r.NumpadMemorySubtract=108]="NumpadMemorySubtract",r[r.NumpadMultiply=109]="NumpadMultiply",r[r.NumpadParenLeft=110]="NumpadParenLeft",r[r.NumpadParenRight=111]="NumpadParenRight",r[r.NumpadStar=112]="NumpadStar",r[r.NumpadSubtract=113]="NumpadSubtract",r[r.Escape=114]="Escape",r[r.F1=115]="F1",r[r.F2=116]="F2",r[r.F3=117]="F3",r[r.F4=118]="F4",r[r.F5=119]="F5",r[r.F6=120]="F6",r[r.F7=121]="F7",r[r.F8=122]="F8",r[r.F9=123]="F9",r[r.F10=124]="F10",r[r.F11=125]="F11",r[r.F12=126]="F12",r[r.F13=127]="F13",r[r.F14=128]="F14",r[r.F15=129]="F15",r[r.Fn=130]="Fn",r[r.FnLock=131]="FnLock",r[r.PrintScreen=132]="PrintScreen",r[r.ScrollLock=133]="ScrollLock",r[r.Pause=134]="Pause",r[r.BrowserBack=135]="BrowserBack",r[r.BrowserFavorites=136]="BrowserFavorites",r[r.BrowserForward=137]="BrowserForward",r[r.BrowserHome=138]="BrowserHome",r[r.BrowserRefresh=139]="BrowserRefresh",r[r.BrowserSearch=140]="BrowserSearch",r[r.BrowserStop=141]="BrowserStop",r[r.Eject=142]="Eject",r[r.LaunchApp1=143]="LaunchApp1",r[r.LaunchApp2=144]="LaunchApp2",r[r.LaunchMail=145]="LaunchMail",r[r.MediaPlayPause=146]="MediaPlayPause",r[r.MediaSelect=147]="MediaSelect",r[r.MediaStop=148]="MediaStop",r[r.MediaTrackNext=149]="MediaTrackNext",r[r.MediaTrackPrevious=150]="MediaTrackPrevious",r[r.Power=151]="Power",r[r.Sleep=152]="Sleep",r[r.AudioVolumeDown=153]="AudioVolumeDown",r[r.AudioVolumeMute=154]="AudioVolumeMute",r[r.AudioVolumeUp=155]="AudioVolumeUp",r[r.WakeUp=156]="WakeUp",r[r.Hyper=157]="Hyper",r[r.Super=158]="Super",r[r.Turbo=159]="Turbo",r[r.Abort=160]="Abort",r[r.Resume=161]="Resume",r[r.Suspend=162]="Suspend",r[r.Again=163]="Again",r[r.Copy=164]="Copy",r[r.Cut=165]="Cut",r[r.Find=166]="Find",r[r.Open=167]="Open",r[r.Paste=168]="Paste",r[r.Props=169]="Props",r[r.Select=170]="Select",r[r.Undo=171]="Undo",r[r.Hiragana=172]="Hiragana",r[r.Katakana=173]="Katakana",r[r.Unidentified=174]="Unidentified"})(yt||(yt={}));var by=function(){function r(i){this._curHeldDownKeyToIndexMap=[],this._upKeyToFrameCountMap=[],this._downKeyToFrameCountMap=[],this._curFrameHeldDownList=new kt,this._curFrameDownList=new kt,this._curFrameUpList=new kt,this._htmlCanvas=void 0,this._nativeEvents=[],this._hadListener=!1,this._htmlCanvas=i,i.tabIndex=i.tabIndex,this._onKeyEvent=this._onKeyEvent.bind(this),i.addEventListener("keydown",this._onKeyEvent),i.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0}var o=r.prototype;return o._update=function(t){var e=this._nativeEvents,n=this._curFrameDownList,a=this._curFrameUpList;if(n.length=0,a.length=0,e.length>0){for(var s=this._curHeldDownKeyToIndexMap,l=this._curFrameHeldDownList,c=this._downKeyToFrameCountMap,u=this._upKeyToFrameCountMap,h=0,f=e.length;h<f;h++){var d=e[h],_=yt[d.code];switch(d.type){case"keydown":s[_]==null&&(n.add(_),l.add(_),s[_]=l.length-1,c[_]=t);break;case"keyup":var p=s[_];if(p!=null){s[_]=null;var v=l.deleteByIndex(p);v&&(s[v]=p)}a.add(_),u[_]=t;break}}e.length=0}},o._onFocus=function(){this._hadListener||(this._htmlCanvas.addEventListener("keydown",this._onKeyEvent),this._htmlCanvas.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0)},o._onBlur=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._curHeldDownKeyToIndexMap.length=0,this._curFrameHeldDownList.length=0,this._curFrameDownList.length=0,this._curFrameUpList.length=0,this._nativeEvents.length=0,this._hadListener=!1)},o._destroy=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._hadListener=!1),this._curHeldDownKeyToIndexMap=null,this._upKeyToFrameCountMap=null,this._downKeyToFrameCountMap=null,this._nativeEvents=null,this._curFrameHeldDownList=null,this._curFrameDownList=null,this._curFrameUpList=null},o._onKeyEvent=function(t){t.cancelable&&t.preventDefault(),this._nativeEvents.push(t)},r}(),Dr;(function(r){r[r.None=0]="None",r[r.Color=1]="Color",r[r.Depth=2]="Depth",r[r.Stencil=4]="Stencil",r[r.ColorDepth=3]="ColorDepth",r[r.ColorStencil=5]="ColorStencil",r[r.DepthStencil=6]="DepthStencil",r[r.All=7]="All"})(Dr||(Dr={}));var Bl=function(){this.entity=null,this.distance=0,this.point=new y,this.normal=new y},Jt=function(){function r(i){var t=this;this._initialized=!1,this._engine=void 0,this._restTime=0,this._colliders=new kt,this._gravity=new y(0,-9.81,0),this._nativePhysicsManager=void 0,this._physicalObjectsMap={},this._onContactEnter=function(e,n){for(var a=t._physicalObjectsMap[e],s=t._physicalObjectsMap[n],l=a.collider.entity._scripts,c=0,u=l.length;c<u;c++){var h=l.get(c);h._waitHandlingInValid||h.onCollisionEnter(s)}l=s.collider.entity._scripts;for(var f=0,d=l.length;f<d;f++){var _=l.get(f);_._waitHandlingInValid||_.onCollisionEnter(a)}},this._onContactExit=function(e,n){for(var a=t._physicalObjectsMap[e],s=t._physicalObjectsMap[n],l=a.collider.entity._scripts,c=0,u=l.length;c<u;c++){var h=l.get(c);h._waitHandlingInValid||h.onCollisionExit(s)}l=s.collider.entity._scripts;for(var f=0,d=l.length;f<d;f++){var _=l.get(f);_._waitHandlingInValid||_.onCollisionExit(a)}},this._onContactStay=function(e,n){for(var a=t._physicalObjectsMap[e],s=t._physicalObjectsMap[n],l=a.collider.entity._scripts,c=0,u=l.length;c<u;c++){var h=l.get(c);h._waitHandlingInValid||h.onCollisionStay(s)}l=s.collider.entity._scripts;for(var f=0,d=l.length;f<d;f++){var _=l.get(f);_._waitHandlingInValid||_.onCollisionStay(a)}},this._onTriggerEnter=function(e,n){for(var a=t._physicalObjectsMap[e],s=t._physicalObjectsMap[n],l=a.collider.entity._scripts,c=0,u=l.length;c<u;c++){var h=l.get(c);h._waitHandlingInValid||h.onTriggerEnter(s)}l=s.collider.entity._scripts;for(var f=0,d=l.length;f<d;f++){var _=l.get(f);_._waitHandlingInValid||_.onTriggerEnter(a)}},this._onTriggerExit=function(e,n){for(var a=t._physicalObjectsMap[e],s=t._physicalObjectsMap[n],l=a.collider.entity._scripts,c=0,u=l.length;c<u;c++){var h=l.get(c);h._waitHandlingInValid||h.onTriggerExit(s)}l=s.collider.entity._scripts;for(var f=0,d=l.length;f<d;f++){var _=l.get(f);_._waitHandlingInValid||_.onTriggerExit(a)}},this._onTriggerStay=function(e,n){for(var a=t._physicalObjectsMap[e],s=t._physicalObjectsMap[n],l=a.collider.entity._scripts,c=0,u=l.length;c<u;c++){var h=l.get(c);h._waitHandlingInValid||h.onTriggerStay(s)}l=s.collider.entity._scripts;for(var f=0,d=l.length;f<d;f++){var _=l.get(f);_._waitHandlingInValid||_.onTriggerStay(a)}},this.fixedTimeStep=1/60,this.maxSumTimeStep=1/3,this._engine=i}var o=r.prototype;return o.initialize=function(t){this._initialized||(r._nativePhysics=t,this._nativePhysicsManager=r._nativePhysics.createPhysicsManager(this._onContactEnter,this._onContactExit,this._onContactStay,this._onTriggerEnter,this._onTriggerExit,this._onTriggerStay),this._initialized=!0)},o.raycast=function(t,e,n,a){var s=this,l,c=Number.MAX_VALUE;typeof e=="number"?c=e:e!=null&&(l=e);var u=Tt.Everything;if(typeof n=="number"?u=n:n!=null&&(l=n),a&&(l=a),l!=null){var h=this._nativePhysicsManager.raycast(t,c,function(f,d,_,p){l.entity=s._physicalObjectsMap[f]._collider.entity,l.distance=d,l.normal.copyFrom(p),l.point.copyFrom(_)});return h?l.entity.layer&u?!0:(l.entity=null,l.distance=0,l.point.set(0,0,0),l.normal.set(0,0,0),!1):!1}else return this._nativePhysicsManager.raycast(t,c)},o._update=function(t){var e=this.fixedTimeStep,n=this._nativePhysicsManager,a=this._engine._componentsManager,s=t+this._restTime,l=Math.floor(Math.min(this.maxSumTimeStep,s)/e);this._restTime=s-l*e;for(var c=0;c<l;c++)a.callScriptOnPhysicsUpdate(),this._callColliderOnUpdate(),n.update(e),this._callColliderOnLateUpdate()},o._addColliderShape=function(t){this._physicalObjectsMap[t.id]=t,this._nativePhysicsManager.addColliderShape(t._nativeShape)},o._removeColliderShape=function(t){delete this._physicalObjectsMap[t.id],this._nativePhysicsManager.removeColliderShape(t._nativeShape)},o._addCollider=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsManager.addCollider(t._nativeCollider)},o._addCharacterController=function(t){t._index===-1&&(t._index=this._colliders.length,this._colliders.add(t)),this._nativePhysicsManager.addCharacterController(t._nativeCollider)},o._removeCollider=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsManager.removeCollider(t._nativeCollider)},o._removeCharacterController=function(t){var e=this._colliders.deleteByIndex(t._index);e&&(e._index=t._index),t._index=-1,this._nativePhysicsManager.removeCharacterController(t._nativeCollider)},o._callColliderOnUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onUpdate()},o._callColliderOnLateUpdate=function(){for(var t=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)t[e]._onLateUpdate()},ie(r,[{key:"gravity",get:function(){return this._gravity},set:function(t){var e=this._gravity;e!==t&&e.copyFrom(t),this._nativePhysicsManager.setGravity(e)}}]),r}();Jt._nativePhysics=void 0;var Va;(function(r){r[r.Average=0]="Average",r[r.Minimum=1]="Minimum",r[r.Multiply=2]="Multiply",r[r.Maximum=3]="Maximum"})(Va||(Va={}));var dv=function(){function r(){this._bounciness=.1,this._dynamicFriction=.1,this._staticFriction=.1,this._bounceCombine=Va.Average,this._frictionCombine=Va.Average,this._nativeMaterial=void 0,this._nativeMaterial=Jt._nativePhysics.createPhysicsMaterial(this._staticFriction,this._dynamicFriction,this._bounciness,this._bounceCombine,this._frictionCombine)}var o=r.prototype;return o._destroy=function(){this._nativeMaterial.destroy()},ie(r,[{key:"bounciness",get:function(){return this._bounciness},set:function(t){this._bounciness=t,this._nativeMaterial.setBounciness(t)}},{key:"dynamicFriction",get:function(){return this._dynamicFriction},set:function(t){this._dynamicFriction=t,this._nativeMaterial.setDynamicFriction(t)}},{key:"staticFriction",get:function(){return this._staticFriction},set:function(t){this._staticFriction=t,this._nativeMaterial.setStaticFriction(t)}},{key:"bounceCombine",get:function(){return this._bounceCombine},set:function(t){this._bounceCombine=t,this._nativeMaterial.setBounceCombine(t)}},{key:"frictionCombine",get:function(){return this._frictionCombine},set:function(t){this._frictionCombine=t,this._nativeMaterial.setFrictionCombine(t)}}]),r}(),vu,pu,Ps,gu,rn=(vu=ca(rr),vu(pu=(Ps=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,X(e,"_index",gu,N(e)),e._nativeCollider=void 0,e._updateFlag=void 0,e._shapes=[],e._updateFlag=e.entity.transform.registerWorldChangeFlag(),e}var i=o.prototype;return i.addShape=function(e){var n=e._collider;n!==this&&(n&&n.removeShape(e),this._shapes.push(e),this.engine.physicsManager._addColliderShape(e),e._collider=this,this._nativeCollider.addShape(e._nativeShape))},i.removeShape=function(e){var n=this._shapes.indexOf(e);n!==-1&&(this._shapes.splice(n,1),this.engine.physicsManager._removeColliderShape(e),e._collider=null,this._nativeCollider.removeShape(e._nativeShape))},i.clearShapes=function(){for(var e=this._shapes,n=0,a=e.length;n<a;n++){var s=e[n];this.engine.physicsManager._removeColliderShape(s),s._destroy(),this._nativeCollider.removeShape(s._nativeShape)}e.length=0},i._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform;this._nativeCollider.setWorldTransform(e.worldPosition,e.worldRotationQuaternion);for(var n=e.lossyWorldScale,a=0,s=this.shapes.length;a<s;a++)this.shapes[a]._nativeShape.setWorldScale(n);this._updateFlag.flag=!1}},i._onLateUpdate=function(){},i._onEnable=function(){this.engine.physicsManager._addCollider(this)},i._onDisable=function(){this.engine.physicsManager._removeCollider(this)},i._onDestroy=function(){this.clearShapes(),this._nativeCollider.destroy()},ie(o,[{key:"shapes",get:function(){return this._shapes}}]),o}(wr),gu=j(Ps.prototype,"_index",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Ps))||pu),Mo;(function(r){r[r.PreventClimbing=0]="PreventClimbing",r[r.PreventClimbingAndForceSliding=1]="PreventClimbingAndForceSliding"})(Mo||(Mo={}));var _v=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,e._index=-1,e._stepOffset=0,e._nonWalkableMode=Mo.PreventClimbing,e._upDirection=new y(0,1,0),e._slopeLimit=0,e._nativeCollider=Jt._nativePhysics.createCharacterController(),e}var i=o.prototype;return i.move=function(e,n,a){return this._nativeCollider.move(e,n,a)},i.addShape=function(e){if(this._shapes.length>0)throw"only allow single shape on controller!";r.prototype.addShape.call(this,e),this._updateFlag.flag=!0},i.clearShapes=function(){this._shapes.length>0&&r.prototype.removeShape.call(this,this._shapes[0])},i._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform,n=this.shapes;this._nativeCollider.setWorldPosition(e.worldPosition);for(var a=e.lossyWorldScale,s=0,l=n.length;s<l;s++)n[s]._nativeShape.setWorldScale(a);this._updateFlag.flag=!1}},i._onLateUpdate=function(){var e=this.entity.transform.worldPosition;this._nativeCollider.getWorldPosition(e),this.entity.transform.worldPosition=e,this._updateFlag.flag=!1},i._onEnable=function(){this.engine.physicsManager._addCharacterController(this)},i._onDisable=function(){this.engine.physicsManager._removeCharacterController(this)},ie(o,[{key:"stepOffset",get:function(){return this._stepOffset},set:function(e){this._stepOffset=e,this._nativeCollider.setStepOffset(e)}},{key:"nonWalkableMode",get:function(){return this._nonWalkableMode},set:function(e){this._nonWalkableMode=e,this._nativeCollider.setNonWalkableMode(e)}},{key:"upDirection",get:function(){return this._upDirection},set:function(e){this._upDirection!==e&&this._upDirection.copyFrom(e),this._nativeCollider.setUpDirection(this._upDirection)}},{key:"slopeLimit",get:function(){return this._slopeLimit},set:function(e){this._slopeLimit=e,this._nativeCollider.setSlopeLimit(e)}}]),o}(rn),ua=function(){function r(){this._collider=void 0,this._nativeShape=void 0,this._id=void 0,this._position=new y,this._material=void 0,this._isTrigger=!1,this._isSceneQuery=!0,this._contactOffset=0,this._material=new dv,this._id=r._idGenerator++}var o=r.prototype;return o.setPosition=function(t,e,n){this._position.set(t,e,n),this._nativeShape.setPosition(this._position)},o._destroy=function(){this._material._destroy(),this._nativeShape.destroy()},ie(r,[{key:"collider",get:function(){return this._collider}},{key:"id",get:function(){return this._id}},{key:"contactOffset",get:function(){return this._contactOffset},set:function(t){this._contactOffset=t,this._nativeShape.setContactOffset(t)}},{key:"material",get:function(){return this._material},set:function(t){this._material=t,this._nativeShape.setMaterial(t._nativeMaterial)}},{key:"position",get:function(){return this._position},set:function(t){this._position!==t&&this._position.copyFrom(t),this._nativeShape.setPosition(t)}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger=t,this._nativeShape.setIsTrigger(t)}}]),r}();ua._idGenerator=0;var Il=function(r){ne(o,r);function o(){var t;return t=r.call(this)||this,t._size=new y(1,1,1),t._nativeShape=Jt._nativePhysics.createBoxColliderShape(t._id,t._size,t._material._nativeMaterial),t}var i=o.prototype;return i.setSize=function(e,n,a){this._size.x=e,this._size.y=n,this._size.z=a,this._nativeShape.setSize(this._size)},ie(o,[{key:"size",get:function(){return this._size},set:function(e){this._size!=e&&this._size.copyFrom(e),this._nativeShape.setSize(e)}}]),o}(ua),zl=function(r){ne(o,r);function o(){var i;return i=r.call(this)||this,i._radius=1,i._nativeShape=Jt._nativePhysics.createSphereColliderShape(i._id,i._radius,i._material._nativeMaterial),i}return ie(o,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t,this._nativeShape.setRadius(t)}}]),o}(ua),Sy=function(r){ne(o,r);function o(){var t;return t=r.call(this)||this,t._rotation=new y,t._nativeShape=Jt._nativePhysics.createPlaneColliderShape(t._id,t._material._nativeMaterial),t}var i=o.prototype;return i.setRotation=function(e,n,a){this._rotation.set(e,n,a),this._nativeShape.setRotation(this._rotation)},ie(o,[{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation!=e&&this._rotation.copyFrom(e),this._nativeShape.setRotation(e)}}]),o}(ua),mi;(function(r){r[r.X=0]="X",r[r.Y=1]="Y",r[r.Z=2]="Z"})(mi||(mi={}));var vv=function(r){ne(o,r);function o(){var i;return i=r.call(this)||this,i._radius=1,i._height=2,i._upAxis=mi.Y,i._nativeShape=Jt._nativePhysics.createCapsuleColliderShape(i._id,i._radius,i._height,i._material._nativeMaterial),i._nativeShape.setUpAxis(mi.Y),i}return ie(o,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t,this._nativeShape.setRadius(t)}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._nativeShape.setHeight(t)}},{key:"upAxis",get:function(){return this._upAxis},set:function(t){this._upAxis=t,this._nativeShape.setUpAxis(t)}}]),o}(ua),mu,yu,ts=(mu=ca(rn),mu(yu=function(r){ne(o,r);function o(i){var t;return t=r.call(this,i)||this,t._connectedCollider=new xu,t._collider=new xu,t._nativeJoint=void 0,t._force=0,t._torque=0,t._connectedCollider.localPosition=new y,t}return ie(o,[{key:"connectedCollider",get:function(){return this._connectedCollider.collider},set:function(t){this._connectedCollider.collider!==t&&(this._connectedCollider.collider=t,this._nativeJoint.setConnectedCollider(t._nativeCollider))}},{key:"connectedAnchor",get:function(){return this._connectedCollider.localPosition},set:function(t){var e=this._connectedCollider.localPosition;t!==e&&e.copyFrom(t),this._nativeJoint.setConnectedAnchor(t)}},{key:"connectedMassScale",get:function(){return this._connectedCollider.massScale},set:function(t){t!==this._connectedCollider.massScale&&(this._connectedCollider.massScale=t,this._nativeJoint.setConnectedMassScale(t))}},{key:"connectedInertiaScale",get:function(){return this._connectedCollider.inertiaScale},set:function(t){t!==this._connectedCollider.inertiaScale&&(this._connectedCollider.inertiaScale=t,this._nativeJoint.setConnectedInertiaScale(t))}},{key:"massScale",get:function(){return this._collider.massScale},set:function(t){t!==this._collider.massScale&&(this._collider.massScale=t,this._nativeJoint.setMassScale(t))}},{key:"inertiaScale",get:function(){return this._collider.inertiaScale},set:function(t){t!==this._collider.inertiaScale&&(this._collider.inertiaScale=t,this._nativeJoint.setInertiaScale(t))}},{key:"breakForce",get:function(){return this._force},set:function(t){t!==this._force&&(this._force=t,this._nativeJoint.setBreakForce(t))}},{key:"breakTorque",get:function(){return this._torque},set:function(t){t!==this._torque&&(this._torque=t,this._nativeJoint.setBreakTorque(t))}}]),o}(wr))||yu),xu=function(){this.collider=null,this.localPosition=void 0,this.localRotation=void 0,this.massScale=0,this.inertiaScale=0},Cy=function(r){ne(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i._onAwake=function(){var e=this._collider;e.collider=this.entity.getComponent(rn),this._nativeJoint=Jt._nativePhysics.createFixedJoint(e.collider._nativeCollider)},o}(ts),Pr;(function(r){r[r.LimitEnabled=1]="LimitEnabled",r[r.DriveEnabled=2]="DriveEnabled",r[r.DriveFreeSpin=4]="DriveFreeSpin"})(Pr||(Pr={}));var Ay=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t._axis=new y(1,0,0),t._hingeFlags=0,t._useSpring=!1,t._jointMonitor=void 0,t._limits=void 0,t}var i=o.prototype;return i._onAwake=function(){var e=this._collider;e.localPosition=new y,e.collider=this.entity.getComponent(rn),this._nativeJoint=Jt._nativePhysics.createHingeJoint(e.collider._nativeCollider)},ie(o,[{key:"axis",get:function(){return this._axis},set:function(e){var n=this._axis;e!==n&&n.copyFrom(e),this._nativeJoint.setAxis(n)}},{key:"swingOffset",get:function(){return this._collider.localPosition},set:function(e){var n=this._collider.localPosition;e!==n&&n.copyFrom(e),this._nativeJoint.setSwingOffset(n)}},{key:"angle",get:function(){return this._nativeJoint.getAngle()}},{key:"velocity",get:function(){return this._nativeJoint.getVelocity()}},{key:"useLimits",get:function(){return(this._hingeFlags&Pr.LimitEnabled)==Pr.LimitEnabled},set:function(e){e!==this.useLimits&&(this._hingeFlags|=Pr.LimitEnabled),this._nativeJoint.setHingeJointFlag(Pr.LimitEnabled,e)}},{key:"useMotor",get:function(){return(this._hingeFlags&Pr.DriveEnabled)==Pr.DriveEnabled},set:function(e){e!==this.useMotor&&(this._hingeFlags|=Pr.DriveEnabled),this._nativeJoint.setHingeJointFlag(Pr.DriveEnabled,e)}},{key:"useSpring",get:function(){return this._useSpring},set:function(e){this._useSpring=e,this.limits=this._limits}},{key:"motor",get:function(){return this._jointMonitor},set:function(e){this._jointMonitor=e,this._nativeJoint.setDriveVelocity(e.targetVelocity),this._nativeJoint.setDriveForceLimit(e.forceLimit),this._nativeJoint.setDriveGearRatio(e.gearRation),this._nativeJoint.setHingeJointFlag(Pr.DriveFreeSpin,e.freeSpin)}},{key:"limits",get:function(){return this._limits},set:function(e){this._limits=e,this.useSpring?this._nativeJoint.setSoftLimit(e.min,e.max,e.stiffness,e.damping):this._nativeJoint.setHardLimit(e.min,e.max,e.contactDistance)}}]),o}(ts),Py=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t._minDistance=0,t._maxDistance=0,t._tolerance=.25,t._stiffness=0,t._damping=0,t}var i=o.prototype;return i._onAwake=function(){var e=this._collider;e.localPosition=new y,e.collider=this.entity.getComponent(rn),this._nativeJoint=Jt._nativePhysics.createSpringJoint(e.collider._nativeCollider)},ie(o,[{key:"swingOffset",get:function(){return this._collider.localPosition},set:function(e){var n=this._collider.localPosition;e!==n&&n.copyFrom(e),this._nativeJoint.setSwingOffset(e)}},{key:"minDistance",get:function(){return this._minDistance},set:function(e){this._minDistance=e,this._nativeJoint.setMinDistance(e)}},{key:"maxDistance",get:function(){return this._maxDistance},set:function(e){this._maxDistance=e,this._nativeJoint.setMaxDistance(e)}},{key:"tolerance",get:function(){return this._tolerance},set:function(e){this._tolerance=e,this._nativeJoint.setTolerance(e)}},{key:"stiffness",get:function(){return this._stiffness},set:function(e){this._stiffness=e,this._nativeJoint.setStiffness(e)}},{key:"damping",get:function(){return this._damping},set:function(e){this._damping=e,this._nativeJoint.setDamping(e)}}]),o}(ts),Ty=function(){this.max=0,this.min=0,this.contactDistance=-1,this.stiffness=0,this.damping=0},My=function(){this.targetVelocity=0,this.forceLimit=Number.MAX_VALUE,this.gearRation=1,this.freeSpin=!1},Eo;(function(r){r[r.Sides=1]="Sides",r[r.Up=2]="Up",r[r.Down=4]="Down"})(Eo||(Eo={}));var Dl=function(r){ne(o,r);function o(i){var t;t=r.call(this,i)||this;var e=t.entity.transform;return t._nativeCollider=Jt._nativePhysics.createStaticCollider(e.worldPosition,e.worldRotationQuaternion),t}return o}(rn),Ey=function(r){ne(o,r);function o(t){var e;e=r.call(this,t)||this,e._linearDamping=0,e._angularDamping=0,e._linearVelocity=new y,e._angularVelocity=new y,e._mass=0,e._centerOfMass=new y,e._inertiaTensor=new y,e._maxAngularVelocity=0,e._maxDepenetrationVelocity=0,e._sleepThreshold=0,e._solverIterations=0,e._isKinematic=!1,e._constraints=0,e._collisionDetectionMode=Ro.Discrete;var n=e.entity.transform;return e._nativeCollider=Jt._nativePhysics.createDynamicCollider(n.worldPosition,n.worldRotationQuaternion),e}var i=o.prototype;return i.applyForce=function(e){this._nativeCollider.addForce(e)},i.applyTorque=function(e){this._nativeCollider.addTorque(e)},i.move=function(e,n){this._nativeCollider.move(e,n)},i.sleep=function(){this._nativeCollider.sleep()},i.wakeUp=function(){this._nativeCollider.wakeUp()},i._onLateUpdate=function(){var e=this.entity.transform,n=e.worldPosition,a=e.worldRotationQuaternion;this._nativeCollider.getWorldTransform(n,a),this._updateFlag.flag=!1},ie(o,[{key:"linearDamping",get:function(){return this._linearDamping},set:function(e){this._linearDamping=e,this._nativeCollider.setLinearDamping(e)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(e){this._angularDamping=e,this._nativeCollider.setAngularDamping(e)}},{key:"linearVelocity",get:function(){return this._linearVelocity},set:function(e){this._linearVelocity!==e&&this._linearVelocity.copyFrom(e),this._nativeCollider.setLinearVelocity(this._linearVelocity)}},{key:"angularVelocity",get:function(){return this._angularVelocity},set:function(e){this._angularVelocity!==e&&this._angularVelocity.copyFrom(e),this._nativeCollider.setAngularVelocity(this._angularVelocity)}},{key:"mass",get:function(){return this._mass},set:function(e){this._mass=e,this._nativeCollider.setMass(e)}},{key:"centerOfMass",get:function(){return this._centerOfMass},set:function(e){this._centerOfMass!==e&&this._centerOfMass.copyFrom(e),this._nativeCollider.setCenterOfMass(this._centerOfMass)}},{key:"inertiaTensor",get:function(){return this._inertiaTensor},set:function(e){this._inertiaTensor!==e&&this._inertiaTensor.copyFrom(e),this._nativeCollider.setInertiaTensor(this._inertiaTensor)}},{key:"maxAngularVelocity",get:function(){return this._maxAngularVelocity},set:function(e){this._maxAngularVelocity=e,this._nativeCollider.setMaxAngularVelocity(e)}},{key:"maxDepenetrationVelocity",get:function(){return this._maxDepenetrationVelocity},set:function(e){this._maxDepenetrationVelocity=e,this._nativeCollider.setMaxDepenetrationVelocity(e)}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(e){this._sleepThreshold=e,this._nativeCollider.setSleepThreshold(e)}},{key:"solverIterations",get:function(){return this._solverIterations},set:function(e){this._solverIterations=e,this._nativeCollider.setSolverIterations(e)}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(e){this._isKinematic=e,this._nativeCollider.setIsKinematic(e)}},{key:"constraints",get:function(){return this._constraints},set:function(e){this._constraints=e,this._nativeCollider.setConstraints(e)}},{key:"collisionDetectionMode",get:function(){return this._collisionDetectionMode},set:function(e){this._collisionDetectionMode=e,this._nativeCollider.setCollisionDetectionMode(e)}}]),o}(rn),Ro;(function(r){r[r.Discrete=0]="Discrete",r[r.Continuous=1]="Continuous",r[r.ContinuousDynamic=2]="ContinuousDynamic",r[r.ContinuousSpeculative=3]="ContinuousSpeculative"})(Ro||(Ro={}));var Ks;(function(r){r[r.None=0]="None",r[r.FreezePositionX=1]="FreezePositionX",r[r.FreezePositionY=2]="FreezePositionY",r[r.FreezePositionZ=4]="FreezePositionZ",r[r.FreezeRotationX=8]="FreezeRotationX",r[r.FreezeRotationY=16]="FreezeRotationY",r[r.FreezeRotationZ=32]="FreezeRotationZ"})(Ks||(Ks={}));var Tr;(function(r){r[r.Down=0]="Down",r[r.Move=1]="Move",r[r.Up=2]="Up",r[r.Leave=3]="Leave"})(Tr||(Tr={}));var gi;(function(r){r[r.Primary=0]="Primary",r[r.Auxiliary=1]="Auxiliary",r[r.Secondary=2]="Secondary",r[r.XButton1=3]="XButton1",r[r.XButton2=4]="XButton2",r[r.XButton3=5]="XButton3",r[r.XButton4=6]="XButton4",r[r.XButton5=7]="XButton5",r[r.XButton6=8]="XButton6",r[r.XButton7=9]="XButton7",r[r.XButton8=10]="XButton8"})(gi||(gi={}));var pv=function(o){this.id=void 0,this.phase=Tr.Leave,this.position=new Z,this._uniqueID=void 0,this.id=o},Zi=function(){function r(i,t){this._pointers=[],this._movingDelta=new Z,this._multiPointerEnabled=!0,this._buttons=0,this._upMap=[],this._downMap=[],this._downList=new kt,this._upList=new kt,this._currentPosition=new Z,this._currentPressedEntity=void 0,this._currentEnteredEntity=void 0,this._engine=void 0,this._canvas=void 0,this._htmlCanvas=void 0,this._nativeEvents=[],this._pointerPool=void 0,this._keyEventList=[],this._keyEventCount=0,this._needOverallPointers=!1,this._hadListener=!1,this._lastPositionFrameCount=0,this._engine=i,this._canvas=i.canvas,this._htmlCanvas=t,t.oncontextmenu=function(n){return!1};var e=this._onPointerEvent=this._onPointerEvent.bind(this);t.addEventListener("pointerdown",e),t.addEventListener("pointerup",e),t.addEventListener("pointerout",e),t.addEventListener("pointermove",e),this._hadListener=!0,this._pointerPool=new Array(11)}var o=r.prototype;return o._update=function(t){if(this._needOverallPointers&&this._overallPointers(),this._downList.length=0,this._upList.length=0,this._movingDelta.set(0,0),this._nativeEvents.length>0&&this._handlePointerEvent(this._nativeEvents,t),this._pointers.length>0&&(this._lastPositionFrameCount=t),this._engine.physicsManager._initialized){var e=this._pointerRayCast(),n=this._keyEventCount;if(n>0){for(var a=this._keyEventList,s=0;s<n;s++)switch(a[s]){case En.Down:this._firePointerDown(e);break;case En.Up:this._firePointerUpAndClick(e);break}this._firePointerExitAndEnter(e),a[n-1]===En.Leave&&(this._currentPressedEntity=null),this._keyEventCount=0}else this._firePointerDrag(),this._firePointerExitAndEnter(e)}},o._onFocus=function(){if(!this._hadListener){var t=this._htmlCanvas,e=this._onPointerEvent;t.addEventListener("pointerdown",e),t.addEventListener("pointerup",e),t.addEventListener("pointerout",e),t.addEventListener("pointermove",e),this._hadListener=!0}},o._onBlur=function(){if(this._hadListener){var t=this._htmlCanvas,e=this._onPointerEvent;t.removeEventListener("pointerdown",e),t.removeEventListener("pointerup",e),t.removeEventListener("pointerout",e),t.removeEventListener("pointermove",e),this._nativeEvents.length=0,this._pointerPool.length=0,this._currentEnteredEntity=null,this._currentPressedEntity=null,this._downList.length=0,this._upList.length=0,this._hadListener=!1}},o._destroy=function(){if(this._hadListener){var t=this._htmlCanvas,e=this._onPointerEvent;t.removeEventListener("pointerdown",e),t.removeEventListener("pointerup",e),t.removeEventListener("pointerout",e),t.removeEventListener("pointermove",e),this._hadListener=!1}this._nativeEvents.length=0,this._pointerPool.length=0,this._pointers.length=0,this._currentPosition=null,this._currentEnteredEntity=null,this._currentPressedEntity=null,this._engine=null,this._canvas=null},o._onPointerEvent=function(t){t.cancelable&&t.preventDefault(),t.type==="pointerdown"&&this._htmlCanvas.focus(),this._nativeEvents.push(t)},o._overallPointers=function(){for(var t=this._pointers,e=0,n=t.length,a=0;a<n;a++)t[a].phase===Tr.Leave?e++:e>0&&(t[a-e]=t[a]);t.length=n-e,this._needOverallPointers=!1},o._getIndexByPointerID=function(t){for(var e=this._pointers,n=e.length-1;n>=0;n--)if(e[n]._uniqueID===t)return n;return-1},o._addPointer=function(t,e,n,a){var s=this._pointers,l=s.length;if(l===0||this._multiPointerEnabled){for(var c=this._pointerPool,u=0;u<l&&!(s[u].id>u);u++);var h=c[u];h||(h=c[u]=new pv(u)),h._uniqueID=t,h.position.set(e,n),h.phase=a,s.splice(u,0,h)}},o._removePointer=function(t){var e=this._pointers[t];e.phase=Tr.Leave},o._updatePointer=function(t,e,n,a){var s=this._pointers[t];s.position.set(e,n),s.phase=a},o._handlePointerEvent=function(t,e){for(var n=this._pointers,a=this._keyEventList,s=this._upMap,l=this._downMap,c=this._upList,u=this._downList,h=n.length,f=this._canvas.width/this._htmlCanvas.clientWidth,d=this._canvas.height/this._htmlCanvas.clientHeight,_=t.length,p=0;p<_;p++){var v=t[p],g=v.button|gi.Primary,m=this._getIndexByPointerID(v.pointerId);switch(v.type){case"pointerdown":m===-1?(this._addPointer(v.pointerId,v.offsetX*f,v.offsetY*d,Tr.Down),h++):this._updatePointer(m,v.offsetX*f,v.offsetY*d,Tr.Down),h===1&&(a[this._keyEventCount++]=En.Down),u.add(g),l[g]=e;break;case"pointerup":m>=0&&(this._updatePointer(m,v.offsetX*f,v.offsetY*d,Tr.Up),h===1&&(a[this._keyEventCount++]=En.Up)),c.add(g),s[g]=e;break;case"pointermove":m===-1?(this._addPointer(v.pointerId,v.offsetX*f,v.offsetY*d,Tr.Move),h++):this._updatePointer(m,v.offsetX*f,v.offsetY*d,Tr.Move);break;case"pointerout":m>=0&&(this._removePointer(m),--h===0&&(a[this._keyEventCount++]=En.Leave),this._needOverallPointers=!0);break}}this._buttons=t[_-1].buttons;var x=n.length;if(x>0){var w=this._currentPosition,C=w.x,T=w.y;if(h===0){var b=t[_-1];w.set(b.offsetX*f,b.offsetY*d)}else{w.set(0,0);for(var M=0;M<x;M++)w.add(n[M].position);w.scale(1/x)}this._lastPositionFrameCount===e-1&&this._movingDelta.set(w.x-C,w.y-T)}t.length=0},o._pointerRayCast=function(){if(this._pointers.length>0)for(var t=r._tempPoint,e=r._tempRay,n=r._tempHitResult,a=this._engine.sceneManager.activeScene._activeCameras,s=this._currentPosition.x/this._canvas.width,l=this._currentPosition.y/this._canvas.height,c=a.length-1;c>=0;c--){var u=a[c];if(!(!u.enabled||u.renderTarget)){var h=u.viewport,f=h.x,d=h.y,_=h.z,p=h.w;if(s>=f&&l>=d&&s-f<=_&&l-d<=p){if(t.set((s-f)/_,(l-d)/p),this._engine.physicsManager.raycast(u.viewportPointToRay(t,e),Number.MAX_VALUE,u.cullingMask,n))return n.entity;if(u.clearFlags&Dr.Color)return null}}}return null},o._firePointerDrag=function(){if(this._currentPressedEntity)for(var t=this._currentPressedEntity._scripts,e=t.length-1;e>=0;e--){var n=t.get(e);n._waitHandlingInValid||n.onPointerDrag()}},o._firePointerExitAndEnter=function(t){if(this._currentEnteredEntity!==t){if(this._currentEnteredEntity)for(var e=this._currentEnteredEntity._scripts,n=e.length-1;n>=0;n--){var a=e.get(n);a._waitHandlingInValid||a.onPointerExit()}if(t)for(var s=t._scripts,l=s.length-1;l>=0;l--){var c=s.get(l);c._waitHandlingInValid||c.onPointerEnter()}this._currentEnteredEntity=t}},o._firePointerDown=function(t){if(t)for(var e=t._scripts,n=e.length-1;n>=0;n--){var a=e.get(n);a._waitHandlingInValid||a.onPointerDown()}this._currentPressedEntity=t},o._firePointerUpAndClick=function(t){var e=this._currentPressedEntity;if(e){for(var n=e===t,a=e._scripts,s=a.length-1;s>=0;s--){var l=a.get(s);l._waitHandlingInValid||(n&&l.onPointerClick(),l.onPointerUp())}this._currentPressedEntity=null}},r}();Zi.Buttons=[1,4,2,8,16,32,64,128,256,512,1024];Zi._tempRay=new Rl;Zi._tempPoint=new Z;Zi._tempHitResult=new Bl;var En;(function(r){r[r.Down=0]="Down",r[r.Up=1]="Up",r[r.Leave=2]="Leave"})(En||(En={}));var Ry=function(){function r(i){this._delta=new y,this._nativeEvents=[],this._canvas=void 0,this._hadListener=void 0,this._onWheelEvent=this._onWheelEvent.bind(this),i.addEventListener("wheel",this._onWheelEvent),this._canvas=i,this._hadListener=!0}var o=r.prototype;return o._update=function(){var t=this._delta;t.set(0,0,0);var e=this._nativeEvents;if(e.length>0){for(var n=e.length-1;n>=0;n--){var a=e[n];t.x+=a.deltaX,t.y+=a.deltaY,t.z+=a.deltaZ}e.length=0}},o._onFocus=function(){this._hadListener||(this._canvas.addEventListener("wheel",this._onWheelEvent),this._hadListener=!0)},o._onBlur=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._nativeEvents.length=0,this._delta.set(0,0,0),this._hadListener=!1)},o._destroy=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._hadListener=!1),this._nativeEvents=null},o._onWheelEvent=function(t){t.cancelable&&t.preventDefault(),this._nativeEvents.push(t)},r}(),gv=function(){var r=o.prototype;r.isKeyHeldDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameHeldDownList.length>0:this._keyboardManager._curHeldDownKeyToIndexMap[t]!=null:!1},r.isKeyDown=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameDownList.length>0:this._keyboardManager._downKeyToFrameCountMap[t]===this._curFrameCount:!1},r.isKeyUp=function(t){return this._initialized?t===void 0?this._keyboardManager._curFrameUpList.length>0:this._keyboardManager._upKeyToFrameCountMap[t]===this._curFrameCount:!1},r.isPointerHeldDown=function(t){return this._initialized?t===void 0?this._pointerManager._buttons!==0:(this._pointerManager._buttons&Zi.Buttons[t])!==0:!1},r.isPointerDown=function(t){return this._initialized?t===void 0?this._pointerManager._downList.length>0:this._pointerManager._downMap[t]===this._curFrameCount:!1},r.isPointerUp=function(t){return this._initialized?t===void 0?this._pointerManager._upList.length>0:this._pointerManager._upMap[t]===this._curFrameCount:!1};function o(i){this._initialized=!1,this._curFrameCount=0,this._wheelManager=void 0,this._pointerManager=void 0,this._keyboardManager=void 0;var t=i._canvas._webCanvas;(typeof OffscreenCanvas>"u"||!(t instanceof OffscreenCanvas))&&(this._wheelManager=new Ry(t),this._pointerManager=new Zi(i,t),this._keyboardManager=new by(t),this._onBlur=this._onBlur.bind(this),window.addEventListener("blur",this._onBlur),this._onFocus=this._onFocus.bind(this),window.addEventListener("focus",this._onFocus),this._initialized=!0)}return r._update=function(){this._initialized&&(++this._curFrameCount,this._wheelManager._update(),this._pointerManager._update(this._curFrameCount),this._keyboardManager._update(this._curFrameCount))},r._destroy=function(){this._initialized&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._wheelManager._destroy(),this._pointerManager._destroy(),this._keyboardManager._destroy())},r._onBlur=function(){this._wheelManager._onBlur(),this._pointerManager._onBlur(),this._keyboardManager._onBlur()},r._onFocus=function(){this._wheelManager._onFocus(),this._pointerManager._onFocus(),this._keyboardManager._onFocus()},ie(o,[{key:"pointers",get:function(){return this._initialized?this._pointerManager._pointers:null}},{key:"multiPointerEnabled",get:function(){return this._initialized?this._pointerManager._multiPointerEnabled:!1},set:function(t){this._initialized&&(this._pointerManager._multiPointerEnabled=t)}},{key:"wheelDelta",get:function(){return this._initialized?this._wheelManager._delta:null}},{key:"pointerMovingDelta",get:function(){return this._initialized?this._pointerManager._movingDelta:null}},{key:"pointerPosition",get:function(){return this._initialized&&this._pointerManager._pointers.length>0?this._pointerManager._currentPosition:null}}]),o}(),xt;(function(r){r[r.Opaque=0]="Opaque",r[r.AlphaTest=1]="AlphaTest",r[r.Transparent=2]="Transparent"})(xt||(xt={}));var gn=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,e.isGCIgnored=!1,e._refCount=0,t.resourceManager._addRefObject(e.instanceId,N(e)),e}var i=o.prototype;return i.destroy=function(e){if(e===void 0&&(e=!1),this._destroyed)return!0;if(!e&&this._refCount!==0)return!1;var n=this._engine.resourceManager;n&&(r.prototype.destroy.call(this),n._deleteRefObject(this.instanceId));var a=this._getRefCount();return a>0&&this._addRefCount(-a),this._engine=null,this._onDestroy(),!0},i._getRefCount=function(){return this._refCount},i._addRefCount=function(e){this._refCount+=e},i._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},ie(o,[{key:"refCount",get:function(){return this._refCount}}]),o}(pn),Fr;(function(r){r[r.Scene=0]="Scene",r[r.Camera=1]="Camera",r[r.Renderer=2]="Renderer",r[r.Material=3]="Material"})(Fr||(Fr={}));var Kr=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.name=void 0,t._platformTexture=void 0,t._mipmap=void 0,t._format=void 0,t._width=void 0,t._height=void 0,t._mipmapCount=void 0,t._wrapModeU=void 0,t._wrapModeV=void 0,t._filterMode=void 0,t._anisoLevel=1,t}var i=o.prototype;return i.generateMipmaps=function(){!this._mipmap||this._platformTexture.generateMipmaps()},i._onDestroy=function(){this._platformTexture.destroy(),this._platformTexture=null},i._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},i._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},ie(o,[{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){e!==this._wrapModeU&&(this._wrapModeU=e,this._platformTexture.wrapModeU=e)}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){e!==this._wrapModeV&&(this._wrapModeV=e,this._platformTexture.wrapModeV=e)}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,this._platformTexture.filterMode=e)}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var n=this._engine._hardwareRenderer.capability.maxAnisoLevel;e>n&&(Fe.warn("anisoLevel:"+e+", exceeds the limit and is automatically downgraded to:"+n),e=n),e<1&&(Fe.warn("anisoLevel:"+e+", must be greater than 0, and is automatically downgraded to 1"),e=1),e!==this._anisoLevel&&(this._anisoLevel=e,this._platformTexture.anisoLevel=e)}}]),o}(gn),Ut;(function(r){r[r.Float=0]="Float",r[r.Int=1]="Int",r[r.Vector2=2]="Vector2",r[r.Vector3=3]="Vector3",r[r.Vector4=4]="Vector4",r[r.Matrix=5]="Matrix",r[r.Color=6]="Color",r[r.Texture=7]="Texture",r[r.FloatArray=8]="FloatArray",r[r.IntArray=9]="IntArray",r[r.TextureArray=10]="TextureArray"})(Ut||(Ut={}));var Fy=`#define GLSLIFY 1
#define PI 3.14159265359
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define LOG2 1.442695
#define saturate( a ) clamp( a, 0.0, 1.0 )
#define whiteCompliment(a) ( 1.0 - saturate( a ) )
float pow2(float x){return x*x;}vec4 RGBMToLinear(vec4 value,float maxRange){return vec4(value.rgb*value.a*maxRange,1.0);}vec4 gammaToLinear(vec4 srgbIn){return vec4(pow(srgbIn.rgb,vec3(2.2)),srgbIn.a);}vec4 linearToGamma(vec4 linearIn){return vec4(pow(linearIn.rgb,vec3(1.0/2.2)),linearIn.a);}`,By=`#define GLSLIFY 1
attribute vec3 POSITION;
#ifdef O3_HAS_UV
attribute vec2 TEXCOORD_0;
#endif
#ifdef O3_HAS_UV1
attribute vec2 TEXCOORD_1;
#endif
#ifdef O3_HAS_SKIN
attribute vec4 JOINTS_0;attribute vec4 WEIGHTS_0;
#ifdef O3_USE_JOINT_TEXTURE
uniform sampler2D u_jointSampler;uniform float u_jointCount;mat4 getJointMatrix(sampler2D smp,float index){float base=index/u_jointCount;float hf=0.5/u_jointCount;float v=base+hf;vec4 m0=texture2D(smp,vec2(0.125,v));vec4 m1=texture2D(smp,vec2(0.375,v));vec4 m2=texture2D(smp,vec2(0.625,v));vec4 m3=texture2D(smp,vec2(0.875,v));return mat4(m0,m1,m2,m3);}
#else
uniform mat4 u_jointMatrix[O3_JOINTS_NUM];
#endif
#endif
#ifdef O3_HAS_VERTEXCOLOR
attribute vec4 COLOR_0;
#endif
uniform mat4 u_localMat;uniform mat4 u_modelMat;uniform mat4 u_viewMat;uniform mat4 u_projMat;uniform mat4 u_MVMat;uniform mat4 u_MVPMat;uniform mat4 u_normalMat;uniform vec3 u_cameraPos;uniform vec4 u_tilingOffset;
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
attribute vec3 NORMAL;
#endif
#ifdef O3_HAS_TANGENT
attribute vec4 TANGENT;
#endif
#endif
`,Iy=`#define GLSLIFY 1
uniform mat4 u_localMat;uniform mat4 u_modelMat;uniform mat4 u_viewMat;uniform mat4 u_projMat;uniform mat4 u_MVMat;uniform mat4 u_MVPMat;uniform mat4 u_normalMat;uniform vec3 u_cameraPos;`,zy=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
varying vec4 v_color;
#endif
`,Dy=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
varying vec3 v_normal;
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
varying mat3 v_TBN;
#endif
#endif
#endif
`,Ly=`#define GLSLIFY 1
varying vec2 v_uv;
#ifdef O3_HAS_UV1
varying vec2 v_uv1;
#endif
`,Oy=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
varying vec3 v_pos;
#endif
`,Ny=`#define GLSLIFY 1
#ifdef O3_GENERATE_SHADOW_MAP
uniform mat4 u_viewMatFromLight;uniform mat4 u_projMatFromLight;
#endif
#ifdef O3_SHADOW_MAP_COUNT
uniform mat4 u_viewMatFromLight[O3_SHADOW_MAP_COUNT];uniform mat4 u_projMatFromLight[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];
#endif
`,Uy=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
varying vec3 v_fogDepth;uniform vec3 u_fogColor;
#ifdef O3_FOG_EXP2
uniform float u_fogDensity;
#else
uniform float u_fogNear;uniform float u_fogFar;
#endif
#endif
`,Vy=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
vec3 normal=vec3(NORMAL);
#endif
#ifdef O3_HAS_TANGENT
vec4 tangent=vec4(TANGENT);
#endif
#endif
`,ky=`#define GLSLIFY 1
vec4 position=vec4(POSITION,1.0);`,Gy=`#define GLSLIFY 1
#ifndef O3_GENERATE_SHADOW_MAP
gl_Position=u_MVPMat*position;
#endif
`,Hy=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
v_color=COLOR_0;
#endif
`,Wy=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
v_normal=normalize(mat3(u_normalMat)*normal);
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
vec3 normalW=normalize(mat3(u_normalMat)*normal.xyz);vec3 tangentW=normalize(mat3(u_normalMat)*tangent.xyz);vec3 bitangentW=cross(normalW,tangentW)*tangent.w;v_TBN=mat3(tangentW,bitangentW,normalW);
#endif
#endif
#endif
`,Xy=`#define GLSLIFY 1
#ifdef O3_HAS_SKIN
#ifdef O3_USE_JOINT_TEXTURE
mat4 skinMatrix=WEIGHTS_0.x*getJointMatrix(u_jointSampler,JOINTS_0.x)+WEIGHTS_0.y*getJointMatrix(u_jointSampler,JOINTS_0.y)+WEIGHTS_0.z*getJointMatrix(u_jointSampler,JOINTS_0.z)+WEIGHTS_0.w*getJointMatrix(u_jointSampler,JOINTS_0.w);
#else
mat4 skinMatrix=WEIGHTS_0.x*u_jointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*u_jointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*u_jointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*u_jointMatrix[int(JOINTS_0.w)];
#endif
position=skinMatrix*position;
#if defined(O3_HAS_NORMAL) && !defined(OMIT_NORMAL)
normal=vec4(skinMatrix*vec4(normal,0.0)).xyz;
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
tangent.xyz=vec4(skinMatrix*vec4(tangent.xyz,0.0)).xyz;
#endif
#endif
#endif
`,jy=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifdef OASIS_BLENDSHAPE_TEXTURE
uniform mediump sampler2DArray u_blendShapeTexture;uniform ivec3 u_blendShapeTextureInfo;uniform float u_blendShapeWeights[OASIS_BLENDSHAPE_COUNT];
#else
attribute vec3 POSITION_BS0;attribute vec3 POSITION_BS1;attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;
#if defined( OASIS_BLENDSHAPE_NORMAL ) || defined( OASIS_BLENDSHAPE_TANGENT )
#ifdef OASIS_BLENDSHAPE_NORMAL
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 NORMAL_BS2;attribute vec3 NORMAL_BS3;
#endif
#ifdef OASIS_BLENDSHAPE_TANGENT
attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;attribute vec3 TANGENT_BS2;attribute vec3 TANGENT_BS3;
#endif
uniform float u_blendShapeWeights[4];
#else
attribute vec3 POSITION_BS4;attribute vec3 POSITION_BS5;attribute vec3 POSITION_BS6;attribute vec3 POSITION_BS7;uniform float u_blendShapeWeights[8];
#endif
#endif
#ifdef OASIS_BLENDSHAPE_TEXTURE
vec3 getBlendShapeVertexElement(int blendShapeIndex,int vertexElementIndex){int y=vertexElementIndex/u_blendShapeTextureInfo.y;int x=vertexElementIndex-y*u_blendShapeTextureInfo.y;ivec3 uv=ivec3(x,y,blendShapeIndex);return texelFetch(u_blendShapeTexture,uv,0).xyz;}
#endif
#endif
`,$y=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifdef OASIS_BLENDSHAPE_TEXTURE
int vertexOffset=gl_VertexID*u_blendShapeTextureInfo.x;for(int i=0;i<OASIS_BLENDSHAPE_COUNT;i++){int vertexElementOffset=vertexOffset;float weight=u_blendShapeWeights[i];position.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#ifndef OMIT_NORMAL
#if defined( O3_HAS_NORMAL ) && defined( OASIS_BLENDSHAPE_NORMAL )
vertexElementOffset+=1;normal+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#if defined( O3_HAS_TANGENT ) && defined(OASIS_BLENDSHAPE_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
vertexElementOffset+=1;tangent.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#endif
}
#else
position.xyz+=POSITION_BS0*u_blendShapeWeights[0];position.xyz+=POSITION_BS1*u_blendShapeWeights[1];position.xyz+=POSITION_BS2*u_blendShapeWeights[2];position.xyz+=POSITION_BS3*u_blendShapeWeights[3];
#if defined( OASIS_BLENDSHAPE_NORMAL ) || defined( OASIS_BLENDSHAPE_TANGENT )
#ifndef OMIT_NORMAL
#if defined( O3_HAS_NORMAL ) && defined( OASIS_BLENDSHAPE_NORMAL )
normal+=NORMAL_BS0*u_blendShapeWeights[0];normal+=NORMAL_BS1*u_blendShapeWeights[1];normal+=NORMAL_BS2*u_blendShapeWeights[2];normal+=NORMAL_BS3*u_blendShapeWeights[3];
#endif
#if defined( O3_HAS_TANGENT ) && defined(OASIS_BLENDSHAPE_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
tangent.xyz+=TANGENT_BS0*u_blendShapeWeights[0];tangent.xyz+=TANGENT_BS1*u_blendShapeWeights[1];tangent.xyz+=TANGENT_BS2*u_blendShapeWeights[2];tangent.xyz+=TANGENT_BS3*u_blendShapeWeights[3];
#endif
#endif
#else
position.xyz+=POSITION_BS4*u_blendShapeWeights[4];position.xyz+=POSITION_BS5*u_blendShapeWeights[5];position.xyz+=POSITION_BS6*u_blendShapeWeights[6];position.xyz+=POSITION_BS7*u_blendShapeWeights[7];
#endif
#endif
#endif
`,qy=`#define GLSLIFY 1
#ifdef O3_HAS_UV
v_uv=TEXCOORD_0;
#else
v_uv=vec2(0.,0.);
#endif
#ifdef O3_HAS_UV1
v_uv1=TEXCOORD_1;
#endif
#ifdef O3_NEED_TILINGOFFSET
v_uv=v_uv*u_tilingOffset.xy+u_tilingOffset.zw;
#endif
`,Yy=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec4 temp_pos=u_modelMat*position;v_pos=temp_pos.xyz/temp_pos.w;
#endif
`,Qy=`#define GLSLIFY 1
#ifdef O3_GENERATE_SHADOW_MAP
gl_Position=u_projMatFromLight*u_viewMatFromLight*u_modelMat*position;
#endif
#ifdef O3_SHADOW_MAP_COUNT
for(int i=0;i<O3_SHADOW_MAP_COUNT;i++){v_PositionFromLight[i]=u_projMatFromLight[i]*u_viewMatFromLight[i]*u_modelMat*vec4(POSITION,1.0);}
#endif
`,Jy=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
v_fogDepth=(u_MVMat*position).xyz;
#endif
`,Ky=`#define GLSLIFY 1
#ifdef O3_DIRECT_LIGHT_COUNT
struct DirectLight{vec3 color;vec3 direction;};uniform vec3 u_directLightColor[O3_DIRECT_LIGHT_COUNT];uniform vec3 u_directLightDirection[O3_DIRECT_LIGHT_COUNT];
#endif
#ifdef O3_POINT_LIGHT_COUNT
struct PointLight{vec3 color;vec3 position;float distance;};uniform vec3 u_pointLightColor[O3_POINT_LIGHT_COUNT];uniform vec3 u_pointLightPosition[O3_POINT_LIGHT_COUNT];uniform float u_pointLightDistance[O3_POINT_LIGHT_COUNT];
#endif
#ifdef O3_SPOT_LIGHT_COUNT
struct SpotLight{vec3 color;vec3 position;vec3 direction;float distance;float angleCos;float penumbraCos;};uniform vec3 u_spotLightColor[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightPosition[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightDirection[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightDistance[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightAngleCos[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightPenumbraCos[O3_SPOT_LIGHT_COUNT];
#endif
struct EnvMapLight{vec3 diffuse;float mipMapLevel;float diffuseIntensity;float specularIntensity;};uniform EnvMapLight u_envMapLight;
#ifdef O3_USE_SH
uniform vec3 u_env_sh[9];
#endif
#ifdef O3_USE_SPECULAR_ENV
uniform samplerCube u_env_specularSampler;
#endif
`,Zy=`#define GLSLIFY 1
uniform vec4 u_emissiveColor;uniform vec4 u_baseColor;uniform vec4 u_specularColor;uniform float u_shininess;uniform float u_normalIntensity;uniform float u_alphaCutoff;
#ifdef EMISSIVETEXTURE
uniform sampler2D u_emissiveTexture;
#endif
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
#ifdef O3_SPECULAR_TEXTURE
uniform sampler2D u_specularTexture;
#endif
#ifdef NORMALTEXTURE
uniform sampler2D u_normalTexture;
#endif
`,e1=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
float fogDepth=length(v_fogDepth);
#ifdef O3_FOG_EXP2
float fogFactor=whiteCompliment(exp2(-u_fogDensity*u_fogDensity*fogDepth*fogDepth*LOG2));
#else
float fogFactor=smoothstep(u_fogNear,u_fogFar,fogDepth);
#endif
gl_FragColor.rgb=mix(gl_FragColor.rgb,u_fogColor,fogFactor);
#endif
`,t1=`#define GLSLIFY 1
vec4 ambient=vec4(0.0);vec4 emission=u_emissiveColor;vec4 diffuse=u_baseColor;vec4 specular=u_specularColor;
#ifdef EMISSIVETEXTURE
vec4 emissiveTextureColor=texture2D(u_emissiveTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
emissiveTextureColor=gammaToLinear(emissiveTextureColor);
#endif
emission*=emissiveTextureColor;
#endif
#ifdef BASETEXTURE
vec4 diffuseTextureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
diffuseTextureColor=gammaToLinear(diffuseTextureColor);
#endif
diffuse*=diffuseTextureColor;
#endif
#ifdef O3_HAS_VERTEXCOLOR
diffuse*=v_color;
#endif
#ifdef O3_SPECULAR_TEXTURE
vec4 specularTextureColor=texture2D(u_specularTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
specularTextureColor=gammaToLinear(specularTextureColor);
#endif
specular*=specularTextureColor;
#endif
ambient=vec4(u_envMapLight.diffuse*u_envMapLight.diffuseIntensity,1.0)*diffuse;`,r1=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec3 V=normalize(u_cameraPos-v_pos);
#endif
`,n1=`#define GLSLIFY 1
#ifdef NORMALTEXTURE
mat3 tbn=getTBN();vec3 N=getNormalByNormalTexture(tbn,u_normalTexture,u_normalIntensity,v_uv);
#else
vec3 N=getNormal();
#endif
vec3 lightDiffuse=vec3(0.0,0.0,0.0);vec3 lightSpecular=vec3(0.0,0.0,0.0);
#ifdef O3_DIRECT_LIGHT_COUNT
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];float d=max(dot(N,-directionalLight.direction),0.0);lightDiffuse+=directionalLight.color*d;vec3 halfDir=normalize(V-directionalLight.direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess);lightSpecular+=directionalLight.color*s;}
#endif
#ifdef O3_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];vec3 direction=v_pos-pointLight.position;float dist=length(direction);direction/=dist;float decay=clamp(1.0-pow(dist/pointLight.distance,4.0),0.0,1.0);float d=max(dot(N,-direction),0.0)*decay;lightDiffuse+=pointLight.color*d;vec3 halfDir=normalize(V-direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decay;lightSpecular+=pointLight.color*s;}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];vec3 direction=spotLight.position-v_pos;float lightDistance=length(direction);direction/=lightDistance;float angleCos=dot(direction,-spotLight.direction);float decay=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayTotal=decay*spotEffect;float d=max(dot(N,direction),0.0)*decayTotal;lightDiffuse+=spotLight.color*d;vec3 halfDir=normalize(V+direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decayTotal;lightSpecular+=spotLight.color*s;}
#endif
diffuse*=vec4(lightDiffuse,1.0);specular*=vec4(lightSpecular,1.0);
#ifdef ALPHA_CUTOFF
if(diffuse.a<u_alphaCutoff){discard;}
#endif
`,i1=`#define GLSLIFY 1
vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod7(vec4 x){return x-floor(x*(1.0/7.0))*7.0;}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 permute(vec4 x){return mod289((34.0*x+1.0)*x);}vec3 permute(vec3 x){return mod289((34.0*x+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float taylorInvSqrt(float r){return 1.79284291400159-0.85373472095314*r;}vec4 fade(vec4 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}
#define K 0.142857142857
#define Ko 0.428571428571
#define K2 0.020408163265306
#define Kd2 0.0714285714285
#define Kz 0.166666666667
#define Kzo 0.416666666667
#define jitter 1.0
#define jitter1 0.8
`,a1=`#define GLSLIFY 1
vec2 cellular(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec3 oi=vec3(-1.0,0.0,1.0);vec3 of=vec3(-0.5,0.5,1.5);vec3 px=permute(Pi.x+oi);vec3 p=permute(px.x+Pi.y+oi);vec3 ox=fract(p*K)-Ko;vec3 oy=mod7(floor(p*K))*K-Ko;vec3 dx=Pf.x+0.5+jitter*ox;vec3 dy=Pf.y-of+jitter*oy;vec3 d1=dx*dx+dy*dy;p=permute(px.y+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-0.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d2=dx*dx+dy*dy;p=permute(px.z+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-1.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d3=dx*dx+dy*dy;vec3 d1a=min(d1,d2);d2=max(d1,d2);d2=min(d2,d3);d1=min(d1a,d2);d2=max(d1a,d2);d1.xy=(d1.x<d1.y)? d1.xy : d1.yx;d1.xz=(d1.x<d1.z)? d1.xz : d1.zx;d1.yz=min(d1.yz,d2.yz);d1.y=min(d1.y,d1.z);d1.y=min(d1.y,d2.x);return sqrt(d1.xy);}`,o1=`#define GLSLIFY 1
vec2 cellular2x2(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec4 Pfx=Pf.x+vec4(-0.5,-1.5,-0.5,-1.5);vec4 Pfy=Pf.y+vec4(-0.5,-0.5,-1.5,-1.5);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 ox=mod7(p)*K+Kd2;vec4 oy=mod7(floor(p*K))*K+Kd2;vec4 dx=Pfx+jitter1*ox;vec4 dy=Pfy+jitter1*oy;vec4 d=dx*dx+dy*dy;d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.y=min(d.y,d.z);d.y=min(d.y,d.w);return sqrt(d.xy);}`,s1=`#define GLSLIFY 1
vec2 cellular2x2x2(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P);vec4 Pfx=Pf.x+vec4(0.0,-1.0,0.0,-1.0);vec4 Pfy=Pf.y+vec4(0.0,0.0,-1.0,-1.0);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 p1=permute(p+Pi.z);vec4 p2=permute(p+Pi.z+vec4(1.0));vec4 ox1=fract(p1*K)-Ko;vec4 oy1=mod7(floor(p1*K))*K-Ko;vec4 oz1=floor(p1*K2)*Kz-Kzo;vec4 ox2=fract(p2*K)-Ko;vec4 oy2=mod7(floor(p2*K))*K-Ko;vec4 oz2=floor(p2*K2)*Kz-Kzo;vec4 dx1=Pfx+jitter1*ox1;vec4 dy1=Pfy+jitter1*oy1;vec4 dz1=Pf.z+jitter1*oz1;vec4 dx2=Pfx+jitter1*ox2;vec4 dy2=Pfy+jitter1*oy2;vec4 dz2=Pf.z-1.0+jitter1*oz2;vec4 d1=dx1*dx1+dy1*dy1+dz1*dz1;vec4 d2=dx2*dx2+dy2*dy2+dz2*dz2;vec4 d=min(d1,d2);d2=max(d1,d2);d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.yzw=min(d.yzw,d2.yzw);d.y=min(d.y,d.z);d.y=min(d.y,d.w);d.y=min(d.y,d2.x);return sqrt(d.xy);}`,l1=`#define GLSLIFY 1
vec2 cellular(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P)-0.5;vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);vec3 p=permute(Pi.x+vec3(-1.0,0.0,1.0));vec3 p1=permute(p+Pi.y-1.0);vec3 p2=permute(p+Pi.y);vec3 p3=permute(p+Pi.y+1.0);vec3 p11=permute(p1+Pi.z-1.0);vec3 p12=permute(p1+Pi.z);vec3 p13=permute(p1+Pi.z+1.0);vec3 p21=permute(p2+Pi.z-1.0);vec3 p22=permute(p2+Pi.z);vec3 p23=permute(p2+Pi.z+1.0);vec3 p31=permute(p3+Pi.z-1.0);vec3 p32=permute(p3+Pi.z);vec3 p33=permute(p3+Pi.z+1.0);vec3 ox11=fract(p11*K)-Ko;vec3 oy11=mod7(floor(p11*K))*K-Ko;vec3 oz11=floor(p11*K2)*Kz-Kzo;vec3 ox12=fract(p12*K)-Ko;vec3 oy12=mod7(floor(p12*K))*K-Ko;vec3 oz12=floor(p12*K2)*Kz-Kzo;vec3 ox13=fract(p13*K)-Ko;vec3 oy13=mod7(floor(p13*K))*K-Ko;vec3 oz13=floor(p13*K2)*Kz-Kzo;vec3 ox21=fract(p21*K)-Ko;vec3 oy21=mod7(floor(p21*K))*K-Ko;vec3 oz21=floor(p21*K2)*Kz-Kzo;vec3 ox22=fract(p22*K)-Ko;vec3 oy22=mod7(floor(p22*K))*K-Ko;vec3 oz22=floor(p22*K2)*Kz-Kzo;vec3 ox23=fract(p23*K)-Ko;vec3 oy23=mod7(floor(p23*K))*K-Ko;vec3 oz23=floor(p23*K2)*Kz-Kzo;vec3 ox31=fract(p31*K)-Ko;vec3 oy31=mod7(floor(p31*K))*K-Ko;vec3 oz31=floor(p31*K2)*Kz-Kzo;vec3 ox32=fract(p32*K)-Ko;vec3 oy32=mod7(floor(p32*K))*K-Ko;vec3 oz32=floor(p32*K2)*Kz-Kzo;vec3 ox33=fract(p33*K)-Ko;vec3 oy33=mod7(floor(p33*K))*K-Ko;vec3 oz33=floor(p33*K2)*Kz-Kzo;vec3 dx11=Pfx+jitter*ox11;vec3 dy11=Pfy.x+jitter*oy11;vec3 dz11=Pfz.x+jitter*oz11;vec3 dx12=Pfx+jitter*ox12;vec3 dy12=Pfy.x+jitter*oy12;vec3 dz12=Pfz.y+jitter*oz12;vec3 dx13=Pfx+jitter*ox13;vec3 dy13=Pfy.x+jitter*oy13;vec3 dz13=Pfz.z+jitter*oz13;vec3 dx21=Pfx+jitter*ox21;vec3 dy21=Pfy.y+jitter*oy21;vec3 dz21=Pfz.x+jitter*oz21;vec3 dx22=Pfx+jitter*ox22;vec3 dy22=Pfy.y+jitter*oy22;vec3 dz22=Pfz.y+jitter*oz22;vec3 dx23=Pfx+jitter*ox23;vec3 dy23=Pfy.y+jitter*oy23;vec3 dz23=Pfz.z+jitter*oz23;vec3 dx31=Pfx+jitter*ox31;vec3 dy31=Pfy.z+jitter*oy31;vec3 dz31=Pfz.x+jitter*oz31;vec3 dx32=Pfx+jitter*ox32;vec3 dy32=Pfy.z+jitter*oy32;vec3 dz32=Pfz.y+jitter*oz32;vec3 dx33=Pfx+jitter*ox33;vec3 dy33=Pfy.z+jitter*oy33;vec3 dz33=Pfz.z+jitter*oz33;vec3 d11=dx11*dx11+dy11*dy11+dz11*dz11;vec3 d12=dx12*dx12+dy12*dy12+dz12*dz12;vec3 d13=dx13*dx13+dy13*dy13+dz13*dz13;vec3 d21=dx21*dx21+dy21*dy21+dz21*dz21;vec3 d22=dx22*dx22+dy22*dy22+dz22*dz22;vec3 d23=dx23*dx23+dy23*dy23+dz23*dz23;vec3 d31=dx31*dx31+dy31*dy31+dz31*dz31;vec3 d32=dx32*dx32+dy32*dy32+dz32*dz32;vec3 d33=dx33*dx33+dy33*dy33+dz33*dz33;vec3 d1a=min(d11,d12);d12=max(d11,d12);d11=min(d1a,d13);d13=max(d1a,d13);d12=min(d12,d13);vec3 d2a=min(d21,d22);d22=max(d21,d22);d21=min(d2a,d23);d23=max(d2a,d23);d22=min(d22,d23);vec3 d3a=min(d31,d32);d32=max(d31,d32);d31=min(d3a,d33);d33=max(d3a,d33);d32=min(d32,d33);vec3 da=min(d11,d21);d21=max(d11,d21);d11=min(da,d31);d31=max(da,d31);d11.xy=(d11.x<d11.y)? d11.xy : d11.yx;d11.xz=(d11.x<d11.z)? d11.xz : d11.zx;d12=min(d12,d21);d12=min(d12,d22);d12=min(d12,d31);d12=min(d12,d32);d11.yz=min(d11.yz,d12.xy);d11.y=min(d11.y,d12.z);d11.y=min(d11.y,d11.z);return sqrt(d11.xy);}`,c1=`#define GLSLIFY 1
#include <noise_cellular_2D>
#include <noise_cellular_3D>
#include <noise_cellular_2x2>
#include <noise_cellular_2x2x2>
`,u1=`#define GLSLIFY 1
float perlin(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}float perlin(vec2 P,vec2 rep){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod(Pi,rep.xyxy);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}`,h1=`#define GLSLIFY 1
float perlin(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}float perlin(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep);vec3 Pi1=mod(Pi0+vec3(1.0),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}`,f1=`#define GLSLIFY 1
float perlin(vec4 P){vec4 Pi0=floor(P);vec4 Pi1=Pi0+1.0;Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}float perlin(vec4 P,vec4 rep){vec4 Pi0=mod(floor(P),rep);vec4 Pi1=mod(Pi0+1.0,rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}`,d1=`#define GLSLIFY 1
#include <noise_perlin_2D>
#include <noise_perlin_3D>
#include <noise_perlin_4D>
`,_1=`#define GLSLIFY 1
vec2 rgrad2(vec2 p,float rot){float u=permute(permute(p.x)+p.y)*0.0243902439+rot;u=fract(u)*6.28318530718;return vec2(cos(u),sin(u));}vec3 psrdnoise(vec2 pos,vec2 per,float rot){pos.y+=0.01;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 psdnoise(vec2 pos,vec2 per){return psrdnoise(pos,per,0.0);}float psrnoise(vec2 pos,vec2 per,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float psnoise(vec2 pos,vec2 per){return psrnoise(pos,per,0.0);}vec3 srdnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 sdnoise(vec2 pos){return srdnoise(pos,0.0);}float srnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float snoise(vec2 pos){return srnoise(pos,0.0);}`,v1=`#define GLSLIFY 1
float simplex(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}`,p1=`#define GLSLIFY 1
float simplex(vec3 v,out vec3 gradient){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);vec4 m2=m*m;vec4 m4=m2*m2;vec4 pdotx=vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3));vec4 temp=m2*m*pdotx;gradient=-8.0*(temp.x*x0+temp.y*x1+temp.z*x2+temp.w*x3);gradient+=m4.x*p0+m4.y*p1+m4.z*p2+m4.w*p3;gradient*=42.0;return 42.0*dot(m4,pdotx);}`,g1=`#define GLSLIFY 1
float simplex(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`,m1=`#define GLSLIFY 1
vec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}
#define F4 0.309016994374947451
float simplex(vec4 v){const vec4 C=vec4(0.138196601125011,0.276393202250021,0.414589803375032,-0.447213595499958);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}`,y1=`#define GLSLIFY 1
#include <noise_simplex_2D>
#include <noise_simplex_3D>
#include <noise_simplex_3D_grad>
#include <noise_simplex_4D>
`,x1=`#define GLSLIFY 1
uniform float u_alphaCutoff;uniform vec4 u_baseColor;uniform float u_metal;uniform float u_roughness;uniform vec3 u_PBRSpecularColor;uniform float u_glossiness;uniform vec3 u_emissiveColor;
#ifdef CLEARCOAT
uniform float u_clearCoat;uniform float u_clearCoatRoughness;
#endif
uniform float u_normalIntensity;uniform float u_occlusionIntensity;uniform float u_occlusionTextureCoord;
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
#ifdef NORMALTEXTURE
uniform sampler2D u_normalTexture;
#endif
#ifdef EMISSIVETEXTURE
uniform sampler2D u_emissiveTexture;
#endif
#ifdef ROUGHNESSMETALLICTEXTURE
uniform sampler2D u_roughnessMetallicTexture;
#endif
#ifdef SPECULARGLOSSINESSTEXTURE
uniform sampler2D u_specularGlossinessTexture;
#endif
#ifdef OCCLUSIONTEXTURE
uniform sampler2D u_occlusionTexture;
#endif
#ifdef HAS_CLEARCOATTEXTURE
uniform sampler2D u_clearCoatTexture;
#endif
#ifdef HAS_CLEARCOATROUGHNESSTEXTURE
uniform sampler2D u_clearCoatRoughnessTexture;
#endif
#ifdef HAS_CLEARCOATNORMALTEXTURE
uniform sampler2D u_clearCoatNormalTexture;
#endif
struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct Geometry{vec3 position;vec3 normal;vec3 viewDir;float dotNV;
#ifdef CLEARCOAT
vec3 clearCoatNormal;float clearCoatDotNV;
#endif
};struct Material{vec3 diffuseColor;float roughness;vec3 specularColor;float opacity;
#ifdef CLEARCOAT
float clearCoat;float clearCoatRoughness;
#endif
};`,w1=`#define GLSLIFY 1
#include <normal_get>
float computeSpecularOcclusion(float ambientOcclusion,float roughness,float dotNV){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}float getAARoughnessFactor(vec3 normal){
#ifdef HAS_DERIVATIVES
vec3 dxy=max(abs(dFdx(normal)),abs(dFdy(normal)));return 0.04+max(max(dxy.x,dxy.y),dxy.z);
#else
return 0.04;
#endif
}void initGeometry(out Geometry geometry){geometry.position=v_pos;geometry.viewDir=normalize(u_cameraPos-v_pos);
#if defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE)
mat3 tbn=getTBN();
#endif
#ifdef NORMALTEXTURE
geometry.normal=getNormalByNormalTexture(tbn,u_normalTexture,u_normalIntensity,v_uv);
#else
geometry.normal=getNormal();
#endif
geometry.dotNV=saturate(dot(geometry.normal,geometry.viewDir));
#ifdef CLEARCOAT
#ifdef HAS_CLEARCOATNORMALTEXTURE
geometry.clearCoatNormal=getNormalByNormalTexture(tbn,u_clearCoatNormalTexture,u_normalIntensity,v_uv);
#else
geometry.clearCoatNormal=getNormal();
#endif
geometry.clearCoatDotNV=saturate(dot(geometry.clearCoatNormal,geometry.viewDir));
#endif
}void initMaterial(out Material material,const in Geometry geometry){vec4 baseColor=u_baseColor;float metal=u_metal;float roughness=u_roughness;vec3 specularColor=u_PBRSpecularColor;float glossiness=u_glossiness;float alphaCutoff=u_alphaCutoff;
#ifdef BASETEXTURE
vec4 baseTextureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
baseTextureColor=gammaToLinear(baseTextureColor);
#endif
baseColor*=baseTextureColor;
#endif
#ifdef O3_HAS_VERTEXCOLOR
baseColor*=v_color;
#endif
#ifdef ALPHA_CUTOFF
if(baseColor.a<alphaCutoff){discard;}
#endif
#ifdef ROUGHNESSMETALLICTEXTURE
vec4 metalRoughMapColor=texture2D(u_roughnessMetallicTexture,v_uv);roughness*=metalRoughMapColor.g;metal*=metalRoughMapColor.b;
#endif
#ifdef SPECULARGLOSSINESSTEXTURE
vec4 specularGlossinessColor=texture2D(u_specularGlossinessTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
specularGlossinessColor=gammaToLinear(specularGlossinessColor);
#endif
specularColor*=specularGlossinessColor.rgb;glossiness*=specularGlossinessColor.a;
#endif
#ifdef IS_METALLIC_WORKFLOW
material.diffuseColor=baseColor.rgb*(1.0-metal);material.specularColor=mix(vec3(0.04),baseColor.rgb,metal);material.roughness=roughness;
#else
float specularStrength=max(max(specularColor.r,specularColor.g),specularColor.b);material.diffuseColor=baseColor.rgb*(1.0-specularStrength);material.specularColor=specularColor;material.roughness=1.0-glossiness;
#endif
material.roughness=max(material.roughness,getAARoughnessFactor(geometry.normal));
#ifdef CLEARCOAT
material.clearCoat=u_clearCoat;material.clearCoatRoughness=u_clearCoatRoughness;
#ifdef HAS_CLEARCOATTEXTURE
material.clearCoat*=texture2D(u_clearCoatTexture,v_uv).r;
#endif
#ifdef HAS_CLEARCOATROUGHNESSTEXTURE
material.clearCoatRoughness*=texture2D(u_clearCoatRoughnessTexture,v_uv).g;
#endif
material.clearCoat=saturate(material.clearCoat);material.clearCoatRoughness=max(material.clearCoatRoughness,getAARoughnessFactor(geometry.clearCoatNormal));
#endif
material.opacity=baseColor.a;}
#include <brdf>
#include <direct_irradiance_frag_define>
#include <ibl_frag_define>
`,b1=`#define GLSLIFY 1
float F_Schlick(float dotLH){return 0.04+0.96*(pow(1.0-dotLH,5.0));}vec3 F_Schlick(vec3 specularColor,float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_SmithCorrelated(float alpha,float dotNL,float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}float D_GGX(float alpha,float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}vec3 BRDF_Specular_GGX(vec3 incidentDirection,vec3 viewDir,vec3 normal,vec3 specularColor,float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentDirection+viewDir);float dotNL=saturate(dot(normal,incidentDirection));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotLH=saturate(dot(incidentDirection,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);float D=D_GGX(alpha,dotNH);return F*(G*D);}vec3 BRDF_Diffuse_Lambert(vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}`,S1=`#define GLSLIFY 1
void addDirectRadiance(vec3 incidentDirection,vec3 color,Geometry geometry,Material material,inout ReflectedLight reflectedLight){float attenuation=1.0;
#ifdef CLEARCOAT
float clearCoatDotNL=saturate(dot(geometry.clearCoatNormal,incidentDirection));vec3 clearCoatIrradiance=clearCoatDotNL*color;reflectedLight.directSpecular+=material.clearCoat*clearCoatIrradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.clearCoatNormal,vec3(0.04),material.clearCoatRoughness);attenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
float dotNL=saturate(dot(geometry.normal,incidentDirection));vec3 irradiance=dotNL*color*PI;reflectedLight.directSpecular+=attenuation*irradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.normal,material.specularColor,material.roughness);reflectedLight.directDiffuse+=attenuation*irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}
#ifdef O3_DIRECT_LIGHT_COUNT
void addDirectionalDirectLightRadiance(DirectLight directionalLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 color=directionalLight.color;vec3 direction=-directionalLight.direction;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef O3_POINT_LIGHT_COUNT
void addPointDirectLightRadiance(PointLight pointLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=pointLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);vec3 color=pointLight.color;color*=clamp(1.0-pow(lightDistance/pointLight.distance,4.0),0.0,1.0);addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
void addSpotDirectLightRadiance(SpotLight spotLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=spotLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(direction,-spotLight.direction);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayEffect=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);vec3 color=spotLight.color;color*=spotEffect*decayEffect;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
void addTotalDirectRadiance(Geometry geometry,Material material,inout ReflectedLight reflectedLight){
#ifdef O3_DIRECT_LIGHT_COUNT
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];addDirectionalDirectLightRadiance(directionalLight,geometry,material,reflectedLight);}
#endif
#ifdef O3_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];addPointDirectLightRadiance(pointLight,geometry,material,reflectedLight);}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];addSpotDirectLightRadiance(spotLight,geometry,material,reflectedLight);}
#endif
}`,C1=`#define GLSLIFY 1
vec3 getLightProbeIrradiance(vec3 sh[9],vec3 normal){normal.x=-normal.x;vec3 result=sh[0]+sh[1]*(normal.y)+sh[2]*(normal.z)+sh[3]*(normal.x)+sh[4]*(normal.y*normal.x)+sh[5]*(normal.y*normal.z)+sh[6]*(3.0*normal.z*normal.z-1.0)+sh[7]*(normal.z*normal.x)+sh[8]*(normal.x*normal.x-normal.y*normal.y);return max(result,vec3(0.0));}vec3 envBRDFApprox(vec3 specularColor,float roughness,float dotNV){const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float getSpecularMIPLevel(float roughness,int maxMIPLevel){return roughness*float(maxMIPLevel);}vec3 getLightProbeRadiance(vec3 viewDir,vec3 normal,float roughness,int maxMIPLevel,float specularIntensity){
#ifndef O3_USE_SPECULAR_ENV
return vec3(0);
#else
vec3 reflectVec=reflect(-viewDir,normal);reflectVec.x=-reflectVec.x;float specularMIPLevel=getSpecularMIPLevel(roughness,maxMIPLevel);
#ifdef HAS_TEX_LOD
vec4 envMapColor=textureCubeLodEXT(u_env_specularSampler,reflectVec,specularMIPLevel);
#else
vec4 envMapColor=textureCube(u_env_specularSampler,reflectVec,specularMIPLevel);
#endif
#ifdef O3_DECODE_ENV_RGBM
envMapColor.rgb=RGBMToLinear(envMapColor,5.0).rgb;
#ifdef OASIS_COLORSPACE_GAMMA
envMapColor=linearToGamma(envMapColor);
#endif
#else
#ifndef OASIS_COLORSPACE_GAMMA
envMapColor=gammaToLinear(envMapColor);
#endif
#endif
return envMapColor.rgb*specularIntensity;
#endif
}`,A1=`#define GLSLIFY 1
Geometry geometry;Material material;ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));initGeometry(geometry);initMaterial(material,geometry);addTotalDirectRadiance(geometry,material,reflectedLight);
#ifdef O3_USE_SH
vec3 irradiance=getLightProbeIrradiance(u_env_sh,geometry.normal);
#ifdef OASIS_COLORSPACE_GAMMA
irradiance=linearToGamma(vec4(irradiance,1.0)).rgb;
#endif
irradiance*=u_envMapLight.diffuseIntensity;
#else
vec3 irradiance=u_envMapLight.diffuse*u_envMapLight.diffuseIntensity;irradiance*=PI;
#endif
reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);vec3 radiance=getLightProbeRadiance(geometry.viewDir,geometry.normal,material.roughness,int(u_envMapLight.mipMapLevel),u_envMapLight.specularIntensity);float radianceAttenuation=1.0;
#ifdef CLEARCOAT
vec3 clearCoatRadiance=getLightProbeRadiance(geometry.viewDir,geometry.clearCoatNormal,material.clearCoatRoughness,int(u_envMapLight.mipMapLevel),u_envMapLight.specularIntensity);reflectedLight.indirectSpecular+=clearCoatRadiance*material.clearCoat*envBRDFApprox(vec3(0.04),material.clearCoatRoughness,geometry.clearCoatDotNV);radianceAttenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
reflectedLight.indirectSpecular+=radianceAttenuation*radiance*envBRDFApprox(material.specularColor,material.roughness,geometry.dotNV);
#ifdef OCCLUSIONTEXTURE
vec2 aoUV=v_uv;
#ifdef O3_HAS_UV1
if(u_occlusionTextureCoord==1.0){aoUV=v_uv1;}
#endif
float ambientOcclusion=(texture2D(u_occlusionTexture,aoUV).r-1.0)*u_occlusionIntensity+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;
#ifdef O3_USE_SPECULAR_ENV
reflectedLight.indirectSpecular*=computeSpecularOcclusion(ambientOcclusion,material.roughness,geometry.dotNV);
#endif
#endif
vec3 emissiveRadiance=u_emissiveColor;
#ifdef EMISSIVETEXTURE
vec4 emissiveColor=texture2D(u_emissiveTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
emissiveColor=gammaToLinear(emissiveColor);
#endif
emissiveRadiance*=emissiveColor.rgb;
#endif
vec3 totalRadiance=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+emissiveRadiance;vec4 targetColor=vec4(totalRadiance,material.opacity);
#ifndef OASIS_COLORSPACE_GAMMA
targetColor=linearToGamma(targetColor);
#endif
gl_FragColor=targetColor;`,P1={pbr_frag_define:x1,pbr_helper:w1,brdf:b1,direct_irradiance_frag_define:S1,ibl_frag_define:C1,pbr_frag:A1},T1=`#define GLSLIFY 1
vec3 getNormal(){
#ifdef O3_HAS_NORMAL
vec3 normal=normalize(v_normal);
#elif defined(HAS_DERIVATIVES)
vec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 normal=normalize(cross(pos_dx,pos_dy));
#else
vec3 normal=vec3(0,0,1);
#endif
normal*=float(gl_FrontFacing)*2.0-1.0;return normal;}vec3 getNormalByNormalTexture(mat3 tbn,sampler2D normalTexture,float normalIntensity,vec2 uv){vec3 normal=texture2D(normalTexture,uv).rgb;normal=normalize(tbn*((2.0*normal-1.0)*vec3(normalIntensity,normalIntensity,1.0)));normal*=float(gl_FrontFacing)*2.0-1.0;return normal;}mat3 getTBN(){
#if defined(O3_HAS_NORMAL) && defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
mat3 tbn=v_TBN;
#else
vec3 normal=getNormal();vec3 position=v_pos;vec2 uv=gl_FrontFacing? v_uv:-v_uv;
#ifdef HAS_DERIVATIVES
vec3 dp1=dFdx(position);vec3 dp2=dFdy(position);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));mat3 tbn=mat3(tangent*invmax,binormal*invmax,normal);
#else
mat3 tbn=mat3(vec3(0.0),vec3(0.0),normal);
#endif
#endif
return tbn;}`,M1=Xc(Xc({common:Fy,common_vert:By,common_frag:Iy,color_share:zy,normal_share:Dy,uv_share:Ly,worldpos_share:Oy,shadow_share:Ny,fog_share:Uy,begin_normal_vert:Vy,begin_position_vert:ky,position_vert:Gy,color_vert:Hy,normal_vert:Wy,skinning_vert:Xy,blendShape_input:jy,blendShape_vert:$y,uv_vert:qy,worldpos_vert:Yy,shadow_vert:Qy,fog_vert:Jy,light_frag_define:Ky,mobile_material_frag:Zy,fog_frag:e1,begin_mobile_frag:t1,begin_viewdir_frag:r1,mobile_blinnphong_frag:n1,noise_common:i1,noise_cellular_2D:a1,noise_cellular_2x2:o1,noise_cellular_2x2x2:s1,noise_cellular_3D:l1,noise_cellular:c1,noise_perlin_2D:u1,noise_perlin_3D:h1,noise_perlin_4D:f1,noise_perlin:d1,noise_psrd_2D:_1,noise_simplex_2D:v1,noise_simplex_3D_grad:p1,noise_simplex_3D:g1,noise_simplex_4D:m1,noise_simplex:y1},P1),{},{normal_get:T1}),Zn=function(){function r(){}return r.parseCustomMacros=function(i){return i.map(function(t){return"#define "+t+`
`}).join("")},r.parseIncludes=function(i){var t=/^[ \t]*#include +<([\w\d.]+)>/gm;function e(n,a){var s=M1[a];return s===void 0?(Fe.error('Shader slice "'+n.trim()+'" not founded.'),""):r.parseIncludes(s)}return i.replace(t,e)},r.parseExtension=function(i){return i.map(function(t){return"#extension "+t+` : enable
`}).join("")},r.convertTo300=function(i,t){if(i=i.replace(/\battribute\b/g,"in"),i=i.replace(/\bvarying\b/g,t?"in":"out"),i=i.replace(/\btexture(2D|Cube)\b/g,"texture"),i=i.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod"),t){var e=/\bgl_FragData\[.+?\]/g.test(i);if(e){i=i.replace(/\bgl_FragColor\b/g,"gl_FragData[0]");var n=i.match(/\bgl_FragData\[.+?\]/g);i=this._replaceMRTShader(i,n)}else i=i.replace(/void\s+?main\s*\(/g,`out vec4 glFragColor;
void main(`),i=i.replace(/\bgl_FragColor\b/g,"glFragColor")}return i},r._replaceMRTShader=function(i,t){for(var e="",n=new Set,a=0;a<t.length;a++){var s=t[a].match(/\bgl_FragData\[(.+?)\]/);n.add(s[1])}return n.forEach(function(l){e+="layout(location="+l+") out vec4 fragOutColor"+l+`;
`}),e+="void main(",i=i.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1"),i=i.replace(/void\s+?main\s*\(/g,e),i},r}(),rs=function r(o,i,t,e){this.name=void 0,this.value=void 0,this._nameId=void 0,this._maskIndex=void 0,this._maskValue=void 0,this.name=o,this._maskIndex=t,this._maskValue=e,this.value=i;var n=r._macroNameIdMap,a=n[o];n[o]===void 0&&(n[o]=a=r._macroNameCounter++),this._nameId=a};rs._macroNameIdMap=Object.create(null);rs._macroNameCounter=0;var Ln;(function(r){r[r.Linear=0]="Linear",r[r.Gamma=1]="Gamma"})(Ln||(Ln={}));var E1=function(){function r(i){this.name=void 0,this.propertyId=void 0,this.location=void 0,this.applyFunc=void 0,this.cacheValue=void 0,this.textureIndex=void 0,this.textureDefault=void 0,this._rhi=void 0,this._gl=void 0,this._colorSpace=void 0;var t=i._hardwareRenderer;this._rhi=t,this._gl=t.gl,this._colorSpace=i.settings.colorSpace}var o=r.prototype;return o.upload1f=function(t,e){this.cacheValue!==e&&(this._gl.uniform1f(t.location,e),this.cacheValue=e)},o.upload1fv=function(t,e){this._gl.uniform1fv(t.location,e)},o.upload2f=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._colorSpace===Ln.Linear?this._gl.uniform2f(t.location,me.gammaToLinearSpace(e.r),me.gammaToLinearSpace(e.g)):this._gl.uniform2f(t.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2f(t.location,e.x,e.y),n.x=e.x,n.y=e.y)},o.upload2fv=function(t,e){this._gl.uniform2fv(t.location,e)},o.upload3f=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._colorSpace===Ln.Linear?this._gl.uniform3f(t.location,me.gammaToLinearSpace(e.r),me.gammaToLinearSpace(e.g),me.gammaToLinearSpace(e.b)):this._gl.uniform3f(t.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3f(t.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},o.upload3fv=function(t,e){this._gl.uniform3fv(t.location,e)},o.upload4f=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._colorSpace===Ln.Linear?this._gl.uniform4f(t.location,me.gammaToLinearSpace(e.r),me.gammaToLinearSpace(e.g),me.gammaToLinearSpace(e.b),e.a):this._gl.uniform4f(t.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4f(t.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},o.upload4fv=function(t,e){this._gl.uniform4fv(t.location,e)},o.upload1i=function(t,e){this.cacheValue!==e&&(this._gl.uniform1i(t.location,e),this.cacheValue=e)},o.upload1iv=function(t,e){this._gl.uniform1iv(t.location,e)},o.upload2i=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._gl.uniform2i(t.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2i(t.location,e.x,e.y),n.x=e.x,n.y=e.y)},o.upload2iv=function(t,e){this._gl.uniform2iv(t.location,e)},o.upload3i=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._gl.uniform3i(t.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3i(t.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},o.upload3iv=function(t,e){this._gl.uniform3iv(t.location,e)},o.upload4i=function(t,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._gl.uniform4i(t.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4i(t.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},o.upload4iv=function(t,e){this._gl.uniform4iv(t.location,e)},o.uploadMat4=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e.elements)},o.uploadMat4v=function(t,e){this._gl.uniformMatrix4fv(t.location,!1,e)},o.uploadTexture=function(t,e){var n=this._rhi;n.activeTexture(t.textureIndex),n.bindTexture(e._platformTexture)},o.uploadTextureArray=function(t,e){for(var n=this._rhi,a=t.textureIndex,s=0;s<e.length;s++){var l=e[s];n.activeTexture(a[s]),n.bindTexture(l._platformTexture)}},r}(),_a=function(){this.constUniforms=[],this.textureUniforms=[]},mv=function(){r._addLineNum=function(t){var e=t.split(`
`),n=(e.length+1).toString().length+6,a;return e.map(function(s,l){if(a="0:"+(l+1),a.length>=n)return a.substring(0,n)+s;for(var c=0;c<n-a.length;c++)a+=" ";return a+s}).join(`
`)};function r(i,t,e){this.id=void 0,this.sceneUniformBlock=new _a,this.cameraUniformBlock=new _a,this.rendererUniformBlock=new _a,this.materialUniformBlock=new _a,this.otherUniformBlock=new _a,this._uploadRenderCount=-1,this._uploadCamera=void 0,this._uploadRenderer=void 0,this._uploadMaterial=void 0,this.attributeLocation=Object.create(null),this._isValid=void 0,this._engine=void 0,this._gl=void 0,this._vertexShader=void 0,this._fragmentShader=void 0,this._glProgram=void 0,this._activeTextureUint=0,this._engine=i,this._gl=i._hardwareRenderer.gl,this._glProgram=this._createProgram(t,e),this._glProgram?(this._isValid=!0,this._recordLocation()):this._isValid=!1,this.id=r._counter++}var o=r.prototype;return o.uploadAll=function(t,e){this.uploadUniforms(t,e),this.uploadTextures(t,e)},o.uploadUniforms=function(t,e){for(var n=e._propertyValueMap,a=t.constUniforms,s=0,l=a.length;s<l;s++){var c=a[s],u=n[c.propertyId];u!=null&&c.applyFunc(c,u)}},o.uploadTextures=function(t,e){var n=e._propertyValueMap,a=t.textureUniforms;if(a)for(var s=0,l=a.length;s<l;s++){var c=a[s],u=n[c.propertyId];u&&!u.destroyed?c.applyFunc(c,u):c.applyFunc(c,c.textureDefault)}},o.uploadUnGroupTextures=function(){var t=this.otherUniformBlock.textureUniforms;if(t)for(var e=0,n=t.length;e<n;e++){var a=t[e];a.applyFunc(a,a.textureDefault)}},o.groupingOtherUniformBlock=function(){var t=this.otherUniformBlock,e=t.constUniforms,n=t.textureUniforms;e.length>0&&this._groupingSubOtherUniforms(e,!1),n.length>0&&this._groupingSubOtherUniforms(n,!0)},o.bind=function(){var t=this._engine._hardwareRenderer;return t._currentBind!==this?(this._gl.useProgram(this._glProgram),t._currentBind=this,!0):!1},o.destroy=function(){var t=this._gl;this._vertexShader&&t.deleteShader(this._vertexShader),this._fragmentShader&&t.deleteShader(this._fragmentShader),this._glProgram&&t.deleteProgram(this._glProgram)},o._groupingSubOtherUniforms=function(t,e){for(var n=t.length-1;n>=0;n--){var a=t[n],s=k._getShaderPropertyGroup(a.name);s!==void 0&&(t.splice(t.indexOf(a),1),this._groupingUniform(a,s,e))}},o._groupingUniform=function(t,e,n){switch(e){case Fr.Scene:n?this.sceneUniformBlock.textureUniforms.push(t):this.sceneUniformBlock.constUniforms.push(t);break;case Fr.Camera:n?this.cameraUniformBlock.textureUniforms.push(t):this.cameraUniformBlock.constUniforms.push(t);break;case Fr.Renderer:n?this.rendererUniformBlock.textureUniforms.push(t):this.rendererUniformBlock.constUniforms.push(t);break;case Fr.Material:n?this.materialUniformBlock.textureUniforms.push(t):this.materialUniformBlock.constUniforms.push(t);break;default:n?this.otherUniformBlock.textureUniforms.push(t):this.otherUniformBlock.constUniforms.push(t)}},o._createProgram=function(t,e){var n=this._gl,a=this._createShader(n.VERTEX_SHADER,t);if(!a)return null;var s=this._createShader(n.FRAGMENT_SHADER,e);if(!s)return null;var l=n.createProgram();return n.attachShader(l,a),n.attachShader(l,s),n.linkProgram(l),n.validateProgram(l),n.isContextLost()?(Fe.error("Context lost while linking program."),n.deleteShader(a),n.deleteShader(s),null):Fe.isEnabled&&!n.getProgramParameter(l,n.LINK_STATUS)?(Fe.error(`Could not link WebGL program. 
`+n.getProgramInfoLog(l)),n.deleteProgram(l),null):(this._vertexShader=a,this._fragmentShader=s,l)},o._createShader=function(t,e){var n=this._gl,a=n.createShader(t);return a?(n.shaderSource(a,e),n.compileShader(a),n.isContextLost()?(Fe.error("Context lost while compiling shader."),n.deleteShader(a),null):Fe.isEnabled&&!n.getShaderParameter(a,n.COMPILE_STATUS)?(Fe.error(`Could not compile WebGL shader.
`+n.getShaderInfoLog(a),r._addLineNum(e)),n.deleteShader(a),null):a):(Fe.error("Context lost while create shader."),null)},o._recordLocation=function(){var t=this,e=this._gl,n=this._glProgram,a=this._getUniformInfos(),s=this._getAttributeInfos();a.forEach(function(l){var c=l.name,u=l.size,h=l.type,f=new E1(t._engine),d=!1,_=!1;c.indexOf("[0]")>0&&(c=c.substr(0,c.length-3),d=!0);var p=e.getUniformLocation(n,c);switch(f.name=c,f.propertyId=k.getPropertyByName(c)._uniqueId,f.location=p,h){case e.FLOAT:d?f.applyFunc=f.upload1fv:(f.applyFunc=f.upload1f,f.cacheValue=0);break;case e.FLOAT_VEC2:d?f.applyFunc=f.upload2fv:(f.applyFunc=f.upload2f,f.cacheValue=new Z(0,0));break;case e.FLOAT_VEC3:d?f.applyFunc=f.upload3fv:(f.applyFunc=f.upload3f,f.cacheValue=new y(0,0,0));break;case e.FLOAT_VEC4:d?f.applyFunc=f.upload4fv:(f.applyFunc=f.upload4f,f.cacheValue=new qe(0,0,0,0));break;case e.BOOL:case e.INT:d?f.applyFunc=f.upload1iv:(f.applyFunc=f.upload1i,f.cacheValue=0);break;case e.BOOL_VEC2:case e.INT_VEC2:d?f.applyFunc=f.upload2iv:(f.applyFunc=f.upload2i,f.cacheValue=new Z(0,0));break;case e.BOOL_VEC3:case e.INT_VEC3:f.applyFunc=d?f.upload3iv:f.upload3i,f.cacheValue=new y(0,0,0);break;case e.BOOL_VEC4:case e.INT_VEC4:d?f.applyFunc=f.upload4iv:(f.applyFunc=f.upload4i,f.cacheValue=new qe(0,0,0));break;case e.FLOAT_MAT4:f.applyFunc=d?f.uploadMat4v:f.uploadMat4;break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.SAMPLER_2D_ARRAY:var v;switch(h){case e.SAMPLER_2D:v=t._engine._magentaTexture2D;break;case e.SAMPLER_CUBE:v=t._engine._magentaTextureCube;break;case e.SAMPLER_2D_ARRAY:v=t._engine._magentaTexture2DArray;break;default:throw new Error("Unsupported texture type.")}if(_=!0,d){for(var g=new Array(u),m=new Int32Array(u),x=new Array(u),w=0;w<u;w++)g[w]=v,m[w]=t._activeTextureUint,x[w]=e.TEXTURE0+t._activeTextureUint++;f.textureDefault=g,f.textureIndex=x,f.applyFunc=f.uploadTextureArray,t.bind(),e.uniform1iv(p,m),f.uploadTextureArray(f,g)}else{var C=e.TEXTURE0+t._activeTextureUint;f.textureDefault=v,f.textureIndex=C,f.applyFunc=f.uploadTexture,t.bind(),e.uniform1i(p,t._activeTextureUint++),f.uploadTexture(f,v)}break}var T=k._getShaderPropertyGroup(c);t._groupingUniform(f,T,_)}),s.forEach(function(l){var c=l.name;t.attributeLocation[c]=e.getAttribLocation(n,c)})},o._getUniformInfos=function(){for(var t=this._gl,e=this._glProgram,n=new Array,a=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),s=0;s<a;++s){var l=t.getActiveUniform(e,s);n[s]=l}return n},o._getAttributeInfos=function(){for(var t=this._gl,e=this._glProgram,n=new Array,a=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s=0;s<a;++s){var l=t.getActiveAttrib(e,s);n[s]=l}return n},ie(r,[{key:"isValid",get:function(){return this._isValid}}]),r}();mv._counter=0;var Ll=function(){function r(o){this._uniqueId=void 0,this._group=void 0,this._type=void 0,this.name=void 0,this.name=o,this._uniqueId=r._propertyNameCounter++}return ie(r,[{key:"type",get:function(){return this._type}}]),r}();Ll._propertyNameCounter=0;var k=function(){r.create=function(t,e,n){var a=r._shaderMap;if(a[t])throw'Shader named "'+t+'" already exists.';return a[t]=new r(t,e,n)},r.find=function(t){return r._shaderMap[t]},r.getMacroByName=function(t,e){var n=e?t+" "+e:t,a=r._macroMap[n];if(!a){var s=r._macroMaskMap,l=r._macroCounter,c=Math.floor(l/32),u=l%32;a=new rs(t,e,c,1<<u),r._macroMap[n]=a,c==s.length&&(s.length++,s[c]=new Array(32)),s[c][u]=n,r._macroCounter++}return a},r.getPropertyByName=function(t){var e=r._propertyNameMap;if(e[t]!=null)return e[t];var n=new Ll(t);return e[t]=n,r._propertyIdMap[n._uniqueId]=n,n},r._getShaderPropertyGroup=function(t){var e=r._propertyNameMap[t];return e==null?void 0:e._group},r._getNamesByMacros=function(t,e){var n=r._macroMaskMap,a=t._mask;e.length=0;for(var s=0,l=t._length;s<l;s++)for(var c=n[s],u=a[s],h=u<0?32:Math.floor(Math.log2(u))+1,f=0;f<h;f++)u&1<<f&&e.push(c[f])};function r(i,t,e){this.name=void 0,this._shaderId=0,this._vertexSource=void 0,this._fragmentSource=void 0,this._shaderId=r._shaderCounter++,this.name=i,this._vertexSource=t,this._fragmentSource=e}var o=r.prototype;return o.compileVariant=function(t,e){var n=r._compileMacros;n.clear();for(var a=0,s=e.length;a<s;a++)n.enable(r.getMacroByName(e[a]));return this._getShaderProgram(t,n).isValid},o._getShaderProgram=function(t,e){var n=t._getShaderProgramPool(this),a=n.get(e);if(a)return a;var s=t._hardwareRenderer.isWebGL2,l=[];r._getNamesByMacros(e,l);var c=Zn.parseCustomMacros(l),u=s?"#version 300 es":"#version 100",h=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      precision highp int;
    #else
      precision mediump float;
      precision mediump int;
    #endif
    `;t._hardwareRenderer.canIUse(he.shaderTextureLod)&&(h+=`#define HAS_TEX_LOD
`),t._hardwareRenderer.canIUse(he.standardDerivatives)&&(h+=`#define HAS_DERIVATIVES
`);var f=Zn.parseIncludes(" "+u+`
        `+h+`
        `+c+`
        `+this._vertexSource),d=Zn.parseIncludes(" "+u+`
        `+(s?"":Zn.parseExtension(r._shaderExtension))+`
        `+h+`
        `+c+`
      `+this._fragmentSource);return s&&(f=Zn.convertTo300(f),d=Zn.convertTo300(d,!0)),a=new mv(t,f,d),n.cache(a),a},r}();k._compileMacros=new ar;k._propertyIdMap=Object.create(null);k._shaderCounter=0;k._shaderMap=Object.create(null);k._propertyNameMap=Object.create(null);k._macroMaskMap=[];k._macroCounter=0;k._macroMap=Object.create(null);k._shaderExtension=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"];var Ya=function(){function r(i){this._group=void 0,this._propertyValueMap=Object.create(null),this._macroCollection=new ar,this._macroMap=Object.create(null),this._refCount=0,this._group=i}var o=r.prototype;return o.getFloat=function(t){return this.getPropertyValue(t)},o.setFloat=function(t,e){this._setPropertyValue(t,Ut.Float,e)},o.getInt=function(t){return this.getPropertyValue(t)},o.setInt=function(t,e){this._setPropertyValue(t,Ut.Int,e)},o.getFloatArray=function(t){return this.getPropertyValue(t)},o.setFloatArray=function(t,e){this._setPropertyValue(t,Ut.FloatArray,e)},o.getIntArray=function(t){return this.getPropertyValue(t)},o.setIntArray=function(t,e){this._setPropertyValue(t,Ut.IntArray,e)},o.getVector2=function(t){return this.getPropertyValue(t)},o.setVector2=function(t,e){this._setPropertyValue(t,Ut.Vector2,e)},o.getVector3=function(t){return this.getPropertyValue(t)},o.setVector3=function(t,e){this._setPropertyValue(t,Ut.Vector3,e)},o.getVector4=function(t){return this.getPropertyValue(t)},o.setVector4=function(t,e){this._setPropertyValue(t,Ut.Vector4,e)},o.getMatrix=function(t){return this.getPropertyValue(t)},o.setMatrix=function(t,e){this._setPropertyValue(t,Ut.Matrix,e)},o.getColor=function(t){return this.getPropertyValue(t)},o.setColor=function(t,e){this._setPropertyValue(t,Ut.Color,e)},o.getTexture=function(t){return this.getPropertyValue(t)},o.setTexture=function(t,e){if(this._getRefCount()>0){var n=this.getPropertyValue(t);n&&n._addRefCount(-1),e&&e._addRefCount(1)}this._setPropertyValue(t,Ut.Texture,e)},o.getTextureArray=function(t){return this.getPropertyValue(t)},o.setTextureArray=function(t,e){if(this._getRefCount()>0){var n=this.getPropertyValue(t);if(n)for(var a=0,s=n.length;a<s;a++)n[a]._addRefCount(-1);if(e)for(var l=0,c=e.length;l<c;l++)e[l]._addRefCount(1)}this._setPropertyValue(t,Ut.TextureArray,e)},o.getPropertyValue=function(t){return typeof t=="string"&&(t=k.getPropertyByName(t)),this._propertyValueMap[t._uniqueId]},o.enableMacro=function(t,e){typeof t=="string"&&(t=k.getMacroByName(t,e));var n=t._nameId,a=this._macroMap[n];if(a!==t){var s=this._macroCollection;a&&s.disable(a),s.enable(t),this._macroMap[n]=t}},o.disableMacro=function(t){var e;if(typeof t=="string"){if(e=rs._macroNameIdMap[t],e===void 0)return}else e=t._nameId;var n=this._macroMap[e];n&&(this._macroCollection.disable(n),delete this._macroMap[e])},o.getMacros=function(t){if(t){var e=this._macroMap;t.length=0;for(var n in e)t.push(e[n])}else return Object.values(this._macroMap)},o.getProperties=function(t){var e;t?(t.length=0,e=t):e=[];var n=this._propertyValueMap,a=k._propertyIdMap;for(var s in n)e.push(a[s]);if(!t)return e},o.clone=function(){var t=new r(this._group);return this.cloneTo(t),t},o.cloneTo=function(t){mr.deepCloneObject(this._macroCollection,t._macroCollection),Oa(t._macroMap,this._macroMap);for(var e=this._propertyValueMap,n=t._propertyValueMap,a=Object.keys(e),s=0,l=a.length;s<l;s++){var c=a[s],u=e[c];if(u!=null)if(typeof u=="number")n[c]=u;else if(u instanceof Kr)n[c]=u;else if(u instanceof Array||u instanceof Float32Array||u instanceof Int32Array)n[c]=u.slice();else{var h=n[c];h?h.copyFrom(u):n[c]=u.clone()}else n[c]=u}},o._setPropertyValue=function(t,e,n){if(typeof t=="string"&&(t=k.getPropertyByName(t)),t._group!==this._group)if(t._group===void 0)t._group=this._group;else throw"Shader property "+t.name+" has been used as "+Fr[t._group]+" group.";if(t._type!==e)if(t._type===void 0)t._type=e;else throw"Shader property "+t.name+" has been used as "+Ut[t._type]+" type.";this._propertyValueMap[t._uniqueId]=n},o._getRefCount=function(){return this._refCount},o._addRefCount=function(t){this._refCount+=t;var e=this._propertyValueMap;for(var n in e){var a=e[n];a&&a instanceof Kr&&a._addRefCount(t)}},r}(),xe;(function(r){r[r.Zero=0]="Zero",r[r.One=1]="One",r[r.SourceColor=2]="SourceColor",r[r.OneMinusSourceColor=3]="OneMinusSourceColor",r[r.DestinationColor=4]="DestinationColor",r[r.OneMinusDestinationColor=5]="OneMinusDestinationColor",r[r.SourceAlpha=6]="SourceAlpha",r[r.OneMinusSourceAlpha=7]="OneMinusSourceAlpha",r[r.DestinationAlpha=8]="DestinationAlpha",r[r.OneMinusDestinationAlpha=9]="OneMinusDestinationAlpha",r[r.SourceAlphaSaturate=10]="SourceAlphaSaturate",r[r.BlendColor=11]="BlendColor",r[r.OneMinusBlendColor=12]="OneMinusBlendColor"})(xe||(xe={}));var er;(function(r){r[r.Add=0]="Add",r[r.Subtract=1]="Subtract",r[r.ReverseSubtract=2]="ReverseSubtract",r[r.Min=3]="Min",r[r.Max=4]="Max"})(er||(er={}));var Br;(function(r){r[r.None=0]="None",r[r.Red=1]="Red",r[r.Green=2]="Green",r[r.Blue=4]="Blue",r[r.Alpha=8]="Alpha",r[r.All=15]="All"})(Br||(Br={}));var R1=function(){this.enabled=!1,this.colorBlendOperation=er.Add,this.alphaBlendOperation=er.Add,this.sourceColorBlendFactor=xe.One,this.sourceAlphaBlendFactor=xe.One,this.destinationColorBlendFactor=xe.Zero,this.destinationAlphaBlendFactor=xe.Zero,this.colorWriteMask=Br.All},F1=function(){function r(){this.targetBlendState=new R1,this.blendColor=new me(0,0,0,0),this.alphaToCoverage=!1}r._getGLBlendFactor=function(t,e){var n=t.gl;switch(e){case xe.Zero:return n.ZERO;case xe.One:return n.ONE;case xe.SourceColor:return n.SRC_COLOR;case xe.OneMinusSourceColor:return n.ONE_MINUS_SRC_COLOR;case xe.DestinationColor:return n.DST_COLOR;case xe.OneMinusDestinationColor:return n.ONE_MINUS_DST_COLOR;case xe.SourceAlpha:return n.SRC_ALPHA;case xe.OneMinusSourceAlpha:return n.ONE_MINUS_SRC_ALPHA;case xe.DestinationAlpha:return n.DST_ALPHA;case xe.OneMinusDestinationAlpha:return n.ONE_MINUS_DST_ALPHA;case xe.SourceAlphaSaturate:return n.SRC_ALPHA_SATURATE;case xe.BlendColor:return n.CONSTANT_COLOR;case xe.OneMinusBlendColor:return n.ONE_MINUS_CONSTANT_COLOR}},r._getGLBlendOperation=function(t,e){var n=t.gl;switch(e){case er.Add:return n.FUNC_ADD;case er.Subtract:return n.FUNC_SUBTRACT;case er.ReverseSubtract:return n.FUNC_REVERSE_SUBTRACT;case er.Min:if(!t.canIUse(he.blendMinMax))throw new Error("BlendOperation.Min is not supported in this context");return n.MIN;case er.Max:if(!t.canIUse(he.blendMinMax))throw new Error("BlendOperation.Max is not supported in this context");return n.MAX}};var o=r.prototype;return o._apply=function(t,e){this._platformApply(t,e.blendState)},o._platformApply=function(t,e){var n=t.gl,a=e.targetBlendState,s=this.targetBlendState,l=s.enabled,c=s.colorBlendOperation,u=s.alphaBlendOperation,h=s.sourceColorBlendFactor,f=s.destinationColorBlendFactor,d=s.sourceAlphaBlendFactor,_=s.destinationAlphaBlendFactor,p=s.colorWriteMask;if(l!==a.enabled&&(l?n.enable(n.BLEND):n.disable(n.BLEND),a.enabled=l),l){(h!==a.sourceColorBlendFactor||f!==a.destinationColorBlendFactor||d!==a.sourceAlphaBlendFactor||_!==a.destinationAlphaBlendFactor)&&(n.blendFuncSeparate(r._getGLBlendFactor(t,h),r._getGLBlendFactor(t,f),r._getGLBlendFactor(t,d),r._getGLBlendFactor(t,_)),a.sourceColorBlendFactor=h,a.destinationColorBlendFactor=f,a.sourceAlphaBlendFactor=d,a.destinationAlphaBlendFactor=_),(c!==a.colorBlendOperation||u!==a.alphaBlendOperation)&&(n.blendEquationSeparate(r._getGLBlendOperation(t,c),r._getGLBlendOperation(t,u)),a.colorBlendOperation=c,a.alphaBlendOperation=u);var v=this.blendColor;me.equals(e.blendColor,v)||(n.blendColor(v.r,v.g,v.b,v.a),e.blendColor.copyFrom(v))}p!==a.colorWriteMask&&(n.colorMask((p&Br.Red)!==0,(p&Br.Green)!==0,(p&Br.Blue)!==0,(p&Br.Alpha)!==0),a.colorWriteMask=p);var g=this.alphaToCoverage;g!==e.alphaToCoverage&&(g?n.enable(n.SAMPLE_ALPHA_TO_COVERAGE):n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),e.alphaToCoverage=g)},r}(),Xe;(function(r){r[r.Never=0]="Never",r[r.Less=1]="Less",r[r.Equal=2]="Equal",r[r.LessEqual=3]="LessEqual",r[r.Greater=4]="Greater",r[r.NotEqual=5]="NotEqual",r[r.GreaterEqual=6]="GreaterEqual",r[r.Always=7]="Always"})(Xe||(Xe={}));var B1=function(){function r(){this.enabled=!0,this.writeEnabled=!0,this.compareFunction=Xe.Less}r._getGLCompareFunction=function(t,e){var n=t.gl;switch(e){case Xe.Never:return n.NEVER;case Xe.Less:return n.LESS;case Xe.Equal:return n.EQUAL;case Xe.LessEqual:return n.LEQUAL;case Xe.Greater:return n.GREATER;case Xe.NotEqual:return n.NOTEQUAL;case Xe.GreaterEqual:return n.GEQUAL;case Xe.Always:return n.ALWAYS}};var o=r.prototype;return o._apply=function(t,e){this._platformApply(t,e.depthState)},o._platformApply=function(t,e){var n=t.gl,a=this.enabled,s=this.compareFunction,l=this.writeEnabled;a!=e.enabled&&(a?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),e.enabled=a),a&&(s!=e.compareFunction&&(n.depthFunc(r._getGLCompareFunction(t,s)),e.compareFunction=s),l!=e.writeEnabled&&(n.depthMask(l),e.writeEnabled=l))},r}(),nr;(function(r){r[r.Off=0]="Off",r[r.Front=1]="Front",r[r.Back=2]="Back"})(nr||(nr={}));var I1=function(){function r(){this.cullMode=nr.Back,this.depthBias=0,this.slopeScaledDepthBias=0,this._cullFaceEnable=!0,this._frontFaceInvert=!1}var o=r.prototype;return o._apply=function(t,e,n){this._platformApply(t,e.rasterState,n)},o._platformApply=function(t,e,n){var a=t.gl,s=this.cullMode,l=this.depthBias,c=this.slopeScaledDepthBias,u=s!==nr.Off;u!==e._cullFaceEnable&&(u?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),e._cullFaceEnable=u),u&&s!==e.cullMode&&(s==nr.Back?a.cullFace(a.BACK):a.cullFace(a.FRONT),e.cullMode=s),n!==e._frontFaceInvert&&(n?a.frontFace(a.CW):a.frontFace(a.CCW),e._frontFaceInvert=n),(l!==e.depthBias||c!==e.slopeScaledDepthBias)&&(l!==0||c!==0?(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(c,l)):a.disable(a.POLYGON_OFFSET_FILL),e.depthBias=l,e.slopeScaledDepthBias=c)},r}(),dt;(function(r){r[r.Keep=0]="Keep",r[r.Zero=1]="Zero",r[r.Replace=2]="Replace",r[r.IncrementSaturate=3]="IncrementSaturate",r[r.DecrementSaturate=4]="DecrementSaturate",r[r.Invert=5]="Invert",r[r.IncrementWrap=6]="IncrementWrap",r[r.DecrementWrap=7]="DecrementWrap"})(dt||(dt={}));var z1=function(){function r(){this.enabled=!1,this.referenceValue=0,this.mask=255,this.writeMask=255,this.compareFunctionFront=Xe.Always,this.compareFunctionBack=Xe.Always,this.passOperationFront=dt.Keep,this.passOperationBack=dt.Keep,this.failOperationFront=dt.Keep,this.failOperationBack=dt.Keep,this.zFailOperationFront=dt.Keep,this.zFailOperationBack=dt.Keep}r._getGLCompareFunction=function(t,e){var n=t.gl;switch(e){case Xe.Never:return n.NEVER;case Xe.Less:return n.LESS;case Xe.Equal:return n.EQUAL;case Xe.LessEqual:return n.LEQUAL;case Xe.Greater:return n.GREATER;case Xe.NotEqual:return n.NOTEQUAL;case Xe.GreaterEqual:return n.GEQUAL;case Xe.Always:return n.ALWAYS}},r._getGLStencilOperation=function(t,e){var n=t.gl;switch(e){case dt.Keep:return n.KEEP;case dt.Zero:return n.ZERO;case dt.Replace:return n.REPLACE;case dt.IncrementSaturate:return n.INCR;case dt.DecrementSaturate:return n.DECR;case dt.Invert:return n.INVERT;case dt.IncrementWrap:return n.INCR_WRAP;case dt.DecrementWrap:return n.DECR_WRAP}};var o=r.prototype;return o._apply=function(t,e){this._platformApply(t,e.stencilState)},o._platformApply=function(t,e){var n=t.gl,a=this.enabled,s=this.referenceValue,l=this.mask,c=this.compareFunctionFront,u=this.compareFunctionBack,h=this.failOperationFront,f=this.zFailOperationFront,d=this.passOperationFront,_=this.failOperationBack,p=this.zFailOperationBack,v=this.passOperationBack,g=this.writeMask;if(a!=e.enabled&&(a?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),e.enabled=a),a){var m=s!==e.referenceValue||l!==e.mask;(m||c!==e.compareFunctionFront)&&(n.stencilFuncSeparate(n.FRONT,r._getGLCompareFunction(t,c),s,l),e.compareFunctionFront=c),(m||u!==e.compareFunctionBack)&&(n.stencilFuncSeparate(n.BACK,r._getGLCompareFunction(t,u),s,l),e.compareFunctionBack=this.compareFunctionBack),m&&(e.referenceValue=this.referenceValue,e.mask=this.mask),(h!==e.failOperationFront||f!==e.zFailOperationFront||d!==e.passOperationFront)&&(n.stencilOpSeparate(n.FRONT,r._getGLStencilOperation(t,h),r._getGLStencilOperation(t,f),r._getGLStencilOperation(t,d)),e.failOperationFront=h,e.zFailOperationFront=f,e.passOperationFront=d),(_!==e.failOperationBack||p!==e.zFailOperationBack||v!==e.passOperationBack)&&(n.stencilOpSeparate(n.BACK,r._getGLStencilOperation(t,_),r._getGLStencilOperation(t,p),r._getGLStencilOperation(t,v)),e.failOperationBack=_,e.zFailOperationBack=p,e.passOperationBack=v),g!==e.writeMask&&(n.stencilMask(g),e.writeMask=g)}},r}(),yv=function(){function r(){this.blendState=new F1,this.depthState=new B1,this.stencilState=new z1,this.rasterState=new I1}var o=r.prototype;return o._apply=function(t,e){var n=t._hardwareRenderer,a=t._lastRenderState;this.blendState._apply(n,a),this.depthState._apply(n,a),this.stencilState._apply(n,a),this.rasterState._apply(n,a,e)},r}(),Ir=function(r){ne(o,r);function o(t,e){var n;return n=r.call(this,t)||this,n.name=void 0,n.shader=void 0,n.renderQueueType=xt.Opaque,n.shaderData=new Ya(Fr.Material),n.renderState=new yv,n.shader=e,n}var i=o.prototype;return i.clone=function(){var e=new o(this._engine,this.shader);return this.cloneTo(e),e},i.cloneTo=function(e){e.shader=this.shader,e.renderQueueType=this.renderQueueType,this.shaderData.cloneTo(e.shaderData),mr.deepCloneObject(this.renderState,e.renderState)},i._addRefCount=function(e){r.prototype._addRefCount.call(this,e),this.shaderData._addRefCount(e)},i._preRender=function(e){},i._onDestroy=function(){},o}(gn),ci=function(){function r(i){this._elementPoolIndex=0,this._elementPool=[],this._type=void 0,this._type=i}var o=r.prototype;return o.getFromPool=function(){var t=this._elementPoolIndex,e=this._elementPool;if(this._elementPoolIndex++,e.length===t){var n=new this._type;return e.push(n),n}else return e[t]},o.resetPool=function(){this._elementPoolIndex=0},r}(),ns=function(){this.component=void 0,this.material=void 0,this.multiRenderData=void 0},xv=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.mesh=void 0,t.subMesh=void 0,t}var i=o.prototype;return i.setValue=function(e,n,a,s){this.component=e,this.mesh=n,this.subMesh=a,this.material=s},o}(ns),D1=function(){function r(){this._camera=void 0,this._viewProjectMatrix=new ge}var o=r.prototype;return o._setContext=function(t){this._camera=t,ge.multiply(t.projectionMatrix,t.viewMatrix,this._viewProjectMatrix)},r}(),wv=function(r){ne(o,r);function o(){var t;return t=r.call(this)||this,t.renderData=void 0,t.texture=void 0,t.multiRenderData=!1,t}var i=o.prototype;return i.setValue=function(e,n,a,s){this.component=e,this.renderData=n,this.material=a,this.texture=s},o}(ns),L1=function(r){ne(o,r);function o(){var t;return t=r.call(this)||this,t.renderData=void 0,t.isAdd=!0,t.multiRenderData=!1,t}var i=o.prototype;return i.setValue=function(e,n,a){this.component=e,this.renderData=n,this.material=a},o}(ns),pr;(function(r){r[r.None=0]="None",r[r.VisibleInsideMask=1]="VisibleInsideMask",r[r.VisibleOutsideMask=2]="VisibleOutsideMask"})(pr||(pr={}));var wu,bu,_t,Su,Cu,Au,Pu,Tu,Mu,Eu,Ru,Fu,Bu,Iu,zu,Du,Lu,Ou,Nu,Cn,Qa=(wu=ca(rr),wu(bu=(_t=(Cn=function(r){ne(o,r);function o(t){var e;e=r.call(this,t)||this,X(e,"shaderData",Su,N(e)),X(e,"isCulled",Cu,N(e)),X(e,"_distanceForSort",Au,N(e)),X(e,"_onUpdateIndex",Pu,N(e)),X(e,"_rendererIndex",Tu,N(e)),X(e,"_globalShaderMacro",Mu,N(e)),X(e,"_transformChangeFlag",Eu,N(e)),X(e,"_bounds",Ru,N(e)),X(e,"_overrideUpdate",Fu,N(e)),X(e,"_materials",Bu,N(e)),X(e,"_mvMatrix",Iu,N(e)),X(e,"_mvpMatrix",zu,N(e)),X(e,"_mvInvMatrix",Du,N(e)),X(e,"_normalMatrix",Lu,N(e)),X(e,"_materialsInstanced",Ou,N(e)),X(e,"_priority",Nu,N(e));var n=o.prototype;return e._overrideUpdate=e.update!==n.update,e._transformChangeFlag=e.entity.transform.registerWorldChangeFlag(),e.shaderData._addRefCount(1),e}var i=o.prototype;return i.getInstanceMaterial=function(e){e===void 0&&(e=0);var n=this._materials;if(n.length>e){var a=n[e];if(a)return this._materialsInstanced[e]?a:this._createInstanceMaterial(a,e)}return null},i.getMaterial=function(e){return e===void 0&&(e=0),this._materials[e]||null},i.setMaterial=function(e,n){n===void 0&&(n=null),typeof e=="number"?this._setMaterial(e,n):this._setMaterial(0,e)},i.getInstanceMaterials=function(){for(var e=this._materials,n=this._materialsInstanced,a=0,s=e.length;a<s;a++)n[a]||this._createInstanceMaterial(this._materials[a],a);return e},i.getMaterials=function(){return this._materials},i.setMaterials=function(e){for(var n=e.length,a=this._materials,s=this._materialsInstanced,l=n,c=a.length;l<c;l++){var u=a[l];u&&u._addRefCount(-1)}a.length!==n&&(a.length=n),s.length!==0&&(s.length=0);for(var h=0;h<n;h++){var f=a[h],d=e[h];f!==d&&(a[h]=d,f&&f._addRefCount(-1),d&&d._addRefCount(1))}},i.update=function(e){},i._updateShaderData=function(e){var n=this.shaderData,a=this.entity.transform.worldMatrix,s=this._mvMatrix,l=this._mvpMatrix,c=this._mvInvMatrix,u=this._normalMatrix;ge.multiply(e._camera.viewMatrix,a,s),ge.multiply(e._viewProjectMatrix,a,l),ge.invert(s,c),ge.invert(a,u),u.transpose(),n.setMatrix(o._localMatrixProperty,this.entity.transform.localMatrix),n.setMatrix(o._worldMatrixProperty,a),n.setMatrix(o._mvMatrixProperty,s),n.setMatrix(o._mvpMatrixProperty,l),n.setMatrix(o._mvInvMatrixProperty,c),n.setMatrix(o._normalMatrixProperty,u)},i._onEnable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},i._onDisable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},i._render=function(e){throw"not implement"},i._onDestroy=function(){var e=this._transformChangeFlag;e&&(e.destroy(),this._transformChangeFlag=null),this.shaderData._addRefCount(-1);for(var n=this._materials,a=0,s=n.length;a<s;a++){var l;(l=n[a])===null||l===void 0||l._addRefCount(-1)}},i._updateBounds=function(e){},i._createInstanceMaterial=function(e,n){var a=e.clone();return a.name=a.name+"(Instance)",e._addRefCount(-1),a._addRefCount(1),this._materialsInstanced[n]=!0,this._materials[n]=a,a},i._setMaterial=function(e,n){var a=this._materials;e>=a.length&&(a.length=e+1);var s=a[e];if(s!==n){var l=this._materialsInstanced;e<l.length&&(l[e]=!1),s&&s._addRefCount(-1),n&&n._addRefCount(1),a[e]=n}},ie(o,[{key:"materialCount",get:function(){return this._materials.length},set:function(e){var n=this._materials,a=this._materialsInstanced;n.length!==e&&(n.length=e),a.length>e&&(a.length=e)}},{key:"bounds",get:function(){var e=this._transformChangeFlag;return e.flag&&(this._updateBounds(this._bounds),e.flag=!1),this._bounds}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}}]),o}(wr),Cn._localMatrixProperty=k.getPropertyByName("u_localMat"),Cn._worldMatrixProperty=k.getPropertyByName("u_modelMat"),Cn._mvMatrixProperty=k.getPropertyByName("u_MVMat"),Cn._mvpMatrixProperty=k.getPropertyByName("u_MVPMat"),Cn._mvInvMatrixProperty=k.getPropertyByName("u_MVInvMat"),Cn._normalMatrixProperty=k.getPropertyByName("u_normalMat"),Cn),Su=j(_t.prototype,"shaderData",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ya(Fr.Renderer)}}),Cu=j(_t.prototype,"isCulled",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Au=j(_t.prototype,"_distanceForSort",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pu=j(_t.prototype,"_onUpdateIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Tu=j(_t.prototype,"_rendererIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Mu=j(_t.prototype,"_globalShaderMacro",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ar}}),Eu=j(_t.prototype,"_transformChangeFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ru=j(_t.prototype,"_bounds",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tn}}),Fu=j(_t.prototype,"_overrideUpdate",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bu=j(_t.prototype,"_materials",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Iu=j(_t.prototype,"_mvMatrix",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),zu=j(_t.prototype,"_mvpMatrix",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),Du=j(_t.prototype,"_mvInvMatrix",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),Lu=j(_t.prototype,"_normalMatrix",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),Ou=j(_t.prototype,"_materialsInstanced",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nu=j(_t.prototype,"_priority",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_t))||bu);function bv(){return function(r){}}var Uu,Vu,ao,ya=(Uu=bv(),Uu(Vu=(ao=function(){function r(){}return r.resetData=function(i){var t=i._renderData,e=t.vertexCount=4,n=t.positions,a=t.uvs;if(n.length<e)for(var s=n.length;s<e;s++)n.push(new y),a.push(new Z);t.triangles=r._rectangleTriangles},r.updatePositions=function(i){var t=i.width,e=i.height,n=i.sprite,a=n.pivot,s=a.x,l=a.y,c=r._worldMatrix,u=c.elements,h=i.entity.transform.worldMatrix.elements,f=i.flipX?-t:t,d=i.flipY?-e:e;u[0]=h[0]*f,u[1]=h[1]*f,u[2]=h[2]*f,u[4]=h[4]*d,u[5]=h[5]*d,u[6]=h[6]*d,u[8]=h[8],u[9]=h[9],u[10]=h[10],u[12]=h[12]-s*u[0]-l*u[4],u[13]=h[13]-s*u[1]-l*u[5],u[14]=h[14]-s*u[2]-l*u[6];for(var _=n._getPositions(),p=i._renderData.positions,v=0;v<4;v++){var g=_[v],m=g.x,x=g.y;p[v].set(u[0]*m+u[4]*x+u[12],u[1]*m+u[5]*x+u[13],u[2]*m+u[6]*x+u[14])}tn.transform(n._getBounds(),c,i._bounds)},r.updateUVs=function(i){var t=i.sprite._getUVs(),e=i._renderData.uvs,n=t[0],a=n.x,s=n.y,l=t[3],c=l.x,u=l.y;e[0].set(a,s),e[1].set(c,s),e[2].set(a,u),e[3].set(c,u)},r}(),ao._rectangleTriangles=[0,1,2,2,1,3],ao._worldMatrix=new ge,ao))||Vu),Ol=function(o,i,t,e,n){e===void 0&&(e=null),n===void 0&&(n=null),this.vertexCount=o,this.positions=i,this.uvs=t,this.triangles=e,this.color=n},Je;(function(r){r[r.texture=1]="texture",r[r.size=2]="size",r[r.atlasRotate=4]="atlasRotate",r[r.atlasRegion=8]="atlasRegion",r[r.atlasRegionOffset=16]="atlasRegionOffset",r[r.region=32]="region",r[r.pivot=64]="pivot",r[r.border=128]="border"})(Je||(Je={}));var ea;(function(r){r[r.Layer0=1]="Layer0",r[r.Layer1=2]="Layer1",r[r.Layer2=4]="Layer2",r[r.Layer3=8]="Layer3",r[r.Layer4=16]="Layer4",r[r.Layer5=32]="Layer5",r[r.Layer6=64]="Layer6",r[r.Layer7=128]="Layer7",r[r.Layer8=256]="Layer8",r[r.Layer9=512]="Layer9",r[r.Layer10=1024]="Layer10",r[r.Layer11=2048]="Layer11",r[r.Layer12=4096]="Layer12",r[r.Layer13=8192]="Layer13",r[r.Layer14=16384]="Layer14",r[r.Layer15=32768]="Layer15",r[r.Layer16=65536]="Layer16",r[r.Layer17=131072]="Layer17",r[r.Layer18=262144]="Layer18",r[r.Layer19=524288]="Layer19",r[r.Layer20=1048576]="Layer20",r[r.Layer21=2097152]="Layer21",r[r.Layer22=4194304]="Layer22",r[r.Layer23=8388608]="Layer23",r[r.Layer24=16777216]="Layer24",r[r.Layer25=33554432]="Layer25",r[r.Layer26=67108864]="Layer26",r[r.Layer27=134217728]="Layer27",r[r.Layer28=268435456]="Layer28",r[r.Layer29=536870912]="Layer29",r[r.Layer30=1073741824]="Layer30",r[r.Layer31=2147483648]="Layer31",r[r.Everything=4294967295]="Everything"})(ea||(ea={}));var Sr,ku,Gu,Hu,Wu,Xu,ju,$u,qu,Yu,oo,Zs=(Sr=(oo=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,X(e,"influenceLayers",ku,N(e)),e._maskElement=void 0,e._renderData=void 0,X(e,"_sprite",Gu,N(e)),X(e,"_width",Hu,N(e)),X(e,"_height",Wu,N(e)),X(e,"_flipX",Xu,N(e)),X(e,"_flipY",ju,N(e)),X(e,"_alphaCutoff",$u,N(e)),X(e,"_dirtyFlag",qu,N(e)),X(e,"_spriteChangeFlag",Yu,N(e)),e._renderData=new Ol(4,[],[]),ya.resetData(N(e)),e.setMaterial(e._engine._spriteMaskDefaultMaterial),e.shaderData.setFloat(o._alphaCutoffProperty,e._alphaCutoff),e._onSpriteChange=e._onSpriteChange.bind(N(e)),e}var i=o.prototype;return i._onDestroy=function(){this._sprite=null,this._renderData=null,this._spriteChangeFlag&&(this._spriteChangeFlag.destroy(),this._spriteChangeFlag=null),r.prototype._onDestroy.call(this)},i._render=function(e){var n;if(!(!((n=this.sprite)!==null&&n!==void 0&&n.texture)||!this.width||!this.height)){(this._transformChangeFlag.flag||this._dirtyFlag&Ot.Position)&&(ya.updatePositions(this),this._dirtyFlag&=~Ot.Position,this._transformChangeFlag.flag=!1),this._dirtyFlag&Ot.UV&&(ya.updateUVs(this),this._dirtyFlag&=~Ot.UV);var a=this._engine._spriteMaskElementPool,s=a.getFromPool();s.setValue(this,this._renderData,this.getMaterial()),e._renderPipeline._allSpriteMasks.add(this),this._maskElement=s}},i._cloneTo=function(e){e.sprite=this._sprite},i._onSpriteChange=function(e){switch(e){case Je.texture:this.shaderData.setTexture(o._textureProperty,this.sprite.texture);break;case Je.region:case Je.atlasRegionOffset:this._dirtyFlag|=Ot.All;break;case Je.atlasRegion:this._dirtyFlag|=Ot.UV;break}},ie(o,[{key:"width",get:function(){return this._width===void 0&&this._sprite&&(this.width=this._sprite.width),this._width},set:function(e){this._width!==e&&(this._width=e,this._dirtyFlag|=Ot.Position)}},{key:"height",get:function(){return this._height===void 0&&this._sprite&&(this.height=this._sprite.height),this._height},set:function(e){this._height!==e&&(this._height=e,this._dirtyFlag|=Ot.Position)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyFlag|=Ot.Position)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyFlag|=Ot.Position)}},{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._spriteChangeFlag&&this._spriteChangeFlag.destroy(),e?(this._spriteChangeFlag=e._registerUpdateFlag(),this._spriteChangeFlag.listener=this._onSpriteChange,this._dirtyFlag|=Ot.All,this.shaderData.setTexture(o._textureProperty,e.texture)):(this._spriteChangeFlag=null,this.shaderData.setTexture(o._textureProperty,null)))}},{key:"alphaCutoff",get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff!==e&&(this._alphaCutoff=e,this.shaderData.setFloat(o._alphaCutoffProperty,e))}},{key:"bounds",get:function(){var e;return!((e=this.sprite)!==null&&e!==void 0&&e.texture)||!this.width||!this.height?Or._defaultBoundingBox:((this._transformChangeFlag.flag||this._dirtyFlag&Ot.Position)&&(ya.updatePositions(this),this._dirtyFlag&=~Ot.Position,this._transformChangeFlag.flag=!1),this._bounds)}}]),o}(Qa),oo._textureProperty=k.getPropertyByName("u_maskTexture"),oo._alphaCutoffProperty=k.getPropertyByName("u_maskAlphaCutoff"),oo),ku=j(Sr.prototype,"influenceLayers",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ea.Everything}}),Gu=j(Sr.prototype,"_sprite",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hu=j(Sr.prototype,"_width",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Wu=j(Sr.prototype,"_height",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Xu=j(Sr.prototype,"_flipX",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ju=j(Sr.prototype,"_flipY",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$u=j(Sr.prototype,"_alphaCutoff",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),qu=j(Sr.prototype,"_dirtyFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Yu=j(Sr.prototype,"_spriteChangeFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sr),Ot;(function(r){r[r.Position=1]="Position",r[r.UV=2]="UV",r[r.All=3]="All"})(Ot||(Ot={}));var fe;(function(r){r[r.Float=0]="Float",r[r.Vector2=1]="Vector2",r[r.Vector3=2]="Vector3",r[r.Vector4=3]="Vector4",r[r.Byte4=4]="Byte4",r[r.UByte4=5]="UByte4",r[r.NormalizedByte4=6]="NormalizedByte4",r[r.NormalizedUByte4=7]="NormalizedUByte4",r[r.Short2=8]="Short2",r[r.UShort2=9]="UShort2",r[r.NormalizedShort2=10]="NormalizedShort2",r[r.NormalizedUShort2=11]="NormalizedUShort2",r[r.Short4=12]="Short4",r[r.UShort4=13]="UShort4",r[r.NormalizedShort4=14]="NormalizedShort4",r[r.NormalizedUShort4=15]="NormalizedUShort4"})(fe||(fe={}));var Rt;(function(r){r[r.Static=0]="Static",r[r.Dynamic=1]="Dynamic",r[r.Stream=2]="Stream"})(Rt||(Rt={}));var gt;(function(r){r[r.UInt8=0]="UInt8",r[r.UInt16=1]="UInt16",r[r.UInt32=2]="UInt32"})(gt||(gt={}));var ka=function(){function r(){}return r._getGLBufferUsage=function(i,t){switch(t){case Rt.Static:return i.STATIC_DRAW;case Rt.Dynamic:return i.DYNAMIC_DRAW;case Rt.Stream:return i.STREAM_DRAW}},r._getGLIndexType=function(i){switch(i){case gt.UInt8:return nt.UNSIGNED_BYTE;case gt.UInt16:return nt.UNSIGNED_SHORT;case gt.UInt32:return nt.UNSIGNED_INT}},r._getGLIndexByteCount=function(i){switch(i){case gt.UInt8:return 1;case gt.UInt16:return 2;case gt.UInt32:return 4}},r._getElementInfo=function(i){var t,e,n=!1;switch(i){case fe.Float:t=1,e=nt.FLOAT;break;case fe.Vector2:t=2,e=nt.FLOAT;break;case fe.Vector3:t=3,e=nt.FLOAT;break;case fe.Vector4:t=4,e=nt.FLOAT;break;case fe.Byte4:t=4,e=nt.BYTE;break;case fe.UByte4:t=4,e=nt.UNSIGNED_BYTE;break;case fe.NormalizedByte4:t=4,e=nt.BYTE,n=!0;break;case fe.NormalizedUByte4:t=4,e=nt.UNSIGNED_BYTE,n=!0;break;case fe.Short2:t=2,e=nt.SHORT;break;case fe.UShort2:t=2,e=nt.UNSIGNED_SHORT;break;case fe.NormalizedShort2:t=2,e=nt.SHORT,n=!0;break;case fe.NormalizedUShort2:t=2,e=nt.UNSIGNED_SHORT,n=!0;break;case fe.Short4:t=4,e=nt.SHORT;break;case fe.UShort4:t=4,e=nt.UNSIGNED_SHORT;break;case fe.NormalizedShort4:t=4,e=nt.SHORT,n=!0;break;case fe.NormalizedUShort4:t=4,e=nt.UNSIGNED_SHORT,n=!0;break}return{size:t,type:e,normalized:n}},r}(),Ve=function(){function r(o,i,t,e,n){n===void 0&&(n=0),this._glElementInfo=void 0,this._semantic=void 0,this._offset=void 0,this._format=void 0,this._bindingIndex=void 0,this._instanceStepRate=void 0,this._semantic=o,this._offset=i,this._format=t,this._bindingIndex=e,this._glElementInfo=ka._getElementInfo(this.format),this._instanceStepRate=Math.floor(n)}return ie(r,[{key:"semantic",get:function(){return this._semantic}},{key:"offset",get:function(){return this._offset},set:function(i){this._offset=i}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex},set:function(i){this._bindingIndex=i}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}}]),r}(),Lr;(function(r){r[r.VertexBuffer=0]="VertexBuffer",r[r.IndexBuffer=1]="IndexBuffer"})(Lr||(Lr={}));var Ga;(function(r){r[r.None=0]="None",r[r.Discard=1]="Discard"})(Ga||(Ga={}));var dn=function(r){ne(o,r);function o(t,e,n,a){var s;a===void 0&&(a=Rt.Static),s=r.call(this,t)||this,s._glBindTarget=void 0,s._glBufferUsage=void 0,s._nativeBuffer=void 0,s._hardwareRenderer=void 0,s._type=void 0,s._byteLength=void 0,s._bufferUsage=void 0,s._engine=t,s._type=e,s._bufferUsage=a;var l=t._hardwareRenderer,c=l.gl,u=ka._getGLBufferUsage(c,a),h=e===Lr.VertexBuffer?c.ARRAY_BUFFER:c.ELEMENT_ARRAY_BUFFER;return s._nativeBuffer=c.createBuffer(),s._hardwareRenderer=l,s._glBufferUsage=u,s._glBindTarget=h,s.bind(),typeof n=="number"?(s._byteLength=n,c.bufferData(h,n,u)):(s._byteLength=n.byteLength,c.bufferData(h,n,u)),c.bindBuffer(h,null),s}var i=o.prototype;return i.bind=function(){var e=this._hardwareRenderer.gl;e.bindBuffer(this._glBindTarget,this._nativeBuffer)},i.setData=function(e,n,a,s,l){n===void 0&&(n=0),a===void 0&&(a=0),l===void 0&&(l=Ga.None);var c=this._hardwareRenderer.gl,u=this._hardwareRenderer.isWebGL2,h=this._glBindTarget;this.bind(),l===Ga.Discard&&c.bufferData(h,this._byteLength,this._glBufferUsage);var f=e.BYTES_PER_ELEMENT||1,d=s?f*s:e.byteLength;if(a!==0||d<e.byteLength){var _=e.byteOffset!==void 0;if(u&&_)c.bufferSubData(h,n,e,a,d/f);else{var p=new Uint8Array(_?e.buffer:e,a*f,d);c.bufferSubData(h,n,p)}}else c.bufferSubData(h,n,e);c.bindBuffer(h,null)},i.getData=function(e,n,a,s){n===void 0&&(n=0),a===void 0&&(a=0);var l=this._hardwareRenderer.isWebGL2;if(l){var c=this._hardwareRenderer.gl;this.bind(),c.getBufferSubData(this._glBindTarget,n,e,a,s)}else throw"Buffer is write-only on WebGL1.0 platforms."},i._onDestroy=function(){var e=this._hardwareRenderer.gl;e.deleteBuffer(this._nativeBuffer),this._nativeBuffer=null,this._hardwareRenderer=null},i.resize=function(e){this.bind();var n=this._hardwareRenderer.gl;n.bufferData(this._glBindTarget,e,this._glBufferUsage),this._byteLength=e},ie(o,[{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),o}(gn),kn;(function(r){r[r.Points=0]="Points",r[r.Lines=1]="Lines",r[r.LineLoop=2]="LineLoop",r[r.LineStrip=3]="LineStrip",r[r.Triangles=4]="Triangles",r[r.TriangleStrip=5]="TriangleStrip",r[r.TriangleFan=6]="TriangleFan"})(kn||(kn={}));var Fo=function(){function r(o,i){this._buffer=void 0,this._format=void 0,this._buffer=o,this._format=i}return ie(r,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),r}(),Nl=function(o,i,t){o===void 0&&(o=0),i===void 0&&(i=0),t===void 0&&(t=kn.Triangles),this.start=void 0,this.count=void 0,this.topology=void 0,this.start=o,this.count=i,this.topology=t},Ul=function(r){ne(o,r);function o(t,e){var n;return n=r.call(this,t)||this,n.name=void 0,n.bounds=new tn,n._vertexElementMap={},n._glIndexType=void 0,n._glIndexByteCount=void 0,n._platformPrimitive=void 0,n._instanceCount=0,n._vertexBufferBindings=[],n._indexBufferBinding=null,n._vertexElements=[],n._enableVAO=!0,n._subMeshes=[],n._updateFlagManager=new Ki,n.name=e,n._platformPrimitive=n._engine._hardwareRenderer.createPlatformPrimitive(N(n)),n}var i=o.prototype;return i.addSubMesh=function(e,n,a){return a===void 0&&(a=kn.Triangles),typeof e=="number"&&(e=new Nl(e,n,a)),this._subMeshes.push(e),e},i.removeSubMesh=function(e){var n=this._subMeshes,a=n.indexOf(e);a!==-1&&n.splice(a,1)},i.clearSubMesh=function(){this._subMeshes.length=0},i.registerUpdateFlag=function(){return this._updateFlagManager.createFlag(qa)},i._clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var n in e)delete e[n]},i._addVertexElement=function(e){var n=e.semantic;this._vertexElementMap[n]=e,this._vertexElements.push(e),this._updateFlagManager.dispatch()},i._setVertexBufferBinding=function(e,n){if(this._getRefCount()>0){var a=this._vertexBufferBindings[e];a&&a._buffer._addRefCount(-1),n._buffer._addRefCount(1)}this._vertexBufferBindings[e]=n},i._draw=function(e,n){this._platformPrimitive.draw(e,n)},i._addRefCount=function(e){r.prototype._addRefCount.call(this,e);for(var n=this._vertexBufferBindings,a=0,s=n.length;a<s;a++)n[a]._buffer._addRefCount(e)},i._onDestroy=function(){this._vertexBufferBindings=null,this._indexBufferBinding=null,this._vertexElements=null,this._vertexElementMap=null,this._platformPrimitive.destroy()},i._setVertexElements=function(e){this._clearVertexElements();for(var n=0,a=e.length;n<a;n++)this._addVertexElement(e[n])},i._setIndexBufferBinding=function(e){e?(this._indexBufferBinding=e,this._glIndexType=ka._getGLIndexType(e.format),this._glIndexByteCount=ka._getGLIndexByteCount(e.format)):(this._indexBufferBinding=null,this._glIndexType=void 0)},ie(o,[{key:"subMesh",get:function(){return this._subMeshes[0]||null}},{key:"subMeshes",get:function(){return this._subMeshes}}]),o}(gn),is=function(){function r(o,i){this._buffer=void 0,this._stride=void 0,this._buffer=o,this._stride=i}return ie(r,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),r}(),vt;(function(r){r[r.Depth=0]="Depth",r[r.DepthStencil=1]="DepthStencil",r[r.Stencil=2]="Stencil",r[r.Depth16=3]="Depth16",r[r.Depth24=4]="Depth24",r[r.Depth32=5]="Depth32",r[r.Depth24Stencil8=6]="Depth24Stencil8",r[r.Depth32Stencil8=7]="Depth32Stencil8"})(vt||(vt={}));var jt;(function(r){r[r.PositiveX=0]="PositiveX",r[r.NegativeX=1]="NegativeX",r[r.PositiveY=2]="PositiveY",r[r.NegativeY=3]="NegativeY",r[r.PositiveZ=4]="PositiveZ",r[r.NegativeZ=5]="NegativeZ"})(jt||(jt={}));var gr;(function(r){r[r.Point=0]="Point",r[r.Bilinear=1]="Bilinear",r[r.Trilinear=2]="Trilinear"})(gr||(gr={}));var se;(function(r){r[r.R8G8B8=0]="R8G8B8",r[r.R8G8B8A8=1]="R8G8B8A8",r[r.R4G4B4A4=2]="R4G4B4A4",r[r.R5G5B5A1=3]="R5G5B5A1",r[r.R5G6B5=4]="R5G6B5",r[r.Alpha8=5]="Alpha8",r[r.LuminanceAlpha=6]="LuminanceAlpha",r[r.R16G16B16A16=7]="R16G16B16A16",r[r.R32G32B32A32=8]="R32G32B32A32",r[r.DXT1=9]="DXT1",r[r.DXT5=10]="DXT5",r[r.ETC1_RGB=11]="ETC1_RGB",r[r.ETC2_RGB=12]="ETC2_RGB",r[r.ETC2_RGBA5=13]="ETC2_RGBA5",r[r.ETC2_RGBA8=14]="ETC2_RGBA8",r[r.PVRTC_RGB2=15]="PVRTC_RGB2",r[r.PVRTC_RGBA2=16]="PVRTC_RGBA2",r[r.PVRTC_RGB4=17]="PVRTC_RGB4",r[r.PVRTC_RGBA4=18]="PVRTC_RGBA4",r[r.ASTC_4x4=19]="ASTC_4x4",r[r.ASTC_5x5=20]="ASTC_5x5",r[r.ASTC_6x6=21]="ASTC_6x6",r[r.ASTC_8x8=22]="ASTC_8x8",r[r.ASTC_10x10=23]="ASTC_10x10",r[r.ASTC_12x12=24]="ASTC_12x12",r[r.Depth=25]="Depth",r[r.DepthStencil=26]="DepthStencil",r[r.Stencil=27]="Stencil",r[r.Depth16=28]="Depth16",r[r.Depth24=29]="Depth24",r[r.Depth32=30]="Depth32",r[r.Depth24Stencil8=31]="Depth24Stencil8",r[r.Depth32Stencil8=32]="Depth32Stencil8"})(se||(se={}));var qt;(function(r){r[r.Clamp=0]="Clamp",r[r.Repeat=1]="Repeat",r[r.Mirror=2]="Mirror"})(qt||(qt={}));var Bo=function(r){ne(o,r);function o(t,e,n,a,s,l){var c;return s===void 0&&(s=vt.Depth),l===void 0&&(l=1),c=r.call(this,t)||this,c._platformRenderTarget=void 0,c._depth=void 0,c._antiAliasing=void 0,c._autoGenerateMipmaps=!0,c._width=void 0,c._height=void 0,c._colorTextures=void 0,c._depthTexture=void 0,c._width=e,c._height=n,c._antiAliasing=l,c._depth=s,a?c._colorTextures=a instanceof Array?a.slice():[a]:c._colorTextures=[],s instanceof Kr&&(c._depthTexture=s),c._platformRenderTarget=t._hardwareRenderer.createPlatformRenderTarget(N(c)),c}var i=o.prototype;return i.getColorTexture=function(e){return e===void 0&&(e=0),this._colorTextures[e]},i.generateMipmaps=function(){if(this._autoGenerateMipmaps){for(var e=this._colorTextures,n=0,a=e.length;n<a;n++){var s=e[n];s.generateMipmaps()}this._depthTexture&&this._depthTexture.generateMipmaps()}},i.destroy=function(){this._platformRenderTarget.destroy(),this._colorTextures.length=0,this._depthTexture=null,this._depth=null},i._setRenderTargetInfo=function(e,n){this._platformRenderTarget.setRenderTargetInfo(e,n)},i._blitRenderTarget=function(){this._platformRenderTarget.blitRenderTarget()},ie(o,[{key:"autoGenerateMipmaps",get:function(){return this._autoGenerateMipmaps},set:function(e){this._autoGenerateMipmaps=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),o}(pn),yr=function(r){ne(o,r);function o(t,e,n,a,s){var l;return a===void 0&&(a=se.R8G8B8A8),s===void 0&&(s=!0),l=r.call(this,t)||this,l._mipmap=s,l._width=e,l._height=n,l._format=a,l._mipmapCount=l._getMipmapCount(),l._platformTexture=t._hardwareRenderer.createPlatformTexture2D(N(l)),l.filterMode=gr.Bilinear,l.wrapModeU=l.wrapModeV=qt.Repeat,l}var i=o.prototype;return i.setPixelBuffer=function(e,n,a,s,l,c){n===void 0&&(n=0),a===void 0&&(a=0),s===void 0&&(s=0),this._platformTexture.setPixelBuffer(e,n,a,s,l,c)},i.setImageSource=function(e,n,a,s,l,c){n===void 0&&(n=0),a===void 0&&(a=!1),s===void 0&&(s=!1),l===void 0&&(l=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,n,a,s,l,c)},i.getPixelBuffer=function(e,n,a,s,l,c){var u=arguments.length;u===1?this._platformTexture.getPixelBuffer(0,0,this._width,this._height,0,e):u===2?this._platformTexture.getPixelBuffer(0,0,this._width>>e,this._height>>e,e,n):u===5?this._platformTexture.getPixelBuffer(e,n,a,s,0,l):u===6&&this._platformTexture.getPixelBuffer(e,n,a,s,l,c)},o}(Kr),Vl=function(r){ne(o,r);function o(t,e,n,a,s,l){var c;return s===void 0&&(s=se.R8G8B8A8),l===void 0&&(l=!0),c=r.call(this,t)||this,c._length=void 0,c._mipmap=l,c._width=e,c._height=n,c._length=a,c._format=s,c._mipmapCount=c._getMipmapCount(),c._platformTexture=t._hardwareRenderer.createPlatformTexture2DArray(N(c)),c.filterMode=gr.Bilinear,c.wrapModeU=c.wrapModeV=qt.Repeat,c}var i=o.prototype;return i.setPixelBuffer=function(e,n,a,s,l,c,u,h){a===void 0&&(a=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,n,a,s,l,c,u,h)},i.setImageSource=function(e,n,a,s,l,c,u){a===void 0&&(a=0),s===void 0&&(s=!1),l===void 0&&(l=!1),c===void 0&&(c=0),u===void 0&&(u=0),this._platformTexture.setImageSource(e,n,a,s,l,c,u)},i.getPixelBuffer=function(e,n,a,s,l,c,u){var h=arguments.length;h===1?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,n):h===2?this._platformTexture.getPixelBuffer(e,0,0,this._width>>n,this._height>>n,n,a):h===5?this._platformTexture.getPixelBuffer(e,n,a,s,l,0,c):h===6&&this._platformTexture.getPixelBuffer(e,n,a,s,l,c,u)},ie(o,[{key:"length",get:function(){return this._length}}]),o}(Kr),tr=function(r){ne(o,r);function o(t,e,n,a){var s;return n===void 0&&(n=se.R8G8B8A8),a===void 0&&(a=!0),s=r.call(this,t)||this,s._mipmap=a,s._width=e,s._height=e,s._format=n,s._mipmapCount=s._getMipmapCount(),s._platformTexture=t._hardwareRenderer.createPlatformTextureCube(N(s)),s.filterMode=gr.Bilinear,s.wrapModeU=s.wrapModeV=qt.Clamp,s}var i=o.prototype;return i.setPixelBuffer=function(e,n,a,s,l,c,u){a===void 0&&(a=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,n,a,s,l,c,u)},i.setImageSource=function(e,n,a,s,l,c,u){a===void 0&&(a=0),s===void 0&&(s=!1),l===void 0&&(l=!1),c===void 0&&(c=0),u===void 0&&(u=0),this._platformTexture.setImageSource(e,n,a,s,l,c,u)},i.getPixelBuffer=function(e,n,a,s,l,c,u){var h=arguments.length;h===2?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,n):h===3?this._platformTexture.getPixelBuffer(e,0,0,this._width>>n,this._height>>n,n,a):h===6?this._platformTexture.getPixelBuffer(e,n,a,s,l,0,c):h===7&&this._platformTexture.getPixelBuffer(e,n,a,s,l,c,u)},o}(Kr),Hn=function(){function r(i,t){this._blendShapeCount=0,this._blendShapes=[],this._blendShapeNames=void 0,this._layoutDirtyListener=new es,this._subDataDirtyFlags=[],this._vertexTexture=void 0,this._vertexBuffers=[],this._vertices=void 0,this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._vertexElementOffset=void 0,this._storeInVertexBufferInfo=[],this._maxCountSingleVertexBuffer=0,this._engine=void 0,this._modelMesh=void 0,this._lastCreateHostInfo=new y(0,0,0),this._canUseTextureStoreData=!0,this._dataTextureInfo=new y,this._engine=i,this._modelMesh=t,this._canUseTextureStoreData=this._engine._hardwareRenderer.capability.canUseFloatTextureBlendShape,this._layoutDirtyListener.listener=this._updateLayoutChange.bind(this)}var o=r.prototype;return o._addBlendShape=function(t){this._blendShapes.push(t),this._blendShapeCount++,t._addLayoutChangeFlag(this._layoutDirtyListener),this._updateLayoutChange(t),this._subDataDirtyFlags.push(t._createSubDataDirtyFlag())},o._clearBlendShapes=function(){this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._blendShapes.length=0,this._blendShapeCount=0,this._layoutDirtyListener.clearFromManagers();for(var t=this._subDataDirtyFlags,e=0,n=t.length;e<n;e++)t[e].destroy();t.length=0},o._updateShaderData=function(t,e){var n=this._blendShapeCount;if(n>0){if(t.enableMacro(r._blendShapeMacro),this._useTextureMode())t.enableMacro(r._blendShapeTextureMacro),t.setTexture(r._blendShapeTextureProperty,this._vertexTexture),t.setVector3(r._blendShapeTextureInfoProperty,this._dataTextureInfo),t.setFloatArray(r._blendShapeWeightsProperty,e.blendShapeWeights);else{var a=this._getVertexBufferModeSupportCount();if(n>a){var s=e._condensedBlendShapeWeights;s||(s=new Float32Array(a),e._condensedBlendShapeWeights=s),this._filterCondensedBlendShapeWeights(e.blendShapeWeights,s),t.setFloatArray(r._blendShapeWeightsProperty,s),this._modelMesh._enableVAO=!1,n=a}else t.setFloatArray(r._blendShapeWeightsProperty,e.blendShapeWeights),this._modelMesh._enableVAO=!0;t.disableMacro(r._blendShapeTextureMacro)}t.enableMacro("OASIS_BLENDSHAPE_COUNT",n.toString()),this._useBlendNormal?t.enableMacro(r._blendShapeNormalMacro):t.disableMacro(r._blendShapeNormalMacro),this._useBlendTangent?t.enableMacro(r._blendShapeTangentMacro):t.disableMacro(r._blendShapeTangentMacro)}else t.disableMacro(r._blendShapeMacro),t.disableMacro("OASIS_BLENDSHAPE_COUNT")},o._useTextureMode=function(){return this._canUseTextureStoreData?this._blendShapeCount>this._getVertexBufferModeSupportCount():!1},o._layoutOrCountChange=function(){var t=this._lastCreateHostInfo;return t.x!==this._blendShapeCount||!!t.y!==this._useBlendNormal||!!t.z!==this._useBlendTangent},o._vertexElementsNeedUpdate=function(){var t=this._getVertexBufferModeSupportCount(),e=this._lastCreateHostInfo;return Math.min(e.x,t)!==Math.min(this._blendShapeCount,t)||!!e.y!==this._useBlendNormal||!!e.z!==this._useBlendTangent},o._needUpdateData=function(){for(var t=this._subDataDirtyFlags,e=0,n=t.length;e<n;e++)if(t[e].flag)return!0;return!1},o._addVertexElements=function(t){var e=0;this._vertexElementOffset=t._vertexElements.length;for(var n=0,a=Math.min(this._blendShapeCount,this._getVertexBufferModeSupportCount());n<a;n++)t._addVertexElement(new Ve("POSITION_BS"+n,e,fe.Vector3,1)),e+=12,this._useBlendNormal&&(t._addVertexElement(new Ve("NORMAL_BS"+n,e,fe.Vector3,1)),e+=12),this._useBlendTangent&&(t._addVertexElement(new Ve("TANGENT_BS"+n,e,fe.Vector3,1)),e+=12)},o._update=function(t,e){var n=this._modelMesh.vertexCount,a=this._useTextureMode(),s=this._layoutOrCountChange()||t;s&&(a?this._createTextureArray(n):this._createVertexBuffers(n,e),this._lastCreateHostInfo.set(this._blendShapeCount,+this._useBlendNormal,+this._useBlendTangent)),this._needUpdateData()&&(a?this._updateTextureArray(n,s):this._updateVertexBuffers(n,s))},o._releaseMemoryCache=function(){for(var t=this._blendShapes,e=t.length,n=new Array(e),a=0;a<e;a++)n[a]=t[a].name;this._blendShapeNames=n,this._layoutDirtyListener.destroy();for(var s=this._subDataDirtyFlags,l=0,c=s.length;l<c;l++)s[l].destroy();this._layoutDirtyListener=null,this._subDataDirtyFlags=null,this._blendShapes=null,this._vertices=null},o._createVertexBuffers=function(t,e){var n=this._engine,a=this._modelMesh,s=this._blendShapeCount,l=this._vertexBuffers,c=this._vertexElementCount*3,u=c*4,h=Math.floor(255/u),f=Math.ceil(s/h),d=c*t*Math.min(h,s);l.length=f,this._vertices=new Float32Array(d),this._maxCountSingleVertexBuffer=h,this._storeInVertexBufferInfo.length=s;for(var _=0;_<f;_++){var p=f-1,v=_===p?s-p*h:h,g=v*u,m=g*t,x=e?Rt.Static:Rt.Dynamic,w=new dn(n,Lr.VertexBuffer,m,x);a._setVertexBufferBinding(_+1,new is(w,g)),l[_]=w}},o._createTextureArray=function(t){var e=this._engine._hardwareRenderer.capability.maxTextureSize,n=this._vertexElementCount,a=n*t,s=1;a>e&&(s=Math.ceil(a/e),a=e);var l=this._vertexTexture,c=this._blendShapes.length;l&&l.destroy(),l=new Vl(this._engine,a,s,c,se.R32G32B32A32,!1),l.filterMode=gr.Point,this._vertices=new Float32Array(c*a*s*4),this._vertexTexture=l,this._dataTextureInfo.set(n,a,s)},o._updateVertexBuffers=function(t,e){for(var n=this._blendShapes,a=this._maxCountSingleVertexBuffer,s=this._vertices,l=this._vertexBuffers,c=this._storeInVertexBufferInfo,u=this._subDataDirtyFlags,h=this._vertexElementCount*3,f=h*4,d=0,_=n.length;d<_;d++){var p=u[d];if(e||p.flag){var v=n[d].frames,g=v.length,m=v[g-1];if(g>0&&m.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";var x=Math.floor(d/a),w=d%a,C=l[x],T=C.byteLength/(t*4),b=w*h,M=c[d];M||(c[d]=M=new Z),M.set(x+1,w*f);for(var I=m,E=I.deltaPositions,B=0;B<t;B++){var S=b+T*B,A=E[B];A&&(s[S]=A.x,s[S+1]=A.y,s[S+2]=A.z)}if(b+=3,this._useBlendNormal){var R=m,D=R.deltaNormals;if(D)for(var z=0;z<t;z++){var U=b+T*z,V=D[z];V&&(s[U]=V.x,s[U+1]=V.y,s[U+2]=V.z)}b+=3}if(this._useBlendTangent){var L=m,J=L.deltaTangents;if(J)for(var oe=0;oe<t;oe++){var le=b+T*oe,te=J[oe];te&&(s[le]=te.x,s[le+1]=te.y,s[le+2]=te.z)}b+=3}(w===a-1||d===_-1)&&C.setData(s,0,0,C.byteLength/4),p.flag=!1}}},o._updateTextureArray=function(t,e){for(var n=this._blendShapes,a=this._vertexTexture,s=this._vertices,l=this._subDataDirtyFlags,c=0,u=n.length;c<u;c++){var h=l[c],f=a.width*a.height*4;if(e||h.flag){var d=n[c].frames,_=d.length,p=d[_-1];if(_>0&&p.deltaPositions.length!==t)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";for(var v=p,g=v.deltaPositions,m=v.deltaNormals,x=v.deltaTangents,w=c*f,C=0;C<t;C++){var T=g[C];if(s[w]=T.x,s[w+1]=T.y,s[w+2]=T.z,w+=4,m){var b=m[C];s[w]=b.x,s[w+1]=b.y,s[w+2]=b.z,w+=4}if(x){var M=x[C];s[w]=M.x,s[w+1]=M.y,s[w+2]=M.z,w+=4}}h.flag=!1}}a.setPixelBuffer(0,s)},o._updateLayoutChange=function(t){var e=this._blendShapeCount>1,n=1,a=t._useBlendShapeNormal,s=t._useBlendShapeTangent;e&&(a&&(a=this._useBlendNormal),s&&(s=this._useBlendTangent)),a&&n++,s&&n++,this._useBlendNormal=a,this._useBlendTangent=s,this._vertexElementCount=n},o._attributeModeUpdateVertexElement=function(t,e,n,a){var s=this._vertexElementOffset+this._vertexElementCount*a,l=e[n],c=l.x,u=l.y,h=t[s];if(h.bindingIndex=c,h.offset=u,this._useBlendNormal){var f=t[++s];u+=12,f.bindingIndex=c,f.offset=u}if(this._useBlendTangent){var d=t[++s];u+=12,d.bindingIndex=c,d.offset=u}},o._getVertexBufferModeSupportCount=function(){return this._useBlendNormal||this._useBlendTangent?4:8},o._filterCondensedBlendShapeWeights=function(t,e){for(var n=e.length,a=this._modelMesh._vertexElements,s=this._storeInVertexBufferInfo,l=Number.POSITIVE_INFINITY,c,u=0,h=Math.min(t.length,this._blendShapeCount);u<h;u++){var f=t[u];if(u<n)this._attributeModeUpdateVertexElement(a,s,u,u),e[u]=f,f<l&&(l=f,c=u);else if(f>l){this._attributeModeUpdateVertexElement(a,s,u,c),e[c]=f,l=Number.POSITIVE_INFINITY;for(var d=0;d<n;d++){var _=e[d];_<l&&(l=_,c=d)}}}},r}();Hn._blendShapeMacro=k.getMacroByName("OASIS_BLENDSHAPE");Hn._blendShapeTextureMacro=k.getMacroByName("OASIS_BLENDSHAPE_TEXTURE");Hn._blendShapeNormalMacro=k.getMacroByName("OASIS_BLENDSHAPE_NORMAL");Hn._blendShapeTangentMacro=k.getMacroByName("OASIS_BLENDSHAPE_TANGENT");Hn._blendShapeWeightsProperty=k.getPropertyByName("u_blendShapeWeights");Hn._blendShapeTextureProperty=k.getPropertyByName("u_blendShapeTexture");Hn._blendShapeTextureInfoProperty=k.getPropertyByName("u_blendShapeTextureInfo");var ur=function(r){ne(o,r);function o(t,e){var n;return n=r.call(this,t)||this,n._blendShapeManager=void 0,n._vertexCount=0,n._accessible=!0,n._verticesFloat32=null,n._verticesUint8=null,n._indices=null,n._indicesFormat=null,n._vertexSlotChanged=!0,n._vertexChangeFlag=0,n._indicesChangeFlag=!1,n._vertexStrideFloat=0,n._lastUploadVertexCount=-1,n._positions=[],n._normals=null,n._colors=null,n._tangents=null,n._uv=null,n._uv1=null,n._uv2=null,n._uv3=null,n._uv4=null,n._uv5=null,n._uv6=null,n._uv7=null,n._boneWeights=null,n._boneIndices=null,n.name=e,n._blendShapeManager=new Hn(t,N(n)),n}var i=o.prototype;return i.setPositions=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._positions=e,this._vertexCount=e.length,this._vertexChangeFlag|=He.Position},i.getPositions=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._positions},i.setNormals=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._normals!=!!e,this._vertexChangeFlag|=He.Normal,this._normals=e},i.getNormals=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._normals},i.setColors=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._colors!=!!e,this._vertexChangeFlag|=He.Color,this._colors=e},i.getColors=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._colors},i.setBoneWeights=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=e!=null,this._vertexChangeFlag|=He.BoneWeight,this._boneWeights=e},i.getBoneWeights=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneWeights},i.setBoneIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._boneIndices!=!!e,this._vertexChangeFlag|=He.BoneIndex,this._boneIndices=e},i.getBoneIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneIndices},i.setTangents=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._tangents!=!!e,this._vertexChangeFlag|=He.Tangent,this._tangents=e},i.getTangents=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._tangents},i.setUVs=function(e,n){var a;if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";switch(n=(a=n)!=null?a:0,n){case 0:this._vertexSlotChanged=!!this._uv!=!!e,this._vertexChangeFlag|=He.UV,this._uv=e;break;case 1:this._vertexSlotChanged=!!this._uv1!=!!e,this._vertexChangeFlag|=He.UV1,this._uv1=e;break;case 2:this._vertexSlotChanged=!!this._uv2!=!!e,this._vertexChangeFlag|=He.UV2,this._uv2=e;break;case 3:this._vertexSlotChanged=!!this._uv3!=!!e,this._vertexChangeFlag|=He.UV3,this._uv3=e;break;case 4:this._vertexSlotChanged=!!this._uv4!=!!e,this._vertexChangeFlag|=He.UV4,this._uv4=e;break;case 5:this._vertexSlotChanged=!!this._uv5!=!!e,this._vertexChangeFlag|=He.UV5,this._uv5=e;break;case 6:this._vertexSlotChanged=!!this._uv6!=!!e,this._vertexChangeFlag|=He.UV6,this._uv6=e;break;case 7:this._vertexSlotChanged=!!this._uv7!=!!e,this._vertexChangeFlag|=He.UV7,this._uv7=e;break;default:throw"The index of channel needs to be in range [0 - 7]."}},i.getUVs=function(e){var n;if(!this._accessible)throw"Not allowed to access data while accessible is false.";switch(e=(n=e)!=null?n:0,e){case 0:return this._uv;case 1:return this._uv1;case 2:return this._uv2;case 3:return this._uv3;case 4:return this._uv4;case 5:return this._uv5;case 6:return this._uv6;case 7:return this._uv7}throw"The index of channel needs to be in range [0 - 7]."},i.setIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._indices!==e&&(this._indices=e,e instanceof Uint8Array?this._indicesFormat=gt.UInt8:e instanceof Uint16Array?this._indicesFormat=gt.UInt16:e instanceof Uint32Array&&(this._indicesFormat=gt.UInt32)),this._indicesChangeFlag=!0},i.getIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._indices},i.addBlendShape=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._blendShapeManager._addBlendShape(e)},i.clearBlendShapes=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._blendShapeManager._clearBlendShapes()},i.getBlendShapeName=function(e){if(this._accessible){var n=this._blendShapeManager._blendShapes;return n[e].name}else return this._blendShapeManager._blendShapeNames[e]},i.uploadData=function(e){var n,a;if(!this._accessible)throw"Not allowed to access data while accessible is false.";var s=this._vertexCount,l=this._updateVertexElements(),c=this._lastUploadVertexCount!==s,u=(n=this._vertexBufferBindings[0])===null||n===void 0?void 0:n._buffer;if(c){u==null||u.destroy();var h=this._vertexStrideFloat,f=h*s,d=new Float32Array(f);this._verticesFloat32=d,this._verticesUint8=new Uint8Array(d.buffer),this._updateVertices(d,!0);var _=new dn(this._engine,Lr.VertexBuffer,d,e?Rt.Static:Rt.Dynamic);this._setVertexBufferBinding(0,new is(_,h*4)),this._lastUploadVertexCount=s}else if(this._vertexChangeFlag&He.All){var p=this._verticesFloat32;this._updateVertices(p,l),u.setData(p)}var v=this._indices,g=(a=this._indexBufferBinding)===null||a===void 0?void 0:a._buffer;if(v)if(!g||v.byteLength!=g.byteLength){g==null||g.destroy();var m=new dn(this._engine,Lr.IndexBuffer,v);this._setIndexBufferBinding(new Fo(m,this._indicesFormat)),this._indicesChangeFlag=!1}else this._indicesChangeFlag&&(g.setData(v),this._indexBufferBinding._format!==this._indicesFormat&&this._setIndexBufferBinding(new Fo(g,this._indicesFormat)),this._indicesChangeFlag=!1);else g&&(g.destroy(),this._setIndexBufferBinding(null));var x=this._blendShapeManager;x._blendShapeCount>0&&x._update(c,e),e&&(this._accessible=!1,this._releaseCache())},i._onDestroy=function(){r.prototype._onDestroy.call(this),this._accessible&&this._releaseCache()},i._updateVertexElements=function(){var e=this._blendShapeManager,n=!e._useTextureMode();if(this._vertexSlotChanged||n&&e._vertexElementsNeedUpdate()){var a=12,s=3;return this._clearVertexElements(),this._addVertexElement(O1),this._normals&&(this._addVertexElement(new Ve("NORMAL",a,fe.Vector3,0)),a+=12,s+=3),this._colors&&(this._addVertexElement(new Ve("COLOR_0",a,fe.Vector4,0)),a+=16,s+=4),this._boneWeights&&(this._addVertexElement(new Ve("WEIGHTS_0",a,fe.Vector4,0)),a+=16,s+=4),this._boneIndices&&(this._addVertexElement(new Ve("JOINTS_0",a,fe.UByte4,0)),a+=4,s+=1),this._tangents&&(this._addVertexElement(new Ve("TANGENT",a,fe.Vector4,0)),a+=16,s+=4),this._uv&&(this._addVertexElement(new Ve("TEXCOORD_0",a,fe.Vector2,0)),a+=8,s+=2),this._uv1&&(this._addVertexElement(new Ve("TEXCOORD_1",a,fe.Vector2,0)),a+=8,s+=2),this._uv2&&(this._addVertexElement(new Ve("TEXCOORD_2",a,fe.Vector2,0)),a+=8,s+=2),this._uv3&&(this._addVertexElement(new Ve("TEXCOORD_3",a,fe.Vector2,0)),a+=8,s+=2),this._uv4&&(this._addVertexElement(new Ve("TEXCOORD_4",a,fe.Vector2,0)),a+=8,s+=2),this._uv5&&(this._addVertexElement(new Ve("TEXCOORD_5",a,fe.Vector2,0)),a+=8,s+=2),this._uv6&&(this._addVertexElement(new Ve("TEXCOORD_6",a,fe.Vector2,0)),a+=8,s+=2),this._uv7&&(this._addVertexElement(new Ve("TEXCOORD_7",a,fe.Vector2,0)),a+=8,s+=2),n&&e._blendShapeCount>0&&e._addVertexElements(this),this._vertexSlotChanged=!1,this._vertexStrideFloat=s,!0}return!1},i._updateVertices=function(e,n){var a=this._vertexStrideFloat,s=this._vertexCount,l=this._positions,c=this._normals,u=this._colors,h=this._vertexChangeFlag,f=this._boneWeights,d=this._boneIndices,_=this._tangents,p=this._uv,v=this._uv1,g=this._uv2,m=this._uv3,x=this._uv4,w=this._uv5,C=this._uv6,T=this._uv7;if(n&&(this._vertexChangeFlag=He.All),h&He.Position)for(var b=0;b<s;b++){var M=a*b,I=l[b];e[M]=I.x,e[M+1]=I.y,e[M+2]=I.z}var E=3;if(c){if(h&He.Normal)for(var B=0;B<s;B++){var S=a*B+E,A=c[B];A&&(e[S]=A.x,e[S+1]=A.y,e[S+2]=A.z)}E+=3}if(u){if(h&He.Color)for(var R=0;R<s;R++){var D=a*R+E,z=u[R];z&&(e[D]=z.r,e[D+1]=z.g,e[D+2]=z.b,e[D+3]=z.a)}E+=4}if(f){if(h&He.BoneWeight)for(var U=0;U<s;U++){var V=a*U+E,L=f[U];L&&(e[V]=L.x,e[V+1]=L.y,e[V+2]=L.z,e[V+3]=L.w)}E+=4}if(d){if(h&He.BoneIndex)for(var J=this._verticesUint8,oe=0;oe<s;oe++){var le=a*oe+E,te=d[oe];if(te){var Ae=le*4;J[Ae]=te.x,J[Ae+1]=te.y,J[Ae+2]=te.z,J[Ae+3]=te.w}}E+=1}if(_){if(h&He.Tangent)for(var Ie=0;Ie<s;Ie++){var G=a*Ie+E,ce=_[Ie];ce&&(e[G]=ce.x,e[G+1]=ce.y,e[G+2]=ce.z,e[G+3]=ce.w)}E+=4}if(p){if(h&He.UV)for(var pe=0;pe<s;pe++){var Pe=a*pe+E,Te=p[pe];Te&&(e[Pe]=Te.x,e[Pe+1]=Te.y)}E+=2}if(v){if(h&He.UV1)for(var Ye=0;Ye<s;Ye++){var P=a*Ye+E,F=v[Ye];F&&(e[P]=F.x,e[P+1]=F.y)}E+=2}if(g){if(h&He.UV2)for(var O=0;O<s;O++){var W=a*O+E,H=g[O];H&&(e[W]=H.x,e[W+1]=H.y)}E+=2}if(m){if(h&He.UV3)for(var Y=0;Y<s;Y++){var ee=a*Y+E,K=m[Y];K&&(e[ee]=K.x,e[ee+1]=K.y)}E+=2}if(x){if(h&He.UV4)for(var q=0;q<s;q++){var $=a*q+E,_e=x[q];_e&&(e[$]=_e.x,e[$+1]=_e.y)}E+=2}if(w){if(h&He.UV5)for(var ue=0;ue<s;ue++){var ve=a*ue+E,ye=w[ue];ye&&(e[ve]=ye.x,e[ve+1]=ye.y)}E+=2}if(C){if(h&He.UV6)for(var we=0;we<s;we++){var Ge=a*we+E,Oe=C[we];Oe&&(e[Ge]=Oe.x,e[Ge+1]=Oe.y)}E+=2}if(T){if(h&He.UV7)for(var Qe=0;Qe<s;Qe++){var ut=a*Qe+E,Ur=T[Qe];Ur&&(e[ut]=Ur.x,e[ut+1]=Ur.y)}E+=2}this._vertexChangeFlag=0},i._releaseCache=function(){this._verticesUint8=null,this._indices=null,this._verticesFloat32=null,this._positions.length=0,this._tangents=null,this._normals=null,this._colors=null,this._uv=null,this._uv1=null,this._uv2=null,this._uv3=null,this._uv4=null,this._uv5=null,this._uv6=null,this._uv7=null,this._blendShapeManager._releaseMemoryCache()},ie(o,[{key:"accessible",get:function(){return this._accessible}},{key:"vertexCount",get:function(){return this._vertexCount}},{key:"blendShapes",get:function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._blendShapeManager._blendShapes}},{key:"blendShapeCount",get:function(){return this._blendShapeManager._blendShapeCount}}]),o}(Ul),O1=new Ve("POSITION",0,fe.Vector3,0),He;(function(r){r[r.Position=1]="Position",r[r.Normal=2]="Normal",r[r.Color=4]="Color",r[r.Tangent=8]="Tangent",r[r.BoneWeight=16]="BoneWeight",r[r.BoneIndex=32]="BoneIndex",r[r.UV=64]="UV",r[r.UV1=128]="UV1",r[r.UV2=256]="UV2",r[r.UV3=512]="UV3",r[r.UV4=1024]="UV4",r[r.UV5=2048]="UV5",r[r.UV6=4096]="UV6",r[r.UV7=8192]="UV7",r[r.All=65535]="All"})(He||(He={}));var Sv=function(r){ne(o,r);function o(i){var t;return t=r.call(this,null)||this,t.name=i,t.inverseBindMatrices=void 0,t.joints=void 0,t.skeleton=void 0,t.inverseBindMatrices=[],t.joints=[],t.skeleton="none",t}return o}(pn),so,Qu,Ju,$n,yi=(so=($n=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,X(e,"_mesh",Qu,N(e)),X(e,"_meshUpdateFlag",Ju,N(e)),e}var i=o.prototype;return i._render=function(e){var n=this._mesh;if(n){if(this._meshUpdateFlag.flag){var a=this.shaderData,s=n._vertexElements;a.disableMacro(o._uvMacro),a.disableMacro(o._uv1Macro),a.disableMacro(o._normalMacro),a.disableMacro(o._tangentMacro),a.disableMacro(o._vertexColorMacro);for(var l=0,c=s.length;l<c;l++){var u=s[l].semantic;switch(u){case"TEXCOORD_0":a.enableMacro(o._uvMacro);break;case"TEXCOORD_1":a.enableMacro(o._uv1Macro);break;case"NORMAL":a.enableMacro(o._normalMacro);break;case"TANGENT":a.enableMacro(o._tangentMacro);break;case"COLOR_0":a.enableMacro(o._vertexColorMacro);break}}this._meshUpdateFlag.flag=!1}for(var h=n.subMeshes,f=e._renderPipeline,d=this._engine._renderElementPool,_=0,p=h.length;_<p;_++){var v=this._materials[_];if(v){var g=d.getFromPool();g.setValue(this,n,h[_],v),f.pushPrimitive(g)}}}else Fe.error("mesh is null.")},i._onDestroy=function(){r.prototype._onDestroy.call(this);var e=this._mesh;e&&!e.destroyed&&(e._addRefCount(-1),this._mesh=null)},i._cloneTo=function(e){e.mesh=this._mesh},i._updateBounds=function(e){var n=this._mesh;if(n){var a=n.bounds,s=this._entity.transform.worldMatrix;tn.transform(a,s,e)}else e.min.set(0,0,0),e.max.set(0,0,0)},i._setMesh=function(e){var n=this._mesh;n&&(n._addRefCount(-1),this._meshUpdateFlag.destroy()),e&&(e._addRefCount(1),this._meshUpdateFlag=e.registerUpdateFlag()),this._mesh=e},ie(o,[{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh!==e&&this._setMesh(e)}}]),o}(Qa),$n._uvMacro=k.getMacroByName("O3_HAS_UV"),$n._uv1Macro=k.getMacroByName("O3_HAS_UV1"),$n._normalMacro=k.getMacroByName("O3_HAS_NORMAL"),$n._tangentMacro=k.getMacroByName("O3_HAS_TANGENT"),$n._vertexColorMacro=k.getMacroByName("O3_HAS_VERTEXCOLOR"),$n),Qu=j(so.prototype,"_mesh",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ju=j(so.prototype,"_meshUpdateFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so),Gr,Ku,Zu,eh,th,rh,nh,ih,ah,Mi,ta=(Gr=(Mi=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,X(e,"matrixPalette",Ku,N(e)),X(e,"jointNodes",Zu,N(e)),X(e,"jointTexture",eh,N(e)),X(e,"_hasInitJoints",th,N(e)),X(e,"_mat",rh,N(e)),X(e,"_useJointTexture",nh,N(e)),e._skin=void 0,X(e,"_blendShapeWeights",ih,N(e)),X(e,"_condensedBlendShapeWeights",ah,N(e)),e._mat=new ge,e._skin=null,e}var i=o.prototype;return i._updateShaderData=function(e){r.prototype._updateShaderData.call(this,e);var n=this.shaderData;!this._useJointTexture&&this.matrixPalette&&n.setFloatArray(o._jointMatrixProperty,this.matrixPalette);var a=this.mesh;a._blendShapeManager._updateShaderData(n,this)},i._initJoints=function(){if(!!this._skin){for(var e=this._skin,n=e.joints,a=[],s=n.length-1;s>=0;s--)a[s]=this.findByNodeName(this.entity,n[s]);this.matrixPalette=new Float32Array(a.length*16),this.jointNodes=a;var l=this.entity.engine._hardwareRenderer;if(!!l){var c=l.renderStates.getParameter(l.gl.MAX_VERTEX_UNIFORM_VECTORS),u=Math.floor((c-30)/4),h=this.shaderData,f=a.length;if(f)if(h.enableMacro("O3_HAS_SKIN"),h.setInt(o._jointCountProperty,f),f>u)l.canIUseMoreJoints?this._useJointTexture=!0:Fe.error("component's joints count("+f+") greater than device's MAX_VERTEX_UNIFORM_VECTORS number "+c+", and don't support jointTexture in this device. suggest joint count less than "+u+".",this);else{var d=Math.max(o._maxJoints,f);o._maxJoints=d,h.disableMacro("O3_USE_JOINT_TEXTURE"),h.enableMacro("O3_JOINTS_NUM",d.toString())}else h.disableMacro("O3_HAS_SKIN")}}},i.findByNodeName=function(e,n){if(!e)return null;var a=e.findByName(n);return a||this.findByNodeName(e.parent,n)},i.update=function(){if(this._hasInitJoints||(this._initJoints(),this._hasInitJoints=!0),this._skin){for(var e=this.jointNodes,n=this._skin.inverseBindMatrices,a=this.matrixPalette,s=this.entity.getInvModelMatrix(),l=this._mat,c=e.length-1;c>=0;c--)l.identity(),e[c]?ge.multiply(e[c].transform.worldMatrix,n[c],l):l.copyFrom(n[c]),ge.multiply(s,l,l),a.set(l.elements,c*16);this._useJointTexture&&this.createJointTexture()}},i.createJointTexture=function(){if(!this.jointTexture){var e=this.engine,n=e._hardwareRenderer;if(!n)return;this.jointTexture=new yr(e,4,this.jointNodes.length,se.R32G32B32A32,!1),this.jointTexture.filterMode=gr.Point,this.shaderData.enableMacro("O3_USE_JOINT_TEXTURE"),this.shaderData.setTexture(o._jointSamplerProperty,this.jointTexture)}this.jointTexture.setPixelBuffer(this.matrixPalette)},i._cloneTo=function(e){r.prototype._cloneTo.call(this,e),this._blendShapeWeights&&(e._blendShapeWeights=this._blendShapeWeights.slice())},i._checkBlendShapeWeightLength=function(){var e=this._mesh,n=e?e.blendShapeCount:0,a=this._blendShapeWeights;if(a){if(a.length!==n){var s=new Float32Array(n);if(n>a.length)s.set(a);else for(var l=0,c=a.length;l<c;l++)a[l]=s[l];this._blendShapeWeights=s}}else this._blendShapeWeights=new Float32Array(n)},ie(o,[{key:"blendShapeWeights",get:function(){return this._checkBlendShapeWeightLength(),this._blendShapeWeights},set:function(e){this._checkBlendShapeWeightLength();var n=this._blendShapeWeights;if(e.length<=n.length)n.set(e);else for(var a=0,s=n.length;a<s;a++)n[a]=e[a]}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin=e}}]),o}(yi),Mi._jointCountProperty=k.getPropertyByName("u_jointCount"),Mi._jointSamplerProperty=k.getPropertyByName("u_jointSampler"),Mi._jointMatrixProperty=k.getPropertyByName("u_jointMatrix"),Mi._maxJoints=0,Mi),Ku=j(Gr.prototype,"matrixPalette",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu=j(Gr.prototype,"jointNodes",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eh=j(Gr.prototype,"jointTexture",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),th=j(Gr.prototype,"_hasInitJoints",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rh=j(Gr.prototype,"_mat",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nh=j(Gr.prototype,"_useJointTexture",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ih=j(Gr.prototype,"_blendShapeWeights",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ah=j(Gr.prototype,"_condensedBlendShapeWeights",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gr),Cv=function(){function r(){}return r.createSphere=function(i,t,e,n){t===void 0&&(t=.5),e===void 0&&(e=18),n===void 0&&(n=!0);var a=new ur(i);e=Math.max(2,Math.floor(e));for(var s=e+1,l=s*s,c=e*e,u=r._generateIndices(i,l,c*6),h=Math.PI,f=h*2,d=1/s,_=1/e,p=new Array(l),v=new Array(l),g=new Array(l),m=0;m<l;++m){var x=m%s,w=m*d|0,C=x*_,T=w*_,b=C*f,M=T*h,I=Math.sin(M),E=-t*Math.cos(b)*I,B=t*Math.cos(M),S=t*Math.sin(b)*I;p[m]=new y(E,B,S),v[m]=new y(E,B,S),g[m]=new Z(C,T)}for(var A=0,R=0;R<c;++R){var D=R%e,z=R*_|0,U=z*s+D,V=U+1,L=U+s,J=L+1;u[A++]=V,u[A++]=U,u[A++]=J,u[A++]=U,u[A++]=L,u[A++]=J}var oe=a.bounds;return oe.min.set(-t,-t,-t),oe.max.set(t,t,t),r._initialize(a,p,v,g,u,n),a},r.createCuboid=function(i,t,e,n,a){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),a===void 0&&(a=!0);var s=new ur(i),l=t/2,c=e/2,u=n/2,h=new Array(24),f=new Array(24),d=new Array(24);h[0]=new y(-l,c,-u),h[1]=new y(l,c,-u),h[2]=new y(l,c,u),h[3]=new y(-l,c,u),f[0]=new y(0,1,0),f[1]=new y(0,1,0),f[2]=new y(0,1,0),f[3]=new y(0,1,0),d[0]=new Z(0,0),d[1]=new Z(1,0),d[2]=new Z(1,1),d[3]=new Z(0,1),h[4]=new y(-l,-c,-u),h[5]=new y(l,-c,-u),h[6]=new y(l,-c,u),h[7]=new y(-l,-c,u),f[4]=new y(0,-1,0),f[5]=new y(0,-1,0),f[6]=new y(0,-1,0),f[7]=new y(0,-1,0),d[4]=new Z(0,1),d[5]=new Z(1,1),d[6]=new Z(1,0),d[7]=new Z(0,0),h[8]=new y(-l,c,-u),h[9]=new y(-l,c,u),h[10]=new y(-l,-c,u),h[11]=new y(-l,-c,-u),f[8]=new y(-1,0,0),f[9]=new y(-1,0,0),f[10]=new y(-1,0,0),f[11]=new y(-1,0,0),d[8]=new Z(0,0),d[9]=new Z(1,0),d[10]=new Z(1,1),d[11]=new Z(0,1),h[12]=new y(l,c,-u),h[13]=new y(l,c,u),h[14]=new y(l,-c,u),h[15]=new y(l,-c,-u),f[12]=new y(1,0,0),f[13]=new y(1,0,0),f[14]=new y(1,0,0),f[15]=new y(1,0,0),d[12]=new Z(1,0),d[13]=new Z(0,0),d[14]=new Z(0,1),d[15]=new Z(1,1),h[16]=new y(-l,c,u),h[17]=new y(l,c,u),h[18]=new y(l,-c,u),h[19]=new y(-l,-c,u),f[16]=new y(0,0,1),f[17]=new y(0,0,1),f[18]=new y(0,0,1),f[19]=new y(0,0,1),d[16]=new Z(0,0),d[17]=new Z(1,0),d[18]=new Z(1,1),d[19]=new Z(0,1),h[20]=new y(-l,c,-u),h[21]=new y(l,c,-u),h[22]=new y(l,-c,-u),h[23]=new y(-l,-c,-u),f[20]=new y(0,0,-1),f[21]=new y(0,0,-1),f[22]=new y(0,0,-1),f[23]=new y(0,0,-1),d[20]=new Z(1,0),d[21]=new Z(0,0),d[22]=new Z(0,1),d[23]=new Z(1,1);var _=new Uint16Array(36);_[0]=0,_[1]=2,_[2]=1,_[3]=2,_[4]=0,_[5]=3,_[6]=4,_[7]=6,_[8]=7,_[9]=6,_[10]=4,_[11]=5,_[12]=8,_[13]=10,_[14]=9,_[15]=10,_[16]=8,_[17]=11,_[18]=12,_[19]=14,_[20]=15,_[21]=14,_[22]=12,_[23]=13,_[24]=16,_[25]=18,_[26]=17,_[27]=18,_[28]=16,_[29]=19,_[30]=20,_[31]=22,_[32]=23,_[33]=22,_[34]=20,_[35]=21;var p=s.bounds;return p.min.set(-l,-c,-u),p.max.set(l,c,u),r._initialize(s,h,f,d,_,a),s},r.createPlane=function(i,t,e,n,a,s){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),a===void 0&&(a=1),s===void 0&&(s=!0);var l=new ur(i);n=Math.max(1,Math.floor(n)),a=Math.max(1,Math.floor(a));for(var c=n+1,u=a+1,h=t/2,f=e/2,d=t/n,_=e/a,p=c*u,v=a*n,g=r._generateIndices(i,p,v*6),m=1/c,x=1/n,w=1/a,C=new Array(p),T=new Array(p),b=new Array(p),M=0;M<p;++M){var I=M%c,E=M*m|0;C[M]=new y(I*d-h,0,E*_-f),T[M]=new y(0,1,0),b[M]=new Z(I*x,E*w)}for(var B=0,S=0;S<v;++S){var A=S%n,R=S*x|0,D=R*c+A,z=D+1,U=D+c,V=U+1;g[B++]=D,g[B++]=U,g[B++]=z,g[B++]=U,g[B++]=V,g[B++]=z}var L=l.bounds;return L.min.set(-h,0,-f),L.max.set(h,0,f),r._initialize(l,C,T,b,g,s),l},r.createCylinder=function(i,t,e,n,a,s,l){t===void 0&&(t=.5),e===void 0&&(e=.5),n===void 0&&(n=2),a===void 0&&(a=20),s===void 0&&(s=1),l===void 0&&(l=!0);var c=new ur(i);a=Math.floor(a),s=Math.floor(s);for(var u=a+1,h=s+1,f=n*.5,d=n/s,_=u*h,p=a*s,v=a*2,g=_+2+v,m=r._generateIndices(i,g,p*6+v*3),x=1/u,w=1/a,C=1/s,T=new Array(g),b=new Array(g),M=new Array(g),I=0,E=Math.PI,B=Math.PI*2,S=e-t,A=S/n,R=S/s,D=0;D<_;++D){var z=D%u,U=D*x|0,V=z*w,L=U*C,J=E+V*B,oe=Math.sin(J),le=Math.cos(J),te=e-U*R,Ae=te*oe,Ie=U*d-f,G=te*le;T[D]=new y(Ae,Ie,G),b[D]=new y(oe,A,le),M[D]=new Z(V,1-L)}for(var ce=0;ce<p;++ce){var pe=ce%a,Pe=ce*w|0,Te=Pe*u+pe,Ye=Te+1,P=Te+u,F=P+1;m[I++]=Ye,m[I++]=P,m[I++]=Te,m[I++]=Ye,m[I++]=F,m[I++]=P}T[_]=new y(0,-f,0),b[_]=new y(0,-1,0),M[_]=new Z(.5,.5),T[_+1]=new y(0,f,0),b[_+1]=new y(0,1,0),M[_+1]=new Z(.5,.5);for(var O=_+2,W=1/(t*2),H=1/(e*2),Y=u*s,ee=0;ee<a;++ee){var K=T[ee],q=K.x,$=K.z;T[O]=new y(q,-f,$),b[O]=new y(0,-1,0),M[O++]=new Z(q*H+.5,.5-$*H);var _e=T[ee+Y];q=_e.x,$=_e.z,T[O]=new y(q,f,$),b[O]=new y(0,1,0),M[O++]=new Z(q*W+.5,$*W+.5)}for(var ue=_+1,ve=_+2,ye=ve+1,we=0;we<a;++we){var Ge=we*2,Oe=we===a-1?0:Ge+2;m[I++]=_,m[I++]=ve+Oe,m[I++]=ve+Ge,m[I++]=ue,m[I++]=ye+Ge,m[I++]=ye+Oe}var Qe=c.bounds,ut=Math.max(t,e);return Qe.min.set(-ut,-f,-ut),Qe.max.set(ut,f,ut),r._initialize(c,T,b,M,m,l),c},r.createTorus=function(i,t,e,n,a,s,l){t===void 0&&(t=.5),e===void 0&&(e=.1),n===void 0&&(n=30),a===void 0&&(a=30),s===void 0&&(s=360),l===void 0&&(l=!0);var c=new ur(i);n=Math.floor(n),a=Math.floor(a);var u=(n+1)*(a+1),h=n*a,f=r._generateIndices(i,u,h*6),d=new Array(u),_=new Array(u),p=new Array(u);s=s/180*Math.PI;for(var v=0,g=0;g<=n;g++)for(var m=0;m<=a;m++){var x=m/a*s,w=g/n*Math.PI*2,C=Math.cos(w),T=Math.sin(w),b=Math.cos(x),M=Math.sin(x),I=new y((t+e*C)*b,(t+e*C)*M,e*T);d[v]=I;var E=t*b,B=t*M;_[v]=new y(I.x-E,I.y-B,I.z).normalize(),p[v++]=new Z(m/a,g/n)}v=0;for(var S=1;S<=n;S++)for(var A=1;A<=a;A++){var R=(a+1)*S+A-1,D=(a+1)*(S-1)+A-1,z=(a+1)*(S-1)+A,U=(a+1)*S+A;f[v++]=R,f[v++]=D,f[v++]=U,f[v++]=D,f[v++]=z,f[v++]=U}var V=c.bounds,L=t+e;return V.min.set(-L,-L,-e),V.max.set(L,L,e),r._initialize(c,d,_,p,f,l),c},r.createCone=function(i,t,e,n,a,s){t===void 0&&(t=.5),e===void 0&&(e=2),n===void 0&&(n=20),a===void 0&&(a=1),s===void 0&&(s=!0);var l=new ur(i);n=Math.floor(n),a=Math.floor(a);for(var c=n+1,u=a+1,h=e*.5,f=e/a,d=c*u,_=n*a,p=d+1+n,v=r._generateIndices(i,p,_*6+n*3),g=1/c,m=1/n,x=1/a,w=new Array(p),C=new Array(p),T=new Array(p),b=0,M=Math.PI,I=Math.PI*2,E=t/e,B=0;B<d;++B){var S=B%c,A=B*g|0,R=S*m,D=A*x,z=M+R*I,U=Math.sin(z),V=Math.cos(z),L=t-A*t,J=L*U,oe=A*f-h,le=L*V;w[B]=new y(J,oe,le),C[B]=new y(U,E,V),T[B]=new Z(R,1-D)}for(var te=0;te<_;++te){var Ae=te%n,Ie=te*m|0,G=Ie*c+Ae,ce=G+1,pe=G+c,Pe=pe+1;v[b++]=ce,v[b++]=pe,v[b++]=G,v[b++]=ce,v[b++]=Pe,v[b++]=pe}w[d]=new y(0,-h,0),C[d]=new y(0,-1,0),T[d]=new Z(.5,.5);for(var Te=d+1,Ye=1/(t*2),P=0;P<n;++P){var F=w[P],O=F.x,W=F.z;w[Te]=new y(O,-h,W),C[Te]=new y(0,-1,0),T[Te++]=new Z(O*Ye+.5,.5-W*Ye)}for(var H=d+1,Y=0;Y<n;++Y){var ee=Y,K=Y===n-1?0:ee+1;v[b++]=d,v[b++]=H+K,v[b++]=H+ee}var q=l.bounds;return q.min.set(-t,-h,-t),q.max.set(t,h,t),r._initialize(l,w,C,T,v,s),l},r.createCapsule=function(i,t,e,n,a,s){t===void 0&&(t=.5),e===void 0&&(e=2),n===void 0&&(n=6),a===void 0&&(a=1),s===void 0&&(s=!0);var l=new ur(i);n=Math.max(2,Math.floor(n)),a=Math.floor(a);for(var c=n+1,u=a+1,h=e*.5,f=e/a,d=c*u,_=n*a,p=c*c,v=n*n,g=d+2*p,m=r._generateIndices(i,g,(_+2*v)*6),x=1/c,w=1/n,C=1/a,T=Math.PI,b=Math.PI*2,M=new Array(g),I=new Array(g),E=new Array(g),B=0,S=0;S<d;++S){var A=S%c,R=S*x|0,D=A*w,z=R*C,U=T+D*b,V=Math.sin(U),L=Math.cos(U);M[S]=new y(t*V,R*f-h,t*L),I[S]=new y(V,0,L),E[S]=new Z(D,1-z)}for(var J=0;J<_;++J){var oe=J%n,le=J*w|0,te=le*c+oe,Ae=te+1,Ie=te+c,G=Ie+1;m[B++]=Ae,m[B++]=Ie,m[B++]=te,m[B++]=Ae,m[B++]=G,m[B++]=Ie}r._createCapsuleCap(t,e,n,b,d,1,M,I,E,m,B),r._createCapsuleCap(t,e,n,-b,d+p,-1,M,I,E,m,B+6*v);var ce=l.bounds;return ce.min.set(-t,-t-h,-t),ce.max.set(t,t+h,t),r._initialize(l,M,I,E,m,s),l},r._initialize=function(i,t,e,n,a,s){i.setPositions(t),i.setNormals(e),i.setUVs(n),i.setIndices(a),i.uploadData(s),i.addSubMesh(0,a.length)},r._generateIndices=function(i,t,e){var n=null;if(t>65535)if(i._hardwareRenderer.canIUse(he.elementIndexUint))n=new Uint32Array(e);else throw Error("The vertex count is over limit.");else n=new Uint16Array(e);return n},r._createCapsuleCap=function(i,t,e,n,a,s,l,c,u,h,f){for(var d=e+1,_=t*.5*s,p=d*d,v=e*e,g=1/d,m=1/e,x=0;x<p;++x){var w=x%d,C=x*g|0,T=w*m,b=C*m,M=T*n,I=b*Math.PI/2,E=Math.sin(I),B=-i*Math.cos(M)*E,S=i*Math.cos(I)*s+_,A=i*Math.sin(M)*E,R=x+a;l[R]=new y(B,S,A),c[R]=new y(B,S-_,A),u[R]=new Z(T,b)}for(var D=0;D<v;++D){var z=D%e,U=D*m|0,V=U*d+z+a,L=V+1,J=V+d,oe=J+1;h[f++]=L,h[f++]=V,h[f++]=oe,h[f++]=V,h[f++]=J,h[f++]=oe}},r}(),as=function(r){ne(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.setVertexElements=function(e){this._setVertexElements(e)},i.setVertexBufferBinding=function(e,n,a){n===void 0&&(n=0),a===void 0&&(a=0);var s=e,l=s.buffer!==void 0;l||(s=new is(e,n));var c=this._vertexBufferBindings;c.length<=a&&(c.length=a+1),this._setVertexBufferBinding(l?n:a,s)},i.setVertexBufferBindings=function(e,n){n===void 0&&(n=0);var a=this._vertexBufferBindings,s=e.length,l=n+s;a.length<l&&(a.length=l);for(var c=0;c<s;c++)this._setVertexBufferBinding(n+c,e[c])},i.setIndexBufferBinding=function(e,n){var a=e;if(a){var s=a.buffer!==void 0;s||(a=new Fo(e,n))}this._setIndexBufferBinding(a)},ie(o,[{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"vertexBufferBindings",get:function(){return this._vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}},{key:"vertexElements",get:function(){return this._vertexElements}}]),o}(Ul),Av=function(o,i,t,e){if(t===void 0&&(t=null),e===void 0&&(e=null),this.weight=void 0,this.deltaPositions=void 0,this.deltaNormals=void 0,this.deltaTangents=void 0,t&&t.length!==i.length)throw"deltaNormals length must same with deltaPositions length.";if(e&&e.length!==i.length)throw"deltaTangents length must same with deltaPositions length.";this.weight=o,this.deltaPositions=i,this.deltaNormals=t,this.deltaTangents=e},kl=function(){function r(i){this.name=void 0,this._useBlendShapeNormal=!0,this._useBlendShapeTangent=!0,this._layoutChangeManager=new Ki,this._dataChangeManager=new Ki,this._frames=[],this.name=i}var o=r.prototype;return o.addFrame=function(t,e,n,a){if(typeof t=="number"){var s=new Av(t,e,n,a);return this._addFrame(s),s}else this._addFrame(t)},o.clearFrames=function(){this._frames.length=0,this._updateUseNormalAndTangent(!0,!0),this._dataChangeManager.dispatch()},o._addLayoutChangeFlag=function(t){this._layoutChangeManager.addFlag(t)},o._addDataDirtyFlag=function(t){this._dataChangeManager.addFlag(t)},o._createSubDataDirtyFlag=function(){return this._dataChangeManager.createFlag(qa)},o._addFrame=function(t){var e=this._frames,n=e.length;if(n>0&&t.deltaPositions.length!==e[n-1].deltaPositions.length)throw"Frame's deltaPositions length must same with before frame deltaPositions length.";this._frames.push(t),this._updateUseNormalAndTangent(!!t.deltaNormals,!!t.deltaTangents),this._dataChangeManager.dispatch()},o._updateUseNormalAndTangent=function(t,e){var n=this._useBlendShapeNormal&&t,a=this._useBlendShapeTangent&&e;(this._useBlendShapeNormal!==n||this._useBlendShapeTangent!==a)&&(this._useBlendShapeNormal=n,this._useBlendShapeTangent=a,this._layoutChangeManager.dispatch(this))},ie(r,[{key:"frames",get:function(){return this._frames}}]),r}(),os=function(){function r(i){this._engine=void 0,this._subMeshPool=new ci(Nl),this._batchedQueue=[],this._meshes=[],this._meshCount=1,this._vertexBuffers=[],this._indiceBuffers=[],this._vertices=void 0,this._indices=void 0,this._flushId=0,this._vertexCount=0,this._elementCount=0,this._engine=i;var t=r.MAX_VERTEX_COUNT;this._vertices=new Float32Array(t*9),this._indices=new Uint16Array(t*3);for(var e=this._meshes,n=this._meshCount,a=0;a<n;a++)e[a]=this._createMesh(i,a)}var o=r.prototype;return o.drawElement=function(t,e,n){if(t.multiRenderData)for(var a=t.charElements,s=0,l=a.length;s<l;++s)this._drawSubElement(a[s],e,n);else this._drawSubElement(t,e,n)},o._drawSubElement=function(t,e,n){var a=t.renderData.vertexCount;this._vertexCount+a>r.MAX_VERTEX_COUNT&&this.flush(e,n),this._vertexCount+=a,this._batchedQueue[this._elementCount++]=t},o.flush=function(t,e){var n=this._batchedQueue;n.length!==0&&(this._updateData(this._engine),this.drawBatches(t,e),r._canUploadSameBuffer||this._flushId++,n.length=0,this._subMeshPool.resetPool(),this._vertexCount=0,this._elementCount=0)},o.clear=function(){this._flushId=0,this._vertexCount=0,this._elementCount=0,this._batchedQueue.length=0},o.destroy=function(){this._batchedQueue=null;for(var t=this._meshes,e=this._vertexBuffers,n=this._indiceBuffers,a=0,s=t.length;a<s;++a)t[a].destroy();this._meshes=null;for(var l=0,c=e.length;l<c;++l)e[l].destroy();this._vertexBuffers=null;for(var u=0,h=n.length;u<h;++u)n[u].destroy();this._indiceBuffers=null},o._createMesh=function(t,e){var n=r.MAX_VERTEX_COUNT,a=new as(t,"BufferMesh"+e),s=[],l=this.createVertexElements(s);return this._vertexBuffers[e]=new dn(t,Lr.VertexBuffer,n*4*l,Rt.Dynamic),this._indiceBuffers[e]=new dn(t,Lr.IndexBuffer,n*3,Rt.Dynamic),a.setVertexBufferBinding(this._vertexBuffers[e],l),a.setIndexBufferBinding(this._indiceBuffers[e],gt.UInt16),a.setVertexElements(s),a},o._updateData=function(t){var e=this._meshes,n=this._flushId;!r._canUploadSameBuffer&&this._meshCount<=n&&(this._meshCount++,e[n]=this._createMesh(t,n));var a=this._batchedQueue,s=this._vertices,l=this._indices,c=e[n];c.clearSubMesh();for(var u=0,h=0,f=0,d=0,_=0,p=0,v=null,g=0,m=a.length;g<m;g++){var x=a[g];u=this.updateVertices(x,s,u);for(var w=x.renderData.triangles,C=w.length,T=0;T<C;T++)l[h++]=w[T]+_;_+=x.renderData.vertexCount,v===null||this.canBatch(v,x)?d+=C:(c.addSubMesh(this._getSubMeshFromPool(f,d)),f+=d,d=C,a[p++]=v),v=x}c.addSubMesh(this._getSubMeshFromPool(f,d)),a[p]=v,this._vertexBuffers[n].setData(s,0,0,u),this._indiceBuffers[n].setData(l,0,0,h)},o._getSubMeshFromPool=function(t,e){var n=this._subMeshPool.getFromPool();return n.start=t,n.count=e,n.topology=kn.Triangles,n},r}();os.MAX_VERTEX_COUNT=4096;os._canUploadSameBuffer=!0;var N1=function(r){ne(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.createVertexElements=function(e){return e[0]=new Ve("POSITION",0,fe.Vector3,0),e[1]=new Ve("TEXCOORD_0",12,fe.Vector2,0),20},i.canBatch=function(e,n){if(e.isAdd!==n.isAdd)return!1;var a=e.component.shaderData,s=n.component.shaderData,l=Zs._textureProperty,c=Zs._alphaCutoffProperty;return a.getTexture(l)===s.getTexture(l)&&a.getTexture(c)===s.getTexture(c)},i.updateVertices=function(e,n,a){for(var s=e.renderData,l=s.positions,c=s.uvs,u=s.vertexCount,h=0;h<u;h++){var f=l[h],d=c[h];n[a++]=f.x,n[a++]=f.y,n[a++]=f.z,n[a++]=d.x,n[a++]=d.y}return a},i.drawBatches=function(e){for(var n=this._engine,a=this._batchedQueue,s=this._meshes[this._flushId],l=s.subMeshes,c=e.scene.shaderData,u=e.shaderData,h=0,f=l.length;h<f;h++){var d=l[h],_=a[h];if(!d||!_)return;var p=_.component,v=_.material,g=k._compileMacros;ar.unionCollection(p._globalShaderMacro,v.shaderData._macroCollection,g);var m=v.renderState.stencilState,x=_.isAdd?dt.IncrementSaturate:dt.DecrementSaturate;m.passOperationFront=x,m.passOperationBack=x;var w=v.shader._getShaderProgram(n,g);if(!w.isValid)return;w.bind(),w.groupingOtherUniformBlock(),w.uploadAll(w.sceneUniformBlock,c),w.uploadAll(w.cameraUniformBlock,u),w.uploadAll(w.rendererUniformBlock,p.shaderData),w.uploadAll(w.materialUniformBlock,v.shaderData),v.renderState._apply(n,!1),n._hardwareRenderer.drawPrimitive(s,d,w)}},o}(os),U1=function(){function r(i){this._batcher=void 0,this._preMaskLayer=0,this._batcher=new N1(i)}var o=r.prototype;return o.clear=function(){this._preMaskLayer=0,this._batcher.clear()},o.preRender=function(t,e){e.maskInteraction!==pr.None&&(this._batcher.clear(),this._processMasksDiff(t,e),this._batcher.flush(t,null))},o.postRender=function(t){t.maskInteraction!==pr.None&&(this._preMaskLayer=t.maskLayer)},o.destroy=function(){this._batcher.destroy(),this._batcher=null},o._processMasksDiff=function(t,e){var n=this._preMaskLayer,a=e.maskLayer;if(n!==a)for(var s=t._renderPipeline._allSpriteMasks,l=n&a,c=a&~n,u=n&~a,h=s._elements,f=0,d=s.length;f<d;f++){var _=h[f],p=_.influenceLayers;if(!(p&l)){if(p&c){var v=_._maskElement;v.isAdd=!0,this._batcher.drawElement(v,t,null);continue}if(p&u){var g=_._maskElement;g.isAdd=!1,this._batcher.drawElement(g,t,null)}}}},r}(),V1=function(r){ne(o,r);function o(){var i;return i=r.call(this)||this,i.charElements=[],i.multiRenderData=!0,i}return o}(ns),hn;(function(r){r[r.SolidColor=0]="SolidColor",r[r.Sky=1]="Sky",r[r.Texture=2]="Texture"})(hn||(hn={}));var Bn;(function(r){r[r.AspectFitWidth=0]="AspectFitWidth",r[r.AspectFitHeight=1]="AspectFitHeight",r[r.Fill=2]="Fill"})(Bn||(Bn={}));var Pv=function(){this.material=void 0,this.mesh=void 0,this._matrix=new ge},Tv=function(){function r(i){this._engine=i,this.mode=hn.SolidColor,this.solidColor=new me(.25,.25,.25,1),this.sky=new Pv,this._textureFillMode=Bn.AspectFitHeight,this._mesh=void 0,this._texture=null,this._mesh=this._createPlane(i)}var o=r.prototype;return o._resizeBackgroundTexture=function(){if(!!this._texture){var t=this._engine.canvas,e=t.width,n=t.height,a=this._mesh,s=a.getPositions();switch(this._textureFillMode){case Bn.Fill:s[0].set(-1,-1,1),s[1].set(1,-1,1),s[2].set(-1,1,1),s[3].set(1,1,1);break;case Bn.AspectFitWidth:var l=this._texture.height*e/this.texture.width/n;s[0].set(-1,-l,1),s[1].set(1,-l,1),s[2].set(-1,l,1),s[3].set(1,l,1);break;case Bn.AspectFitHeight:var c=this._texture.width*n/this.texture.height/e;s[0].set(-c,-1,1),s[1].set(c,-1,1),s[2].set(-c,1,1),s[3].set(c,1,1);break}a.setPositions(s),a.uploadData(!1)}},o._createPlane=function(t){var e=new ur(t);e.isGCIgnored=!0;for(var n=new Uint8Array([1,2,0,1,3,2]),a=new Array(4),s=new Array(4),l=0;l<4;++l)a[l]=new y,s[l]=new Z(l%2,1-(l*.5|0));return e.setPositions(a),e.setUVs(s),e.setIndices(n),e.uploadData(!1),e.addSubMesh(0,n.length),e},ie(r,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this._engine._backgroundTextureMaterial.shaderData.setTexture("u_baseTexture",t))}},{key:"textureFillMode",get:function(){return this._textureFillMode},set:function(t){t!==this._textureFillMode&&(this._textureFillMode=t,this._resizeBackgroundTexture())}}]),r}(),ra;(function(r){r[r.SolidColor=0]="SolidColor",r[r.SphericalHarmonics=1]="SphericalHarmonics"})(ra||(ra={}));var or=function(){function r(){this._diffuseSphericalHarmonics=void 0,this._diffuseSolidColor=new me(.212,.227,.259),this._diffuseIntensity=1,this._specularTexture=void 0,this._specularIntensity=1,this._diffuseMode=ra.SolidColor,this._shArray=new Float32Array(27),this._scenes=[],this._specularTextureDecodeRGBM=!1}var o=r.prototype;return o._addToScene=function(t){this._scenes.push(t);var e=t.shaderData;e.setColor(r._diffuseColorProperty,this._diffuseSolidColor),e.setFloat(r._diffuseIntensityProperty,this._diffuseIntensity),e.setFloat(r._specularIntensityProperty,this._specularIntensity),e.setFloatArray(r._diffuseSHProperty,this._shArray),this._setDiffuseMode(e),this._setSpecularTextureDecodeRGBM(e),this._setSpecularTexture(e)},o._removeFromScene=function(t){var e=this._scenes,n=e.indexOf(t);e.splice(n,1)},o._setDiffuseMode=function(t){this._diffuseMode===ra.SphericalHarmonics?t.enableMacro(r._shMacro):t.disableMacro(r._shMacro)},o._setSpecularTexture=function(t){this._specularTexture?(t.setTexture(r._specularTextureProperty,this._specularTexture),t.setFloat(r._mipLevelProperty,this._specularTexture.mipmapCount-1),t.enableMacro(r._specularMacro)):t.disableMacro(r._specularMacro)},o._setSpecularTextureDecodeRGBM=function(t){this._specularTextureDecodeRGBM?t.enableMacro(r._decodeRGBMMacro):t.disableMacro(r._decodeRGBMMacro)},o._preComputeSH=function(t,e){var n=t.coefficients;e[0]=n[0]*.886227,e[1]=n[1]*.886227,e[2]=n[2]*.886227,e[3]=n[3]*-1.023327,e[4]=n[4]*-1.023327,e[5]=n[5]*-1.023327,e[6]=n[6]*1.023327,e[7]=n[7]*1.023327,e[8]=n[8]*1.023327,e[9]=n[9]*-1.023327,e[10]=n[10]*-1.023327,e[11]=n[11]*-1.023327,e[12]=n[12]*.858086,e[13]=n[13]*.858086,e[14]=n[14]*.858086,e[15]=n[15]*-.858086,e[16]=n[16]*-.858086,e[17]=n[17]*-.858086,e[18]=n[18]*.247708,e[19]=n[19]*.247708,e[20]=n[20]*.247708,e[21]=n[21]*-.858086,e[22]=n[22]*-.858086,e[23]=n[23]*-.858086,e[24]=n[24]*.429042,e[25]=n[25]*.429042,e[26]=n[26]*.429042},ie(r,[{key:"specularTextureDecodeRGBM",get:function(){return this._specularTextureDecodeRGBM},set:function(t){this._specularTextureDecodeRGBM=t;for(var e=this._scenes,n=0,a=e.length;n<a;n++)this._setSpecularTextureDecodeRGBM(e[n].shaderData)}},{key:"diffuseMode",get:function(){return this._diffuseMode},set:function(t){this._diffuseMode=t;for(var e=this._scenes,n=0,a=e.length;n<a;n++)this._setDiffuseMode(e[n].shaderData)}},{key:"diffuseSolidColor",get:function(){return this._diffuseSolidColor},set:function(t){t!==this._diffuseSolidColor&&this._diffuseSolidColor.copyFrom(t)}},{key:"diffuseSphericalHarmonics",get:function(){return this._diffuseSphericalHarmonics},set:function(t){if(this._diffuseSphericalHarmonics=t,t){this._preComputeSH(t,this._shArray);for(var e=this._scenes,n=0,a=e.length;n<a;n++)e[n].shaderData.setFloatArray(r._diffuseSHProperty,this._shArray)}}},{key:"diffuseIntensity",get:function(){return this._diffuseIntensity},set:function(t){this._diffuseIntensity=t;for(var e=this._scenes,n=0,a=e.length;n<a;n++)e[n].shaderData.setFloat(r._diffuseIntensityProperty,t)}},{key:"specularTexture",get:function(){return this._specularTexture},set:function(t){this._specularTexture=t;for(var e=this._scenes,n=0,a=e.length;n<a;n++)this._setSpecularTexture(e[n].shaderData)}},{key:"specularIntensity",get:function(){return this._specularIntensity},set:function(t){this._specularIntensity=t;for(var e=0,n=this._scenes.length;e<n;e++)this._scenes[e].shaderData.setFloat(r._specularIntensityProperty,t)}}]),r}();or._shMacro=k.getMacroByName("O3_USE_SH");or._specularMacro=k.getMacroByName("O3_USE_SPECULAR_ENV");or._decodeRGBMMacro=k.getMacroByName("O3_DECODE_ENV_RGBM");or._diffuseColorProperty=k.getPropertyByName("u_envMapLight.diffuse");or._diffuseSHProperty=k.getPropertyByName("u_env_sh");or._diffuseIntensityProperty=k.getPropertyByName("u_envMapLight.diffuseIntensity");or._specularTextureProperty=k.getPropertyByName("u_env_specularSampler");or._specularIntensityProperty=k.getPropertyByName("u_envMapLight.specularIntensity");or._mipLevelProperty=k.getPropertyByName("u_envMapLight.mipMapLevel");var Gl=function(){function r(){}var o=r.prototype;return o.preUpdate=function(t){},o.postUpdate=function(t){},o.preRender=function(t,e){},o.postRender=function(t,e){},o.destroy=function(t){},r}(),wt=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t._viewMat=void 0,t._inverseViewMat=void 0,t}var i=o.prototype;return i._onEnable=function(){this.scene.findFeature(xi).attachRenderLight(this)},i._onDisable=function(){this.scene.findFeature(xi).detachRenderLight(this)},ie(o,[{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new ge),ge.invert(this.entity.transform.worldMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._inverseViewMat||(this._inverseViewMat=new ge),ge.invert(this.viewMatrix,this._inverseViewMat),this._inverseViewMat}}]),o}(wr);wt._maxLight=10;var Yt=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.color=new me(1,1,1,1),t.intensity=1,t._forward=new y,t._lightColor=new me(1,1,1,1),t._reverseDirection=new y,t}o._updateShaderData=function(e){var n=o._combinedData;e.setFloatArray(o._colorProperty,n.color),e.setFloatArray(o._directionProperty,n.direction)};var i=o.prototype;return i._appendData=function(e){var n=e*3,a=e*3,s=this.lightColor,l=this.direction,c=o._combinedData;c.color[n]=s.r,c.color[n+1]=s.g,c.color[n+2]=s.b,c.direction[a]=l.x,c.direction[a+1]=l.y,c.direction[a+2]=l.z},ie(o,[{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}},{key:"reverseDirection",get:function(){return y.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}}]),o}(wt);Yt._colorProperty=k.getPropertyByName("u_directLightColor");Yt._directionProperty=k.getPropertyByName("u_directLightDirection");Yt._combinedData={color:new Float32Array(3*wt._maxLight),direction:new Float32Array(3*wt._maxLight)};var xr=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.color=new me(1,1,1,1),t.intensity=1,t.distance=100,t._lightColor=new me(1,1,1,1),t}o._updateShaderData=function(e){var n=o._combinedData;e.setFloatArray(o._colorProperty,n.color),e.setFloatArray(o._positionProperty,n.position),e.setFloatArray(o._distanceProperty,n.distance)};var i=o.prototype;return i._appendData=function(e){var n=e*3,a=e*3,s=e,l=this.lightColor,c=this.position,u=o._combinedData;u.color[n]=l.r,u.color[n+1]=l.g,u.color[n+2]=l.b,u.position[a]=c.x,u.position[a+1]=c.y,u.position[a+2]=c.z,u.distance[s]=this.distance},ie(o,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),o}(wt);xr._colorProperty=k.getPropertyByName("u_pointLightColor");xr._positionProperty=k.getPropertyByName("u_pointLightPosition");xr._distanceProperty=k.getPropertyByName("u_pointLightDistance");xr._combinedData={color:new Float32Array(3*wt._maxLight),position:new Float32Array(3*wt._maxLight),distance:new Float32Array(wt._maxLight)};var Ht=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.color=new me(1,1,1,1),t.intensity=1,t.distance=100,t.angle=Math.PI/6,t.penumbra=Math.PI/12,t._forward=new y,t._lightColor=new me(1,1,1,1),t._inverseDirection=new y,t}o._updateShaderData=function(e){var n=o._combinedData;e.setFloatArray(o._colorProperty,n.color),e.setFloatArray(o._positionProperty,n.position),e.setFloatArray(o._directionProperty,n.direction),e.setFloatArray(o._distanceProperty,n.distance),e.setFloatArray(o._angleCosProperty,n.angleCos),e.setFloatArray(o._penumbraCosProperty,n.penumbraCos)};var i=o.prototype;return i._appendData=function(e){var n=e*3,a=e*3,s=e*3,l=e,c=e,u=e,h=this.lightColor,f=this.position,d=this.direction,_=o._combinedData;_.color[n]=h.r,_.color[n+1]=h.g,_.color[n+2]=h.b,_.position[a]=f.x,_.position[a+1]=f.y,_.position[a+2]=f.z,_.direction[s]=d.x,_.direction[s+1]=d.y,_.direction[s+2]=d.z,_.distance[l]=this.distance,_.angleCos[u]=Math.cos(this.angle),_.penumbraCos[c]=Math.cos(this.angle+this.penumbra)},ie(o,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"reverseDirection",get:function(){return y.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),o}(wt);Ht._colorProperty=k.getPropertyByName("u_spotLightColor");Ht._positionProperty=k.getPropertyByName("u_spotLightPosition");Ht._directionProperty=k.getPropertyByName("u_spotLightDirection");Ht._distanceProperty=k.getPropertyByName("u_spotLightDistance");Ht._angleCosProperty=k.getPropertyByName("u_spotLightAngleCos");Ht._penumbraCosProperty=k.getPropertyByName("u_spotLightPenumbraCos");Ht._combinedData={color:new Float32Array(3*wt._maxLight),position:new Float32Array(3*wt._maxLight),direction:new Float32Array(3*wt._maxLight),distance:new Float32Array(wt._maxLight),angleCos:new Float32Array(wt._maxLight),penumbraCos:new Float32Array(wt._maxLight)};function k1(){return this.findFeature(xi).visibleLights.length>0}var xi=function(r){ne(o,r);function o(){var t;return t=r.call(this)||this,t.visibleLights=void 0,t.visibleLights=[],t}var i=o.prototype;return i.attachRenderLight=function(e){var n=this.visibleLights.indexOf(e);n==-1?this.visibleLights.push(e):Fe.warn("Light already attached.")},i.detachRenderLight=function(e){var n=this.visibleLights.indexOf(e);n!=-1&&this.visibleLights.splice(n,1)},i._updateShaderData=function(e){for(var n=0,a=0,s=0,l=this.visibleLights,c=0,u=l.length;c<u;c++){var h=l[c];h instanceof Yt?h._appendData(n++):h instanceof xr?h._appendData(a++):h instanceof Ht&&h._appendData(s++)}n?(Yt._updateShaderData(e),e.enableMacro("O3_DIRECT_LIGHT_COUNT",n.toString())):e.disableMacro("O3_DIRECT_LIGHT_COUNT"),a?(xr._updateShaderData(e),e.enableMacro("O3_POINT_LIGHT_COUNT",a.toString())):e.disableMacro("O3_POINT_LIGHT_COUNT"),s?(Ht._updateShaderData(e),e.enableMacro("O3_SPOT_LIGHT_COUNT",s.toString())):e.disableMacro("O3_SPOT_LIGHT_COUNT")},o}(Gl),Zr=function(r){ne(o,r);function o(t,e){var n;n=r.call(this,t)||this,n.name=void 0,n.background=new Tv(n._engine),n.shaderData=new Ya(Fr.Scene),n._activeCameras=[],n._isActiveInEngine=!1,n._globalShaderMacro=new ar,n._rootEntities=[],n._ambientLight=void 0,n.features=[],n.name=e||"";var a=n.shaderData;return o.sceneFeatureManager.addObject(N(n)),a._addRefCount(1),n.ambientLight=new or,t.sceneManager._allScenes.push(N(n)),n}var i=o.prototype;return i.createRootEntity=function(e){var n=new Qr(this._engine,e);return this.addRootEntity(n),n},i.addRootEntity=function(e,n){var a;typeof e=="number"?a=e:(a=void 0,n=e);var s=n._isRoot;s||(n._isRoot=!0,n._removeFromParent());var l=n._scene;l!==this?(l&&s&&l._removeFromEntityList(n),this._addToRootEntityList(a,n),Qr._traverseSetOwnerScene(n,this)):s||this._addToRootEntityList(a,n),this._isActiveInEngine?!n._isActiveInHierarchy&&n._isActive&&n._processActive():n._isActiveInHierarchy&&n._processInActive()},i.removeRootEntity=function(e){e._isRoot&&e._scene==this&&(this._removeFromEntityList(e),e._isRoot=!1,this._isActiveInEngine&&e._isActiveInHierarchy&&e._processInActive(),Qr._traverseSetOwnerScene(e,null))},i.getRootEntity=function(e){return e===void 0&&(e=0),this._rootEntities[e]},i.findEntityByName=function(e){for(var n=this._rootEntities,a=n.length-1;a>=0;a--){var s=n[a];if(s.name===e)return s}for(var l=n.length-1;l>=0;l--){var c=n[l],u=c.findByName(e);if(u)return u}return null},i.findEntityByPath=function(e){for(var n=e.split("/").filter(Boolean),a=0,s=this.rootEntitiesCount;a<s;a++){var l=this.getRootEntity(a);if(l.name==n[0]){for(var c=1,u=n.length;c<u&&(l=Qr._findChildByName(l,n[c]),!!l);++c);return l}}return null},i.destroy=function(){if(!this._destroyed){this._destroy();var e=this.engine.sceneManager._allScenes;e.splice(e.indexOf(this),1)}},i._attachRenderCamera=function(e){var n=this._activeCameras.indexOf(e);n===-1?this._activeCameras.push(e):Fe.warn("Camera already attached.")},i._detachRenderCamera=function(e){var n=this._activeCameras.indexOf(e);n!==-1&&this._activeCameras.splice(n,1)},i._processActive=function(e){this._isActiveInEngine=e;for(var n=this._rootEntities,a=n.length-1;a>=0;a--){var s=n[a];s._isActive&&(e?s._processActive():s._processInActive())}},i._updateShaderData=function(){this.findFeature(xi)._updateShaderData(this.shaderData),ar.unionCollection(this.engine._macroCollection,this.shaderData._macroCollection,this._globalShaderMacro)},i._removeFromEntityList=function(e){var n=this._rootEntities,a=e._siblingIndex;n.splice(a,1);for(var s=n.length;a<s;a++)n[a]._siblingIndex--;e._siblingIndex=-1},i._destroy=function(){this._isActiveInEngine&&(this._engine.sceneManager.activeScene=null),o.sceneFeatureManager.callFeatureMethod(this,"destroy",[this]);for(var e=0,n=this.rootEntitiesCount;e<n;e++)this._rootEntities[e].destroy();this._rootEntities.length=0,this._activeCameras.length=0,o.sceneFeatureManager._objects=[],this.shaderData._addRefCount(-1)},i._addToRootEntityList=function(e,n){var a=this._rootEntities,s=a.length;if(e===void 0)n._siblingIndex=s,a.push(n);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;n._siblingIndex=e,a.splice(e,0,n);for(var l=e+1,c=s+1;l<c;l++)a[l]._siblingIndex++}},o.registerFeature=function(e){o.sceneFeatureManager.registerFeature(e)},i.findFeature=function(e){return o.sceneFeatureManager.findFeature(this,e)},ie(o,[{key:"ambientLight",get:function(){return this._ambientLight},set:function(e){if(!e){Fe.warn("The scene must have one ambient light");return}var n=this._ambientLight;n!==e&&(n&&n._removeFromScene(this),e._addToScene(this),this._ambientLight=e)}},{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}}]),o}(pn);Zr.sceneFeatureManager=new fv;var Mv=function(){function r(i){this.engine=i,this._allScenes=[],this._activeScene=void 0}var o=r.prototype;return o.loadScene=function(t,e){var n=this;e===void 0&&(e=!0);var a=this.engine.resourceManager.load(t);return a.then(function(s){var l=n._activeScene;n.activeScene=s,l&&e&&l.destroy()}),a},o.mergeScenes=function(t,e){for(var n=t.rootEntities,a=0,s=n.length;a<s;a++)e.addRootEntity(n[a])},o._destroyAllScene=function(){for(var t=this._allScenes,e=0,n=t.length;e<n;e++)t[e]._destroy();t.length=0},ie(r,[{key:"activeScene",get:function(){return this._activeScene},set:function(t){var e=this._activeScene;e!==t&&(e&&e._processActive(!1),t&&t._processActive(!0),this._activeScene=t)}}]),r}(),G1=`#define GLSLIFY 1
#include <common>
#include <common_frag>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <mobile_material_frag>
#include <fog_share>
#include <normal_get>
void main(){
#include <begin_mobile_frag>
#include <begin_viewdir_frag>
#include <mobile_blinnphong_frag>
gl_FragColor=emission+ambient+diffuse+specular;gl_FragColor.a=diffuse.a;
#ifndef OASIS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
#include <fog_frag>
}`,H1=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <shadow_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <shadow_vert>
#include <position_vert>
#include <fog_vert>
}`,W1=`#define GLSLIFY 1
varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;uniform sampler2D u_texture;void main(){if(v_lifeLeft==1.0){discard;}float alphaFactor=1.0;
#ifdef fadeIn
float fadeInFactor=step(0.5,v_lifeLeft);alphaFactor=2.0*fadeInFactor*(1.0-v_lifeLeft)+(1.0-fadeInFactor);
#endif
#ifdef fadeOut
float fadeOutFactor=step(0.5,v_lifeLeft);alphaFactor=alphaFactor*2.0*(1.0-fadeOutFactor)*v_lifeLeft+alphaFactor*fadeOutFactor;
#endif
#ifdef particleTexture
vec4 tex=texture2D(u_texture,v_uv);
#ifdef useOriginColor
gl_FragColor=vec4(tex.rgb,alphaFactor*tex.a*v_color.w);
#else
gl_FragColor=vec4(v_color.xyz*tex.rgb,alphaFactor*tex.a*v_color.w);
#endif
#else
gl_FragColor=vec4(v_color.xyz,alphaFactor*v_color.w);
#endif
}`,X1=`#define GLSLIFY 1
attribute vec3 a_position;attribute vec3 a_velocity;attribute vec3 a_acceleration;attribute vec4 a_color;attribute vec4 a_lifeAndSize;attribute vec2 a_rotation;attribute vec3 a_uv;attribute vec2 a_normalizedUv;uniform float u_time;uniform bool u_once;uniform mat4 u_MVPMat;varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;
#ifdef is2d
uniform mat4 u_viewInvMat;uniform mat4 u_projMat;uniform mat4 u_viewMat;uniform mat4 u_modelMat;
#endif
mat2 rotation2d(float angle){float s=sin(angle);float c=cos(angle);return mat2(c,-s,s,c);}void main(){v_color=a_color;v_uv=a_uv.xy;float life=a_lifeAndSize.y;float startTime=a_lifeAndSize.x;float deltaTime=max(mod(u_time-startTime,life),0.0);if((u_once&&u_time>life+startTime)){deltaTime=0.0;}v_lifeLeft=1.0-deltaTime/life;float scale=a_lifeAndSize.z;vec3 position=a_position+(a_velocity+a_acceleration*deltaTime*0.5)*deltaTime;
#ifdef isScaleByLifetime
scale*=v_lifeLeft;
#else
scale*=pow(a_lifeAndSize.w,deltaTime);
#endif
#ifdef rotateToVelocity
vec3 v=a_velocity+a_acceleration*deltaTime;float angle=atan(v.z,v.x)*2.0;
#else
float deltaAngle=deltaTime*a_rotation.y;float angle=a_rotation.x+deltaAngle;
#endif
#ifdef is2d
vec2 rotatedPoint=rotation2d(angle)*vec2(a_normalizedUv.x,a_normalizedUv.y*a_uv.z);vec3 basisX=u_viewInvMat[0].xyz;vec3 basisZ=u_viewInvMat[1].xyz;vec3 localPosition=vec3(basisX*rotatedPoint.x+basisZ*rotatedPoint.y)*scale+position;gl_Position=u_projMat*u_viewMat*vec4(localPosition+u_modelMat[3].xyz,1.);
#else
#ifdef rotateToVelocity
float s=sin(angle);float c=cos(angle);
#else
float s=sin(angle);float c=cos(angle);
#endif
vec4 rotatedPoint=vec4((a_normalizedUv.x*c+a_normalizedUv.y*a_uv.z*s)*scale,0.,(a_normalizedUv.x*s-a_normalizedUv.y*a_uv.z*c)*scale,1.);vec4 orientation=vec4(0,0,0,1);vec4 q2=orientation+orientation;vec4 qx=orientation.xxxw*q2.xyzx;vec4 qy=orientation.xyyw*q2.xyzy;vec4 qz=orientation.xxzw*q2.xxzz;mat4 localMatrix=mat4((1.0-qy.y)-qz.z,qx.y+qz.w,qx.z-qy.w,0,qx.y-qz.w,(1.0-qx.x)-qz.z,qy.z+qx.w,0,qx.z+qy.w,qy.z-qx.w,(1.0-qx.x)-qy.y,0,position.x,position.y,position.z,1);rotatedPoint=localMatrix*rotatedPoint;gl_Position=u_MVPMat*rotatedPoint;
#endif
}`,j1=`#define GLSLIFY 1
#define IS_METALLIC_WORKFLOW
#include <common>
#include <common_frag>
#include <fog_share>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <fog_frag>
}`,$1=`#define GLSLIFY 1
#include <common>
#include <common_frag>
#include <fog_share>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <fog_frag>
}`,oh=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <shadow_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <shadow_vert>
#include <position_vert>
#include <fog_vert>
}`,q1=`#define GLSLIFY 1
vec4 pack(float depth){const vec4 bitShift=vec4(1.0,256.0,256.0*256.0,256.0*256.0*256.0);const vec4 bitMask=vec4(1.0/256.0,1.0/256.0,1.0/256.0,0.0);vec4 rgbaDepth=fract(depth*bitShift);rgbaDepth-=rgbaDepth.gbaa*bitMask;return rgbaDepth;}void main(){gl_FragColor=pack(gl_FragCoord.z);}`,sh=`#define GLSLIFY 1
#include <common_vert>
#include <blendShape_input>
#include <normal_share>
#include <shadow_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <shadow_vert>
#include <position_vert>
}`,Y1=`#define GLSLIFY 1
#ifdef O3_SHADOW_MAP_COUNT
uniform float u_shadowBias[O3_SHADOW_MAP_COUNT];uniform float u_shadowIntensity[O3_SHADOW_MAP_COUNT];uniform float u_shadowRadius[O3_SHADOW_MAP_COUNT];uniform vec2 u_shadowMapSize[O3_SHADOW_MAP_COUNT];uniform sampler2D u_shadowMaps[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];const vec4 bitShift=vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0));float unpack(const in vec4 rgbaDepth){return dot(rgbaDepth,bitShift);}float getVisibility(vec4 positionFromLight,const in sampler2D shadowMap,vec2 mapSize,float intensity,float bias,float radius){vec3 shadowCoord=(positionFromLight.xyz/positionFromLight.w)/2.0+0.5;float filterX=step(0.0,shadowCoord.x)*(1.0-step(1.0,shadowCoord.x));float filterY=step(0.0,shadowCoord.y)*(1.0-step(1.0,shadowCoord.y));shadowCoord.z-=bias;vec2 texelSize=vec2(1.0)/mapSize;float visibility=0.0;for(float y=-1.0;y<=1.0;y+=1.0){for(float x=-1.0;x<=1.0;x+=1.0){vec2 uv=shadowCoord.xy+texelSize*vec2(x,y)*radius;vec4 rgbaDepth=texture2D(shadowMap,uv);float depth=unpack(rgbaDepth);visibility+=step(depth,shadowCoord.z)*intensity;}}visibility*=(1.0/9.0);return visibility*filterX*filterY;}
#endif
void main(){vec4 shadowColor=vec4(1.0,1.0,1.0,1.0);
#ifdef O3_SHADOW_MAP_COUNT
float visibility=1.0;
#if (O3_SHADOW_MAP_COUNT == 1)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);
#elif (O3_SHADOW_MAP_COUNT == 2)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);
#elif (O3_SHADOW_MAP_COUNT == 3)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);visibility-=getVisibility(v_PositionFromLight[2],u_shadowMaps[2],u_shadowMapSize[2],u_shadowIntensity[2],u_shadowBias[2],u_shadowRadius[2]);
#endif
visibility=clamp(visibility,0.0,1.0);shadowColor=vec4(visibility,visibility,visibility,1.0);
#endif
gl_FragColor=shadowColor;}`,Q1=`#define GLSLIFY 1
#include <common>
uniform samplerCube u_cube;varying vec3 v_cubeUV;uniform vec4 u_cubeDecodeParam;void main(){vec4 textureColor=textureCube(u_cube,v_cubeUV);if(u_cubeDecodeParam.x>0.0){textureColor=RGBMToLinear(textureColor,u_cubeDecodeParam.y);textureColor=linearToGamma(textureColor);}gl_FragColor=textureColor;}`,J1=`#define GLSLIFY 1
#include <common_vert>
uniform mat4 u_mvpNoscale;varying vec3 v_cubeUV;void main(){v_cubeUV=vec3(-POSITION.x,POSITION.yz);gl_Position=u_mvpNoscale*vec4(POSITION,1.0);gl_Position.z=gl_Position.w;}`,K1=`#define GLSLIFY 1
uniform sampler2D u_maskTexture;uniform float u_maskAlphaCutoff;varying vec2 v_uv;void main(){vec4 color=texture2D(u_maskTexture,v_uv);if(color.a<u_maskAlphaCutoff){discard;}gl_FragColor=color;}`,Z1=`#define GLSLIFY 1
uniform mat4 u_VPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=u_VPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,ex=`#define GLSLIFY 1
#ifdef USE_CUSTOM_TEXTURE
uniform sampler2D u_cusTomTexture;
#else
uniform sampler2D u_spriteTexture;
#endif
varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_CUSTOM_TEXTURE
vec4 baseColor=texture2D(u_cusTomTexture,v_uv);
#else
vec4 baseColor=texture2D(u_spriteTexture,v_uv);
#endif
gl_FragColor=baseColor*v_color;}`,tx=`#define GLSLIFY 1
#ifdef USE_MODEL_MATRIX
uniform mat4 u_MVPMat;
#else
uniform mat4 u_VPMat;
#endif
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;attribute vec4 COLOR_0;varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_MODEL_MATRIX
gl_Position=u_MVPMat*vec4(POSITION,1.0);
#else
gl_Position=u_VPMat*vec4(POSITION,1.0);
#endif
v_uv=TEXCOORD_0;v_color=COLOR_0;}`,rx=`#define GLSLIFY 1
#include <common>
#include <uv_share>
#include <fog_share>
uniform vec4 u_baseColor;uniform float u_alphaCutoff;
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
void main(){vec4 baseColor=u_baseColor;
#ifdef BASETEXTURE
vec4 textureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
textureColor=gammaToLinear(textureColor);
#endif
baseColor*=textureColor;
#endif
#ifdef ALPHA_CUTOFF
if(baseColor.a<u_alphaCutoff){discard;}
#endif
#ifndef OASIS_COLORSPACE_GAMMA
baseColor=linearToGamma(baseColor);
#endif
gl_FragColor=baseColor;
#include <fog_frag>
}`,nx=`#define GLSLIFY 1
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <position_vert>
#include <fog_vert>
}`,ix=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,ax=`#define GLSLIFY 1
uniform sampler2D u_baseTexture;varying vec2 v_uv;void main(){gl_FragColor=texture2D(u_baseTexture,v_uv);}`,ox=function(){function r(){}return r.init=function(){k.create("blinn-phong",H1,G1),k.create("pbr",oh,j1),k.create("pbr-specular",oh,$1),k.create("unlit",nx,rx),k.create("shadow-map",sh,q1),k.create("shadow",sh,Y1),k.create("skybox",J1,Q1),k.create("particle-shader",X1,W1),k.create("SpriteMask",Z1,K1),k.create("Sprite",tx,ex),k.create("background-texture",ix,ax)},r}(),sx=function(){function r(){this._cacheHierarchy=1,this._cacheMap=Object.create(null),this._lastQueryMap=void 0,this._lastQueryKey=void 0}var o=r.prototype;return o.get=function(t){var e=this._cacheMap,n=t._length;n>this._cacheHierarchy&&this._resizeCacheMapHierarchy(e,0,n);for(var a=t._mask,s=t._length-1,l=this._cacheHierarchy-1,c=0;c<l;c++){var u=s<c?0:a[c],h=e[u];h||(e[u]=h=Object.create(null)),e=h}var f=s<l?0:a[l],d=e[f];return d||(this._lastQueryKey=f,this._lastQueryMap=e),d},o.cache=function(t){this._lastQueryMap[this._lastQueryKey]=t},o._resizeCacheMapHierarchy=function(t,e,n){var a=this._cacheHierarchy-1;if(e==a){for(var s in t)for(var l=t[s],c=0,u=n-a;c<u;c++)c==u-1?t[0]=l:t=t[c==0?s:0]=Object.create(null);this._cacheHierarchy=n}else for(var h in t)this._resizeCacheMapHierarchy(t[h],++e,n)},r}(),An=new fv;ox.init();var Or=function(r){ne(o,r);function o(t,e,n){var a;a=r.call(this)||this,a.physicsManager=void 0,a.inputManager=void 0,a._componentsManager=new Fl,a._hardwareRenderer=void 0,a._lastRenderState=new yv,a._renderElementPool=new ci(xv),a._spriteElementPool=new ci(wv),a._spriteMaskElementPool=new ci(L1),a._textElementPool=new ci(V1),a._spriteDefaultMaterial=void 0,a._spriteMaskDefaultMaterial=void 0,a._renderContext=new D1,a._magentaTexture2D=void 0,a._magentaTextureCube=void 0,a._magentaTexture2DArray=void 0,a._magentaMaterial=void 0,a._backgroundTextureMaterial=void 0,a._renderCount=0,a._shaderProgramPools=[],a._spriteMaskManager=void 0,a._canSpriteBatch=!0,a._macroCollection=new ar,a._canvas=void 0,a._settings={},a._resourceManager=new $a(N(a)),a._sceneManager=new Mv(N(a)),a._vSyncCount=1,a._targetFrameRate=60,a._time=new uv,a._isPaused=!0,a._requestId=void 0,a._timeoutId=void 0,a._vSyncCounter=1,a._targetFrameInterval=1e3/60,a._destroyed=!1,a._waittingDestroy=!1,a._animate=function(){a._vSyncCount?(a._requestId=requestAnimationFrame(a._animate),a._vSyncCounter++%a._vSyncCount===0&&(a.update(),a._vSyncCounter=1)):(a._timeoutId=window.setTimeout(a._animate,a._targetFrameInterval),a.update())},a.features=[],a._hardwareRenderer=e,a._hardwareRenderer.init(t),a.physicsManager=new Jt(N(a)),a._canvas=t,An.addObject(N(a)),a._sceneManager.activeScene=new Zr(N(a),"DefaultScene"),a._spriteMaskManager=new U1(N(a)),a._spriteDefaultMaterial=a._createSpriteMaterial(),a._spriteMaskDefaultMaterial=a._createSpriteMaskMaterial(),a.inputManager=new gv(N(a));var s=new Uint8Array([255,0,255,255]),l=new yr(N(a),1,1,se.R8G8B8A8,!1);l.setPixelBuffer(s),l.isGCIgnored=!0;var c=new tr(N(a),1,se.R8G8B8A8,!1);if(c.setPixelBuffer(jt.PositiveX,s),c.setPixelBuffer(jt.NegativeX,s),c.setPixelBuffer(jt.PositiveY,s),c.setPixelBuffer(jt.NegativeY,s),c.setPixelBuffer(jt.PositiveZ,s),c.setPixelBuffer(jt.NegativeZ,s),c.isGCIgnored=!0,a._magentaTexture2D=l,a._magentaTextureCube=c,e.isWebGL2){var u=new Vl(N(a),1,1,1,se.R8G8B8A8,!1);u.setPixelBuffer(0,s),u.isGCIgnored=!0,a._magentaTexture2DArray=u}var h=new Ir(N(a),k.find("unlit"));h.shaderData.setColor("u_baseColor",new me(1,0,1.01,1)),a._magentaMaterial=h;var f=new Ir(N(a),k.find("background-texture"));f.isGCIgnored=!0,f.renderState.depthState.compareFunction=Xe.LessEqual,a._backgroundTextureMaterial=f;var d=(n==null?void 0:n.colorSpace)||Ln.Linear;return d===Ln.Gamma&&a._macroCollection.enable(o._gammaMacro),a._settings.colorSpace=d,a}var i=o.prototype;return i.createEntity=function(e){return new Qr(this,e)},i.pause=function(){this._isPaused=!0,cancelAnimationFrame(this._requestId),clearTimeout(this._timeoutId)},i.resume=function(){!this._isPaused||(this._isPaused=!1,this.time.reset(),this._requestId=requestAnimationFrame(this._animate))},i.update=function(){var e=this._time,n=e.deltaTime;e.tick(),this._renderElementPool.resetPool(),this._spriteElementPool.resetPool(),this._spriteMaskElementPool.resetPool(),this._textElementPool.resetPool(),An.callFeatureMethod(this,"preTick",[this,this._sceneManager._activeScene]);var a=this._sceneManager._activeScene,s=this._componentsManager;a&&(a._activeCameras.sort(function(l,c){return l.priority-c.priority}),s.callScriptOnStart(),this.physicsManager._initialized&&this.physicsManager._update(n/1e3),this.inputManager._update(),s.callScriptOnUpdate(n),s.callAnimationUpdate(n),s.callScriptOnLateUpdate(n),this._render(a)),An.callFeatureMethod(this,"postTick",[this,this._sceneManager._activeScene]),this._waittingDestroy&&this._sceneManager._destroyAllScene(),s.handlingInvalidScripts(),this._waittingDestroy&&this._destroy()},i.run=function(){An.callFeatureMethod(this,"preLoad",[this]),this.resume(),this.trigger(new Js("run",this))},i.destroy=function(){this._destroyed||(this._waittingDestroy=!0)},i._destroy=function(){this._resourceManager._destroy(),this._magentaTexture2D.destroy(!0),this._magentaTextureCube.destroy(!0),this.inputManager._destroy(),this.trigger(new Js("shutdown",this)),An.callFeatureMethod(this,"shutdown",[this]),this.pause(),this._animate=null,this._sceneManager=null,this._resourceManager=null,this._canvas=null,this.features=[],this._time=null,this._spriteMaskManager.destroy(),An._objects=[],this.removeAllEventListeners(),this._waittingDestroy=!1,this._destroyed=!0},i._getShaderProgramPool=function(e){var n=e._shaderId,a=this._shaderProgramPools,s=a[n];if(!s){var l=n+1;l<a.length&&(a.length=l),a[n]=s=new sx}return s},i._render=function(e){var n=e._activeCameras,a=this._componentsManager,s=this.time.deltaTime;if(a.callRendererOnUpdate(s),e._updateShaderData(),n.length>0)for(var l=0,c=n.length;l<c;l++){var u=n[l];a.callCameraOnBeginRender(u),Zr.sceneFeatureManager.callFeatureMethod(e,"preRender",[e,u]),u.render(),Zr.sceneFeatureManager.callFeatureMethod(e,"postRender",[e,u]),a.callCameraOnEndRender(u)}else Fe.debug("NO active camera.")},i._createSpriteMaterial=function(){var e=new Ir(this,k.find("Sprite")),n=e.renderState,a=n.blendState.targetBlendState;return a.enabled=!0,a.sourceColorBlendFactor=xe.SourceAlpha,a.destinationColorBlendFactor=xe.OneMinusSourceAlpha,a.sourceAlphaBlendFactor=xe.One,a.destinationAlphaBlendFactor=xe.OneMinusSourceAlpha,a.colorBlendOperation=a.alphaBlendOperation=er.Add,n.depthState.writeEnabled=!1,n.rasterState.cullMode=nr.Off,e.renderQueueType=xt.Transparent,e.isGCIgnored=!0,e},i._createSpriteMaskMaterial=function(){var e=new Ir(this,k.find("SpriteMask")),n=e.renderState;return n.blendState.targetBlendState.colorWriteMask=Br.None,n.rasterState.cullMode=nr.Off,n.stencilState.enabled=!0,n.depthState.enabled=!1,e.isGCIgnored=!0,e},i.findFeature=function(e){return An.findFeature(this,e)},o.registerFeature=function(e){An.registerFeature(e)},ie(o,[{key:"settings",get:function(){return this._settings}},{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}},{key:"destroyed",get:function(){return this._destroyed}}]),o}(cv);Or._gammaMacro=k.getMacroByName("OASIS_COLORSPACE_GAMMA");Or._pixelsPerUnit=100;Or._defaultBoundingBox=new tn(new y(0,0,0),new y(0,0,0));var lx=function(){function r(){}return r._isIos=function(){if(!window)return!1;var i=window.navigator.userAgent.toLocaleLowerCase();return/iphone|ipad|ipod/.test(i)},ie(r,null,[{key:"devicePixelRatio",get:function(){return window.devicePixelRatio}}]),r}(),cx=function(){function r(){}var o=r.prototype;return o.preLoad=function(t){},o.preTick=function(t,e){},o.postTick=function(t,e){},o.shutdown=function(t){},r}(),Cr,lh,ch,uh,hh,fh,dh,_h,vh,ph,mn=(Cr=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,X(t,"_started",lh,N(t)),X(t,"_onStartIndex",ch,N(t)),X(t,"_onUpdateIndex",uh,N(t)),X(t,"_onLateUpdateIndex",hh,N(t)),X(t,"_onPhysicsUpdateIndex",fh,N(t)),X(t,"_onPreRenderIndex",dh,N(t)),X(t,"_onPostRenderIndex",_h,N(t)),X(t,"_entityScriptsIndex",vh,N(t)),X(t,"_waitHandlingInValid",ph,N(t)),t}var i=o.prototype;return i.onAwake=function(){},i.onEnable=function(){},i.onStart=function(){},i.onUpdate=function(e){},i.onLateUpdate=function(e){},i.onBeginRender=function(e){},i.onEndRender=function(e){},i.onPhysicsUpdate=function(){},i.onTriggerEnter=function(e){},i.onTriggerExit=function(e){},i.onTriggerStay=function(e){},i.onCollisionEnter=function(e){},i.onCollisionExit=function(e){},i.onCollisionStay=function(e){},i.onPointerDown=function(){},i.onPointerUp=function(){},i.onPointerClick=function(){},i.onPointerEnter=function(){},i.onPointerExit=function(){},i.onPointerDrag=function(){},i.onDisable=function(){},i.onDestroy=function(){},i._onAwake=function(){this.onAwake()},i._onEnable=function(){if(this._waitHandlingInValid)this._waitHandlingInValid=!1;else{var e=this.engine._componentsManager,n=o.prototype;this._started||e.addOnStartScript(this),this.onUpdate!==n.onUpdate&&e.addOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.addOnLateUpdateScript(this),this.onPhysicsUpdate!==n.onPhysicsUpdate&&e.addOnPhysicsUpdateScript(this),this._entity._addScript(this)}this.onEnable()},i._onDisable=function(){this._waitHandlingInValid=!0,this._engine._componentsManager.addDisableScript(this),this.onDisable()},i._onDestroy=function(){this._engine._componentsManager.addDestroyScript(this)},i._handlingInValid=function(){var e=this.engine._componentsManager,n=o.prototype;this.onUpdate!==n.onUpdate&&e.removeOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.removeOnLateUpdateScript(this),this.onPhysicsUpdate!==n.onPhysicsUpdate&&e.removeOnPhysicsUpdateScript(this),this._entity._removeScript(this),this._waitHandlingInValid=!1},o}(wr),lh=j(Cr.prototype,"_started",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ch=j(Cr.prototype,"_onStartIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),uh=j(Cr.prototype,"_onUpdateIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),hh=j(Cr.prototype,"_onLateUpdateIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),fh=j(Cr.prototype,"_onPhysicsUpdateIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),dh=j(Cr.prototype,"_onPreRenderIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),_h=j(Cr.prototype,"_onPostRenderIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),vh=j(Cr.prototype,"_entityScriptsIndex",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),ph=j(Cr.prototype,"_waitHandlingInValid",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Cr),ux=0,ui=function(){function r(i,t,e,n,a){i===void 0&&(i="RENDER_PASS"+ux++),t===void 0&&(t=0),e===void 0&&(e=null),n===void 0&&(n=null),a===void 0&&(a=null),this.name=void 0,this.enabled=void 0,this.priority=void 0,this.renderTarget=void 0,this.replaceMaterial=void 0,this.mask=void 0,this.renderOverride=void 0,this.clearFlags=void 0,this.clearColor=void 0,this.name=i,this.enabled=!0,this.priority=t,this.renderTarget=e,this.replaceMaterial=n,this.mask=a||Tt.Everything,this.renderOverride=!1}var o=r.prototype;return o.render=function(t,e,n,a){},o.preRender=function(t,e,n,a){},o.postRender=function(t,e,n,a){},r}(),Ev=function(r){ne(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.createVertexElements=function(e){return e[0]=new Ve("POSITION",0,fe.Vector3,0),e[1]=new Ve("TEXCOORD_0",12,fe.Vector2,0),e[2]=new Ve("COLOR_0",20,fe.Vector4,0),36},i.canBatch=function(e,n){if(!this._engine._canSpriteBatch)return!1;var a=e.component,s=n.component;return!this.checkBatchWithMask(a,s)||e.texture!==n.texture?!1:e.material===n.material},i.checkBatchWithMask=function(e,n){var a=e.maskInteraction;return a!==n.maskInteraction?!1:a===pr.None?!0:e.maskLayer===n.maskLayer},i.updateVertices=function(e,n,a){for(var s=e.renderData,l=s.positions,c=s.uvs,u=s.color,h=s.vertexCount,f=0;f<h;f++){var d=l[f],_=c[f];n[a++]=d.x,n[a++]=d.y,n[a++]=d.z,n[a++]=_.x,n[a++]=_.y,n[a++]=u.r,n[a++]=u.g,n[a++]=u.b,n[a++]=u.a}return a},i.drawBatches=function(e,n){for(var a=this._engine,s=this._batchedQueue,l=this._meshes[this._flushId],c=l.subMeshes,u=a._spriteMaskManager,h=e.scene.shaderData,f=e.shaderData,d=0,_=c.length;d<_;d++){var p=c[d],v=s[d];if(!p||!v)return;var g=v.component,m=v.material;u.preRender(e,g);var x=k._compileMacros;ar.unionCollection(g._globalShaderMacro,m.shaderData._macroCollection,x),(n||m)._preRender(v);var w=(n||m).shader._getShaderProgram(a,x);if(!w.isValid)return;g.shaderData.setTexture(o._textureProperty,v.texture),w.bind(),w.groupingOtherUniformBlock(),w.uploadAll(w.sceneUniformBlock,h),w.uploadAll(w.cameraUniformBlock,f),w.uploadAll(w.rendererUniformBlock,g.shaderData),w.uploadAll(w.materialUniformBlock,m.shaderData),m.renderState._apply(a,!1),a._hardwareRenderer.drawPrimitive(l,p,w),u.postRender(g)}},i.destroy=function(){this._batchedQueue=null;for(var e=this._meshes,n=this._vertexBuffers,a=this._indiceBuffers,s=0,l=e.length;s<l;++s)e[s].destroy();this._meshes=null;for(var c=0,u=n.length;c<u;++c)n[c].destroy();this._vertexBuffers=null;for(var h=0,f=a.length;h<f;++h)a[h].destroy();this._indiceBuffers=null},o}(os);Ev._textureProperty=k.getPropertyByName("u_spriteTexture");var ei=function(){r._compareFromNearToFar=function(t,e){return t.component.priority-e.component.priority||t.component._distanceForSort-e.component._distanceForSort},r._compareFromFarToNear=function(t,e){return t.component.priority-e.component.priority||e.component._distanceForSort-t.component._distanceForSort};function r(i){this.items=[],this._spriteBatcher=void 0,this._spriteBatcher=new Ev(i)}var o=r.prototype;return o.pushPrimitive=function(t){this.items.push(t)},o.render=function(t,e,n){var a=this.items;if(a.length!==0){for(var s=t.engine,l=t.scene,c=s._renderCount,u=s._hardwareRenderer,h=l.shaderData,f=t.shaderData,d=0,_=a.length;d<_;d++){var p=a[d],v=p.component.entity.layer;if(!!(v&n))if(p.mesh){this._spriteBatcher.flush(t,e);var g=k._compileMacros,m=p,x=m.component,w=m.material.destroyed?s._magentaMaterial:m.material,C=x.shaderData,T=w.shaderData;(e||w)._preRender(m),ar.unionCollection(x._globalShaderMacro,T._macroCollection,g);var b=(e||w).shader._getShaderProgram(s,g);if(!b.isValid)continue;var M=b.bind(),I=c!==b._uploadRenderCount;I?(b.groupingOtherUniformBlock(),b.uploadAll(b.sceneUniformBlock,h),b.uploadAll(b.cameraUniformBlock,f),b.uploadAll(b.rendererUniformBlock,C),b.uploadAll(b.materialUniformBlock,T),b.uploadUnGroupTextures(),b._uploadCamera=t,b._uploadRenderer=x,b._uploadMaterial=w,b._uploadRenderCount=c):(b._uploadCamera!==t?(b.uploadAll(b.cameraUniformBlock,f),b._uploadCamera=t):M&&b.uploadTextures(b.cameraUniformBlock,f),b._uploadRenderer!==x?(b.uploadAll(b.rendererUniformBlock,C),b._uploadRenderer=x):M&&b.uploadTextures(b.rendererUniformBlock,C),b._uploadMaterial!==w?(b.uploadAll(b.materialUniformBlock,T),b._uploadMaterial=w):M&&b.uploadTextures(b.materialUniformBlock,T),M&&b.uploadUnGroupTextures()),w.renderState._apply(s,x.entity.transform._isFrontFaceInvert()),u.drawPrimitive(m.mesh,m.subMesh,b)}else{var E=p;this._spriteBatcher.drawElement(E,t,e)}}this._spriteBatcher.flush(t,e)}},o.clear=function(){this.items.length=0,this._spriteBatcher.clear()},o.destroy=function(){this._spriteBatcher.destroy(),this._spriteBatcher=null},o.sort=function(t){this._quickSort(this.items,0,this.items.length,t)},o._quickSort=function(t,e,n,a){for(;;){if(n-e<=10){this._insertionSort(t,e,n,a);return}var s=e+n>>1,l=t[e],c=t[n-1],u=t[s],h=a(l,c);if(h>0){var f=l;l=c,c=f}var d=a(l,u);if(d>=0){var _=l;l=u,u=c,c=_}else{var p=a(c,u);if(p>0){var v=c;c=u,u=v}}t[e]=l,t[n-1]=u;var g=c,m=e+1,x=n-1;t[s]=t[m],t[m]=g;e:for(var w=m+1;w<x;w++){var C=t[w],T=a(C,g);if(T<0)t[w]=t[m],t[m]=C,m++;else if(T>0){do{if(x--,x==w)break e;var b=t[x];T=a(b,g)}while(T>0);t[w]=t[x],t[x]=C,T<0&&(C=t[w],t[w]=t[m],t[m]=C,m++)}}n-x<m-e?(this._quickSort(t,x,n,a),n=m):(this._quickSort(t,e,m,a),e=x)}},o._insertionSort=function(t,e,n,a){for(var s=e+1;s<n;s++){var l=void 0,c=t[s];for(l=s-1;l>=e;l--){var u=t[l],h=a(u,c);if(h>0)t[l+1]=u;else break}t[l+1]=c}},r}(),Rv=function(){function r(i){this._opaqueQueue=void 0,this._transparentQueue=void 0,this._alphaTestQueue=void 0,this._allSpriteMasks=new kt,this._camera=void 0,this._defaultPass=void 0,this._renderPassArray=void 0,this._lastCanvasSize=new Z,this._camera=i;var t=i.engine;this._opaqueQueue=new ei(t),this._alphaTestQueue=new ei(t),this._transparentQueue=new ei(t),this._renderPassArray=[],this._defaultPass=new ui("default",0,null,null,0),this.addRenderPass(this._defaultPass)}var o=r.prototype;return o.addRenderPass=function(t,e,n,a,s){if(e===void 0&&(e=null),n===void 0&&(n=null),a===void 0&&(a=null),s===void 0&&(s=null),typeof t=="string"){var l=new ui(t,e,n,a,s);this._renderPassArray.push(l)}else t instanceof ui&&this._renderPassArray.push(t);this._renderPassArray.sort(function(c,u){return c.priority-u.priority})},o.removeRenderPass=function(t){var e;if(typeof t=="string"?e=this.getRenderPass(t):t instanceof ui&&(e=t),e){var n=this._renderPassArray.indexOf(e);this._renderPassArray.splice(n,1)}},o.getRenderPass=function(t){for(var e=0,n=this._renderPassArray.length;e<n;e++){var a=this._renderPassArray[e];if(a.name===t)return a}return null},o.destroy=function(){this._opaqueQueue.destroy(),this._alphaTestQueue.destroy(),this._transparentQueue.destroy(),this._allSpriteMasks=null,this._renderPassArray=null,this._defaultPass=null,this._camera=null},o.render=function(t,e,n){var a=this._camera,s=this._opaqueQueue,l=this._alphaTestQueue,c=this._transparentQueue;a.engine._spriteMaskManager.clear(),s.clear(),l.clear(),c.clear(),this._allSpriteMasks.length=0,a.engine._componentsManager.callRender(t),s.sort(ei._compareFromNearToFar),l.sort(ei._compareFromNearToFar),c.sort(ei._compareFromFarToNear);for(var u=0,h=this._renderPassArray.length;u<h;u++)this._drawRenderPass(this._renderPassArray[u],a,e,n)},o._drawRenderPass=function(t,e,n,a){if(t.preRender(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue),t.enabled){var s,l,c=e.engine,u=e.scene,h=u.background,f=c._hardwareRenderer,d=e.renderTarget||t.renderTarget;f.activeRenderTarget(d,e,a),d==null||d._setRenderTargetInfo(n,a);var _=(s=t.clearFlags)!=null?s:e.clearFlags,p=(l=t.clearColor)!=null?l:h.solidColor;_!==Dr.None&&f.clearRenderTarget(e.engine,_,p),t.renderOverride?t.render(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue):(this._opaqueQueue.render(e,t.replaceMaterial,t.mask),this._alphaTestQueue.render(e,t.replaceMaterial,t.mask),e.clearFlags&Dr.Color&&(h.mode===hn.Sky?this._drawSky(c,e,h.sky):h.mode===hn.Texture&&h.texture&&this._drawBackgroundTexture(c,h)),this._transparentQueue.render(e,t.replaceMaterial,t.mask)),d==null||d._blitRenderTarget(),d==null||d.generateMipmaps()}t.postRender(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue)},o.pushPrimitive=function(t){switch(t.material.renderQueueType){case xt.Transparent:this._transparentQueue.pushPrimitive(t);break;case xt.AlphaTest:this._alphaTestQueue.pushPrimitive(t);break;case xt.Opaque:this._opaqueQueue.pushPrimitive(t);break}},o._drawBackgroundTexture=function(t,e){var n=t._hardwareRenderer,a=t._backgroundTextureMaterial,s=t.canvas,l=e._mesh;(this._lastCanvasSize.x!==s.width||this._lastCanvasSize.y!==s.height)&&e._textureFillMode!==Bn.Fill&&(this._lastCanvasSize.set(s.width,s.height),e._resizeBackgroundTexture());var c=a.shader._getShaderProgram(t,k._compileMacros);c.bind(),c.uploadAll(c.materialUniformBlock,a.shaderData),c.uploadUnGroupTextures(),a.renderState._apply(t,!1),n.drawPrimitive(l,l.subMesh,c)},o._drawSky=function(t,e,n){var a=n.material,s=n.mesh,l=n._matrix;if(!a){Fe.warn("The material of sky is not defined.");return}if(!s){Fe.warn("The mesh of sky is not defined.");return}var c=t._hardwareRenderer,u=a.shaderData,h=a.shader,f=a.renderState,d=k._compileMacros;ar.unionCollection(e._globalShaderMacro,u._macroCollection,d);var _=e.viewMatrix,p=e.projectionMatrix;l.copyFrom(_);var v=l.elements;v[12]=v[13]=v[14]=0,ge.multiply(p,l,l),u.setMatrix("u_mvpNoscale",l);var g=h._getShaderProgram(t,d);g.bind(),g.groupingOtherUniformBlock(),g.uploadAll(g.materialUniformBlock,u),g.uploadUnGroupTextures(),f._apply(t,!1),c.drawPrimitive(s,s.subMesh,g)},ie(r,[{key:"defaultRenderPass",get:function(){return this._defaultPass}}]),r}(),gh,mh,Wt,yh,xh,wh,bh,Sh,Ch,Ah,Ph,Th,Mh,Eh,Rh,Pn,hi=function(){};hi.tempVec4=new qe;hi.tempVec3=new y;hi.tempVec2=new Z;var wi=(gh=ca(rr),gh(mh=(Wt=(Pn=function(r){ne(o,r);function o(t){var e;e=r.call(this,t)||this,e.shaderData=new Ya(Fr.Camera),e.priority=0,e.enableFrustumCulling=!0,e.clearFlags=Dr.All,e.cullingMask=Tt.Everything,e._globalShaderMacro=new ar,X(e,"_frustum",yh,N(e)),X(e,"_renderPipeline",xh,N(e)),e._isOrthographic=!1,e._isProjMatSetting=!1,e._nearClipPlane=.1,e._farClipPlane=100,e._fieldOfView=45,e._orthographicSize=10,e._isProjectionDirty=!0,e._isInvProjMatDirty=!0,e._isFrustumProjectDirty=!0,e._customAspectRatio=void 0,e._renderTarget=null,X(e,"_frustumViewChangeFlag",wh,N(e)),X(e,"_transform",bh,N(e)),X(e,"_isViewMatrixDirty",Sh,N(e)),X(e,"_isInvViewProjDirty",Ch,N(e)),X(e,"_projectionMatrix",Ah,N(e)),X(e,"_viewMatrix",Ph,N(e)),X(e,"_viewport",Th,N(e)),X(e,"_inverseProjectionMatrix",Mh,N(e)),X(e,"_lastAspectSize",Eh,N(e)),X(e,"_invViewProjMat",Rh,N(e));var n=e.entity.transform;return e._transform=n,e._isViewMatrixDirty=n.registerWorldChangeFlag(),e._isInvViewProjDirty=n.registerWorldChangeFlag(),e._frustumViewChangeFlag=n.registerWorldChangeFlag(),e._renderPipeline=new Rv(N(e)),e.shaderData._addRefCount(1),e}var i=o.prototype;return i.resetProjectionMatrix=function(){this._isProjMatSetting=!1,this._projMatChange()},i.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projMatChange()},i.worldToViewportPoint=function(e,n){var a=hi.tempVec3,s=hi.tempVec4;y.transformCoordinate(e,this.viewMatrix,a),y.transformToVec4(a,this.projectionMatrix,s);var l=s.w;return n.set((s.x/l+1)*.5,(1-s.y/l)*.5,-a.z),n},i.viewportToWorldPoint=function(e,n){var a=this.nearClipPlane,s=this.farClipPlane,l=1/(a-s),c;if(this.isOrthographic)c=-e.z*2*l,c+=(s+a)*l;else{var u=e.z;c=-u*(a+s)*l,c+=2*a*s*l,c=c/u}return this._innerViewportToWorldPoint(e.x,e.y,(c+1)/2,this._getInvViewProjMat(),n),n},i.viewportPointToRay=function(e,n){var a=this._getInvViewProjMat(),s=this._innerViewportToWorldPoint(e.x,e.y,0,a,n.origin),l=this._innerViewportToWorldPoint(e.x,e.y,1,a,n.direction);return y.subtract(l,s,l),l.normalize(),n},i.screenToViewportPoint=function(e,n){var a=this.engine.canvas,s=this.viewport;return n.x=(e.x/a.width-s.x)/s.z,n.y=(e.y/a.height-s.y)/s.w,e.z!==void 0&&(n.z=e.z),n},i.viewportToScreenPoint=function(e,n){var a=this.engine.canvas,s=this.viewport;return n.x=(s.x+e.x*s.z)*a.width,n.y=(s.y+e.y*s.w)*a.height,e.z!==void 0&&(n.z=e.z),n},i.worldToScreenPoint=function(e,n){return this.worldToViewportPoint(e,n),this.viewportToScreenPoint(n,n)},i.screenToWorldPoint=function(e,n){return this.screenToViewportPoint(e,n),this.viewportToWorldPoint(n,n)},i.screenPointToRay=function(e,n){var a=hi.tempVec2;return this.screenToViewportPoint(e,a),this.viewportPointToRay(a,n)},i.render=function(e,n){n===void 0&&(n=0);var a=this.engine._renderContext;a._setContext(this),this.enableFrustumCulling&&(this._frustumViewChangeFlag.flag||this._isFrustumProjectDirty)&&(this._frustum.calculateFromMatrix(a._viewProjectMatrix),this._frustumViewChangeFlag.flag=!1,this._isFrustumProjectDirty=!1),this._updateShaderData(a),ar.unionCollection(this.scene._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro),n>0&&!this.engine._hardwareRenderer.isWebGL2&&(n=0,Fe.error("mipLevel only take effect in WebGL2.0")),this._renderPipeline.render(a,e,n),this._engine._renderCount++},i._onEnable=function(){this.entity.scene._attachRenderCamera(this)},i._onDisable=function(){this.entity.scene._detachRenderCamera(this)},i._onDestroy=function(){var e;(e=this._renderPipeline)===null||e===void 0||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy(),this.shaderData._addRefCount(-1)},i._projMatChange=function(){this._isFrustumProjectDirty=!0,this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0},i._innerViewportToWorldPoint=function(e,n,a,s,l){var c=hi.tempVec3;return c.set(e*2-1,1-n*2,a*2-1),y.transformCoordinate(c,s,l),l},i._updateShaderData=function(e){var n=this.shaderData;n.setMatrix(o._viewMatrixProperty,this.viewMatrix),n.setMatrix(o._projectionMatrixProperty,this.projectionMatrix),n.setMatrix(o._vpMatrixProperty,e._viewProjectMatrix),n.setMatrix(o._inverseViewMatrixProperty,this._transform.worldMatrix),n.setMatrix(o._inverseProjectionMatrixProperty,this._getInverseProjectionMatrix()),n.setVector3(o._cameraPositionProperty,this._transform.worldPosition)},i._getInvViewProjMat=function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,ge.multiply(this._transform.worldMatrix,this._getInverseProjectionMatrix(),this._invViewProjMat)),this._invViewProjMat},i._getInverseProjectionMatrix=function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,ge.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix},ie(o,[{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projMatChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projMatChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projMatChange()}},{key:"aspectRatio",get:function(){var e,n=this._entity.engine.canvas;return(e=this._customAspectRatio)!=null?e:n.width*this._viewport.z/(n.height*this._viewport.w)},set:function(e){this._customAspectRatio=e,this._projMatChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&this._viewport.copyFrom(e),this._projMatChange()}},{key:"isOrthographic",get:function(){return this._isOrthographic},set:function(e){this._isOrthographic=e,this._projMatChange()}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projMatChange()}},{key:"viewMatrix",get:function(){return this._isViewMatrixDirty.flag&&(this._isViewMatrixDirty.flag=!1,ge.rotationTranslation(this._transform.worldRotationQuaternion,this._transform.worldPosition,this._viewMatrix),this._viewMatrix.invert()),this._viewMatrix}},{key:"projectionMatrix",get:function(){var e=this._entity.engine.canvas;if((!this._isProjectionDirty||this._isProjMatSetting)&&this._lastAspectSize.x===e.width&&this._lastAspectSize.y===e.height)return this._projectionMatrix;this._isProjectionDirty=!1,this._lastAspectSize.x=e.width,this._lastAspectSize.y=e.height;var n=this.aspectRatio;if(!this._isOrthographic)ge.perspective(Q.degreeToRadian(this._fieldOfView),n,this._nearClipPlane,this._farClipPlane,this._projectionMatrix);else{var a=this._orthographicSize*n,s=this._orthographicSize;ge.ortho(-a,a,-s,s,this._nearClipPlane,this._farClipPlane,this._projectionMatrix)}return this._projectionMatrix},set:function(e){this._projectionMatrix=e,this._isProjMatSetting=!0,this._projMatChange()}},{key:"enableHDR",get:function(){return console.log("not implementation"),!1},set:function(e){console.log("not implementation")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget=e}}]),o}(wr),Pn._viewMatrixProperty=k.getPropertyByName("u_viewMat"),Pn._projectionMatrixProperty=k.getPropertyByName("u_projMat"),Pn._vpMatrixProperty=k.getPropertyByName("u_VPMat"),Pn._inverseViewMatrixProperty=k.getPropertyByName("u_viewInvMat"),Pn._inverseProjectionMatrixProperty=k.getPropertyByName("u_projInvMat"),Pn._cameraPositionProperty=k.getPropertyByName("u_cameraPos"),Pn),yh=j(Wt.prototype,"_frustum",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ay}}),xh=j(Wt.prototype,"_renderPipeline",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wh=j(Wt.prototype,"_frustumViewChangeFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bh=j(Wt.prototype,"_transform",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=j(Wt.prototype,"_isViewMatrixDirty",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=j(Wt.prototype,"_isInvViewProjDirty",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ah=j(Wt.prototype,"_projectionMatrix",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),Ph=j(Wt.prototype,"_viewMatrix",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),Th=j(Wt.prototype,"_viewport",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new qe(0,0,1,1)}}),Mh=j(Wt.prototype,"_inverseProjectionMatrix",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),Eh=j(Wt.prototype,"_lastAspectSize",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Z(0,0)}}),Rh=j(Wt.prototype,"_invViewProjMat",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge}}),Wt))||mh),hx={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"},fx=1,dx=1/0,_x=500;function Pa(r,o){return o===void 0&&(o={}),new st(function(i,t,e){var n,a,s,l,c=(n=o.retryCount)!=null?n:fx,u=(a=o.retryInterval)!=null?a:_x;o.timeout=(s=o.timeout)!=null?s:dx,o.type=(l=o.type)!=null?l:gx(r);var h=o.type==="image"?vx:px,f,d=new mx(function(){return h(r,o).onProgress(e).then(function(_){i(_),d.stop()}).catch(function(_){return f=_})},c,u);d.start(function(){t(f)})})}function vx(r,o){return new st(function(i,t){var e=o.timeout,n=new Image,a=function(){t(new Error("request "+r+" fail"))};n.onerror=a,n.onabort=a;var s=-1;e!=1/0&&(s=window.setTimeout(function(){t(new Error("request "+r+" timeout"))},e)),n.onload=function(l){return function(){requestAnimationFrame(function(){i(n),n.onload=null,n.onerror=null,n.onabort=null}),clearTimeout(l)}}(s),n.crossOrigin="anonymous",n.src=r})}function px(r,o){return new st(function(i,t,e){var n,a=new XMLHttpRequest;a.timeout=o.timeout,o.method=(n=o.method)!=null?n:"get",a.onload=function(){var l;if(a.status<200||a.status>=300){t(new Error("request failed from: "+r));return}var c=(l=a.response)!=null?l:a.responseText;i(c)},a.onerror=function(){t(new Error("request failed from: "+r))},a.ontimeout=function(){t(new Error("request timeout from: "+r))},a.onprogress=function(l){e(l.loaded/l.total)},a.open(o.method,r,!0),a.withCredentials=o.credentials==="include",a.responseType=o.type;var s=o.headers;s&&Object.keys(s).forEach(function(l){a.setRequestHeader(l,s[l])}),a.send(o.body)})}function gx(r){var o=r.substring(r.lastIndexOf(".")+1);return hx[o]}var mx=function(){function r(i,t,e){this.execFunc=i,this.totalCount=t,this.interval=e,this._timeoutId=-100,this._currentCount=0,this.done=void 0,this.exec=this.exec.bind(this)}var o=r.prototype;return o.start=function(t){this.done=t,this.exec()},o.stop=function(){clearTimeout(this._timeoutId)},o.exec=function(){var t=this;if(this._currentCount>=this.totalCount){this.done&&this.done();return}this._currentCount++,this.execFunc(this._currentCount).then(function(){t._timeoutId=setTimeout(t.exec,t.interval)})},r}(),rt=function(){r.registerClass=function(i,t){this._engineObjects[i]=t},r.getClass=function(i){return this._engineObjects[i]};function r(o){this.useCache=o,this.request=Pa}return r}();rt._engineObjects={};var tt;(function(r){r.Text="text",r.JSON="json",r.Buffer="buffer",r.Texture2D="texture2d",r.TextureCube="texture-cube",r.Material="material",r.Mesh="mesh",r.AnimationClip="AnimationClip",r.AnimatorController="AnimatorController",r.Prefab="prefab",r.KTX="ktx",r.KTXCube="ktx-cube",r.Sprite="sprite",r.SpriteAtlas="sprite-atlas",r.Env="environment",r.Scene="scene",r.HDR="HDR"})(tt||(tt={}));var ln;(function(r){r[r.Front=0]="Front",r[r.Back=1]="Back",r[r.Double=2]="Double"})(ln||(ln={}));var Hi;(function(r){r[r.Normal=0]="Normal",r[r.Additive=1]="Additive"})(Hi||(Hi={}));var On;(function(r){r[r.UV0=0]="UV0",r[r.UV1=1]="UV1",r[r.UV2=2]="UV2",r[r.UV3=3]="UV3",r[r.UV4=4]="UV4",r[r.UV5=5]="UV5",r[r.UV6=6]="UV6",r[r.UV7=7]="UV7"})(On||(On={}));var Bt=function(r){ne(o,r);function o(t,e){var n;return n=r.call(this,t,e)||this,n._renderFace=ln.Front,n._isTransparent=!1,n._blendMode=void 0,n.blendMode=Hi.Normal,n.shaderData.setFloat(o._alphaCutoffProp,0),n}var i=o.prototype;return i.clone=function(){var e=new o(this._engine,this.shader);return this.cloneTo(e),e},i.cloneTo=function(e){r.prototype.cloneTo.call(this,e),e._renderFace=this._renderFace,e._isTransparent=this._isTransparent,e._blendMode=this._blendMode},ie(o,[{key:"isTransparent",get:function(){return this._isTransparent},set:function(e){if(e!==this._isTransparent){this._isTransparent=e;var n=this.renderState,a=n.depthState,s=n.blendState.targetBlendState;e?(s.enabled=!0,a.writeEnabled=!1,this.renderQueueType=xt.Transparent):(s.enabled=!1,a.writeEnabled=!0,this.renderQueueType=this.shaderData.getFloat(o._alphaCutoffProp)?xt.AlphaTest:xt.Opaque)}}},{key:"alphaCutoff",get:function(){return this.shaderData.getFloat(o._alphaCutoffProp)},set:function(e){this.shaderData.setFloat(o._alphaCutoffProp,e),e>0?(this.shaderData.enableMacro(o._alphaCutoffMacro),this.renderQueueType=this._isTransparent?xt.Transparent:xt.AlphaTest):(this.shaderData.disableMacro(o._alphaCutoffMacro),this.renderQueueType=this._isTransparent?xt.Transparent:xt.Opaque)}},{key:"renderFace",get:function(){return this._renderFace},set:function(e){if(e!==this._renderFace)switch(this._renderFace=e,e){case ln.Front:this.renderState.rasterState.cullMode=nr.Back;break;case ln.Back:this.renderState.rasterState.cullMode=nr.Front;break;case ln.Double:this.renderState.rasterState.cullMode=nr.Off;break}}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){if(e!==this._blendMode){this._blendMode=e;var n=this.renderState.blendState.targetBlendState;switch(e){case Hi.Normal:n.sourceColorBlendFactor=xe.SourceAlpha,n.destinationColorBlendFactor=xe.OneMinusSourceAlpha,n.sourceAlphaBlendFactor=xe.One,n.destinationAlphaBlendFactor=xe.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=er.Add;break;case Hi.Additive:n.sourceColorBlendFactor=xe.SourceAlpha,n.destinationColorBlendFactor=xe.One,n.sourceAlphaBlendFactor=xe.One,n.destinationAlphaBlendFactor=xe.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=er.Add;break}}}}]),o}(Ir);Bt._baseColorProp=k.getPropertyByName("u_baseColor");Bt._baseTextureProp=k.getPropertyByName("u_baseTexture");Bt._baseTextureMacro=k.getMacroByName("BASETEXTURE");Bt._tilingOffsetProp=k.getPropertyByName("u_tilingOffset");Bt._normalTextureProp=k.getPropertyByName("u_normalTexture");Bt._normalIntensityProp=k.getPropertyByName("u_normalIntensity");Bt._normalTextureMacro=k.getMacroByName("NORMALTEXTURE");Bt._emissiveColorProp=k.getPropertyByName("u_emissiveColor");Bt._emissiveTextureProp=k.getPropertyByName("u_emissiveTexture");Bt._emissiveTextureMacro=k.getMacroByName("EMISSIVETEXTURE");Bt._alphaCutoffProp=k.getPropertyByName("u_alphaCutoff");Bt._alphaCutoffMacro=k.getMacroByName("ALPHA_CUTOFF");var ha=function(r){ne(o,r);function o(t){var e;e=r.call(this,t,k.find("blinn-phong"))||this;var n=e.shaderData;return n.enableMacro("O3_NEED_WORLDPOS"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(o._baseColorProp,new me(1,1,1,1)),n.setColor(o._specularColorProp,new me(1,1,1,1)),n.setColor(o._emissiveColorProp,new me(0,0,0,1)),n.setVector4(o._tilingOffsetProp,new qe(1,1,0,0)),n.setFloat(o._shininessProp,16),n.setFloat(o._normalIntensityProp,1),e}var i=o.prototype;return i.clone=function(){var e=new o(this._engine);return this.cloneTo(e),e},ie(o,[{key:"baseColor",get:function(){return this.shaderData.getColor(o._baseColorProp)},set:function(e){var n=this.shaderData.getColor(o._baseColorProp);e!==n&&n.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(o._baseTextureProp)},set:function(e){this.shaderData.setTexture(o._baseTextureProp,e),e?this.shaderData.enableMacro(o._baseTextureMacro):this.shaderData.disableMacro(o._baseTextureMacro)}},{key:"specularColor",get:function(){return this.shaderData.getColor(o._specularColorProp)},set:function(e){var n=this.shaderData.getColor(o._specularColorProp);e!==n&&n.copyFrom(e)}},{key:"specularTexture",get:function(){return this.shaderData.getTexture(o._specularTextureProp)},set:function(e){this.shaderData.setTexture(o._specularTextureProp,e),e?this.shaderData.enableMacro("O3_SPECULAR_TEXTURE"):this.shaderData.disableMacro("O3_SPECULAR_TEXTURE")}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(o._emissiveColorProp)},set:function(e){var n=this.shaderData.getColor(o._emissiveColorProp);e!==n&&n.copyFrom(e)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(o._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(o._emissiveTextureProp,e),e?this.shaderData.enableMacro(o._emissiveTextureMacro):this.shaderData.disableMacro(o._emissiveTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(o._normalTextureProp)},set:function(e){this.shaderData.setTexture(o._normalTextureProp,e),e?this.shaderData.enableMacro(o._normalTextureMacro):this.shaderData.disableMacro(o._normalTextureMacro)}},{key:"normalIntensity",get:function(){return this.shaderData.getFloat(o._normalIntensityProp)},set:function(e){this.shaderData.setFloat(o._normalIntensityProp,e)}},{key:"shininess",get:function(){return this.shaderData.getFloat(o._shininessProp)},set:function(e){this.shaderData.setFloat(o._shininessProp,Math.max(e,1e-4))}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(o._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(o._tilingOffsetProp);e!==n&&n.copyFrom(e)}}]),o}(Bt);ha._specularColorProp=k.getPropertyByName("u_specularColor");ha._shininessProp=k.getPropertyByName("u_shininess");ha._specularTextureProp=k.getPropertyByName("u_specularTexture");var Nr=function(r){ne(o,r);function o(i,t){var e;e=r.call(this,i,t)||this;var n=e.shaderData;return n.enableMacro("O3_NEED_WORLDPOS"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(o._baseColorProp,new me(1,1,1,1)),n.setColor(o._emissiveColorProp,new me(0,0,0,1)),n.setVector4(o._tilingOffsetProp,new qe(1,1,0,0)),n.setFloat(o._normalIntensityProp,1),n.setFloat(o._occlusionTextureIntensityProp,1),n.setFloat(o._occlusionTextureCoordProp,On.UV0),n.setFloat(o._clearCoatProp,0),n.setFloat(o._clearCoatRoughnessProp,0),e}return ie(o,[{key:"baseColor",get:function(){return this.shaderData.getColor(o._baseColorProp)},set:function(t){var e=this.shaderData.getColor(o._baseColorProp);t!==e&&e.copyFrom(t)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(o._baseTextureProp)},set:function(t){this.shaderData.setTexture(o._baseTextureProp,t),t?this.shaderData.enableMacro(o._baseTextureMacro):this.shaderData.disableMacro(o._baseTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(o._normalTextureProp)},set:function(t){this.shaderData.setTexture(o._normalTextureProp,t),t?this.shaderData.enableMacro(o._normalTextureMacro):this.shaderData.disableMacro(o._normalTextureMacro)}},{key:"normalTextureIntensity",get:function(){return this.shaderData.getFloat(o._normalIntensityProp)},set:function(t){this.shaderData.setFloat(o._normalIntensityProp,t)}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(o._emissiveColorProp)},set:function(t){var e=this.shaderData.getColor(o._emissiveColorProp);t!==e&&e.copyFrom(t)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(o._emissiveTextureProp)},set:function(t){this.shaderData.setTexture(o._emissiveTextureProp,t),t?this.shaderData.enableMacro(o._emissiveTextureMacro):this.shaderData.disableMacro(o._emissiveTextureMacro)}},{key:"occlusionTexture",get:function(){return this.shaderData.getTexture(o._occlusionTextureProp)},set:function(t){this.shaderData.setTexture(o._occlusionTextureProp,t),t?this.shaderData.enableMacro("OCCLUSIONTEXTURE"):this.shaderData.disableMacro("OCCLUSIONTEXTURE")}},{key:"occlusionTextureIntensity",get:function(){return this.shaderData.getFloat(o._occlusionTextureIntensityProp)},set:function(t){this.shaderData.setFloat(o._occlusionTextureIntensityProp,t)}},{key:"occlusionTextureCoord",get:function(){return this.shaderData.getFloat(o._occlusionTextureCoordProp)},set:function(t){t>On.UV1&&Fe.warn("Occlusion texture uv coordinate must be UV0 or UV1."),this.shaderData.setFloat(o._occlusionTextureCoordProp,t)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(o._tilingOffsetProp)},set:function(t){var e=this.shaderData.getVector4(o._tilingOffsetProp);t!==e&&e.copyFrom(t)}},{key:"clearCoat",get:function(){return this.shaderData.getFloat(o._clearCoatProp)},set:function(t){!!this.shaderData.getFloat(o._clearCoatProp)!=!!t&&(t===0?this.shaderData.disableMacro("CLEARCOAT"):this.shaderData.enableMacro("CLEARCOAT")),this.shaderData.setFloat(o._clearCoatProp,t)}},{key:"clearCoatTexture",get:function(){return this.shaderData.getTexture(o._clearCoatTextureProp)},set:function(t){this.shaderData.setTexture(o._clearCoatTextureProp,t),t?this.shaderData.enableMacro("HAS_CLEARCOATTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATTEXTURE")}},{key:"clearCoatRoughness",get:function(){return this.shaderData.getFloat(o._clearCoatRoughnessProp)},set:function(t){this.shaderData.setFloat(o._clearCoatRoughnessProp,t)}},{key:"clearCoatRoughnessTexture",get:function(){return this.shaderData.getTexture(o._clearCoatRoughnessTextureProp)},set:function(t){this.shaderData.setTexture(o._clearCoatRoughnessTextureProp,t),t?this.shaderData.enableMacro("HAS_CLEARCOATROUGHNESSTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATROUGHNESSTEXTURE")}},{key:"clearCoatNormalTexture",get:function(){return this.shaderData.getTexture(o._clearCoatNormalTextureProp)},set:function(t){this.shaderData.setTexture(o._clearCoatNormalTextureProp,t),t?this.shaderData.enableMacro("HAS_CLEARCOATNORMALTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATNORMALTEXTURE")}}]),o}(Bt);Nr._occlusionTextureIntensityProp=k.getPropertyByName("u_occlusionIntensity");Nr._occlusionTextureCoordProp=k.getPropertyByName("u_occlusionTextureCoord");Nr._occlusionTextureProp=k.getPropertyByName("u_occlusionTexture");Nr._clearCoatProp=k.getPropertyByName("u_clearCoat");Nr._clearCoatTextureProp=k.getPropertyByName("u_clearCoatTexture");Nr._clearCoatRoughnessProp=k.getPropertyByName("u_clearCoatRoughness");Nr._clearCoatRoughnessTextureProp=k.getPropertyByName("u_clearCoatRoughnessTexture");Nr._clearCoatNormalTextureProp=k.getPropertyByName("u_clearCoatNormalTexture");var fa=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t,k.find("pbr"))||this,e.shaderData.setFloat(o._metallicProp,1),e.shaderData.setFloat(o._roughnessProp,1),e}var i=o.prototype;return i.clone=function(){var e=new o(this._engine);return this.cloneTo(e),e},ie(o,[{key:"metallic",get:function(){return this.shaderData.getFloat(o._metallicProp)},set:function(e){this.shaderData.setFloat(o._metallicProp,e)}},{key:"roughness",get:function(){return this.shaderData.getFloat(o._roughnessProp)},set:function(e){this.shaderData.setFloat(o._roughnessProp,e)}},{key:"roughnessMetallicTexture",get:function(){return this.shaderData.getTexture(o._roughnessMetallicTextureProp)},set:function(e){this.shaderData.setTexture(o._roughnessMetallicTextureProp,e),e?this.shaderData.enableMacro("ROUGHNESSMETALLICTEXTURE"):this.shaderData.disableMacro("ROUGHNESSMETALLICTEXTURE")}}]),o}(Nr);fa._metallicProp=k.getPropertyByName("u_metal");fa._roughnessProp=k.getPropertyByName("u_roughness");fa._roughnessMetallicTextureProp=k.getPropertyByName("u_roughnessMetallicTexture");var Ci=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t,k.find("pbr-specular"))||this,e.shaderData.setColor(o._specularColorProp,new me(1,1,1,1)),e.shaderData.setFloat(o._glossinessProp,1),e}var i=o.prototype;return i.clone=function(){var e=new o(this._engine);return this.cloneTo(e),e},ie(o,[{key:"specularColor",get:function(){return this.shaderData.getColor(o._specularColorProp)},set:function(e){var n=this.shaderData.getColor(o._specularColorProp);e!==n&&n.copyFrom(e)}},{key:"glossiness",get:function(){return this.shaderData.getFloat(o._glossinessProp)},set:function(e){this.shaderData.setFloat(o._glossinessProp,e)}},{key:"specularGlossinessTexture",get:function(){return this.shaderData.getTexture(o._specularGlossinessTextureProp)},set:function(e){this.shaderData.setTexture(o._specularGlossinessTextureProp,e),e?this.shaderData.enableMacro(o._specularGlossinessTextureMacro):this.shaderData.disableMacro(o._specularGlossinessTextureMacro)}}]),o}(Nr);Ci._specularColorProp=k.getPropertyByName("u_PBRSpecularColor");Ci._glossinessProp=k.getPropertyByName("u_glossiness");Ci._specularGlossinessTextureProp=k.getPropertyByName("u_specularGlossinessTexture");Ci._specularGlossinessTextureMacro=k.getMacroByName("SPECULARGLOSSINESSTEXTURE");var ss=function(r){ne(o,r);function o(t){var e;e=r.call(this,t,k.find("unlit"))||this;var n=e.shaderData;return n.enableMacro("OMIT_NORMAL"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(o._baseColorProp,new me(1,1,1,1)),n.setVector4(o._tilingOffsetProp,new qe(1,1,0,0)),e}var i=o.prototype;return i.clone=function(){var e=new o(this._engine);return this.cloneTo(e),e},ie(o,[{key:"baseColor",get:function(){return this.shaderData.getColor(o._baseColorProp)},set:function(e){var n=this.shaderData.getColor(o._baseColorProp);e!==n&&n.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(o._baseTextureProp)},set:function(e){this.shaderData.setTexture(o._baseTextureProp,e),e?this.shaderData.enableMacro(o._baseTextureMacro):this.shaderData.disableMacro(o._baseTextureMacro)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(o._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(o._tilingOffsetProp);e!==n&&n.copyFrom(e)}}]),o}(Bt),fi;(function(r){r[r.Left=0]="Left",r[r.Center=1]="Center",r[r.Right=2]="Right"})(fi||(fi={}));var di;(function(r){r[r.Top=0]="Top",r[r.Center=1]="Center",r[r.Bottom=2]="Bottom"})(di||(di={}));var bi;(function(r){r[r.Overflow=0]="Overflow",r[r.Truncate=1]="Truncate"})(bi||(bi={}));var In;(function(r){r[r.None=0]="None",r[r.Bold=1]="Bold",r[r.Italic=2]="Italic"})(In||(In={}));var Fv=function(r){ne(i,r);var o=i.prototype;o.getSprite=function(e){var n=this._sprites[this._spriteNamesToIndex[e]];return n||console.warn("There is no sprite named "+e+" in the atlas."),n},o.getSprites=function(e,n){n.length=0;var a=this._spriteNamesToIndex[e];if(a!==void 0)for(var s=this._sprites;a>=0;a--){var l=s[a];l.name===e&&n.push(l)}else console.warn("The name of the sprite you want to find is not exit in SpriteAtlas.");return n};function i(t){var e;return e=r.call(this,t)||this,e._sprites=new Array,e._spriteNamesToIndex={},e}return o._addSprite=function(e){this._spriteNamesToIndex[e.name]=this._sprites.push(e)-1},o._onDestroy=function(){this._sprites=null,this._spriteNamesToIndex=null},ie(i,[{key:"sprites",get:function(){return this._sprites}}]),i}(gn),sn;(function(r){r[r.Simple=0]="Simple",r[r.Sliced=1]="Sliced"})(sn||(sn={}));var ls=function(r){ne(o,r);function o(t,e,n,a,s,l){var c;return e===void 0&&(e=null),n===void 0&&(n=null),a===void 0&&(a=null),s===void 0&&(s=null),l===void 0&&(l=null),c=r.call(this,t)||this,c.name=void 0,c._assetID=void 0,c._width=void 0,c._height=void 0,c._positions=[new Z,new Z,new Z,new Z],c._uvs=[new Z,new Z,new Z,new Z],c._bounds=new tn,c._texture=null,c._atlasRotated=!1,c._atlasRegion=new $s(0,0,1,1),c._atlasRegionOffset=new qe(0,0,0,0),c._region=new $s(0,0,1,1),c._pivot=new Z(.5,.5),c._border=new qe(0,0,0,0),c._dirtyFlag=Wr.all,c._updateFlagManager=new Ki,c._texture=e,n&&c._region.copyFrom(n),a&&c._pivot.copyFrom(a),s&&c._border.copyFrom(s),c.name=l,c}var i=o.prototype;return i.clone=function(){var e=new o(this._engine,this._texture,this._region,this._pivot,this._border,this.name);return e._assetID=this._assetID,e._atlasRotated=this._atlasRotated,e._atlasRegion.copyFrom(this._atlasRegion),e._atlasRegionOffset.copyFrom(this._atlasRegionOffset),e},i._registerUpdateFlag=function(){return this._updateFlagManager.createFlag(es)},i._getPositions=function(){return this._dirtyFlag&Wr.positions&&this._updatePositions(),this._positions},i._getUVs=function(){return this._dirtyFlag&Wr.uvs&&this._updateUVs(),this._uvs},i._getBounds=function(){return this._dirtyFlag&Wr.positions&&this._updatePositions(),this._bounds},i._onDestroy=function(){this._texture&&(this._texture=null)},i._calDefaultSize=function(){if(this._texture){var e=this._texture,n=this._atlasRegion,a=this._atlasRegionOffset,s=this._region,l=1/Or._pixelsPerUnit;this.width=e.width*n.width/(1-a.x-a.z)*s.width*l,this.height=e.height*n.height/(1-a.y-a.w)*s.height*l}},i._updatePositions=function(){var e=this._atlasRegionOffset,n=this._region,a=n.x,s=n.y,l=n.width,c=n.height,u=1-a-l,h=1-s-c,f=Math.max(e.x-a,0)/l,d=Math.max(e.w-s,0)/c,_=1-Math.max(e.z-u,0)/l,p=1-Math.max(e.y-h,0)/c,v=this._positions;v[0].set(f,d),v[1].set(_,d),v[2].set(f,p),v[3].set(_,p);var g=this._bounds,m=g.min,x=g.max;m.set(f,d,0),x.set(_,p,0),this._dirtyFlag&=~Wr.positions},i._updateUVs=function(){var e=this._uvs,n=this._atlasRegionOffset,a=this._region,s=a.x,l=a.y,c=a.width,u=a.height,h=1-s-c,f=1-l-u,d=this._atlasRegion,_=d.x,p=d.y,v=d.width,g=d.height,m=n.x,x=n.y,w=n.z,C=n.w,T=v/(1-m-w),b=g/(1-x-C),M=Math.max(s-m,0)*T+_,I=Math.max(f-x,0)*b+p,E=v+_-Math.max(h-w,0)*T,B=g+p-Math.max(l-C,0)*b,S=this._border,A=S.x,R=S.y,D=S.z,z=S.w;e[0].set(M,B),e[1].set((s-m+A*c)*T+_,g+p-(l-C+R*u)*b),e[2].set(v+_-(h-w+D*c)*T,(f-x+z*u)*b+p),e[3].set(E,I),this._dirtyFlag&=~Wr.uvs},i._dispatchSpriteChange=function(e){switch(e){case Je.atlasRegionOffset:case Je.region:this._dirtyFlag|=Wr.all;break;case Je.atlasRegion:case Je.border:this._dirtyFlag|=Wr.uvs;break}this._updateFlagManager.dispatch(e)},ie(o,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._dispatchSpriteChange(Je.texture))}},{key:"width",get:function(){return this._width===void 0&&this._calDefaultSize(),this._width},set:function(e){this._width!==e&&(this._width=e,this._dispatchSpriteChange(Je.size))}},{key:"height",get:function(){return this._height===void 0&&this._calDefaultSize(),this._height},set:function(e){this._height!==e&&(this._height=e,this._dispatchSpriteChange(Je.size))}},{key:"atlasRotated",get:function(){return this._atlasRotated},set:function(e){this._atlasRotated!=e&&(this._atlasRotated=e)}},{key:"atlasRegion",get:function(){return this._atlasRegion},set:function(e){var n=Q.clamp(e.x,0,1),a=Q.clamp(e.y,0,1);this._atlasRegion.set(n,a,Q.clamp(e.width,0,1-n),Q.clamp(e.height,0,1-a)),this._dispatchSpriteChange(Je.atlasRegion)}},{key:"atlasRegionOffset",get:function(){return this._atlasRegionOffset},set:function(e){var n=Q.clamp(e.x,0,1),a=Q.clamp(e.y,0,1);this._atlasRegionOffset.set(n,a,Q.clamp(e.z,0,1-n),Q.clamp(e.w,0,1-a)),this._dispatchSpriteChange(Je.atlasRegionOffset)}},{key:"region",get:function(){return this._region},set:function(e){var n=this._region,a=Q.clamp(e.x,0,1),s=Q.clamp(e.y,0,1);n.set(a,s,Q.clamp(e.width,0,1-a),Q.clamp(e.height,0,1-s)),this._dispatchSpriteChange(Je.region)}},{key:"pivot",get:function(){return this._pivot},set:function(e){var n=this._pivot;if(n===e)this._dispatchSpriteChange(Je.pivot);else{var a=e.x,s=e.y;(n.x!==a||n.y!==s)&&(n.set(a,s),this._dispatchSpriteChange(Je.pivot))}}},{key:"border",get:function(){return this._border},set:function(e){var n=this._border,a=Q.clamp(e.x,0,1),s=Q.clamp(e.y,0,1);n.set(a,s,Q.clamp(e.z,0,1-a),Q.clamp(e.w,0,1-s)),this._dispatchSpriteChange(Je.border)}}]),o}(gn),Wr;(function(r){r[r.positions=1]="positions",r[r.uvs=2]="uvs",r[r.all=3]="all"})(Wr||(Wr={}));var Fh,Bh,Ts,yx=(Fh=bv(),Fh(Bh=(Ts=function(){function r(){}return r.resetData=function(i){var t=i._renderData,e=t.positions,n=t.uvs;if(e.length<16)for(var a=e.length;a<16;a++)e.push(new y),n.push(new Z);t.triangles=[]},r.updatePositions=function(i){var t=i.width,e=i.height,n=i.sprite,a=i._renderData,s=a.positions,l=a.uvs,c=a.triangles,u=n.border,h=n._getUVs(),f=n._getPositions(),d=f[0],_=d.x,p=d.y,v=f[3],g=v.x,m=v.y,x=n.width,w=n.height,C=x*u.x,T=w*u.y,b=w*u.z,M=x*u.w,I,E;if(C+b>t){var B=t/(C+b);I=[x*_*B,C*B,C*B,t-x*(1-g)*B]}else I=[x*_,C,t-b,t-x*(1-g)];if(M+T>e){var S=e/(M+T);E=[w*p*S,T*S,T*S,e-w*(1-m)*S]}else E=[w*p,T,e-M,e-w*(1-m)];var A=i.sprite.pivot,R=A.x,D=A.y,z=i.width*R,U=i.height*D,V=r._worldMatrix,L=V.elements,J=i.entity.transform.worldMatrix.elements,oe=i.flipX?-1:1,le=i.flipY?-1:1;L[0]=J[0]*oe,L[1]=J[1]*oe,L[2]=J[2]*oe,L[4]=J[4]*le,L[5]=J[5]*le,L[6]=J[6]*le,L[8]=J[8],L[9]=J[9],L[10]=J[10],L[12]=J[12]-z*L[0]-U*L[4],L[13]=J[13]-z*L[1]-U*L[5],L[14]=J[14]-z*L[2]-U*L[6];for(var te=0,Ae=0,Ie=0;Ie<4;Ie++){for(var G=I[Ie],ce=h[Ie].x,pe=0;pe<4;pe++){var Pe=E[pe];s[te].set(L[0]*G+L[4]*Pe+L[12],L[1]*G+L[5]*Pe+L[13],L[2]*G+L[6]*Pe+L[14]),l[te].set(ce,h[pe].y),++te}++Ae}for(var Te=te/Ae,Ye=0,P=0;P<Ae-1;++P)for(var F=0;F<Te-1;++F){var O=P*Te+F;c[Ye++]=O,c[Ye++]=O+1,c[Ye++]=O+Te,c[Ye++]=O+1,c[Ye++]=O+Te+1,c[Ye++]=O+Te}i._renderData.vertexCount=Ae*Te,c.length=(Ae-1)*(Te-1)*6;var W=i._bounds,H=W.min,Y=W.max;H.set(I[0],E[0],0),Y.set(I[3],E[3],0),i._bounds.transform(V)},r.updateUVs=function(i){},r}(),Ts._worldMatrix=new ge,Ts))||Bh),zt,Ih,zh,Dh,Lh,Oh,Nh,Uh,Vh,kh,Gh,Hh,Wh,Xh,Ms,Bv=(zt=(Ms=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,X(e,"_renderData",Ih,N(e)),X(e,"_drawMode",zh,N(e)),X(e,"_assembler",Dh,N(e)),X(e,"_color",Lh,N(e)),X(e,"_sprite",Oh,N(e)),X(e,"_width",Nh,N(e)),X(e,"_height",Uh,N(e)),X(e,"_flipX",Vh,N(e)),X(e,"_flipY",kh,N(e)),X(e,"_maskLayer",Gh,N(e)),X(e,"_maskInteraction",Hh,N(e)),X(e,"_dirtyFlag",Wh,N(e)),X(e,"_spriteChangeFlag",Xh,N(e)),e._renderData=new Ol(4,[],[],null,e._color),e.drawMode=sn.Simple,e.setMaterial(e._engine._spriteDefaultMaterial),e._onSpriteChange=e._onSpriteChange.bind(N(e)),e}var i=o.prototype;return i._render=function(e){var n;if(!(!((n=this.sprite)!==null&&n!==void 0&&n.texture)||!this.width||!this.height)){(this._transformChangeFlag.flag||this._dirtyFlag&ht.Position)&&(this._assembler.updatePositions(this),this._dirtyFlag&=~ht.Position,this._transformChangeFlag.flag=!1),this._dirtyFlag&ht.UV&&(this._assembler.updateUVs(this),this._dirtyFlag&=~ht.UV);var a=this._engine._spriteElementPool.getFromPool();a.setValue(this,this._renderData,this.getMaterial(),this.sprite.texture),e._renderPipeline.pushPrimitive(a)}},i._cloneTo=function(e){e.sprite=this._sprite},i._onDestroy=function(){this._color=null,this._sprite=null,this._assembler=null,this._renderData=null,this._spriteChangeFlag&&(this._spriteChangeFlag.destroy(),this._spriteChangeFlag=null),r.prototype._onDestroy.call(this)},i._updateStencilState=function(){var e=this.getInstanceMaterial(),n=e.renderState.stencilState,a=this._maskInteraction;if(a===pr.None)n.enabled=!1,n.writeMask=255,n.referenceValue=0,n.compareFunctionFront=n.compareFunctionBack=Xe.Always;else{n.enabled=!0,n.writeMask=0,n.referenceValue=1;var s=a===pr.VisibleInsideMask?Xe.LessEqual:Xe.Greater;n.compareFunctionFront=s,n.compareFunctionBack=s}},i._onSpriteChange=function(e){switch(e){case Je.texture:this.shaderData.setTexture(o._textureProperty,this.sprite.texture);break;case Je.size:this._drawMode===sn.Sliced&&(this._dirtyFlag|=ht.Position);break;case Je.border:this._drawMode===sn.Sliced&&(this._dirtyFlag|=ht.All);break;case Je.region:case Je.atlasRegionOffset:this._dirtyFlag|=ht.All;break;case Je.atlasRegion:this._dirtyFlag|=ht.UV;break;case Je.pivot:this._dirtyFlag|=ht.Position;break}},ie(o,[{key:"drawMode",get:function(){return this._drawMode},set:function(e){if(this._drawMode!==e){switch(this._drawMode=e,e){case sn.Simple:this._assembler=ya;break;case sn.Sliced:this._assembler=yx;break}this._assembler.resetData(this),this._dirtyFlag|=ht.All}}},{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._spriteChangeFlag&&this._spriteChangeFlag.destroy(),e?(this._spriteChangeFlag=e._registerUpdateFlag(),this._spriteChangeFlag.listener=this._onSpriteChange,this._dirtyFlag|=ht.All,this.shaderData.setTexture(o._textureProperty,e.texture)):(this._spriteChangeFlag=null,this.shaderData.setTexture(o._textureProperty,null)))}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"width",get:function(){return this._width===void 0&&this._sprite&&(this.width=this._sprite.width),this._width},set:function(e){this._width!==e&&(this._width=e,this._dirtyFlag|=ht.Position)}},{key:"height",get:function(){return this._height===void 0&&this._sprite&&(this.height=this._sprite.height),this._height},set:function(e){this._height!==e&&(this._height=e,this._dirtyFlag|=ht.Position)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyFlag|=ht.Position)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyFlag|=ht.Position)}},{key:"bounds",get:function(){var e;return!((e=this.sprite)!==null&&e!==void 0&&e.texture)||!this.width||!this.height?Or._defaultBoundingBox:((this._transformChangeFlag.flag||this._dirtyFlag&ht.Position)&&(this._assembler.updatePositions(this),this._dirtyFlag&=~ht.Position,this._transformChangeFlag.flag=!1),this._bounds)}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._updateStencilState())}}]),o}(Qa),Ms._textureProperty=k.getPropertyByName("u_spriteTexture"),Ms),Ih=j(zt.prototype,"_renderData",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zh=j(zt.prototype,"_drawMode",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=j(zt.prototype,"_assembler",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lh=j(zt.prototype,"_color",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new me(1,1,1,1)}}),Oh=j(zt.prototype,"_sprite",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nh=j(zt.prototype,"_width",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Uh=j(zt.prototype,"_height",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Vh=j(zt.prototype,"_flipX",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kh=j(zt.prototype,"_flipY",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Gh=j(zt.prototype,"_maskLayer",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ea.Layer0}}),Hh=j(zt.prototype,"_maskInteraction",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pr.None}}),Wh=j(zt.prototype,"_dirtyFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xh=j(zt.prototype,"_spriteChangeFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zt),ht;(function(r){r[r.Position=1]="Position",r[r.UV=2]="UV",r[r.All=3]="All"})(ht||(ht={}));var xx=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,e._charInfoMap={},e._texture=void 0,e._space=1,e._curX=1,e._curY=1,e._nextY=1,e}var i=o.prototype;return i._onDestroy=function(){this._texture.destroy(),this._texture=null,this._charInfoMap={}},i.uploadCharTexture=function(e){var n=e.w,a=e.h,s=e.data,l=this._space,c=this.texture,u=c.width,h=n+l,f=a+l;if(1+h>=u||1+f>=u)throw Error("The char fontSize is too large.");var d=this._curX+h;d>=u&&(this._curX=l,this._curY=this._nextY+l);var _=this._curY+f;if(_>this._nextY&&(this._nextY=_),_>=u)return!1;n>0&&a>0&&s&&(c.setPixelBuffer(s,0,this._curX,this._curY,n,a),c.generateMipmaps());var p=1/u,v=this._curX,g=this._curY,m=n,x=a,w=v*p,C=(v+m)*p,T=g*p,b=(g+x)*p;e.x=v,e.y=g;var M=e.uvs;return M[0].set(w,T),M[1].set(C,T),M[2].set(C,b),M[3].set(w,b),this._curX+=h+l,!0},i.addCharInfo=function(e,n){this._charInfoMap[e.charCodeAt(0)]=n},i.getCharInfo=function(e){return this._charInfoMap[e.charCodeAt(0)]},ie(o,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture=e}}]),o}(gn),Io=function(r){ne(o,r),o.createFromOS=function(e,n){n===void 0&&(n="");var a=o._fontMap,s=a[n];return s||(s=new o(e,n),a[n]=s,s)};function o(t,e){var n;return e===void 0&&(e=""),n=r.call(this,t)||this,n._name="",n._fontAtlases=[],n._lastIndex=-1,n._name=e,n}var i=o.prototype;return i._uploadCharTexture=function(e){var n=this._fontAtlases,a=this._lastIndex;a===-1&&(this._createFontAtlas(),a++);var s=n[a];s.uploadCharTexture(e)||(s=this._createFontAtlas(),s.uploadCharTexture(e),a++),this._lastIndex=a,e.data=null},i._addCharInfo=function(e,n){var a=this._lastIndex;n.index=a,this._fontAtlases[a].addCharInfo(e,n)},i._getCharInfo=function(e){for(var n=this._fontAtlases,a=0,s=n.length;a<s;++a){var l=n[a],c=l.getCharInfo(e);if(c)return c}return null},i._getTextureByIndex=function(e){var n=this._fontAtlases[e];return n?n.texture:null},i._getLastIndex=function(){return this._lastIndex},i._onDestroy=function(){for(var e=this._fontAtlases,n=0,a=e.length;n<a;++n)e[n].destroy(!0);e.length=0,delete o._fontMap[this._name]},i._createFontAtlas=function(){var e=this.engine,n=new xx(e),a=new yr(e,256,256);return n.texture=a,this._fontAtlases.push(n),n},ie(o,[{key:"name",get:function(){return this._name}}]),o}(gn);Io._fontMap={};var Iv=function r(){this.texture=void 0,this.localPositions=new qe,this.renderData=void 0;var o=[new y,new y,new y,new y];this.renderData=new Ol(4,o,null,r.triangles,null)};Iv.triangles=[0,2,1,2,0,3];var wx=function(){function r(i,t){this._elements=[],this._type=void 0,this._type=i;for(var e=this._elements,n=0;n<t;++n)e[n]=new i}var o=r.prototype;return o.get=function(){return this._elements.length>0?this._elements.pop():new this._type},o.put=function(t){this._elements.push(t)},r}(),en=function(){function r(){}return r.textContext=function(){var i=r._textContext;if(!i){var t;try{t=new OffscreenCanvas(0,0)}catch{t=document.createElement("canvas")}var e=t.getContext("2d");i={canvas:t,context:e},r._textContext=i}return i},r.measureFont=function(i){var t=r._fontSizeInfoCache,e=t[i];return e||(e=r._measureFontOrChar(i),t[i]=e,e)},r.getNativeFontString=function(i,t,e){var n=e&In.Bold?"bold ":"";return e&In.Italic&&(n+="italic "),!/([\"\'])[^\'\"]+\1/.test(i)&&r._genericFontFamilies.indexOf(i)==-1&&(i='"'+i+'"'),n+=t+"px "+i,n},r.measureChar=function(i,t){return r._measureFontOrChar(t,i)},r.measureTextWithWrap=function(i){for(var t=i.fontSize,e=i.fontStyle,n=i.font.name,a=r.getNativeFontString(n,t,e),s=i._styleFont,l=r.measureFont(a),c=i.text.split(/(?:\r\n|\r|\n)/),u=new Array,h=new Array,f=new Array,d=Or._pixelsPerUnit,_=l.size+i.lineSpacing*d,p=i.width*d,v=0,g=0,m=c.length;g<m;++g){for(var x=c[g],w="",C=0,T=-1,b=-1,M=0,I=x.length;M<I;++M){var E=x[M],B=r._getCharInfo(E,a,s),S=B.w,A=B.offsetY,R=B.h*.5,D=R+A,z=R-A;C+S>p?C===0?(u.push(E),h.push(S),f.push({ascent:D,descent:z,size:D+z})):(u.push(w),h.push(C),f.push({ascent:T,descent:b,size:T+b}),w=E,C=B.xAdvance,T=D,b=z):(w+=E,C+=B.xAdvance,T<D&&(T=D),b<z&&(b=z))}C>0&&(u.push(w),h.push(C),f.push({ascent:T,descent:b,size:T+b}))}var U=i.height*d;return i.overflowMode===bi.Overflow&&(U=_*u.length),{width:v,height:U,lines:u,lineWidths:h,lineHeight:_,lineMaxSizes:f}},r.measureTextWithoutWrap=function(i){var t=i.fontSize,e=i.fontStyle,n=i.font.name,a=r.getNativeFontString(n,t,e),s=i._styleFont,l=r.measureFont(a),c=i.text.split(/(?:\r\n|\r|\n)/),u=c.length,h=new Array,f=new Array,d=Or._pixelsPerUnit,_=l.size+i.lineSpacing*d,p=0,v=i.height*d;i.overflowMode===bi.Overflow&&(v=_*u);for(var g=0;g<u;++g){for(var m=c[g],x=0,w=-1,C=-1,T=0,b=m.length;T<b;++T){var M=r._getCharInfo(m[T],a,s);x+=M.xAdvance;var I=M.offsetY,E=M.h*.5,B=E+I,S=E-I;w<B&&(w=B),C<S&&(C=S)}h[g]=x,f[g]={ascent:w,descent:C,size:w+C},x>p&&(p=x)}return{width:p,height:v,lines:c,lineWidths:h,lineHeight:_,lineMaxSizes:f}},r.getNativeFontHash=function(i,t,e){var n=e&In.Bold?"bold":"";return e&In.Italic&&(n+="italic"),!/([\"\'])[^\'\"]+\1/.test(i)&&r._genericFontFamilies.indexOf(i)==-1&&(i=""+i),n+=t+"px"+i,n},r._measureFontOrChar=function(i,t){t===void 0&&(t="");var e=r.textContext(),n=e.canvas,a=e.context;a.font=i;var s=t||r._measureString,l=Math.round(a.measureText(s).width),c=Math.ceil(a.measureText(r._measureBaseline).width),u=c*r._heightMultiplier;c=r._baselineMultiplier*c|0,n.width=l,n.height=u,a.font=i,a.fillStyle="#000",a.clearRect(0,0,l,u),a.textBaseline="middle",a.fillStyle="#fff",a.fillText(s,0,c);for(var h=a.getImageData(0,0,l,u).data,f=h.length,d=-1,_=-1,p,v=0,g=0,m=0,x=n.width,w=1/x,C=0;C<f;C+=4)if(h[C+3]!==0){var T=C*.25;p=~~(T*w),d===-1&&(d=p),p>_&&(_=p)}d!==-1&&_!==-1&&(v=c-d,g=_-c+1,m=v+g);var b={ascent:v,descent:g,size:m};if(t){var M=null;if(m>0){var I=x*4;M=new Uint8Array(h.buffer,d*I,m*I)}return{x:0,y:0,w:l,h:m,offsetX:0,offsetY:(v-g)*.5,xAdvance:l,uvs:[new Z,new Z,new Z,new Z],ascent:v,descent:g,index:0,data:M}}else return b},r._getCharInfo=function(i,t,e){var n=e._getCharInfo(i);return n||(n=r.measureChar(i,t),e._uploadCharTexture(n),e._addCharInfo(i,n)),n},r}();en._genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui","math","emoji","fangsong"];en._measureString="|\xC9q\xC5";en._measureBaseline="M";en._heightMultiplier=2;en._baselineMultiplier=1.4;en._fontSizeInfoCache={};en._textContext=null;var lt,jh,$h,qh,Yh,Qh,Jh,Kh,Zh,ef,tf,rf,nf,af,of,sf,lf,cf,uf,hf,va,bx=(lt=(va=function(r){ne(o,r);function o(t){var e;e=r.call(this,t)||this,X(e,"_styleFont",jh,N(e)),X(e,"_charRenderDatas",$h,N(e)),X(e,"_dirtyFlag",qh,N(e)),X(e,"_isWorldMatrixDirty",Yh,N(e)),X(e,"_color",Qh,N(e)),X(e,"_text",Jh,N(e)),X(e,"_width",Kh,N(e)),X(e,"_height",Zh,N(e)),X(e,"_localBounds",ef,N(e)),X(e,"_font",tf,N(e)),X(e,"_fontSize",rf,N(e)),X(e,"_fontStyle",nf,N(e)),X(e,"_lineSpacing",af,N(e)),X(e,"_horizontalAlignment",of,N(e)),X(e,"_verticalAlignment",sf,N(e)),X(e,"_enableWrapping",lf,N(e)),X(e,"_overflowMode",cf,N(e)),X(e,"_maskInteraction",uf,N(e)),X(e,"_maskLayer",hf,N(e));var n=N(e),a=n.engine;return e._isWorldMatrixDirty=t.transform._registerWorldChangeListener(),e._isWorldMatrixDirty.listener=function(){e._setDirtyFlagTrue($e.WorldPosition|$e.WorldBounds)},e.font=Io.createFromOS(a),e.setMaterial(a._spriteDefaultMaterial),e}var i=o.prototype;return i._render=function(e){if(!(this._text===""||this.enableWrapping&&this.width<=0||this.overflowMode===bi.Truncate&&this.height<=0)){this._isContainDirtyFlag($e.MaskInteraction)&&(this._updateStencilState(),this._setDirtyFlagFalse($e.MaskInteraction)),this._isContainDirtyFlag($e.StyleFont)&&(this._resetStyleFont(),this._setDirtyFlagFalse($e.StyleFont)),this._isContainDirtyFlag($e.LocalPositionBounds)&&(this._updateLocalData(),this._setDirtyFlagFalse($e.LocalPositionBounds)),this._isContainDirtyFlag($e.WorldPosition)&&(this._updatePosition(),this._setDirtyFlagFalse($e.WorldPosition));var n=this._engine._spriteElementPool,a=this._engine._textElementPool.getFromPool(),s=a.charElements,l=this.getMaterial(),c=this._charRenderDatas,u=c.length;a.component=this,a.material=l,s.length=u;for(var h=0;h<u;++h){var f=c[h],d=n.getFromPool();d.setValue(this,f.renderData,l,f.texture),s[h]=d}e._renderPipeline.pushPrimitive(a)}},i._onDestroy=function(){for(var e=this._charRenderDatas,n=0,a=e.length;n<a;++n)o._charRenderDataPool.put(e[n]);e.length=0,this._isWorldMatrixDirty.destroy(),r.prototype._onDestroy.call(this)},i._cloneTo=function(e){e.font=this._font},i._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},i._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},i._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},i._updateBounds=function(e){tn.transform(this._localBounds,this._entity.transform.worldMatrix,e)},i._updateStencilState=function(){var e=this.getInstanceMaterial(),n=e.renderState.stencilState,a=this._maskInteraction;if(a===pr.None)n.enabled=!1,n.writeMask=255,n.referenceValue=0,n.compareFunctionFront=n.compareFunctionBack=Xe.Always;else{n.enabled=!0,n.writeMask=0,n.referenceValue=1;var s=a===pr.VisibleInsideMask?Xe.LessEqual:Xe.Greater;n.compareFunctionFront=s,n.compareFunctionBack=s}},i._resetStyleFont=function(){var e=this._styleFont;e&&(e._addRefCount(-1),e.destroy()),this._styleFont=Io.createFromOS(this.engine,en.getNativeFontHash(this.font.name,this.fontSize,this.fontStyle)),this._styleFont._addRefCount(1)},i._updatePosition=function(){for(var e=this.entity.transform,n=e.worldMatrix.elements,a=this._charRenderDatas,s=n[0],l=n[1],c=n[2],u=n[4],h=n[5],f=n[6],d=n[12],_=n[13],p=n[14],v=o._tempVec31.set(u,h,f),g=o._tempVec30.set(s,l,c),m=0,x=a.length;m<x;++m){var w=a[m],C=w.localPositions,T=w.renderData.positions,b=C.x,M=C.y,I=T[0];I.x=b*s+M*u+d,I.y=b*l+M*h+_,I.z=b*c+M*f+p;var E=T[1];y.scale(g,C.z-b,E),y.add(I,E,E);var B=T[2];y.scale(v,C.w-M,B),y.add(I,B,T[3]),y.add(E,B,B)}},i._updateLocalData=function(){var e=this.color,n=this.horizontalAlignment,a=this.verticalAlignment,s=this._charRenderDatas,l=this._localBounds,c=l.min,u=l.max;c.set(0,0,0),u.set(0,0,0);var h=Or._pixelsPerUnit,f=1/h,d=this._styleFont,_=this.width*h,p=_*.5,v=this.height*h,g=this.enableWrapping?en.measureTextWithWrap(this):en.measureTextWithoutWrap(this),m=g.height,x=g.lines,w=g.lineWidths,C=g.lineHeight,T=g.lineMaxSizes,b=o._charRenderDataPool,M=C*.5,I=x.length,E=0,B=C*.5-T[0].ascent,S=C*.5-T[I-1].descent-1;switch(a){case di.Top:E=v*.5-M+B;break;case di.Center:E=m*.5-M-(S-B)*.5;break;case di.Bottom:E=m-v*.5-M-S;break}for(var A=0,R=Number.MAX_SAFE_INTEGER,D=Number.MAX_SAFE_INTEGER,z=Number.MIN_SAFE_INTEGER,U=Number.MIN_SAFE_INTEGER,V=I-1,L=0;L<I;++L){var J=x[L],oe=w[L],le=0;switch(n){case fi.Left:le=-p;break;case fi.Center:le=-oe*.5;break;case fi.Right:le=p-oe;break}for(var te=0,Ae=J.length-1;te<=Ae;++te){var Ie=J[te],G=d._getCharInfo(Ie);if(G.h>0){var ce=s[A]||b.get(),pe=ce.renderData,Pe=ce.localPositions;ce.texture=d._getTextureByIndex(G.index),pe.color=e,pe.uvs=G.uvs;var Te=G.w,Ye=G.ascent,P=G.descent,F=le*f,O=(le+Te)*f,W=(E+Ye)*f,H=(E-P+1)*f;Pe.set(F,W,O,H),s[A]=ce,A++,L===0&&(U=Math.max(U,W)),L===V&&(D=Math.min(D,H)),te===0&&(R=Math.min(R,F)),te===Ae&&(z=Math.max(z,O))}le+=G.xAdvance}E-=C}c.set(R,D,0),u.set(z,U,0);var Y=s.length;if(Y>A){for(var ee=A;ee<Y;++ee)b.put(s[ee]);s.length=A}d._getLastIndex()>0&&s.sort(function(K,q){return K.texture.instanceId-q.texture.instanceId})},ie(o,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"text",get:function(){return this._text},set:function(e){e=e||"",this._text!==e&&(this._text=e,this._setDirtyFlagTrue($e.Position))}},{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this._setDirtyFlagTrue($e.Position))}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this._setDirtyFlagTrue($e.Position))}},{key:"font",get:function(){return this._font},set:function(e){this._font!==e&&(this._font=e,this._setDirtyFlagTrue($e.Font))}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this._setDirtyFlagTrue($e.Font))}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(e){this.fontStyle!==e&&(this._fontStyle=e,this._setDirtyFlagTrue($e.Font))}},{key:"lineSpacing",get:function(){return this._lineSpacing},set:function(e){this._lineSpacing!==e&&(this._lineSpacing=e,this._setDirtyFlagTrue($e.Position))}},{key:"horizontalAlignment",get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._setDirtyFlagTrue($e.Position))}},{key:"verticalAlignment",get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._setDirtyFlagTrue($e.Position))}},{key:"enableWrapping",get:function(){return this._enableWrapping},set:function(e){this._enableWrapping!==e&&(this._enableWrapping=e,this._setDirtyFlagTrue($e.Position))}},{key:"overflowMode",get:function(){return this._overflowMode},set:function(e){this._overflowMode!==e&&(this._overflowMode=e,this._setDirtyFlagTrue($e.Position))}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._setDirtyFlagTrue($e.MaskInteraction))}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"bounds",get:function(){return this._isContainDirtyFlag($e.StyleFont)&&this._resetStyleFont(),this._isContainDirtyFlag($e.LocalPositionBounds)&&this._updateLocalData(),this._isContainDirtyFlag($e.WorldPosition)&&this._updatePosition(),this._isContainDirtyFlag($e.WorldBounds)&&this._updateBounds(this._bounds),this._setDirtyFlagFalse($e.Font),this._bounds}}]),o}(Qa),va._charRenderDataPool=new wx(Iv,50),va._tempVec30=new y,va._tempVec31=new y,va),jh=j(lt.prototype,"_styleFont",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$h=j(lt.prototype,"_charRenderDatas",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qh=j(lt.prototype,"_dirtyFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $e.Font}}),Yh=j(lt.prototype,"_isWorldMatrixDirty",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qh=j(lt.prototype,"_color",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new me(1,1,1,1)}}),Jh=j(lt.prototype,"_text",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Kh=j(lt.prototype,"_width",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zh=j(lt.prototype,"_height",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ef=j(lt.prototype,"_localBounds",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tn}}),tf=j(lt.prototype,"_font",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rf=j(lt.prototype,"_fontSize",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 24}}),nf=j(lt.prototype,"_fontStyle",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return In.None}}),af=j(lt.prototype,"_lineSpacing",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),of=j(lt.prototype,"_horizontalAlignment",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fi.Center}}),sf=j(lt.prototype,"_verticalAlignment",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return di.Center}}),lf=j(lt.prototype,"_enableWrapping",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cf=j(lt.prototype,"_overflowMode",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bi.Overflow}}),uf=j(lt.prototype,"_maskInteraction",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pr.None}}),hf=j(lt.prototype,"_maskLayer",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ea.Layer0}}),lt),$e;(function(r){r[r.StyleFont=1]="StyleFont",r[r.LocalPositionBounds=2]="LocalPositionBounds",r[r.WorldPosition=4]="WorldPosition",r[r.WorldBounds=8]="WorldBounds",r[r.MaskInteraction=16]="MaskInteraction",r[r.Position=14]="Position",r[r.Font=15]="Font"})($e||($e={}));var zv=function(){this.relativePath=void 0,this.type=void 0,this.property=void 0,this.curve=void 0},Dv=function(){this.time=void 0,this.functionName=void 0,this.parameter=void 0},Re;(function(r){r[r.Position=0]="Position",r[r.Rotation=1]="Rotation",r[r.Scale=2]="Scale",r[r.BlendShapeWeights=3]="BlendShapeWeights"})(Re||(Re={}));var Sx=function(){},Lv=function(r){ne(o,r);function o(t){var e;return e=r.call(this)||this,e.name=t,e._curveBindings=[],e._length=0,e._events=[],e}var i=o.prototype;return i.addEvent=function(e,n,a){if(typeof e=="string"){var s=new Dv;s.functionName=e,s.time=n,s.parameter=a,this._events.push(s)}else this._events.push(e);this._events.sort(function(l,c){return l.time-c.time})},i.clearEvents=function(){this._events.length=0},i.addCurveBinding=function(e,n,a,s){var l;switch(a){case"position":l=Re.Position;break;case"rotation":l=Re.Rotation;break;case"scale":l=Re.Scale;break;case"blendShapeWeights":l=Re.BlendShapeWeights;break}var c=new zv;c.relativePath=e,c.type=n,c.property=l,c.curve=s,s.length>this._length&&(this._length=s.length),this._curveBindings.push(c)},i.clearCurveBindings=function(){this._curveBindings.length=0,this._length=0},i._sampleAnimation=function(e,n){for(var a=this._curveBindings.length,s=a-1;s>=0;s--){var l=this._curveBindings[s],c=l.curve,u=l.property,h=l.relativePath,f=l.type,d=c.evaluate(n),_=e.findByName(h),p=_.transform;if(f===rr)switch(u){case Re.Position:p.position=d;break;case Re.Rotation:p.rotationQuaternion=d;break;case Re.Scale:p.scale=d;break}}},ie(o,[{key:"events",get:function(){return this._events}},{key:"curveBindings",get:function(){return this._curveBindings}},{key:"length",get:function(){return this._length}}]),o}(Sx),De;(function(r){r[r.Float=0]="Float",r[r.FloatArray=1]="FloatArray",r[r.Vector2=2]="Vector2",r[r.Vector3=3]="Vector3",r[r.Vector4=4]="Vector4",r[r.Quaternion=5]="Quaternion"})(De||(De={}));var zo=function(){function r(){}return r.scaleWeight=function(i,t,e){var n=i.x,a=i.y,s=i.z;e.x=n>0?Math.pow(Math.abs(n),t):-Math.pow(Math.abs(n),t),e.y=a>0?Math.pow(Math.abs(a),t):-Math.pow(Math.abs(a),t),e.z=s>0?Math.pow(Math.abs(s),t):-Math.pow(Math.abs(s),t)},r.scaleBlend=function(i,t,e,n){var a=r._tempVector30,s=r._tempVector31;r.scaleWeight(i,1-e,a),r.scaleWeight(t,e,s);var l=e>.5?t:i;n.x=l.x>0?Math.abs(a.x*s.x):-Math.abs(a.x*s.x),n.y=l.y>0?Math.abs(a.y*s.y):-Math.abs(a.y*s.y),n.z=l.z>0?Math.abs(a.z*s.z):-Math.abs(a.z*s.z)},r.quaternionWeight=function(i,t,e){e.x=i.x*t,e.y=i.y*t,e.z=i.z*t,e.w=i.w},r}();zo._tempVector30=new y;zo._tempVector31=new y;var Ha;(function(r){r[r.Override=0]="Override",r[r.Additive=1]="Additive"})(Ha||(Ha={}));var Vt;(function(r){r[r.UnStarted=0]="UnStarted",r[r.Playing=1]="Playing",r[r.Finished=2]="Finished"})(Vt||(Vt={}));var ft;(function(r){r[r.Standby=0]="Standby",r[r.Playing=1]="Playing",r[r.CrossFading=2]="CrossFading",r[r.FixedCrossFading=3]="FixedCrossFading"})(ft||(ft={}));var Cx=function(){function r(i,t,e){switch(this.crossCurveMark=0,this.crossCurveIndex=void 0,this.target=void 0,this.type=void 0,this.property=void 0,this.component=void 0,this.defaultValue=void 0,this.fixedPoseValue=void 0,this._hasSavedDefaultValue=!1,this.target=i,this.type=t,this.property=e,e){case Re.Position:this.defaultValue=new y,this.fixedPoseValue=new y,this.component=i.transform;break;case Re.Rotation:this.defaultValue=new Me,this.fixedPoseValue=new Me,this.component=i.transform;break;case Re.Scale:this.defaultValue=new y,this.fixedPoseValue=new y,this.component=i.transform;break;case Re.BlendShapeWeights:this.component=i.getComponent(ta);var n=this.component.blendShapeWeights.length;this.defaultValue=new Float32Array(n),this.fixedPoseValue=new Float32Array(n);break}}var o=r.prototype;return o.saveDefaultValue=function(){switch(this.property){case Re.Position:this.defaultValue.copyFrom(this.target.transform.position);break;case Re.Rotation:this.defaultValue.copyFrom(this.target.transform.rotationQuaternion);break;case Re.Scale:this.defaultValue.copyFrom(this.target.transform.scale);break;case Re.BlendShapeWeights:for(var t=this.component,e=t.blendShapeWeights,n=0,a=e.length;n<a;++n)this.defaultValue[n]=e[n];break}this._hasSavedDefaultValue=!0},o.saveFixedPoseValue=function(){switch(this.property){case Re.Position:this.fixedPoseValue.copyFrom(this.target.transform.position);break;case Re.Rotation:this.fixedPoseValue.copyFrom(this.target.transform.rotationQuaternion);break;case Re.Scale:this.fixedPoseValue.copyFrom(this.target.transform.scale);break;case Re.BlendShapeWeights:for(var t=this.component,e=t.blendShapeWeights,n=0,a=e.length;n<a;++n)this.fixedPoseValue[n]=this.component.blendShapeWeights[n];break}},r}(),Ax=function(){this.event=void 0,this.handlers=[]},Hl=function(){this.duration=0,this.offset=0,this.exitTime=1,this.destinationState=void 0},na;(function(r){r[r.Once=0]="Once",r[r.Loop=1]="Loop"})(na||(na={}));var ff=function(){function r(){this.state=void 0,this.stateData=void 0,this.frameTime=void 0,this.playState=void 0,this.clipTime=void 0,this.currentEventIndex=void 0}var o=r.prototype;return o.reset=function(t,e,n){this.state=t,this.frameTime=n,this.stateData=e,this.playState=Vt.UnStarted,this.clipTime=t.clipStartTime*t.clip.length,this.currentEventIndex=0},o.update=function(t){var e=this.state,n=this.frameTime,a=e._getDuration();this.playState=Vt.Playing,e.wrapMode===na.Loop?n=a?n%a:0:Math.abs(n)>a&&(n=n<0?-a:a,this.playState=Vt.Finished),t&&n===0?this.clipTime=e.clipEndTime*e.clip.length:(n<0&&(n+=a),this.clipTime=n+e.clipStartTime*e.clip.length)},r}(),Px=function(){function r(){this.animatorStateDataMap={},this.srcPlayData=new ff,this.destPlayData=new ff,this.layerState=ft.Standby,this.crossCurveMark=0,this.manuallyTransition=new Hl,this.crossFadeTransition=void 0}var o=r.prototype;return o.switchPlayData=function(){var t=this.destPlayData,e=this.srcPlayData;this.srcPlayData=t,this.destPlayData=e},r}(),Tx=function(){this.curveOwners=[],this.eventHandlers=[]},Mx=function(){this.layerIndex=void 0,this.state=void 0},Ex=function(){this.curveOwner=void 0,this.srcCurveIndex=void 0,this.destCurveIndex=void 0},df=function(){function r(){this.vector2=new Z,this.vector3=new y,this.vector4=new qe,this.quaternion=new Me,this._floatArrayPool=[]}var o=r.prototype;return o.getFloatArray=function(t){var e=this._floatArrayPool[t];return e||(this._floatArrayPool[t]=e=new Float32Array(t)),e},r}(),Ar,_f,vf,pf,gf,mf,yf,xf,wf,bf,lo,Ja=(Ar=(lo=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,e._animatorController=void 0,X(e,"_speed",_f,N(e)),X(e,"_controllerUpdateFlag",vf,N(e)),X(e,"_animatorLayersData",pf,N(e)),X(e,"_crossCurveDataCollection",gf,N(e)),X(e,"_animationCurveOwners",mf,N(e)),X(e,"_crossCurveDataPool",yf,N(e)),X(e,"_animationEventHandlerPool",xf,N(e)),X(e,"_baseTempValue",wf,N(e)),X(e,"_crossTempValue",bf,N(e)),e}var i=o.prototype;return i.play=function(e,n,a){var s;n===void 0&&(n=-1),a===void 0&&(a=0),(s=this._controllerUpdateFlag)!==null&&s!==void 0&&s.flag&&this._clearPlayData();var l=this._getAnimatorStateInfo(e,n,o._animatorInfo),c=l.state;if(!!c){if(!c.clip){console.warn("The state named "+e+" has no AnimationClip data.");return}var u=this._getAnimatorLayerData(l.layerIndex),h=u.srcPlayData,f=h.state;f&&f!==c&&this._revertDefaultValue(h.state,h.stateData);var d=this._getAnimatorStateData(e,c,u);u.layerState=ft.Playing,h.reset(c,d,c._getDuration()*a),this._saveDefaultValues(d)}},i._reset=function(){var e=this._animatorController;if(e)for(var n=e.layers,a=0,s=n.length;a<s;++a)for(var l=n[a].stateMachine.states,c=this._getAnimatorLayerData(a),u=0,h=l.length;u<h;++u){var f=l[u],d=this._getAnimatorStateData(f.name,f,c);this._revertDefaultValue(f,d)}this._clearPlayData()},i.crossFade=function(e,n,a,s){var l;a===void 0&&(a=-1),s===void 0&&(s=0),(l=this._controllerUpdateFlag)!==null&&l!==void 0&&l.flag&&this._clearPlayData();var c=this._getAnimatorStateInfo(e,a,o._animatorInfo),u=c.state,h=this._getAnimatorLayerData(a),f=h.manuallyTransition;f.duration=n,f.offset=s,f.destinationState=u,this._crossFadeByTransition(f,a)},i.update=function(e){var n;if(this.speed!==0){var a=this._animatorController;if(!!a&&!((n=this._controllerUpdateFlag)!==null&&n!==void 0&&n.flag)){e*=this.speed;for(var s=0,l=a.layers.length;s<l;s++){var c=this._getAnimatorLayerData(s);c.layerState!==ft.Standby&&this._updateLayer(s,s===0,e/1e3)}}}},i.getCurrentAnimatorState=function(e){var n,a;return(n=this._animatorLayersData[e])===null||n===void 0||(a=n.srcPlayData)===null||a===void 0?void 0:a.state},i._onEnable=function(){this.engine._componentsManager.addOnUpdateAnimations(this)},i._onDisable=function(){this.engine._componentsManager.removeOnUpdateAnimations(this)},i._getAnimatorStateInfo=function(e,n,a){var s=null,l=this._animatorController;if(l){var c=l.layers;if(n===-1){for(var u=0,h=c.length;u<h;u++)if(s=c[u].stateMachine.findStateByName(e),s){n=u;break}}else s=c[n].stateMachine.findStateByName(e)}return a.layerIndex=n,a.state=s,a},i._saveDefaultValues=function(e){for(var n=e.curveOwners,a=n.length-1;a>=0;a--)n[a].saveDefaultValue()},i._getAnimatorStateData=function(e,n,a){var s=a.animatorStateDataMap,l=s[e];return l||(l=new Tx,s[e]=l,this._saveAnimatorStateData(n,l),this._saveAnimatorEventHandlers(n,l)),l},i._saveAnimatorStateData=function(e,n){for(var a=this.entity,s=this._animationCurveOwners,l=n.curveOwners,c=e.clip._curveBindings,u=c.length-1;u>=0;u--){var h=c[u],f=h.relativePath===""?a:a.findByPath(h.relativePath),d=h.property,_=f,p=_.instanceId,v=s[p]||(s[p]=[]);l[u]=v[d]||(v[d]=new Cx(f,h.type,d))}},i._saveAnimatorEventHandlers=function(e,n){var a=this._animationEventHandlerPool,s=this._entity._scripts,l=s.length,c=n.eventHandlers,u=e.clip.events;c.length=0;for(var h=0,f=u.length;h<f;h++){var d=u[h],_=a.getFromPool(),p=d.functionName,v=_.handlers;_.event=d,v.length=0;for(var g=l-1;g>=0;g--){var m=s.get(g)[p];m&&v.push(m)}c.push(_)}},i._clearCrossData=function(e){e.crossCurveMark++,this._crossCurveDataCollection.length=0,this._crossCurveDataPool.resetPool()},i._addCrossCurveData=function(e,n,a,s){var l=this._crossCurveDataPool.getFromPool();l.curveOwner=n,l.srcCurveIndex=a,l.destCurveIndex=s,e.push(l)},i._prepareCrossFading=function(e){var n=this._crossCurveDataCollection,a=e.crossCurveMark;this._prepareSrcCrossData(n,e.srcPlayData,a,!1),this._prepareDestCrossData(n,e.destPlayData,a,!1)},i._prepareStandbyCrossFading=function(e){var n=this._crossCurveDataCollection,a=e.srcPlayData,s=e.crossCurveMark;a.state&&this._prepareSrcCrossData(n,a,s,!0),this._prepareDestCrossData(n,e.destPlayData,s,!0)},i._prepareFixedPoseCrossFading=function(e){for(var n=this._crossCurveDataCollection,a=n.length-1;a>=0;a--){var s=n[a];s.curveOwner.saveFixedPoseValue(),s.destCurveIndex=-1}this._prepareDestCrossData(n,e.destPlayData,e.crossCurveMark,!0)},i._prepareSrcCrossData=function(e,n,a,s){for(var l=n.stateData.curveOwners,c=l.length-1;c>=0;c--){var u=l[c];u.crossCurveMark=a,u.crossCurveIndex=e.length,s&&u.saveFixedPoseValue(),this._addCrossCurveData(e,u,c,-1)}},i._prepareDestCrossData=function(e,n,a,s){for(var l=n.stateData.curveOwners,c=l.length-1;c>=0;c--){var u=l[c];u.crossCurveMark===a?e[u.crossCurveIndex].destCurveIndex=c:(u.saveDefaultValue(),s&&u.saveFixedPoseValue(),u.crossCurveMark=a,u.crossCurveIndex=e.length,this._addCrossCurveData(e,u,-1,c))}},i._evaluateCurve=function(e,n,a,s,l){var c;switch(s&&(c=n.keys[0].value),n._valueType){case De.Float:{var u=n.evaluate(a);return s?u-c:u}case De.FloatArray:{var h=l.getFloatArray(n._valueSize);if(n._evaluate(a,h),s)for(var f=0,d=h.length;f<d;f++)h[f]=h[f]-c[f];return h}case De.Vector2:{var _=l.vector2;return n._evaluate(a,_),s&&(e===Re.Scale?Z.divide(_,c,_):Z.subtract(_,c,_)),_}case De.Vector3:{var p=l.vector3;return n._evaluate(a,p),s&&(e===Re.Scale?y.divide(p,c,p):y.subtract(p,c,p)),p}case De.Vector4:{var v=l.vector4;return n._evaluate(a,v),s&&qe.subtract(v,c,v),v}case De.Quaternion:{var g=l.quaternion;if(n._evaluate(a,g),s){var m=o._tempQuat;Me.conjugate(c,m),Me.multiply(m,g,g)}return g}}},i._getAnimatorLayerData=function(e){var n=this._animatorLayersData[e];return n||(this._animatorLayersData[e]=n=new Px),n},i._updateLayer=function(e,n,a){var s=this._animatorController.layers[e],l=s.blendingMode,c=s.weight,u=this._animatorLayersData[e],h=u.srcPlayData,f=u.destPlayData,d=u.crossFadeTransition,_=l===Ha.Additive,p=n?1:c;switch(u.layerState!==ft.FixedCrossFading&&this._checkTransition(h,d,e),u.layerState){case ft.Playing:this._updatePlayingState(h,u,e,p,a,_);break;case ft.FixedCrossFading:this._updateCrossFadeFromPose(f,u,e,p,a,_);break;case ft.CrossFading:this._updateCrossFade(h,f,u,e,p,a,_);break}},i._updatePlayingState=function(e,n,a,s,l,c){var u=e.stateData,h=u.curveOwners,f=u.eventHandlers,d=e.state,_=e.playState,p=e.clipTime,v=d.clip._curveBindings;e.update(this.speed<0);var g=e.clipTime,m=e.playState;f.length&&this._fireAnimationEvents(e,f,p,g);for(var x=v.length-1;x>=0;x--){var w=h[x],C=this._evaluateCurve(w.property,v[x].curve,g,c,this._baseTempValue);c?this._applyClipValueAdditive(w,C,s):this._applyClipValue(w,C,s)}e.frameTime+=d.speed*l,m===Vt.Finished&&(n.layerState=ft.Standby),_===Vt.UnStarted&&this._callAnimatorScriptOnEnter(d,a),m===Vt.Finished?this._callAnimatorScriptOnExit(d,a):this._callAnimatorScriptOnUpdate(d,a)},i._updateCrossFade=function(e,n,a,s,l,c,u){var h=this._crossCurveDataCollection,f=e.state.clip._curveBindings,d=e.state,_=e.stateData,p=e.playState,v=_.eventHandlers,g=n.state,m=n.stateData,x=n.playState,w=m.eventHandlers,C=g.clip._curveBindings,T=e.clipTime,b=n.clipTime,M=Math.abs(n.frameTime)/(g._getDuration()*a.crossFadeTransition.duration);M>=1&&(M=1),e.update(this.speed<0),n.update(this.speed<0);var I=e.playState,E=n.playState;this._updateCrossFadeData(a,M,c,!1);var B=e.clipTime,S=n.clipTime;v.length&&this._fireAnimationEvents(e,v,T,B),w.length&&this._fireAnimationEvents(n,w,b,S),p===Vt.UnStarted&&this._callAnimatorScriptOnEnter(d,s),M===1||I===Vt.Finished?this._callAnimatorScriptOnExit(d,s):this._callAnimatorScriptOnUpdate(d,s),x===Vt.UnStarted&&this._callAnimatorScriptOnEnter(g,s),E===Vt.Finished?this._callAnimatorScriptOnExit(g,s):this._callAnimatorScriptOnUpdate(g,s);for(var A=h.length-1;A>=0;A--){var R=h[A],D=R.curveOwner,z=R.srcCurveIndex,U=R.destCurveIndex,V=D.property,L=D.defaultValue,J=z>=0?this._evaluateCurve(V,f[z].curve,B,u,this._baseTempValue):L,oe=U>=0?this._evaluateCurve(V,C[U].curve,S,u,this._crossTempValue):L;this._applyCrossClipValue(D,J,oe,M,l,u)}},i._updateCrossFadeFromPose=function(e,n,a,s,l,c){var u=this._crossCurveDataCollection,h=e.state,f=e.stateData,d=e.playState,_=f.eventHandlers,p=h.clip._curveBindings,v=e.clipTime,g=Math.abs(e.frameTime)/(h._getDuration()*n.crossFadeTransition.duration);g>=1&&(g=1),e.update(this.speed<0);var m=e.playState;this._updateCrossFadeData(n,g,l,!0);var x=e.clipTime;_.length&&this._fireAnimationEvents(e,_,v,x),d===Vt.UnStarted&&this._callAnimatorScriptOnEnter(h,a),m===Vt.Finished?this._callAnimatorScriptOnExit(h,a):this._callAnimatorScriptOnUpdate(h,a);for(var w=u.length-1;w>=0;w--){var C=u[w],T=C.curveOwner,b=C.destCurveIndex,M=b>=0?this._evaluateCurve(T.property,p[b].curve,x,c,this._crossTempValue):T.defaultValue;this._applyCrossClipValue(T,T.fixedPoseValue,M,g,s,c)}},i._updateCrossFadeData=function(e,n,a,s){var l=e.destPlayData;l.frameTime+=l.state.speed*a,n===1?(l.playState===Vt.Finished?e.layerState=ft.Standby:e.layerState=ft.Playing,e.switchPlayData()):s||(e.srcPlayData.frameTime+=e.srcPlayData.state.speed*a)},i._applyCrossClipValue=function(e,n,a,s,l,c){var u;if(e.type===rr)switch(e.property){case Re.Position:u=this._baseTempValue.vector3,y.lerp(n,a,s,u);break;case Re.Rotation:u=this._baseTempValue.quaternion,Me.slerp(n,a,s,u);break;case Re.Scale:{u=this._baseTempValue.vector3,y.lerp(n,a,s,u);break}}else if(e.type===ta)switch(e.property){case Re.BlendShapeWeights:u=this._baseTempValue.getFloatArray(n.length);for(var h=0,f=u.length;h<f;++h)u[h]=n[h]+(a[h]-n[h])*s;break}c?this._applyClipValueAdditive(e,u,l):this._applyClipValue(e,u,l)},i._applyClipValue=function(e,n,a){if(e.type===rr){var s=e.target.transform;switch(e.property){case Re.Position:if(a===1)s.position=n;else{var l=s.position;y.lerp(l,n,a,l)}break;case Re.Rotation:if(a===1)s.rotationQuaternion=n;else{var c=s.rotationQuaternion;Me.slerp(c,n,a,c)}break;case Re.Scale:if(a===1)s.scale=n;else{var u=s.scale;y.lerp(u,n,a,u)}break}}else if(e.type===ta)switch(e.property){case Re.BlendShapeWeights:if(a===1)e.component.blendShapeWeights=n;else for(var h=e.component,f=h.blendShapeWeights,d=0,_=f.length;d<_;++d)f[d]+=(n[d]-f[d])*a;break}},i._applyClipValueAdditive=function(e,n,a){if(e.type===rr){var s=e.target.transform;switch(e.property){case Re.Position:var l=s.position;l.x+=n.x*a,l.y+=n.y*a,l.z+=n.z*a,s.position=l;break;case Re.Rotation:var c=s.rotationQuaternion;zo.quaternionWeight(n,a,n),n.normalize(),c.multiply(n),s.rotationQuaternion=c;break;case Re.Scale:var u=s.scale;zo.scaleWeight(u,a,u),y.multiply(u,n,u),s.scale=u;break;case Re.BlendShapeWeights:for(var h=e.component,f=h.blendShapeWeights,d=0,_=f.length;d<_;++d)e.component.blendShapeWeights[d]+=n[d]*a;break}}},i._revertDefaultValue=function(e,n){var a=e.clip;if(a)for(var s=a._curveBindings,l=n.curveOwners,c=s.length-1;c>=0;c--){var u=l[c],h=u.target.transform;if(!!u._hasSavedDefaultValue)switch(u.property){case Re.Position:h.position=u.defaultValue;break;case Re.Rotation:h.rotationQuaternion=u.defaultValue;break;case Re.Scale:h.scale=u.defaultValue;break;case Re.BlendShapeWeights:for(var f=u.component,d=f.blendShapeWeights,_=0,p=d.length;_<p;++_)u.component.blendShapeWeights[_]=u.defaultValue[_];break}}},i._checkTransition=function(e,n,a){for(var s=e.state,l=e.clipTime,c=s._getDuration(),u=s.transitions,h=0,f=u.length;h<f;++h){var d=u[h];c*d.exitTime<=l&&n!==d&&this._crossFadeByTransition(d,a)}},i._crossFadeByTransition=function(e,n){var a=e.destinationState.name,s=this._getAnimatorStateInfo(a,n,o._animatorInfo),l=s.state;if(!!l){if(!l.clip){console.warn("The state named "+a+" has no AnimationClip data.");return}var c=this._getAnimatorLayerData(s.layerIndex),u=c.layerState,h=c.destPlayData,f=this._getAnimatorStateData(a,l,c),d=l._getDuration(),_=d*e.offset;switch(h.reset(l,f,_),u){case ft.Standby:c.layerState=ft.FixedCrossFading,this._clearCrossData(c),this._prepareStandbyCrossFading(c);break;case ft.Playing:c.layerState=ft.CrossFading,this._clearCrossData(c),this._prepareCrossFading(c);break;case ft.CrossFading:c.layerState=ft.FixedCrossFading,this._prepareFixedPoseCrossFading(c);break;case ft.FixedCrossFading:this._prepareFixedPoseCrossFading(c);break}c.crossFadeTransition=e}},i._fireAnimationEvents=function(e,n,a,s){var l=e.state,c=l.clip.length;this.speed>=0?s<a?(this._fireSubAnimationEvents(e,n,a,l.clipEndTime*c),e.currentEventIndex=0,this._fireSubAnimationEvents(e,n,l.clipStartTime*c,s)):this._fireSubAnimationEvents(e,n,a,s):s>a?(this._fireBackwardSubAnimationEvents(e,n,a,l.clipStartTime*c),e.currentEventIndex=n.length-1,this._fireBackwardSubAnimationEvents(e,n,l.clipEndTime*c,s)):this._fireBackwardSubAnimationEvents(e,n,a,s)},i._fireSubAnimationEvents=function(e,n,a,s){for(var l=e.currentEventIndex,c=n.length;l<c;l++){var u=n[l],h=u.event,f=h.time,d=h.parameter;if(f>s)break;var _=u,p=_.handlers;if(f>=a){for(var v=p.length-1;v>=0;v--)p[v](d);e.currentEventIndex=Math.min(l+1,c-1)}}},i._fireBackwardSubAnimationEvents=function(e,n,a,s){for(var l=e.currentEventIndex;l>=0;l--){var c=n[l],u=c.event,h=u.time,f=u.parameter;if(h<s)break;var d=c,_=d.handlers;if(h<=a){for(var p=_.length-1;p>=0;p--)_[p](f);e.currentEventIndex=Math.max(l-1,0)}}},i._callAnimatorScriptOnEnter=function(e,n){for(var a=e._onStateEnterScripts,s=0,l=a.length;s<l;s++)a[s].onStateEnter(this,e,n)},i._callAnimatorScriptOnUpdate=function(e,n){for(var a=e._onStateUpdateScripts,s=0,l=a.length;s<l;s++)a[s].onStateUpdate(this,e,n)},i._callAnimatorScriptOnExit=function(e,n){for(var a=e._onStateExitScripts,s=0,l=a.length;s<l;s++)a[s].onStateExit(this,e,n)},i._clearPlayData=function(){this._animatorLayersData.length=0,this._crossCurveDataCollection.length=0,this._animationCurveOwners.length=0,this._animationEventHandlerPool.resetPool(),this._controllerUpdateFlag&&(this._controllerUpdateFlag.flag=!1)},ie(o,[{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e}},{key:"animatorController",get:function(){return this._animatorController},set:function(e){e!==this._animatorController&&(this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e)}}]),o}(wr),lo._tempQuat=new Me,lo._animatorInfo=new Mx,lo),_f=j(Ar.prototype,"_speed",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vf=j(Ar.prototype,"_controllerUpdateFlag",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pf=j(Ar.prototype,"_animatorLayersData",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gf=j(Ar.prototype,"_crossCurveDataCollection",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mf=j(Ar.prototype,"_animationCurveOwners",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yf=j(Ar.prototype,"_crossCurveDataPool",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ci(Ex)}}),xf=j(Ar.prototype,"_animationEventHandlerPool",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ci(Ax)}}),wf=j(Ar.prototype,"_baseTempValue",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new df}}),bf=j(Ar.prototype,"_crossTempValue",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new df}}),Ar),cs=function(){function r(){this._updateFlagManager=new Ki,this._layers=[],this._layersMap={}}var o=r.prototype;return o.findLayerByName=function(t){return this._layersMap[t]},o.addLayer=function(t){this._layers.push(t),this._layersMap[t.name]=t,this._distributeUpdateFlag()},o.removeLayer=function(t){var e=this.layers[t];this._layers.splice(t,1),delete this._layersMap[e.name],this._distributeUpdateFlag()},o.clearLayers=function(){this._layers.length=0;for(var t in this._layersMap)delete this._layersMap[t];this._distributeUpdateFlag()},o._registerChangeFlag=function(){return this._updateFlagManager.createFlag(qa)},o._distributeUpdateFlag=function(){this._updateFlagManager.dispatch()},ie(r,[{key:"layers",get:function(){return this._layers}}]),r}(),us=function(o){this.name=o,this.weight=1,this.blendingMode=Ha.Override,this.stateMachine=void 0},el=function(){function r(){this._destroyed=!1,this._state=void 0}var o=r.prototype;return o.onStateEnter=function(t,e,n){},o.onStateUpdate=function(t,e,n){},o.onStateExit=function(t,e,n){},o.destroy=function(){this._destroyed||(this._state._removeStateMachineScript(this),this._destroyed=!0)},r}(),Ov=function(){function r(i){this.name=i,this.speed=1,this.wrapMode=na.Loop,this._onStateEnterScripts=[],this._onStateUpdateScripts=[],this._onStateExitScripts=[],this._clipStartTime=0,this._clipEndTime=1,this._clip=void 0,this._transitions=[]}var o=r.prototype;return o.addTransition=function(t){this._transitions.push(t)},o.removeTransition=function(t){var e=this._transitions.indexOf(t);e!==-1&&this._transitions.splice(e,1)},o.addStateMachineScript=function(t){var e=new t;e._state=this;var n=el.prototype;return e.onStateEnter!==n.onStateEnter&&this._onStateEnterScripts.push(e),e.onStateUpdate!==n.onStateUpdate&&this._onStateUpdateScripts.push(e),e.onStateExit!==n.onStateExit&&this._onStateExitScripts.push(e),e},o.clearTransitions=function(){this._transitions.length=0},o._getDuration=function(){return this.clip?(this._clipEndTime-this._clipStartTime)*this.clip.length:null},o._removeStateMachineScript=function(t){var e=el.prototype;if(t.onStateEnter!==e.onStateEnter){var n=this._onStateEnterScripts.indexOf(t);n!==-1&&this._onStateEnterScripts.splice(n,1)}if(t.onStateUpdate!==e.onStateUpdate){var a=this._onStateUpdateScripts.indexOf(t);a!==-1&&this._onStateUpdateScripts.splice(a,1)}if(t.onStateExit!==e.onStateExit){var s=this._onStateExitScripts.indexOf(t);s!==-1&&this._onStateExitScripts.splice(s,1)}},ie(r,[{key:"transitions",get:function(){return this._transitions}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip=t,this._clipEndTime=Math.min(this._clipEndTime,1)}},{key:"clipStartTime",get:function(){return this._clipStartTime},set:function(t){this._clipStartTime=Math.max(t,0)}},{key:"clipEndTime",get:function(){return this._clipEndTime},set:function(t){this._clipEndTime=Math.min(t,1)}}]),r}(),hs=function(){function r(){this.states=[],this._statesMap={}}var o=r.prototype;return o.addState=function(t){var e=this.findStateByName(t);return e?console.warn("The state named "+t+" has existed."):(e=new Ov(t),this.states.push(e),this._statesMap[t]=e),e},o.removeState=function(t){var e=t.name,n=this.states.indexOf(t);n>-1&&this.states.splice(n,1),delete this._statesMap[e]},o.findStateByName=function(t){return this._statesMap[t]},o.makeUniqueStateName=function(t){for(var e=this._statesMap,n=t,a=0;e[t];)t=n+" "+a,a++;return t},r}(),Jr;(function(r){r[r.Linear=0]="Linear",r[r.CubicSpine=1]="CubicSpine",r[r.Step=2]="Step",r[r.Hermite=3]="Hermite"})(Jr||(Jr={}));var Nv=function(){function r(){this.keys=[],this.interpolation=void 0,this._valueSize=void 0,this._valueType=void 0,this._tempValue=void 0,this._length=0,this._currentIndex=0}var o=r.prototype;return o.addKey=function(t){var e=t.time;if(this.keys.push(t),e>this._length&&(this._length=e),!this._valueSize&&(typeof t.value=="number"&&(this._valueSize=1,this._valueType=De.Float,this._tempValue=0),t.value instanceof Z&&(this._valueSize=2,this._valueType=De.Vector2,this._tempValue=new Z),t.value instanceof y&&(this._valueSize=3,this._valueType=De.Vector3,this._tempValue=new y),t.value instanceof qe&&(this._valueSize=4,this._valueType=De.Vector4,this._tempValue=new qe),t.value instanceof Me&&(this._valueSize=4,this._valueType=De.Quaternion,this._tempValue=new Me),t.value instanceof Float32Array)){var n=t.value.length;this._valueSize=n,this._valueType=De.FloatArray,this._tempValue=new Float32Array(n)}this.keys.sort(function(a,s){return a.time-s.time})},o.evaluate=function(t){return this._evaluate(t,this._tempValue)},o.moveKey=function(t,e){this.keys[t]=e},o.removeKey=function(t){this.keys.splice(t,1);for(var e=this.keys,n=this.keys.length,a=0,s=n-1;s>=0;s--)e[s].time>length&&(a=e[s].time);this._length=a},o._evaluate=function(t,e){var n=this.keys,a=this.interpolation;this._valueType;var s=this.keys.length,l=this._currentIndex;l!==-1&&t<n[l].time&&(l=-1);for(var c=l+1;c<s&&!(t<n[c].time);)l++,c++;this._currentIndex=l;var u;if(l===-1)u=this._evaluateStep(0,e);else if(c===s)u=this._evaluateStep(l,e);else{var h=n[l].time,f=n[c].time-h,d=(t-h)/f,_=f;switch(a){case Jr.Linear:u=this._evaluateLinear(l,c,d,e);break;case Jr.Step:u=this._evaluateStep(l,e);break;case Jr.CubicSpine:case Jr.Hermite:u=this._evaluateHermite(l,c,d,_,e)}}return u},o._evaluateLinear=function(t,e,n,a){var s=this._valueType,l=this.keys;switch(s){case De.Float:return l[t].value*(1-n)+l[e].value*n;case De.FloatArray:for(var c=l[t].value,u=l[e].value,h=0,f=c.length;h<f;h++)a[h]=c[h]*(1-n)+u[h]*n;return a;case De.Vector2:return Z.lerp(l[t].value,l[e].value,n,a),a;case De.Vector3:return y.lerp(l[t].value,l[e].value,n,a),a;case De.Vector4:return qe.lerp(l[t].value,l[e].value,n,a),a;case De.Quaternion:return Me.slerp(l[t].value,l[e].value,n,a),a}},o._evaluateStep=function(t,e){var n=this._valueType,a=this.keys;switch(n){case De.Float:return a[t].value;case De.FloatArray:for(var s=a[t].value,l=0,c=s.length;l<c;l++)e[l]=s[l];return e;case De.Vector2:case De.Vector3:case De.Vector4:case De.Quaternion:return e.copyFrom(a[t].value),e}},o._evaluateHermite=function(t,e,n,a,s){var l=this._valueSize,c=this.keys,u=c[t],h=c[e];switch(l){case 1:{var f=u.outTangent,d=h.inTangent,_=u.value,p=h.value;if(Number.isFinite(f)&&Number.isFinite(d)){var v=n*n,g=v*n,m=2*g-3*v+1,x=g-2*v+n,w=g-v,C=-2*g+3*v;return m*_+x*f*a+w*d*a+C*p}else return u.value}case 2:{var T=u.value,b=u.outTangent,M=h.value,I=h.inTangent,E=n*n,B=E*n,S=2*B-3*E+1,A=B-2*E+n,R=B-E,D=-2*B+3*E,z=b.x,U=I.x;return Number.isFinite(z)&&Number.isFinite(U)?s.x=S*T.x+A*z*a+R*U*a+D*M.x:s.x=T.x,z=b.y,U=I.y,Number.isFinite(z)&&Number.isFinite(U)?s.y=S*T.y+A*z*a+R*U*a+D*M.y:s.y=T.y,s}case 3:{var V=u.value,L=u.outTangent,J=h.value,oe=h.inTangent,le=n*n,te=le*n,Ae=2*te-3*le+1,Ie=te-2*le+n,G=te-le,ce=-2*te+3*le,pe=L.x,Pe=oe.x;return Number.isFinite(pe)&&Number.isFinite(Pe)?s.x=Ae*V.x+Ie*pe*a+G*Pe*a+ce*J.x:s.x=V.x,pe=L.y,Pe=oe.y,Number.isFinite(pe)&&Number.isFinite(Pe)?s.y=Ae*V.y+Ie*pe*a+G*Pe*a+ce*J.y:s.y=V.y,pe=L.z,Pe=oe.z,Number.isFinite(pe)&&Number.isFinite(Pe)?s.z=Ae*V.z+Ie*pe*a+G*Pe*a+ce*J.z:s.z=V.z,s}case 4:{var Te=u.value,Ye=u.outTangent,P=h.value,F=h.inTangent,O=n*n,W=O*n,H=2*W-3*O+1,Y=W-2*O+n,ee=W-O,K=-2*W+3*O,q=Ye.x,$=F.x;return Number.isFinite(q)&&Number.isFinite($)?s.x=H*Te.x+Y*q*a+ee*$*a+K*P.x:s.x=Te.x,q=Ye.y,$=F.y,Number.isFinite(q)&&Number.isFinite($)?s.y=H*Te.y+Y*q*a+ee*$*a+K*P.y:s.y=Te.y,q=Ye.z,$=F.z,Number.isFinite(q)&&Number.isFinite($)?s.z=H*Te.z+Y*q*a+ee*$*a+K*P.z:s.z=Te.z,q=Ye.w,$=F.w,Number.isFinite(q)&&Number.isFinite($)?s.w=H*Te.w+Y*q*a+ee*$*a+K*P.w:s.w=Te.w,s}}},ie(r,[{key:"length",get:function(){return this._length}}]),r}(),Uv=function(){this.time=void 0,this.value=void 0},ti=function(r){ne(o,r);function o(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return i=r.call.apply(r,[this].concat(e))||this,i.inTangent=void 0,i.outTangent=void 0,i}return o}(Uv),tl;(function(r){r[r.If=0]="If",r[r.IfNot=1]="IfNot",r[r.Greater=2]="Greater",r[r.Less=3]="Less",r[r.Equals=4]="Equals",r[r.NotEquals=5]="NotEquals"})(tl||(tl={}));var Vv=function(r){ne(o,r);function o(i){var t;return t=r.call(this,i,k.find("skybox"))||this,t._decodeParam=new qe(0,5,0,0),t.renderState.rasterState.cullMode=nr.Off,t.renderState.depthState.compareFunction=Xe.LessEqual,t.shaderData.setVector4("u_cubeDecodeParam",t._decodeParam),t}return ie(o,[{key:"textureDecodeRGBM",get:function(){return Boolean(this._decodeParam.x)},set:function(t){this._decodeParam.x=Number(t)}},{key:"RGBMDecodeFactor",get:function(){return this._decodeParam.y},set:function(t){this._decodeParam.y=t}},{key:"textureCubeMap",get:function(){return this.shaderData.getTexture("u_cube")},set:function(t){this.shaderData.setTexture("u_cube",t)}}]),o}(Ir),ze;(function(r){r[r.Position=1]="Position",r[r.Velocity=2]="Velocity",r[r.Acceleration=4]="Acceleration",r[r.Color=8]="Color",r[r.Alpha=16]="Alpha",r[r.Size=32]="Size",r[r.StartAngle=64]="StartAngle",r[r.StartTime=128]="StartTime",r[r.LifeTime=256]="LifeTime",r[r.RotateVelocity=512]="RotateVelocity",r[r.Scale=1024]="Scale",r[r.Everything=4294967295]="Everything"})(ze||(ze={}));var Wi;(function(r){r[r.Transparent=0]="Transparent",r[r.Additive=1]="Additive"})(Wi||(Wi={}));var Wl=function(r){ne(o,r),o._getRandom=function(){return Math.random()-.5};function o(t){var e;return e=r.call(this,t)||this,e._vertexStride=void 0,e._vertices=void 0,e._vertexBuffer=void 0,e._maxCount=1e3,e._position=new y,e._positionRandomness=new y,e._positionArray=void 0,e._velocity=new y,e._velocityRandomness=new y,e._acceleration=new y,e._accelerationRandomness=new y,e._color=new me(1,1,1,1),e._colorRandomness=0,e._size=1,e._sizeRandomness=0,e._alpha=1,e._alphaRandomness=0,e._startAngle=0,e._startAngleRandomness=0,e._rotateVelocity=0,e._rotateVelocityRandomness=0,e._lifetime=5,e._startTimeRandomness=0,e._scale=1,e._isOnce=!1,e._onceTime=0,e._time=0,e._isInit=!1,e._isStart=!1,e._updateDirtyFlag=ze.Everything,e._isRotateToVelocity=!1,e._isUseOriginColor=!1,e._isScaleByLifetime=!1,e._is2d=!0,e._isFadeIn=!1,e._isFadeOut=!1,e._playOnEnable=!0,e._blendMode=Wi.Transparent,e.spriteSheet=void 0,e.setMaterial(e._createMaterial()),e}var i=o.prototype;return i.update=function(e){if(!(!this._isInit||!this._isStart)){if(this._isOnce&&this._time>this._onceTime)return this.stop();this._updateDirtyFlag&&(this._updateBuffer(),this._updateDirtyFlag=0),this._time+=e/1e3,this.shaderData.setFloat("u_time",this._time)}},i._onEnable=function(){r.prototype._onEnable.call(this),this._playOnEnable&&this.start()},i.start=function(){this._isStart=!0,this._time=0},i.stop=function(){this._isStart=!1},i._createMaterial=function(){var e=new Ir(this.engine,k.find("particle-shader")),n=e.renderState,a=n.blendState.targetBlendState;return a.enabled=!0,a.sourceColorBlendFactor=xe.SourceAlpha,a.destinationColorBlendFactor=xe.OneMinusSourceAlpha,a.sourceAlphaBlendFactor=xe.One,a.destinationAlphaBlendFactor=xe.OneMinusSourceAlpha,n.depthState.writeEnabled=!1,e.renderQueueType=xt.Transparent,this.isUseOriginColor=!0,this.is2d=!0,this.isFadeOut=!0,e},i._createMesh=function(){var e=new as(this._entity.engine,"particleMesh"),n=96,a=this._maxCount*4,s=a*n,l=new Float32Array(s),c=null,u=!1;if(a>o._uint16VertexLimit)if(this.engine._hardwareRenderer.canIUse(he.elementIndexUint))u=!0,c=new Uint32Array(6*this._maxCount);else throw Error("The vertex count is over limit.");else c=new Uint16Array(6*this._maxCount);for(var h=0,f=0;h<this._maxCount;++h){var d=h*4;c[f++]=d,c[f++]=d+1,c[f++]=d+2,c[f++]=d,c[f++]=d+2,c[f++]=d+3}var _=[new Ve("a_position",0,fe.Vector3,0),new Ve("a_velocity",12,fe.Vector3,0),new Ve("a_acceleration",24,fe.Vector3,0),new Ve("a_color",36,fe.Vector4,0),new Ve("a_lifeAndSize",52,fe.Vector4,0),new Ve("a_rotation",68,fe.Vector2,0),new Ve("a_uv",76,fe.Vector3,0),new Ve("a_normalizedUv",88,fe.Vector2,0)],p=new dn(this.engine,Lr.VertexBuffer,s*4,Rt.Dynamic),v=new dn(this.engine,Lr.IndexBuffer,c,Rt.Dynamic);return e.setVertexBufferBinding(p,n),e.setIndexBufferBinding(v,u?gt.UInt32:gt.UInt16),e.setVertexElements(_),e.addSubMesh(0,c.length),this._vertexBuffer=p,this._vertexStride=n/4,this._vertices=l,e},i._updateBuffer=function(){for(var e=0;e<this._maxCount;e++)this._updateSingleBuffer(e);this._vertexBuffer.setData(this._vertices)},i._updateSingleBuffer=function(e){var n=this._updateDirtyFlag,a=this._vertices,s=this._vertexStride,l=o._getRandom,c=e*4,u=c*s,h=(c+1)*s,f=(c+2)*s,d=(c+3)*s;if(n&ze.Position){var _=this._position,p=_.x,v=_.y,g=_.z,m=this._positionArray,x=this._positionRandomness;if(m){if(m.length!==this._maxCount)throw Error("The length of positionArray must be equal to maxCount.");var w=m[e];p+=w.x,v+=w.y,g+=w.z}else p+=l()*x.x,v+=l()*x.y,g+=l()*x.z;a[u]=a[h]=a[f]=a[d]=p,a[u+1]=a[h+1]=a[f+1]=a[d+1]=v,a[u+2]=a[h+2]=a[f+2]=a[d+2]=g}if(n&ze.Velocity){var C=this._velocity,T=this._velocityRandomness;a[u+3]=a[h+3]=a[f+3]=a[d+3]=C.x+l()*T.x,a[u+4]=a[h+4]=a[f+4]=a[d+4]=C.y+l()*T.y,a[u+5]=a[h+5]=a[f+5]=a[d+5]=C.z+l()*T.z}if(n&ze.Acceleration){var b=this._acceleration,M=this._accelerationRandomness;a[u+6]=a[h+6]=a[f+6]=a[d+6]=b.x+l()*M.x,a[u+7]=a[h+7]=a[f+7]=a[d+7]=b.y+l()*M.y,a[u+8]=a[h+8]=a[f+8]=a[d+8]=b.z+l()*M.z}if(n&ze.Color){var I=this._color,E=this._colorRandomness;a[u+9]=a[h+9]=a[f+9]=a[d+9]=Q.clamp(I.r+l()*E,0,1),a[u+10]=a[h+10]=a[f+10]=a[d+10]=Q.clamp(I.g+l()*E,0,1),a[u+11]=a[h+11]=a[f+11]=a[d+11]=Q.clamp(I.b+l()*E,0,1)}if(n&ze.Alpha&&(a[u+12]=a[h+12]=a[f+12]=a[d+12]=Q.clamp(this._alpha+l()*this._alphaRandomness,0,1)),n&ze.StartTime&&(a[u+13]=a[h+13]=a[f+13]=a[d+13]=Math.random()*this._startTimeRandomness),n&ze.LifeTime){var B=this._lifetime;a[u+14]=a[h+14]=a[f+14]=a[d+14]=B+l()*B}if((n&ze.StartTime||n&ze.LifeTime)&&(this._onceTime=Math.max(this._onceTime,a[u+13]+a[u+14])),n&ze.Size){var S=this._size;a[u+15]=a[h+15]=a[f+15]=a[d+15]=Math.max(S+l()*this._sizeRandomness*S*2,0)}n&ze.Scale&&(a[u+16]=a[h+16]=a[f+16]=a[d+16]=this._scale),n&ze.StartAngle&&(a[u+17]=a[h+17]=a[f+17]=a[d+17]=this._startAngle+l()*Math.PI*this._startAngleRandomness*2),n&ze.RotateVelocity&&(a[u+18]=a[h+18]=a[f+18]=a[d+18]=this._rotateVelocity+l()*this._rotateVelocityRandomness),this._updateSingleUv(e,u,h,f,d)},i._updateSingleUv=function(e,n,a,s,l){var c=this.spriteSheet,u=this.getMaterial().shaderData.getTexture("u_texture"),h=this._vertices;if(u){var f=u.width,d=u.height;if(c){var _=c[e%c.length],p=_.x,v=_.y,g=_.w,m=_.h,x=p/f,w=v/d,C=x+g/f,T=w+m/d,b=m/g;h[n+19]=x,h[n+20]=T,h[n+21]=b,h[a+19]=C,h[a+20]=T,h[a+21]=b,h[s+19]=C,h[s+20]=w,h[s+21]=b,h[l+19]=x,h[l+20]=w,h[l+21]=b}else{var M=d/f;h[n+19]=0,h[n+20]=1,h[n+21]=M,h[a+19]=1,h[a+20]=1,h[a+21]=M,h[s+19]=1,h[s+20]=0,h[s+21]=M,h[l+19]=0,h[l+20]=0,h[l+21]=M}}else h[n+19]=0,h[n+20]=0,h[n+21]=1,h[a+19]=1,h[a+20]=0,h[a+21]=1,h[s+19]=1,h[s+20]=1,h[s+21]=1,h[l+19]=0,h[l+20]=1,h[l+21]=1;h[n+22]=-.5,h[n+23]=-.5,h[a+22]=.5,h[a+23]=-.5,h[s+22]=.5,h[s+23]=.5,h[l+22]=-.5,h[l+23]=.5},ie(o,[{key:"texture",get:function(){return this.getMaterial().shaderData.getTexture("u_texture")},set:function(e){e?(this.shaderData.enableMacro("particleTexture"),this.getMaterial().shaderData.setTexture("u_texture",e)):this.shaderData.disableMacro("particleTexture")}},{key:"position",get:function(){return this._position},set:function(e){this._updateDirtyFlag|=ze.Position,this._position=e}},{key:"positionRandomness",get:function(){return this._positionRandomness},set:function(e){this._updateDirtyFlag|=ze.Position,this._positionRandomness=e}},{key:"positionArray",get:function(){return this._positionArray},set:function(e){this._updateDirtyFlag|=ze.Position,this._positionArray=e}},{key:"velocity",get:function(){return this._velocity},set:function(e){this._updateDirtyFlag|=ze.Velocity,this._velocity=e}},{key:"velocityRandomness",get:function(){return this._velocityRandomness},set:function(e){this._updateDirtyFlag|=ze.Velocity,this._velocityRandomness=e}},{key:"acceleration",get:function(){return this._acceleration},set:function(e){this._updateDirtyFlag|=ze.Acceleration,this._acceleration=e}},{key:"accelerationRandomness",get:function(){return this._accelerationRandomness},set:function(e){this._updateDirtyFlag|=ze.Acceleration,this._accelerationRandomness=e}},{key:"color",get:function(){return this._color},set:function(e){this._updateDirtyFlag|=ze.Color,this._color=e}},{key:"colorRandomness",get:function(){return this._colorRandomness},set:function(e){this._updateDirtyFlag|=ze.Color,this._colorRandomness=e}},{key:"size",get:function(){return this._size},set:function(e){this._updateDirtyFlag|=ze.Size,this._size=e}},{key:"sizeRandomness",get:function(){return this._sizeRandomness},set:function(e){this._updateDirtyFlag|=ze.Size,this._sizeRandomness=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._updateDirtyFlag|=ze.Alpha,this._alpha=e}},{key:"alphaRandomness",get:function(){return this._alphaRandomness},set:function(e){this._updateDirtyFlag|=ze.Alpha,this._alphaRandomness=e}},{key:"angle",get:function(){return this._startAngle},set:function(e){this._updateDirtyFlag|=ze.StartAngle,this._startAngle=e}},{key:"angleRandomness",get:function(){return this._startAngleRandomness},set:function(e){this._updateDirtyFlag|=ze.StartAngle,this._startAngleRandomness=e}},{key:"rotateVelocity",get:function(){return this._rotateVelocity},set:function(e){this._updateDirtyFlag|=ze.RotateVelocity,this._rotateVelocity=e}},{key:"rotateVelocityRandomness",get:function(){return this._rotateVelocityRandomness},set:function(e){this._updateDirtyFlag|=ze.RotateVelocity,this._rotateVelocityRandomness=e}},{key:"lifetime",get:function(){return this._lifetime},set:function(e){this._updateDirtyFlag|=ze.LifeTime,this._lifetime=e,this._onceTime=0}},{key:"startTimeRandomness",get:function(){return this._startTimeRandomness},set:function(e){this._updateDirtyFlag|=ze.StartTime,this._startTimeRandomness=e,this._onceTime=0}},{key:"scale",get:function(){return this._scale},set:function(e){this._updateDirtyFlag|=ze.Scale,this._scale=e}},{key:"maxCount",get:function(){return this._maxCount},set:function(e){this._isStart=!1,this._isInit=!1,this._maxCount=e,this._updateDirtyFlag=ze.Everything,this.mesh=this._createMesh(),this._updateBuffer(),this._isInit=!0,this.shaderData.setFloat("u_time",0)}},{key:"isOnce",get:function(){return this._isOnce},set:function(e){this._time=0,this.shaderData.setInt("u_once",e?1:0),this._isOnce=e}},{key:"isRotateToVelocity",get:function(){return this._isRotateToVelocity},set:function(e){e?this.shaderData.enableMacro("rotateToVelocity"):this.shaderData.disableMacro("rotateToVelocity"),this._isRotateToVelocity=e}},{key:"isUseOriginColor",get:function(){return this._isUseOriginColor},set:function(e){e?this.shaderData.enableMacro("useOriginColor"):this.shaderData.disableMacro("useOriginColor"),this._isUseOriginColor=e}},{key:"isScaleByLifetime",get:function(){return this._isScaleByLifetime},set:function(e){e?this.shaderData.enableMacro("isScaleByLifetime"):this.shaderData.disableMacro("isScaleByLifetime"),this._isScaleByLifetime=e}},{key:"is2d",get:function(){return this._is2d},set:function(e){e?this.shaderData.enableMacro("is2d"):(this.shaderData.disableMacro("is2d"),this.getMaterial().renderState.rasterState.cullMode=nr.Off),this._is2d=e}},{key:"isFadeIn",get:function(){return this._isFadeIn},set:function(e){e?this.shaderData.enableMacro("fadeIn"):this.shaderData.disableMacro("fadeIn"),this._isFadeIn=e}},{key:"isFadeOut",get:function(){return this._isFadeOut},set:function(e){e?this.shaderData.enableMacro("fadeOut"):this.shaderData.disableMacro("fadeOut"),this._isFadeOut=e}},{key:"playOnEnable",get:function(){return this._playOnEnable},set:function(e){this._playOnEnable=e,e?this.start():this.stop()}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){var n=this.getMaterial().renderState.blendState,a=n.targetBlendState;e===Wi.Transparent?(a.enabled=!0,a.sourceColorBlendFactor=xe.SourceAlpha,a.destinationColorBlendFactor=xe.OneMinusSourceAlpha,a.sourceAlphaBlendFactor=xe.One,a.destinationAlphaBlendFactor=xe.OneMinusSourceAlpha):e===Wi.Additive&&(a.enabled=!0,a.sourceColorBlendFactor=xe.SourceAlpha,a.destinationColorBlendFactor=xe.One,a.sourceAlphaBlendFactor=xe.One,a.destinationAlphaBlendFactor=xe.OneMinusSourceAlpha),this._blendMode=e}}]),o}(yi);Wl._uint16VertexLimit=65535;var Rx=`#define GLSLIFY 1
varying vec2 v_uv;uniform sampler2D u_texture;void main(void){gl_FragColor=texture2D(u_texture,v_uv);}`,Fx=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;uniform mat4 u_projMat;uniform mat4 u_viewMat;void main(){gl_Position=u_projMat*u_viewMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`;k.create("trail",Fx,Rx);var kv=function(r){ne(o,r);function o(i){var t;t=r.call(this,i,k.find("trail"))||this;var e=t.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=xe.SourceAlpha,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=xe.One,t.renderState.depthState.writeEnabled=!1,t}return o}(Ir),Sf=new y,Bx=function(r){ne(o,r);function o(t,e){var n;n=r.call(this,t)||this,n._vertexStride=void 0,n._vertices=void 0,n._vertexBuffer=void 0,n._stroke=void 0,n._minSeg=void 0,n._lifetime=void 0,n._maxPointNum=void 0,n._points=void 0,n._pointStates=void 0,n._strapPoints=void 0,n._curPointNum=void 0,n._prePointsNum=void 0,n._stroke=e.stroke||.2,n._minSeg=e.minSeg||.02,n._lifetime=e.lifetime||1e3,n._maxPointNum=n._lifetime/1e3*t.engine.targetFrameRate,n._points=[],n._pointStates=[],n._strapPoints=[];for(var a=0;a<n._maxPointNum;a++)n._points.push(new y),n._pointStates.push(n._lifetime),n._strapPoints.push(new y),n._strapPoints.push(new y);n._curPointNum=0;var s=e.material||new kv(n.engine);return n.setMaterial(s),n.setTexture(e.texture),n._initGeometry(),n}var i=o.prototype;return i.update=function(e){for(var n=0,a=0,s=0;s<this._curPointNum;s++)this._pointStates[s]-=e,this._pointStates[s]<0?n++:n>0&&(a=s-n,this._pointStates[a]=this._pointStates[s],this._points[a].copyFrom(this._points[s]));this._curPointNum-=n;var l=!0;if(this._curPointNum===this._maxPointNum)l=!1;else if(this._curPointNum>0){var c=this._points[this._points.length-1];y.distance(this.entity.transform.worldPosition,c)<this._minSeg&&(l=!1)}l&&(this._pointStates[this._curPointNum]=this._lifetime,this._points[this._curPointNum].copyFrom(this.entity.transform.worldPosition),this._curPointNum++)},i._render=function(e){this._updateStrapVertices(e,this._points),this._updateStrapCoords(),this._vertexBuffer.setData(this._vertices),r.prototype._render.call(this,e)},i.setTexture=function(e){e&&this.getMaterial().shaderData.setTexture("u_texture",e)},i._initGeometry=function(){var e=new as(this._entity.engine),n=20,a=this._maxPointNum*2,s=a*n,l=new Float32Array(s),c=[new Ve("POSITION",0,fe.Vector3,0),new Ve("TEXCOORD_0",12,fe.Vector2,0)],u=new dn(this.engine,s*4,Rt.Dynamic);e.setVertexBufferBinding(u,n),e.setVertexElements(c),e.addSubMesh(0,a,kn.TriangleStrip),this._vertexBuffer=u,this._vertexStride=n,this._vertices=l,this.mesh=e},i._updateStrapVertices=function(e,n){var a=e.viewMatrix,s=a.elements,l=new y(s[0],s[4],s[8]),c=new y(s[1],s[5],s[9]),u=new y(s[2],s[6],s[10]),h=this._stroke;c.scale(h);var f=new y,d=new y,_=new Me;y.transformByQuat(l,_,l),y.transformByQuat(c,_,c);var p=new y,v=new y,g=new y;l.normalize();for(var m=this._vertices,x=0;x<this._maxPointNum;x++){if(x<this._curPointNum){var w=n[x];x===this._curPointNum-1&&x!==0?y.subtract(w,n[x-1],g):y.subtract(n[x+1],w,g),this._projectOnPlane(g,u,g),g.normalize();var C=Math.acos(y.dot(l,g));y.cross(l,g,v),y.dot(v,u)<=0&&(C=Math.PI*2-C),Me.rotationAxisAngle(u,C,_),y.transformByQuat(c,_,p),y.add(w,p,f),y.subtract(w,p,d)}var T=x*2*this._vertexStride/4,b=(x*2+1)*this._vertexStride/4;m[T]=f.x,m[T+1]=f.y,m[T+2]=f.z,m[b]=d.x,m[b+1]=d.y,m[b+2]=d.z}},i._updateStrapCoords=function(){if(this._prePointsNum!==this._curPointNum){this._prePointsNum=this._curPointNum;for(var e=this._curPointNum,n=1/e,a=this._vertices,s=0;s<e;s++){var l=1-s*n,c=s*2*this._vertexStride/4,u=(s*2+1)*this._vertexStride/4;a[c]=0,a[c+1]=l,a[u]=1,a[u+1]=l}}},i._projectOnVector=function(e,n,a){var s=n.clone();y.normalize(s,s);var l=y.dot(e,s);a.x=s.x*l,a.y=s.y*l,a.z=s.z*l},i._projectOnPlane=function(e,n,a){this._projectOnVector(e,n,Sf),y.subtract(e,Sf,a)},o}(yi),fs=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,e._color=new me(1,0,0,1),e.color=e._color,e}var i=o.prototype;return i._onEnable=function(){this.scene.shaderData.enableMacro("O3_HAS_FOG")},i._onDisable=function(){this.scene.shaderData.disableMacro("O3_HAS_FOG")},ie(o,[{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.scene.shaderData.setColor(o._colorProperty,e)}}]),o}(wr);fs._colorProperty=k.getPropertyByName("u_fogColor");var Gv=function(r){ne(o,r);function o(t){var e;return e=r.call(this,t)||this,e._density=.0025,e.density=e._density,e}var i=o.prototype;return i._onEnable=function(){this.scene.shaderData.enableMacro("O3_FOG_EXP2")},i._onDisable=function(){this.scene.shaderData.disableMacro("O3_FOG_EXP2")},ie(o,[{key:"density",get:function(){return this._density},set:function(e){this._density=e,this.scene.shaderData.setFloat(o._densityProperty,e)}}]),o}(fs);Gv._densityProperty=k.getPropertyByName("u_fogDensity");var Xl=function(r){ne(o,r);function o(i){var t;return t=r.call(this,i)||this,t._near=1,t._far=1e3,t.near=t._near,t.far=t._far,t}return ie(o,[{key:"near",get:function(){return this._near},set:function(t){this._near=t,this.scene.shaderData.setFloat(o._nearProperty,t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this.scene.shaderData.setFloat(o._farProperty,t)}}]),o}(fs);Xl._nearProperty=k.getPropertyByName("u_fogNear");Xl._farProperty=k.getPropertyByName("u_fogFar");var Hv=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.probeLayer=Tt.Everything,t.width=1024,t.height=1024,t.antiAliasing=1,t._isCube=!1,t._oriCameraRenderTarget=void 0,t._renderTarget=void 0,t._renderTargetSwap=void 0,t._activeRenderTarget=void 0,t._camera=void 0,t._oriCameraCullingMask=void 0,t}var i=o.prototype;return i.onTextureChange=function(e){},i.onBeginRender=function(e){!this.enabled||(this._camera=e,this._oriCameraCullingMask=e.cullingMask,e.cullingMask=this.probeLayer,(!this._activeRenderTarget||this._activeRenderTarget.width!==this.width||this._activeRenderTarget.height!==this.height||this._activeRenderTarget.antiAliasing!==this.antiAliasing)&&(this._renderTarget=new Bo(this.engine,this.width,this.height,this._isCube?new tr(this.engine,this.width):new yr(this.engine,this.width,this.height),vt.Depth,this.antiAliasing),this._renderTargetSwap=new Bo(this.engine,this.width,this.height,this._isCube?new tr(this.engine,this.width):new yr(this.engine,this.width,this.height),vt.Depth,this.antiAliasing),this._activeRenderTarget=this._renderTarget),this._oriCameraRenderTarget=e.renderTarget,e.renderTarget=this._activeRenderTarget)},i.onEndRender=function(e){!this.enabled||(this.onTextureChange&&this.onTextureChange(this._texture),this._activeRenderTarget=this._activeRenderTarget===this._renderTarget?this._renderTargetSwap:this._renderTarget)},i._reset=function(){!this.enabled||(this._camera.renderTarget=this._oriCameraRenderTarget,this._camera.cullingMask=this._oriCameraCullingMask)},ie(o,[{key:"_texture",get:function(){var e;return(e=this._activeRenderTarget)===null||e===void 0?void 0:e.getColorTexture()}}]),o}(mn),Cf=new y,qn=new y,Yn=new y,Ix=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.position=new y(0,0,0),t._isCube=!0,t.oriViewMatrix=new ge,t._oriFieldOfView=void 0,t}var i=o.prototype;return i.onBeginRender=function(e){if(!!this.enabled){r.prototype.onBeginRender.call(this,e),this._storeCamera(e);for(var n=0;n<6;n++)this._setCamera(n,e),e.render(jt.PositiveX+n);this._restoreCamera(e),r.prototype._reset.call(this)}},i._storeCamera=function(e){this.oriViewMatrix.copyFrom(e.viewMatrix),this._oriFieldOfView=e.fieldOfView},i._restoreCamera=function(e){e.viewMatrix.copyFrom(this.oriViewMatrix),e.fieldOfView=this._oriFieldOfView},i._setCamera=function(e,n){switch(e){case 0:qn.set(0,-1,0),Yn.set(1,0,0);break;case 1:qn.set(0,-1,0),Yn.set(-1,0,0);break;case 2:qn.set(0,0,1),Yn.set(0,1,0);break;case 3:qn.set(0,0,-1),Yn.set(0,-1,0);break;case 4:qn.set(0,-1,0),Yn.set(0,0,1);break;case 5:qn.set(0,-1,0),Yn.set(0,0,-1);break}y.add(this.position,Yn,Cf),ge.lookAt(this.position,Cf,qn,n.viewMatrix),n.fieldOfView=90},o}(Hv),pt=function(){r._updateShaderData=function(t){var e=r._combinedData;t.setFloatArray(r._viewMatFromLightProperty,e.viewMatrix),t.setFloatArray(r._projMatFromLightProperty,e.projectionMatrix),t.setFloatArray(r._shadowBiasProperty,e.bias),t.setFloatArray(r._shadowIntensityProperty,e.intensity),t.setFloatArray(r._shadowRadiusProperty,e.radius),t.setFloatArray(r._shadowMapSizeProperty,e.mapSize),t.setTextureArray(r._shadowMapsProperty,e.map)},r.clearMap=function(){r._combinedData.map.length=0};function r(i,t){t===void 0&&(t={engine:null,width:512,height:512}),this._mapSize=void 0,this._renderTarget=void 0,this.light=void 0,this.bias=.005,this.intensity=.2,this.radius=1,this.projectionMatrix=new ge,this.light=i;var e=t,n=e.engine,a=e.width,s=e.height;this._mapSize=new Z(a,s),this._renderTarget=new Bo(n,a,s,new yr(n,a,s))}var o=r.prototype;return o.initShadowProjectionMatrix=function(t){if(t instanceof Yt&&ge.ortho(-5,5,-5,5,.1,50,this.projectionMatrix),t instanceof xr&&ge.perspective(Q.degreeToRadian(50),1,.5,50,this.projectionMatrix),t instanceof Ht){var e=Math.min(Math.PI/2,t.angle*2*Math.sqrt(2));ge.perspective(e,1,.1,t.distance+5,this.projectionMatrix)}},o.appendData=function(t){var e=t*16,n=t*16,a=t,s=t,l=t,c=t*2,u=t,h=r._combinedData;h.viewMatrix.set(this.light.viewMatrix.elements,e),h.projectionMatrix.set(this.projectionMatrix.elements,n),h.bias[a]=this.bias,h.intensity[s]=this.intensity,h.radius[l]=this.radius,h.mapSize[c]=this.mapSize.x,h.mapSize[c+1]=this.mapSize.y,h.map[u]=this.map},ie(r,[{key:"renderTarget",get:function(){return this._renderTarget}},{key:"map",get:function(){return this._renderTarget.getColorTexture()}},{key:"mapSize",get:function(){return this._mapSize}}]),r}();pt._viewMatFromLightProperty=k.getPropertyByName("u_viewMatFromLight");pt._projMatFromLightProperty=k.getPropertyByName("u_projMatFromLight");pt._shadowBiasProperty=k.getPropertyByName("u_shadowBias");pt._shadowIntensityProperty=k.getPropertyByName("u_shadowIntensity");pt._shadowRadiusProperty=k.getPropertyByName("u_shadowRadius");pt._shadowMapSizeProperty=k.getPropertyByName("u_shadowMapSize");pt._shadowMapsProperty=k.getPropertyByName("u_shadowMaps");pt._maxLight=3;pt._combinedData={viewMatrix:new Float32Array(16*pt._maxLight),projectionMatrix:new Float32Array(16*pt._maxLight),bias:new Float32Array(pt._maxLight),intensity:new Float32Array(pt._maxLight),radius:new Float32Array(pt._maxLight),mapSize:new Float32Array(2*pt._maxLight),map:[]};Object.defineProperty(wt.prototype,"enableShadow",{get:function(){return this._enableShadow},set:function(o){if(this._enableShadow=o,this._enableShadow){if(this instanceof or){this._enableShadow=!1,Fe.warn("Has no shadow!");return}this.shadow=this.shadow||new pt(this,{engine:this.engine,width:512,height:512}),this.shadow.initShadowProjectionMatrix(this)}}});Object.defineProperty(wr.prototype,"receiveShadow",{get:function(){return this._receiveShadow},set:function(o){this._receiveShadow=o}});Object.defineProperty(wr.prototype,"castShadow",{get:function(){return this._castShadow},set:function(o){this._castShadow=o}});var zx=function(r){ne(o,r);function o(i){var t;return t=r.call(this,i,k.find("shadow-map"))||this,t.shaderData.enableMacro("O3_GENERATE_SHADOW_MAP"),t}return o}(Ir),jl=function(r){ne(o,r);function o(t,e,n,a,s,l){var c;return c=r.call(this,t,e,n,a,s)||this,c.light=void 0,c.light=l,c.clearColor=new me(1,1,1,1),c}var i=o.prototype;return i.preRender=function(e,n){var a=this.replaceMaterial.shaderData;a.setMatrix(o._viewMatFromLightProperty,this.light.viewMatrix),a.setMatrix(o._projMatFromLightProperty,this.light.shadow.projectionMatrix)},o}(ui);jl._viewMatFromLightProperty=k.getPropertyByName("u_viewMatFromLight");jl._projMatFromLightProperty=k.getPropertyByName("u_projMatFromLight");var Dx=function(r){ne(o,r);function o(i){var t;t=r.call(this,i,k.find("shadow"))||this;var e=t.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=xe.DestinationColor,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=xe.Zero,t.renderState.depthState.compareFunction=Xe.LessEqual,t.renderQueueType=xt.Transparent,t}return o}(Ir),Lx=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.clearFlags=Dr.None,t}var i=o.prototype;return i.preRender=function(e,n){this.enabled=!1;var a=e.scene.findFeature(xi),s=a.visibleLights,l=this.replaceMaterial.shaderData,c=e._renderPipeline.defaultRenderPass;this.renderTarget=c.renderTarget;var u=0;pt.clearMap();for(var h=0,f=s.length;h<f;h++){var d=s[h];d.enableShadow&&d.shadow.appendData(u++)}u?(this.enabled=!0,pt._updateShaderData(l),l.enableMacro("O3_SHADOW_MAP_COUNT",u.toString())):l.disableMacro("O3_SHADOW_MAP_COUNT")},o}(ui),Ox=function(r){ne(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t._shadowPass=void 0,t._shadowMapMaterial=void 0,t}var i=o.prototype;return i.preRender=function(e,n){var a=e.findFeature(xi).visibleLights;if(a.length>0){this._shadowPass||this.addShadowPass(n);for(var s=n._renderPipeline,l=0,c=a.length;l<c;l++){var u=a[l];u.enableShadow&&!u.shadowMapPass?u.shadowMapPass=this.addShadowMapPass(n,u):!u.enableShadow&&u.shadowMapPass&&(s.removeRenderPass(u.shadowMapPass),u.shadowMapPass=null)}this.updatePassRenderFlag(s._opaqueQueue),this.updatePassRenderFlag(s._alphaTestQueue),this.updatePassRenderFlag(s._transparentQueue)}},i.addShadowPass=function(e){var n=new Dx(e.engine);this._shadowPass=new Lx("ShadowPass",1,null,n,Tt.Layer30);var a=e._renderPipeline;a.addRenderPass(this._shadowPass)},i.addShadowMapPass=function(e,n){this._shadowMapMaterial=this._shadowMapMaterial||new zx(e.engine);var a=new jl("ShadowMapPass",-1,n.shadow.renderTarget,this._shadowMapMaterial,Tt.Layer31,n),s=e._renderPipeline;return s.addRenderPass(a),a},i.updatePassRenderFlag=function(e){for(var n=e.items,a=0,s=n.length;a<s;a++){var l=n[a],c=l.component,u=c.receiveShadow,h=c.castShadow;u===!0?c.entity.layer|=Tt.Layer30:u===!1&&(c.entity.layer&=~Tt.Layer30),h===!0?c.entity.layer|=Tt.Layer31:h===!1&&(c.entity.layer&=~Tt.Layer31)}},o}(Gl);Zr.registerFeature(Ox);Zr.registerFeature(xi);Zr.prototype.hasLight=k1;const Af=Object.freeze(Object.defineProperty({__proto__:null,AmbientLight:or,AnimationClip:Lv,AnimationClipCurveBinding:zv,AnimationCurve:Nv,AnimationEvent:Dv,get AnimationProperty(){return Re},Animator:Ja,get AnimatorConditionMode(){return tl},AnimatorController:cs,AnimatorControllerLayer:us,get AnimatorLayerBlendingMode(){return Ha},AnimatorState:Ov,AnimatorStateMachine:hs,AnimatorStateTransition:Hl,AssetPromise:st,get AssetPromiseStatus(){return li},get AssetType(){return tt},Background:Tv,get BackgroundMode(){return hn},get BackgroundTextureFillMode(){return Bn},BaseMaterial:Bt,BasicRenderPipeline:Rv,get BlendFactor(){return xe},get BlendMode(){return Hi},get BlendOperation(){return er},BlendShape:kl,BlendShapeFrame:Av,BlinnPhongMaterial:ha,BoolUpdateFlag:qa,BoxColliderShape:Il,Buffer:dn,get BufferBindFlag(){return Lr},BufferMesh:as,get BufferUsage(){return Rt},BufferUtil:ka,Camera:wi,get CameraClearFlags(){return Dr},CapsuleColliderShape:vv,CharacterController:_v,CloneManager:mr,Collider:rn,ColliderShape:ua,get ColliderShapeUpAxis(){return mi},get CollisionDetectionMode(){return Ro},get ColorSpace(){return Ln},get ColorWriteMask(){return Br},get CompareFunction(){return Xe},Component:wr,get ControllerCollisionFlag(){return Eo},get ControllerNonWalkableMode(){return Mo},CubeProbe:Ix,get CullMode(){return nr},get DataType(){return nt},get DiffuseMode(){return ra},DirectLight:Yt,DynamicCollider:Ey,get DynamicColliderConstraints(){return Ks},EXP2Fog:Gv,Engine:Or,EngineFeature:cx,EngineObject:pn,Entity:Qr,Event:Js,EventDispatcher:cv,FixedJoint:Cy,Fog:fs,Font:Io,get FontStyle(){return In},get GLCapabilityType(){return he},HingeJoint:Ay,HitResult:Bl,IndexBufferBinding:Fo,get IndexFormat(){return gt},InputManager:gv,InterpolableKeyframe:ti,get InterpolableValueType(){return De},get InterpolationType(){return Jr},Joint:ts,JointLimits:Ty,JointMotor:My,Keyframe:Uv,get Keys(){return yt},get Layer(){return Tt},Light:wt,LinearFog:Xl,ListenerUpdateFlag:es,Loader:rt,Logger:Fe,Material:Ir,Mesh:Ul,MeshRenderElement:xv,MeshRenderer:yi,get MeshTopology(){return kn},ModelMesh:ur,ObjectValues:Qs,get OverflowMode(){return bi},PBRBaseMaterial:Nr,PBRMaterial:fa,PBRSpecularMaterial:Ci,ParticleRenderer:Wl,get ParticleRendererBlendMode(){return Wi},PhysicsManager:Jt,PhysicsMaterial:dv,get PhysicsMaterialCombineMode(){return Va},PlaneColliderShape:Sy,PointLight:xr,Pointer:pv,get PointerButton(){return gi},get PointerPhase(){return Tr},PrimitiveMesh:Cv,Probe:Hv,RefObject:gn,get RenderBufferDepthFormat(){return vt},get RenderFace(){return ln},RenderPass:ui,RenderQueue:ei,get RenderQueueType(){return xt},RenderTarget:Bo,Renderer:Qa,ResourceManager:$a,Scene:Zr,SceneFeature:Gl,SceneManager:Mv,Script:mn,get SetDataOptions(){return Ga},Shader:k,ShaderData:Ya,ShaderFactory:Zn,ShaderProperty:Ll,get ShaderPropertyType(){return Ut},Skin:Sv,SkinnedMeshRenderer:ta,Sky:Pv,SkyBoxMaterial:Vv,SphereColliderShape:zl,SpotLight:Ht,SpringJoint:Py,Sprite:ls,SpriteAtlas:Fv,get SpriteDrawMode(){return sn},SpriteElement:wv,SpriteMask:Zs,get SpriteMaskInteraction(){return pr},get SpriteMaskLayer(){return ea},SpriteRenderer:Bv,StateMachineScript:el,StaticCollider:Dl,get StencilOperation(){return dt},SubMesh:Nl,SystemInfo:lx,get TextHorizontalAlignment(){return fi},TextRenderer:bx,get TextVerticalAlignment(){return di},Texture:Kr,Texture2D:yr,Texture2DArray:Vl,get TextureCoordinate(){return On},TextureCube:tr,get TextureCubeFace(){return jt},get TextureFilterMode(){return gr},get TextureFormat(){return se},get TextureWrapMode(){return qt},Time:uv,TrailMaterial:kv,TrailRenderer:Bx,Transform:rr,UnlitMaterial:ss,Util:mo,VertexBufferBinding:is,VertexElement:Ve,get VertexElementFormat(){return fe},get WrapMode(){return na},assignmentClone:Ze,deepClone:it,dependentComponents:ca,ignoreClone:ae,request:Pa,resourceLoader:mt,shallowClone:lv},Symbol.toStringTag,{value:"Module"}));var be;(function(r){r[r.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",r[r.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",r[r.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",r[r.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",r[r.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",r[r.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",r[r.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",r[r.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",r[r.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",r[r.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",r[r.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",r[r.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",r[r.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",r[r.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",r[r.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",r[r.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",r[r.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",r[r.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",r[r.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",r[r.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",r[r.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",r[r.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",r[r.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",r[r.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",r[r.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",r[r.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",r[r.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",r[r.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",r[r.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",r[r.R11_EAC=37488]="R11_EAC",r[r.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",r[r.RG11_EAC=37490]="RG11_EAC",r[r.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",r[r.RGB8_ETC2=37492]="RGB8_ETC2",r[r.SRGB8_ETC2=37493]="SRGB8_ETC2",r[r.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",r[r.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",r[r.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",r[r.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",r[r.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",r[r.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",r[r.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",r[r.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",r[r.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",r[r.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT"})(be||(be={}));function Pf(r,o){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),i.push.apply(i,t)}return i}function Nx(r){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?Pf(Object(i),!0).forEach(function(t){Ux(r,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Pf(Object(i)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}function Tf(r,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function ds(r,o,i){return o&&Tf(r.prototype,o),i&&Tf(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ux(r,o,i){return o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,r}function $l(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,rl(r,o)}function rl(r,o){return rl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rl(r,o)}var Vx=function(){var r=o.prototype;r.resizeByClientSize=function(t){t===void 0&&(t=window.devicePixelRatio);var e=this._webCanvas;(typeof OffscreenCanvas>"u"||!(e instanceof OffscreenCanvas))&&(this.width=e.clientWidth*t,this.height=e.clientHeight*t)};function o(i){this._webCanvas=void 0,this._width=void 0,this._height=void 0,this._scale=new Z;var t=i.width,e=i.height;this._webCanvas=i,this._width=t,this._height=e}return r.setScale=function(t,e){this._scale.set(t,e),this.scale=this._scale},ds(o,[{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._webCanvas.width=t,this._width=t)}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(this._webCanvas.height=t,this._height=t)}},{key:"scale",get:function(){var t=this._webCanvas;return(typeof OffscreenCanvas>"u"||!(t instanceof OffscreenCanvas))&&this._scale.set(t.clientWidth*devicePixelRatio/t.width,t.clientHeight*devicePixelRatio/t.height),this._scale},set:function(t){var e=this._webCanvas;(typeof OffscreenCanvas>"u"||!(e instanceof OffscreenCanvas))&&(e.style.transformOrigin="left top",e.style.transform="scale("+t.x+", "+t.y+")")}}]),o}(),kx=function(){function r(i){this._maxDrawBuffers=void 0,this._maxAnisoLevel=void 0,this._maxAntiAliasing=void 0,this._rhi=void 0,this.capabilityList=void 0,this._rhi=i,this.capabilityList=new Map,this._init(),this._compatibleAllInterface()}var o=r.prototype;return o.canIUse=function(t){return this.capabilityList.get(t)},o.canIUseCompressedTextureInternalFormat=function(t){var e=be.RGBA_ASTC_4X4_KHR,n=be.RGBA_ASTC_12X12_KHR,a=be.SRGB8_ALPHA8_ASTC_4X4_KHR,s=be.SRGB8_ALPHA8_ASTC_12X12_KHR,l=be.RGB_ETC1_WEBGL,c=be.R11_EAC,u=be.SRGB8_ALPHA8_ETC2_EAC,h=be.RGB_PVRTC_4BPPV1_IMG,f=be.RGBA_PVRTC_2BPPV1_IMG,d=be.RGB_S3TC_DXT1_EXT,_=be.RGBA_S3TC_DXT5_EXT;return t>=e&&n<=n||t>=a&&t<=s?this.canIUse(he.astc):t===l?this.canIUse(he.etc1):t>=c&&t<=u?this.canIUse(he.etc):t>=h&&t<=f?this.canIUse(he.pvrtc):t>=d&&t<=_?this.canIUse(he.s3tc):!1},o._init=function(){var t=this.capabilityList,e=this.rhi.isWebGL2,n=this.rhi.requireExtension.bind(this.rhi),a=he.shaderVertexID,s=he.standardDerivatives,l=he.shaderTextureLod,c=he.elementIndexUint,u=he.depthTexture,h=he.vertexArrayObject,f=he.instancedArrays,d=he.multipleSample,_=he.drawBuffers,p=he.astc,v=he.astc_webkit,g=he.etc,m=he.etc_webkit,x=he.etc1,w=he.etc1_webkit,C=he.pvrtc,T=he.pvrtc_webkit,b=he.s3tc,M=he.s3tc_webkit,I=he.textureFloat,E=he.textureHalfFloat,B=he.textureFloatLinear,S=he.textureHalfFloatLinear,A=he.WEBGL_colorBufferFloat,R=he.colorBufferFloat,D=he.colorBufferHalfFloat,z=he.textureFilterAnisotropic;t.set(a,e),t.set(s,e||!!n(s)),t.set(l,e||!!n(l)),t.set(c,e||!!n(c)),t.set(u,e||!!n(u)),t.set(h,e||!!n(h)),t.set(f,e||!!n(f)),t.set(d,e),t.set(_,e||!!n(_)),t.set(I,e||!!n(I)),t.set(E,e||!!n(E)),t.set(B,!!n(B)),t.set(S,e||!!n(S)),t.set(R,e&&!!n(R)||!!n(A)),t.set(D,e&&!!n(R)||!!n(D)),t.set(z,!!n(z)),t.set(p,!!(n(p)||n(v))),t.set(g,!!(n(g)||n(m))),t.set(x,!!(n(x)||n(w))),t.set(C,!!(n(C)||n(T))),t.set(b,!!(n(b)||n(M)))},o._compatibleInterface=function(t,e){var n=this.rhi,a=n.gl,s=null;if(s=n.requireExtension(t))for(var l in e){var c=e[l],u=s[c];u!=null&&u.bind?a[l]=u.bind(s):a[l]=u}},o._compatibleAllInterface=function(){var t=he.depthTexture,e=he.vertexArrayObject,n=he.instancedArrays,a=he.drawBuffers,s=he.textureFilterAnisotropic,l=he.textureHalfFloat,c=he.colorBufferHalfFloat,u=he.WEBGL_colorBufferFloat,h=this.rhi.isWebGL2;if(!h){this._compatibleInterface(t,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this._compatibleInterface(e,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this._compatibleInterface(n,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this._compatibleInterface(a,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var f={};if(this.canIUse(he.drawBuffers)){for(var d=this.maxDrawBuffers,_=0;_<d;_++)_!=0&&(f["COLOR_ATTACHMENT"+_]="COLOR_ATTACHMENT"+_+"_WEBGL"),f["DRAW_BUFFER"+_]="DRAW_BUFFER"+_+"_WEBGL";this._compatibleInterface(a,Nx({drawBuffers:"drawBuffersWEBGL"},f))}this._compatibleInterface(l,{HAFL_FLOAT:"HALF_FLOAT_OES"}),this._compatibleInterface(c,{RGBA16F:"RBGA16F_EXT"}),this._compatibleInterface(u,{RGBA32F:"RBGA32F_EXT"})}this._compatibleInterface(s,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},ds(r,[{key:"maxTextureSize",get:function(){return this.rhi.renderStates.getParameter(this.rhi.gl.MAX_TEXTURE_SIZE)}},{key:"canUseFloatTextureBlendShape",get:function(){return this.canIUse(he.shaderVertexID)&&this.canIUse(he.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(he.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(he.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var t=this._rhi.requireExtension(he.textureFilterAnisotropic);this._maxAnisoLevel=t?this._rhi.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var t=this._rhi.gl,e=this.canIUse(he.multipleSample);this._maxAntiAliasing=e?t.getParameter(t.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}}]),r}(),Gx=function(){function r(i){this.rhi=void 0,this._requireResult=void 0,this.rhi=i,this._requireResult={}}var o=r.prototype;return o.requireExtension=function(t){return this._requireResult[t]!==void 0?this._requireResult[t]:(this._requireResult[t]=this.rhi.gl.getExtension(t),this._requireResult[t])},r}(),Hx=function(){function r(i,t){this.attribLocArray=[],this._primitive=void 0,this.canUseInstancedArrays=void 0,this.gl=void 0,this.vao=new Map,this._useVao=void 0,this._primitive=t,this.canUseInstancedArrays=i.canIUse(he.instancedArrays),this._useVao=i.canIUse(he.vertexArrayObject),this.gl=i.gl}var o=r.prototype;return o.draw=function(t,e){var n=this.gl,a=this._primitive,s=this._useVao&&a._enableVAO;if(s){this.vao.has(t.id)||this.registerVAO(t);var l=this.vao.get(t.id);n.bindVertexArray(l)}else this.bindBufferAndAttrib(t);var c=a._indexBufferBinding,u=a._instanceCount,h=a._glIndexType,f=a._glIndexByteCount,d=e.topology,_=e.start,p=e.count;if(u)if(this.canUseInstancedArrays)if(c)if(this._useVao)n.drawElementsInstanced(d,p,h,_*f,u);else{var g=c.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,g),n.drawElementsInstanced(d,p,h,_*f,u),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArraysInstanced(d,_,p,u);else Fe.error("ANGLE_instanced_arrays extension is not supported");else if(c)if(s)n.drawElements(d,p,h,_*f);else{var v=c.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v),n.drawElements(d,p,h,_*f),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArrays(d,_,p);this._useVao?n.bindVertexArray(null):this.disableAttrib()},o.destroy=function(){if(this._useVao){var t=this.gl;this.vao.forEach(function(e){t.deleteVertexArray(e)}),this.vao.clear()}},o.bindBufferAndAttrib=function(t){var e=this.gl,n=this._primitive,a=n._vertexBufferBindings;this.attribLocArray.length=0;var s=t.attributeLocation,l=n._vertexElementMap,c,u;for(var h in s){var f=s[h];if(f!==-1){var d=l[h];if(d){var _=a[d.bindingIndex],p=_.buffer,v=_.stride;c=p._nativeBuffer,u!==c&&(u=c,e.bindBuffer(e.ARRAY_BUFFER,c)),e.enableVertexAttribArray(f);var g=d._glElementInfo;e.vertexAttribPointer(f,g.size,g.type,g.normalized,v,d.offset),this.canUseInstancedArrays&&e.vertexAttribDivisor(f,d.instanceStepRate),this.attribLocArray.push(f)}else Fe.warn("vertex attribute not found: "+h)}}e.bindBuffer(e.ARRAY_BUFFER,null)},o.disableAttrib=function(){for(var t=this.gl,e=0,n=this.attribLocArray.length;e<n;e++)t.disableVertexAttribArray(this.attribLocArray[e])},o.registerVAO=function(t){var e=this.gl,n=e.createVertexArray();e.bindVertexArray(n);var a=this._primitive._indexBufferBinding;a&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.buffer._nativeBuffer),this.bindBufferAndAttrib(t),e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.disableAttrib(),this.vao.set(t.id,n)},r}(),Wx=function(){function r(i){this._gl=void 0,this._parameters={},this._gl=i,this._parameters={},this._parameters[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[i.MAX_VERTEX_UNIFORM_VECTORS]=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[i.MAX_VERTEX_ATTRIBS]=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._parameters[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[i.MAX_TEXTURE_SIZE]=i.getParameter(i.MAX_TEXTURE_SIZE),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.colorMask(!0,!0,!0,!0),i.blendColor(0,0,0,0),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.enable(i.DEPTH_TEST),i.depthFunc(i.LESS),i.depthMask(!0),i.disable(i.STENCIL_TEST),i.stencilFuncSeparate(i.FRONT,i.ALWAYS,0,255),i.stencilFuncSeparate(i.BACK,i.ALWAYS,0,255),i.stencilOpSeparate(i.FRONT,i.KEEP,i.KEEP,i.KEEP),i.stencilOpSeparate(i.BACK,i.KEEP,i.KEEP,i.KEEP),i.stencilMask(255),i.enable(i.CULL_FACE),i.cullFace(i.BACK),i.disable(i.POLYGON_OFFSET_FILL),i.polygonOffset(0,0)}var o=r.prototype;return o.getParameter=function(t){return this._parameters[t]},r}(),St=function(){r._isPowerOf2=function(t){return(t&t-1)===0},r._getFormatDetail=function(t,e,n){switch(t){case se.R8G8B8:return{internalFormat:n?e.RGB8:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case se.R8G8B8A8:return{internalFormat:n?e.RGBA8:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case se.R4G4B4A4:return{internalFormat:n?e.RGBA4:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case se.R5G5B5A1:return{internalFormat:n?e.RGB5_A1:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case se.R5G6B5:return{internalFormat:n?e.RGB565:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case se.Alpha8:return{internalFormat:e.ALPHA,baseFormat:e.ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case se.LuminanceAlpha:return{internalFormat:e.LUMINANCE_ALPHA,baseFormat:e.LUMINANCE_ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case se.R16G16B16A16:return{internalFormat:e.RGBA16F,baseFormat:e.RGBA,dataType:e.HALF_FLOAT,isCompressed:!1};case se.R32G32B32A32:return{internalFormat:e.RGBA32F,baseFormat:e.RGBA,dataType:e.FLOAT,isCompressed:!1};case se.DXT1:return{internalFormat:be.RGB_S3TC_DXT1_EXT,isCompressed:!0};case se.DXT5:return{internalFormat:be.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case se.ETC1_RGB:return{internalFormat:be.RGB_ETC1_WEBGL,isCompressed:!0};case se.ETC2_RGB:return{internalFormat:be.RGB8_ETC2,isCompressed:!0};case se.ETC2_RGBA5:return{internalFormat:be.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case se.ETC2_RGBA8:return{internalFormat:be.RGBA8_ETC2_EAC,isCompressed:!0};case se.PVRTC_RGB2:return{internalFormat:be.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case se.PVRTC_RGBA2:return{internalFormat:be.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case se.PVRTC_RGB4:return{internalFormat:be.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case se.PVRTC_RGBA4:return{internalFormat:be.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case se.ASTC_4x4:return{internalFormat:be.RGBA_ASTC_4X4_KHR,isCompressed:!0};case se.ASTC_5x5:return{internalFormat:be.RGBA_ASTC_5X5_KHR,isCompressed:!0};case se.ASTC_6x6:return{internalFormat:be.RGBA_ASTC_6X6_KHR,isCompressed:!0};case se.ASTC_8x8:return{internalFormat:be.RGBA_ASTC_8X8_KHR,isCompressed:!0};case se.ASTC_10x10:return{internalFormat:be.RGBA_ASTC_10X10_KHR,isCompressed:!0};case se.ASTC_12x12:return{internalFormat:be.RGBA_ASTC_12X12_KHR,isCompressed:!0};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+t)}},r._getRenderBufferDepthFormatDetail=function(t,e,n){switch(t){case se.Depth:case vt.Depth:return{internalFormat:n?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:n?e.FLOAT:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case se.DepthStencil:case vt.DepthStencil:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case se.Stencil:case vt.Stencil:return{internalFormat:e.STENCIL_INDEX8,baseFormat:e.STENCIL_ATTACHMENT,dataType:e.UNSIGNED_BYTE,isCompressed:!1,attachment:e.STENCIL_ATTACHMENT};case se.Depth16:case vt.Depth16:return{internalFormat:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case se.Depth24:case vt.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case se.Depth32:case vt.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case se.Depth24Stencil8:case vt.Depth24Stencil8:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case se.Depth32Stencil8:case vt.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+t)}},r._supportTextureFormat=function(t,e){var n=!0;switch(t){case se.R16G16B16A16:e.canIUse(he.textureHalfFloat)||(n=!1);break;case se.R32G32B32A32:e.canIUse(he.textureFloat)||(n=!1);break}return n},r._supportRenderBufferColorFormat=function(t,e){var n=!0;switch(t){case se.R16G16B16A16:(!e.canIUse(he.colorBufferHalfFloat)||!e.canIUse(he.textureHalfFloat))&&(n=!1);break;case se.R32G32B32A32:(!e.canIUse(he.colorBufferFloat)||!e.canIUse(he.textureFloat))&&(n=!1);break}return n},r._supportRenderBufferDepthFormat=function(t,e,n){var a=e.isWebGL2,s=!0;if(n&&!e.canIUse(he.depthTexture))return!1;switch(t){case vt.Stencil:case se.Stencil:s=!1;break;case se.Depth24:case se.Depth32:case se.Depth32Stencil8:case vt.Depth24:case vt.Depth32:case vt.Depth32Stencil8:a||(s=!1);break}return s};function r(i,t,e){this._texture=void 0,this._glTexture=void 0,this._rhi=void 0,this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._formatDetail=void 0,this._texture=t,this._rhi=i,this._gl=i.gl,this._isWebGL2=i.isWebGL2,this._target=e,this._glTexture=this._gl.createTexture()}var o=r.prototype;return o.destroy=function(){this._gl.deleteTexture(this._glTexture),this._texture=null,this._glTexture=null,this._formatDetail=null},o.generateMipmaps=function(){this._bind(),this._gl.generateMipmap(this._target)},o._bind=function(){this._rhi.bindTexture(this)},o._initMipmap=function(t){var e=this._gl,n=this._isWebGL2,a=this._formatDetail,s=a.internalFormat,l=a.baseFormat,c=a.dataType,u=this._texture,h=u.mipmapCount,f=u.width,d=u.height;if(this._bind(),n&&!(l===e.LUMINANCE_ALPHA||l===e.ALPHA))e.texStorage2D(this._target,h,s,f,d);else if(l!==s&&(s=l),t)for(var g=0;g<h;g++)for(var m=Math.max(1,f>>g),x=0;x<6;x++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+x,g,s,m,m,0,l,c,null);else for(var _=0;_<h;_++){var p=Math.max(1,f>>_),v=Math.max(1,d>>_);e.texImage2D(this._target,_,s,p,v,0,l,c,null)}},o._getPixelBuffer=function(t,e,n,a,s,l,c){var u=this._gl,h=this._formatDetail,f=h.baseFormat,d=h.dataType;u.bindFramebuffer(u.FRAMEBUFFER,this._getReadFrameBuffer()),l>0&&!this._isWebGL2&&(l=0,Fe.error("mipLevel only take effect in WebGL2.0")),t!=null?u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+t,this._glTexture,l):u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,this._glTexture,l),u.readPixels(e,n,a,s,f,d,c),u.bindFramebuffer(u.FRAMEBUFFER,null)},o._setWrapMode=function(t,e){var n=this._gl,a=this._isWebGL2,s=this._target,l=this._texture,c=l.width,u=l.height;switch(!a&&t!==qt.Clamp&&(!r._isPowerOf2(c)||!r._isPowerOf2(u))&&(Fe.warn("non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE"),t=qt.Clamp),t){case qt.Clamp:n.texParameteri(s,e,n.CLAMP_TO_EDGE);break;case qt.Repeat:n.texParameteri(s,e,n.REPEAT);break;case qt.Mirror:n.texParameteri(s,e,n.MIRRORED_REPEAT);break}},o._getReadFrameBuffer=function(){var t=this._rhi._readFrameBuffer;return t||(this._rhi._readFrameBuffer=t=this._gl.createFramebuffer()),t},ds(r,[{key:"wrapModeU",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_S)}},{key:"wrapModeV",set:function(t){this._bind(),this._setWrapMode(t,this._gl.TEXTURE_WRAP_T)}},{key:"filterMode",set:function(t){var e=this._gl,n=this._target,a=this._texture._mipmap;switch(this._bind(),t){case gr.Point:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(n,e.TEXTURE_MIN_FILTER,a?e.NEAREST_MIPMAP_NEAREST:e.NEAREST);break;case gr.Bilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,a?e.LINEAR_MIPMAP_NEAREST:e.LINEAR);break;case gr.Trilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,a?e.LINEAR_MIPMAP_LINEAR:e.LINEAR);break}}},{key:"anisoLevel",set:function(t){var e=this._gl;this._bind(),e.texParameterf(this._target,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}]),r}(),Xx=function(){function r(i,t){this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._frameBuffer=void 0,this._MSAAFrameBuffer=void 0,this._depthRenderBuffer=void 0,this._MSAAColorRenderBuffers=[],this._MSAADepthRenderBuffer=void 0,this._oriDrawBuffers=void 0,this._blitDrawBuffers=void 0,this._curMipLevel=0,this._gl=i.gl,this._isWebGL2=i.isWebGL2,this._target=t;for(var e=t._colorTextures,n=t._depth,a=t.width,s=t.height,l=n instanceof Kr,c=0,u=e.length;c<u;c++){var h=e[c]._format;if(!St._supportRenderBufferColorFormat(h,i))throw new Error("TextureFormat is not supported:"+se[h]+" in RenderTarget")}if(!St._supportRenderBufferDepthFormat(l?n.format:n,i,l))throw new Error("TextureFormat is not supported:"+se[n]+" in RenderTarget");if(e.length>1&&!i.canIUse(he.drawBuffers))throw new Error("MRT is not supported");if(e.some(function(d){return d.width!==a||d.height!==s}))throw new Error("ColorTexture's size must as same as RenderTarget");if(l&&(n.width!==a||n.height!==s))throw new Error("DepthTexture's size must as same as RenderTarget");if(e.length>1&&e.some(function(d){return d instanceof tr}))throw new Error("MRT+Cube+[,MSAA] is not supported");var f=i.capability.maxAntiAliasing;t.antiAliasing>f&&(Fe.warn("MSAA antiAliasing exceeds the limit and is automatically downgraded to:"+f),t._antiAliasing=f),this._frameBuffer=this._gl.createFramebuffer(),this._bindMainFBO(),t.antiAliasing>1&&(this._MSAAFrameBuffer=this._gl.createFramebuffer(),this._bindMSAAFBO())}var o=r.prototype;return o.setRenderTargetInfo=function(t,e){var n=this._gl,a=this._target,s=a.depthTexture,l=a.getColorTexture(0),c=e!==this._curMipLevel;if(n.bindFramebuffer(n.FRAMEBUFFER,this._frameBuffer),l){var u=l instanceof tr;(c||u)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,u?n.TEXTURE_CUBE_MAP_POSITIVE_X+t:n.TEXTURE_2D,l._platformTexture._glTexture,e)}if(s){var h=s instanceof tr;if(c||h){var f=s._platformTexture;n.framebufferTexture2D(n.FRAMEBUFFER,f._formatDetail.attachment,h?n.TEXTURE_CUBE_MAP_POSITIVE_X+t:n.TEXTURE_2D,f._glTexture,e)}}else if(c){var d=St._getRenderBufferDepthFormatDetail(a._depth,n,this._isWebGL2),_=d.internalFormat;n.bindRenderbuffer(n.RENDERBUFFER,this._depthRenderBuffer),n.renderbufferStorage(n.RENDERBUFFER,_,a.width>>e,a.height>>e)}this._curMipLevel=e,this._activeRenderTarget()},o.blitRenderTarget=function(){if(!!this._MSAAFrameBuffer){var t=this._gl,e=t.COLOR_BUFFER_BIT|(this._target.depthTexture?t.DEPTH_BUFFER_BIT:0),n=this._target,a=n.colorTextureCount,s=n.width,l=n.height;t.bindFramebuffer(t.READ_FRAMEBUFFER,this._MSAAFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this._frameBuffer);for(var c=0;c<a;c++){var u=t.COLOR_ATTACHMENT0+c;this._blitDrawBuffers[c]=u,t.readBuffer(u),t.drawBuffers(this._blitDrawBuffers),t.blitFramebuffer(0,0,s,l,0,0,s,l,e,t.NEAREST),this._blitDrawBuffers[c]=t.NONE}t.bindFramebuffer(t.FRAMEBUFFER,null)}},o.destroy=function(){var t=this._gl;this._frameBuffer&&t.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&t.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&t.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var e=0;e<this._MSAAColorRenderBuffers.length;e++)t.deleteRenderbuffer(this._MSAAColorRenderBuffers[e]);this._frameBuffer=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},o._activeRenderTarget=function(){var t=this._gl;this._MSAAFrameBuffer?t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer)},o._bindMainFBO=function(){var t=this._gl,e=this._isWebGL2,n=this._target,a=n._depth,s=n.colorTextureCount,l=n.width,c=n.height,u=new Array(s);t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer);for(var h=0;h<s;h++){var f=this._target.getColorTexture(h),d=t.COLOR_ATTACHMENT0+h;u[h]=d,f instanceof tr||t.framebufferTexture2D(t.FRAMEBUFFER,d,t.TEXTURE_2D,f._platformTexture._glTexture,0)}if(s>1&&t.drawBuffers(u),this._oriDrawBuffers=u,a!==null){if(a instanceof Kr)a instanceof tr||t.framebufferTexture2D(t.FRAMEBUFFER,a._platformTexture._formatDetail.attachment,t.TEXTURE_2D,a._platformTexture._glTexture,0);else if(this._target.antiAliasing<=1){var _=St._getRenderBufferDepthFormatDetail(a,t,e),p=_.internalFormat,v=_.attachment,g=t.createRenderbuffer();this._depthRenderBuffer=g,t.bindRenderbuffer(t.RENDERBUFFER,g),t.renderbufferStorage(t.RENDERBUFFER,p,l,c),t.framebufferRenderbuffer(t.FRAMEBUFFER,v,t.RENDERBUFFER,g)}}t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},o._bindMSAAFBO=function(){var t=this._gl,e=this._isWebGL2,n=t.createRenderbuffer(),a=this._target,s=a._depth,l=a.colorTextureCount,c=a.antiAliasing,u=a.width,h=a.height;this._blitDrawBuffers=new Array(l),this._MSAADepthRenderBuffer=n,t.bindFramebuffer(t.FRAMEBUFFER,this._MSAAFrameBuffer);for(var f=0;f<l;f++){var d=t.createRenderbuffer();this._MSAAColorRenderBuffers[f]=d,this._blitDrawBuffers[f]=t.NONE,t.bindRenderbuffer(t.RENDERBUFFER,d),t.renderbufferStorageMultisample(t.RENDERBUFFER,c,this._target.getColorTexture(f)._platformTexture._formatDetail.internalFormat,u,h),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+f,t.RENDERBUFFER,d)}if(t.drawBuffers(this._oriDrawBuffers),s!==null){var _=s instanceof Kr?s._platformTexture._formatDetail:St._getRenderBufferDepthFormatDetail(s,t,e),p=_.internalFormat,v=_.attachment;t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorageMultisample(t.RENDERBUFFER,c,p,u,h),t.framebufferRenderbuffer(t.FRAMEBUFFER,v,t.RENDERBUFFER,n)}this._checkFrameBuffer(),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},o._checkFrameBuffer=function(){var t=this._gl,e=this._isWebGL2,n=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case t.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(e&&n===t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},r}(),jx=function(r){$l(o,r);function o(t,e){var n;n=r.call(this,t,e,t.gl.TEXTURE_2D)||this,n._compressedMipFilled=0;var a=e.format,s=e._mipmap,l=e.width,c=e.height,u=n._isWebGL2;if(!St._supportTextureFormat(a,t))throw new Error("Texture format is not supported:"+se[a]);return s&&!u&&(!St._isPowerOf2(l)||!St._isPowerOf2(c))&&(Fe.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=St._getFormatDetail(a,n._gl,u),n._formatDetail.isCompressed&&!u||n._initMipmap(!1),n}var i=o.prototype;return i.setPixelBuffer=function(e,n,a,s,l,c){n===void 0&&(n=0);var u=this._gl,h=this._isWebGL2,f=this._formatDetail,d=f.internalFormat,_=f.baseFormat,p=f.dataType,v=f.isCompressed,g=Math.max(1,this._texture.width>>n),m=Math.max(1,this._texture.height>>n);if(l=l||g-a,c=c||m-s,this._bind(),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,0),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),v){var x=1<<n;h||this._compressedMipFilled&x?u.compressedTexSubImage2D(this._target,n,a,s,l,c,d,e):(u.compressedTexImage2D(this._target,n,d,l,c,0,e),this._compressedMipFilled|=x)}else u.texSubImage2D(this._target,n,a,s,l,c,_,p,e)},i.setImageSource=function(e,n,a,s,l,c){var u=this._gl,h=this._formatDetail,f=h.baseFormat,d=h.dataType;this._bind(),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,+a),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+s),u.texSubImage2D(this._target,n,l||0,c||0,f,d,e)},i.getPixelBuffer=function(e,n,a,s,l,c){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");r.prototype._getPixelBuffer.call(this,null,e,n,a,s,l,c)},o}(St),$x=function(r){$l(o,r);function o(t,e){var n;n=r.call(this,t,e,t.gl.TEXTURE_2D_ARRAY)||this;var a=e.format,s=e.width,l=e.height,c=e.length,u=e.mipmapCount;if(!n._isWebGL2)throw new Error("Texture2D Array is not supported in WebGL1.0");if(!St._supportTextureFormat(a,t))throw new Error("Texture format is not supported:"+se[a]);return n._bind(),n._formatDetail=St._getFormatDetail(a,n._gl,!0),n._gl.texStorage3D(n._target,u,n._formatDetail.internalFormat,s,l,c),n}var i=o.prototype;return i.setPixelBuffer=function(e,n,a,s,l,c,u,h){var f=this._target,d=this._gl,_=this._formatDetail,p=_.internalFormat,v=_.baseFormat,g=_.dataType,m=_.isCompressed;c=c||Math.max(1,this._texture.width>>a)-s,u=u||Math.max(1,this._texture.height>>a)-l,h=h||this._texture.length,this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,0),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),m?d.compressedTexSubImage3D(f,a,s,l,e,c,u,h,p,n):d.texSubImage3D(f,a,s,l,e,c,u,h,v,g,n)},i.setImageSource=function(e,n,a,s,l,c,u){var h=this._gl,f=this._formatDetail,d=f.baseFormat,_=f.dataType;this._bind(),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,+s),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),h.texSubImage3D(this._target,a,c,u,e,n.width,n.height,1,d,_,n)},i.getPixelBuffer=function(e,n,a,s,l,c,u){var h=this._gl,f=this._formatDetail;if(f.isCompressed)throw new Error("Unable to read compressed texture");h.bindFramebuffer(h.FRAMEBUFFER,this._getReadFrameBuffer()),h.framebufferTextureLayer(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,this._glTexture,c,e),h.readPixels(n,a,s,l,f.baseFormat,f.dataType,u),h.bindFramebuffer(h.FRAMEBUFFER,null)},o}(St),qx=function(r){$l(o,r);function o(t,e){var n;n=r.call(this,t,e,t.gl.TEXTURE_CUBE_MAP)||this,n._compressedFaceFilled=[0,0,0,0,0,0];var a=e.format,s=e._mipmap,l=e.width,c=n._isWebGL2;if(!St._supportTextureFormat(a,t))throw new Error("Texture format is not supported:"+se[a]);return s&&!c&&!St._isPowerOf2(l)&&(Fe.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=St._getFormatDetail(a,n._gl,c),n._formatDetail.isCompressed&&!c||n._initMipmap(!0),n}var i=o.prototype;return i.setPixelBuffer=function(e,n,a,s,l,c,u){var h=this._gl,f=this._isWebGL2,d=this._formatDetail,_=d.internalFormat,p=d.baseFormat,v=d.dataType,g=d.isCompressed,m=Math.max(1,this._texture.width>>a);if(c=c||m-s,u=u||m-l,this._bind(),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,0),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),g){var x=1<<a;f||this._compressedFaceFilled[e]&x?h.compressedTexSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,a,s,l,c,u,_,n):(h.compressedTexImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,a,_,c,u,0,n),this._compressedFaceFilled[e]|=x)}else h.texSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,a,s,l,c,u,p,v,n)},i.setImageSource=function(e,n,a,s,l,c,u){var h=this._gl,f=this._formatDetail,d=f.baseFormat,_=f.dataType;this._bind(),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,+s),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),h.texSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,a,c||0,u||0,d,_,n)},i.getPixelBuffer=function(e,n,a,s,l,c,u){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");r.prototype._getPixelBuffer.call(this,e,n,a,s,l,c,u)},o}(St),ai;(function(r){r[r.Auto=0]="Auto",r[r.WebGL2=1]="WebGL2",r[r.WebGL1=2]="WebGL1"})(ai||(ai={}));var Yx=function(){function r(i){i===void 0&&(i={}),this._readFrameBuffer=void 0,this._currentBind=void 0,this._options=void 0,this._gl=void 0,this._renderStates=void 0,this._extensions=void 0,this._capability=void 0,this._isWebGL2=void 0,this._webCanvas=void 0,this._activeTextureID=void 0,this._activeTextures=new Array(32),this._lastViewport=new qe(null,null,null,null),this._lastClearColor=new me(null,null,null,null),this._scissorEnable=!1,this._options=i}var o=r.prototype;return o.init=function(t){var e=this._options;e.alpha===void 0&&(e.alpha=!1),e.stencil===void 0&&(e.stencil=!0);var n=this._webCanvas=t._webCanvas,a=e.webGLMode||ai.Auto,s;if((a==ai.Auto||a==ai.WebGL2)&&(s=n.getContext("webgl2",e),!s&&(typeof OffscreenCanvas>"u"||!(n instanceof OffscreenCanvas))&&(s=n.getContext("experimental-webgl2",e)),this._isWebGL2=!0,s&&!s.deleteQuery&&(this._isWebGL2=!1)),s||(a==ai.Auto||a==ai.WebGL1)&&(s=n.getContext("webgl",e),!s&&(typeof OffscreenCanvas>"u"||!(n instanceof OffscreenCanvas))&&(s=n.getContext("experimental-webgl",e)),this._isWebGL2=!1),!s)throw new Error("Get GL Context FAILED.");this._gl=s,this._activeTextureID=s.TEXTURE0,this._renderStates=new Wx(s),this._extensions=new Gx(this),this._capability=new kx(this),s.activeTexture(s.TEXTURE0),this._options=null},o.createPlatformPrimitive=function(t){return new Hx(this,t)},o.createPlatformTexture2D=function(t){return new jx(this,t)},o.createPlatformTexture2DArray=function(t){return new $x(this,t)},o.createPlatformTextureCube=function(t){return new qx(this,t)},o.createPlatformRenderTarget=function(t){return new Xx(this,t)},o.requireExtension=function(t){return this._extensions.requireExtension(t)},o.canIUse=function(t){return this.capability.canIUse(t)},o.canIUseCompressedTextureInternalFormat=function(t){return this.capability.canIUseCompressedTextureInternalFormat(t)},o.viewport=function(t,e,n,a){var s=this._gl,l=this._lastViewport;if(t!==l.x||e!==l.y||n!==l.z||a!==l.w){var c=this._webCanvas;t===0&&e===0&&n===c.width&&a===c.height?this._scissorEnable&&(s.disable(s.SCISSOR_TEST),this._scissorEnable=!1):(this._scissorEnable||(s.enable(s.SCISSOR_TEST),this._scissorEnable=!0),s.scissor(t,e,n,a)),s.viewport(t,e,n,a),l.set(t,e,n,a)}},o.colorMask=function(t,e,n,a){this._gl.colorMask(t,e,n,a)},o.clearRenderTarget=function(t,e,n){var a=this._gl,s=t._lastRenderState,l=s.blendState.targetBlendState,c=s.depthState,u=s.stencilState,h=0;if(e&Dr.Color){h|=a.COLOR_BUFFER_BIT;var f=this._lastClearColor,d=n.r,_=n.g,p=n.b,v=n.a;n&&(d!==f.r||_!==f.g||p!==f.b||v!==f.a)&&(a.clearColor(d,_,p,v),f.set(d,_,p,v)),l.colorWriteMask!==Br.All&&(a.colorMask(!0,!0,!0,!0),l.colorWriteMask=Br.All)}e&Dr.Depth&&(h|=a.DEPTH_BUFFER_BIT,c.writeEnabled!==!0&&(a.depthMask(!0),c.writeEnabled=!0)),e&Dr.Stencil&&(h|=a.STENCIL_BUFFER_BIT,u.writeMask!==255&&(a.stencilMask(255),u.writeMask=255)),a.clear(h)},o.drawPrimitive=function(t,e,n){t?t._draw(n,e):Fe.error("draw primitive failed.")},o.activeRenderTarget=function(t,e,n){var a=this._gl;if(t){var s;(s=t._platformRenderTarget)===null||s===void 0||s._activeRenderTarget();var l=t.width,c=t.height;this.viewport(0,0,l>>n,c>>n)}else{a.bindFramebuffer(a.FRAMEBUFFER,null);var u=e.viewport,h=a.drawingBufferWidth,f=a.drawingBufferHeight,d=h*u.z,_=f*u.w,p=u.x*h,v=f-u.y*f-_;this.viewport(p,v,d,_)}},o.destroy=function(){},o.activeTexture=function(t){this._activeTextureID!==t&&(this._gl.activeTexture(t),this._activeTextureID=t)},o.bindTexture=function(t){var e=this._activeTextureID-this._gl.TEXTURE0;this._activeTextures[e]!==t&&(this._gl.bindTexture(t._target,t._glTexture),this._activeTextures[e]=t)},ds(r,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"gl",get:function(){return this._gl}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),r}();function Mf(r,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Qx(r,o,i){return o&&Mf(r.prototype,o),i&&Mf(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}var Jx=function(){function r(i,t){var e=this;this._worker=void 0,this._costs={},this._currentLoad=0,this._callbacks={},this._worker=new Worker(i),this._worker.onmessage=function(n){var a=n.data;switch(a.type){case"decode":e._callbacks[a.id].resolve(a.geometry);break;case"error":e._callbacks[a.id].reject(a);break;default:Fe.error('DRACOWorker: Unexpected message, "'+a.type+'"')}},t?this._worker.postMessage({type:"init",decoderConfig:{wasmBinary:t}}):this._worker.postMessage({type:"init",decoderConfig:{}})}var o=r.prototype;return o.setCosts=function(t,e){this._costs[t]=e},o.addCurrentLoad=function(t){this._currentLoad+=t},o.setCallback=function(t,e,n){this._callbacks[t]={resolve:e,reject:n}},o.decode=function(t,e,n){this._worker.postMessage({type:"decode",id:t,taskConfig:e,buffer:n},[n])},o.releaseTask=function(t){this._currentLoad-=this._costs[t],delete this._callbacks[t],delete this._costs[t]},Qx(r,[{key:"currentLoad",get:function(){return this._currentLoad}}]),r}(),Ef=`let decoderPending;
let decoderConfig;

onmessage = function(e) {
  const message = e.data;

  switch (message.type) {
    case "init":
      decoderConfig = message.decoderConfig;
      decoderPending = new Promise(function(resolve /*, reject*/) {
        decoderConfig.onModuleLoaded = function(draco) {
          // Module is Promise-like. Wrap before resolving to avoid loop.
          resolve({ draco: draco });
        };
        DracoDecoderModule(decoderConfig);
      });
      break;

    case "decode":
      const buffer = message.buffer;
      const taskConfig = message.taskConfig;
      decoderPending.then(module => {
        const draco = module.draco;
        const decoder = new draco.Decoder();
        const decoderBuffer = new draco.DecoderBuffer();
        decoderBuffer.Init(new Int8Array(buffer), buffer.byteLength);
        try {
          const geometry = decodeGeometry(draco, decoder, decoderBuffer, taskConfig);
          const buffers = geometry.attributes.map(attr => attr.array.buffer);
          if (geometry.index) buffers.push(geometry.index.array.buffer);
          self.postMessage({ type: "decode", id: message.id, geometry }, buffers);
        } catch (error) {
          console.error(error);
          self.postMessage({ type: "error", id: message.id, error: error.message });
        } finally {
          draco.destroy(decoderBuffer);
          draco.destroy(decoder);
        }
      });
      break;
  }
};

function decodeGeometry(draco, decoder, decoderBuffer, taskConfig) {
  const attributeIDs = taskConfig.attributeIDs;
  const attributeTypes = taskConfig.attributeTypes;

  let dracoGeometry;
  let decodingStatus;

  const geometryType = decoder.GetEncodedGeometryType(decoderBuffer);
  if (geometryType === draco.TRIANGULAR_MESH) {
    dracoGeometry = new draco.Mesh();
    decodingStatus = decoder.DecodeBufferToMesh(decoderBuffer, dracoGeometry);
  } else {
    throw new Error("DRACODecoder worker: Unexpected geometry type.");
  }

  if (!decodingStatus.ok() || dracoGeometry.ptr === 0) {
    throw new Error("DRACODecoder worker: Decoding failed: " + decodingStatus.error_msg());
  }

  const geometry = { index: null, attributes: [] };

  // Gather all vertex attributes.
  for (let attributeName in attributeIDs) {
    const attributeType = self[attributeTypes[attributeName]];

    let attribute;
    let attributeID;

    // A Draco file may be created with default vertex attributes, whose attribute IDs
    // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
    // a Draco file may contain a custom set of attributes, identified by known unique
    // IDs. glTF files always do the latter, and .drc files typically do the former.
    if (taskConfig.useUniqueIDs) {
      attributeID = attributeIDs[attributeName];
      attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeID);
    } else {
      attributeID = decoder.GetAttributeId(dracoGeometry, draco[attributeIDs[attributeName]]);
      if (attributeID === -1) continue;
      attribute = decoder.GetAttribute(dracoGeometry, attributeID);
    }
    geometry.attributes.push(decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute));
  }
  // Add index.
  if (geometryType === draco.TRIANGULAR_MESH) {
    // Generate mesh faces.
    const numFaces = dracoGeometry.num_faces();
    const numIndices = numFaces * 3;
    let dataSize;
    let ptr;
    let index;
    const indexType = self[taskConfig.indexType];

    switch (indexType) {
      case Uint16Array:
        dataSize = numIndices * 2;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt16Array(dracoGeometry, dataSize, ptr);
        index = new Uint16Array(draco.HEAPU16.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      case Uint32Array:
        dataSize = numIndices * 4;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt32Array(dracoGeometry, dataSize, ptr);
        index = new Uint32Array(draco.HEAPU32.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      default:
        throw new Error("DRACODecoder: Unexpected index type.");
    }
    geometry.index = { array: index, itemSize: 1 };
  }
  draco.destroy(dracoGeometry);
  return geometry;
}

function decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute) {
  const numComponents = attribute.num_components();
  const numPoints = dracoGeometry.num_points();
  const numValues = numPoints * numComponents;
  let ptr;
  let array;
  let dataSize;
  switch (attributeType) {
    case Float32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_FLOAT32, dataSize, ptr);
      array = new Float32Array(draco.HEAPF32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT8, numValues, ptr);
      array = new Int8Array(draco.HEAP8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT16, dataSize, ptr);
      array = new Int16Array(draco.HEAP16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT32, dataSize, ptr);
      array = new Int32Array(draco.HEAP32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT8, numValues, ptr);
      array = new Uint8Array(draco.HEAPU8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT16, dataSize, ptr);
      array = new Uint16Array(draco.HEAPU16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT32, dataSize, ptr);
      array = new Uint32Array(draco.HEAPU32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    default:
      throw new Error("DRACODecoder: Unexpected attribute type.");
  }

  return {
    name: attributeName,
    array: array,
    itemSize: numComponents
  };
}
`,Es="https://gw.alipayobjects.com/os/lib/alipay/draco-javascript/1.3.6/lib/",Kx="draco_decoder_gltf.js",Zx="draco_decoder_gltf.r3bin",ew="draco_wasm_wrapper_gltf.js",tw=function(){function r(i){if(i===void 0&&(i={type:"wasm",workerLimit:4}),this.pool=[],this.workerLimit=Math.min(navigator.hardwareConcurrency||4,4),this.useJS=void 0,this.currentTaskId=1,this.taskCache=new WeakMap,this.loadLibPromise=void 0,i.workerLimit>this.workerLimit)Fe.warn("DRACOWorkerPool: Can not initialize worker pool with limit:"+i.workerLimit);else{var t;this.workerLimit=(t=i.workerLimit)!=null?t:4}this.useJS=typeof WebAssembly!="object"||i.type==="js",this.loadLibPromise=this.preloadLib()}var o=r.prototype;return o.preloadLib=function(){var t=this;return this.loadLibPromise?this.loadLibPromise:new Promise(function(e,n){t.useJS?Pa(""+Es+Kx,{type:"text"}).then(function(a){var s=[a,Ef].join(`
`),l=URL.createObjectURL(new Blob([s]));e({workerSourceURL:l,decoderWASMBinary:null})}).catch(function(a){n(a)}):Promise.all([Pa(""+Es+ew,{type:"text"}),Pa(""+Es+Zx,{type:"arraybuffer"})]).then(function(a){var s=a[0],l=a[1],c=[s,Ef].join(`
`),u=URL.createObjectURL(new Blob([c]));e({workerSourceURL:u,decoderWASMBinary:l})}).catch(function(a){n(a)})})},o.getWorker=function(){var t=this;return this.preloadLib().then(function(e){if(t.pool.length<t.workerLimit){var n=new Jx(e.workerSourceURL,e.decoderWASMBinary);t.pool.push(n)}else t.pool.sort(function(a,s){return a.currentLoad>s.currentLoad?-1:1});return t.pool[t.pool.length-1]})},o.decode=function(t,e){var n=this,a=JSON.stringify(e);if(this.taskCache.has(t)){var s=this.taskCache.get(t);if(s.key===a)return s.promise;if(t.byteLength===0)throw new Error("DRACODecoder: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.currentTaskId++,c=t.byteLength,u,h=new Promise(function(f,d){n.getWorker().then(function(_){u=_,_.setCosts(l,c),_.addCurrentLoad(c),_.setCallback(l,f,d),_.decode(l,e,t)}).catch(function(_){d(_)})});return h.finally(function(){u&&l&&u.releaseTask(l)}),this.taskCache.set(t,{key:a,promise:h}),h},r}();function Rf(r,o){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),i.push.apply(i,t)}return i}function et(r){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?Rf(Object(i),!0).forEach(function(t){rw(r,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Rf(Object(i)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}function xa(){xa=function(){return r};var r={},o=Object.prototype,i=o.hasOwnProperty,t=Object.defineProperty||function(S,A,R){S[A]=R.value},e=typeof Symbol=="function"?Symbol:{},n=e.iterator||"@@iterator",a=e.asyncIterator||"@@asyncIterator",s=e.toStringTag||"@@toStringTag";function l(S,A,R){return Object.defineProperty(S,A,{value:R,enumerable:!0,configurable:!0,writable:!0}),S[A]}try{l({},"")}catch{l=function(A,R,D){return A[R]=D}}function c(S,A,R,D){var z=A&&A.prototype instanceof f?A:f,U=Object.create(z.prototype),V=new I(D||[]);return t(U,"_invoke",{value:C(S,R,V)}),U}function u(S,A,R){try{return{type:"normal",arg:S.call(A,R)}}catch(D){return{type:"throw",arg:D}}}r.wrap=c;var h={};function f(){}function d(){}function _(){}var p={};l(p,n,function(){return this});var v=Object.getPrototypeOf,g=v&&v(v(E([])));g&&g!==o&&i.call(g,n)&&(p=g);var m=_.prototype=f.prototype=Object.create(p);function x(S){["next","throw","return"].forEach(function(A){l(S,A,function(R){return this._invoke(A,R)})})}function w(S,A){function R(z,U,V,L){var J=u(S[z],S,U);if(J.type!=="throw"){var oe=J.arg,le=oe.value;return le&&typeof le=="object"&&i.call(le,"__await")?A.resolve(le.__await).then(function(te){R("next",te,V,L)},function(te){R("throw",te,V,L)}):A.resolve(le).then(function(te){oe.value=te,V(oe)},function(te){return R("throw",te,V,L)})}L(J.arg)}var D;t(this,"_invoke",{value:function(z,U){function V(){return new A(function(L,J){R(z,U,L,J)})}return D=D?D.then(V,V):V()}})}function C(S,A,R){var D="suspendedStart";return function(z,U){if(D==="executing")throw new Error("Generator is already running");if(D==="completed"){if(z==="throw")throw U;return B()}for(R.method=z,R.arg=U;;){var V=R.delegate;if(V){var L=T(V,R);if(L){if(L===h)continue;return L}}if(R.method==="next")R.sent=R._sent=R.arg;else if(R.method==="throw"){if(D==="suspendedStart")throw D="completed",R.arg;R.dispatchException(R.arg)}else R.method==="return"&&R.abrupt("return",R.arg);D="executing";var J=u(S,A,R);if(J.type==="normal"){if(D=R.done?"completed":"suspendedYield",J.arg===h)continue;return{value:J.arg,done:R.done}}J.type==="throw"&&(D="completed",R.method="throw",R.arg=J.arg)}}}function T(S,A){var R=S.iterator[A.method];if(R===void 0){if(A.delegate=null,A.method==="throw"){if(S.iterator.return&&(A.method="return",A.arg=void 0,T(S,A),A.method==="throw"))return h;A.method="throw",A.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var D=u(R,S.iterator,A.arg);if(D.type==="throw")return A.method="throw",A.arg=D.arg,A.delegate=null,h;var z=D.arg;return z?z.done?(A[S.resultName]=z.value,A.next=S.nextLoc,A.method!=="return"&&(A.method="next",A.arg=void 0),A.delegate=null,h):z:(A.method="throw",A.arg=new TypeError("iterator result is not an object"),A.delegate=null,h)}function b(S){var A={tryLoc:S[0]};1 in S&&(A.catchLoc=S[1]),2 in S&&(A.finallyLoc=S[2],A.afterLoc=S[3]),this.tryEntries.push(A)}function M(S){var A=S.completion||{};A.type="normal",delete A.arg,S.completion=A}function I(S){this.tryEntries=[{tryLoc:"root"}],S.forEach(b,this),this.reset(!0)}function E(S){if(S){var A=S[n];if(A)return A.call(S);if(typeof S.next=="function")return S;if(!isNaN(S.length)){var R=-1,D=function z(){for(;++R<S.length;)if(i.call(S,R))return z.value=S[R],z.done=!1,z;return z.value=void 0,z.done=!0,z};return D.next=D}}return{next:B}}function B(){return{value:void 0,done:!0}}return d.prototype=_,t(m,"constructor",{value:_,configurable:!0}),t(_,"constructor",{value:d,configurable:!0}),d.displayName=l(_,s,"GeneratorFunction"),r.isGeneratorFunction=function(S){var A=typeof S=="function"&&S.constructor;return!!A&&(A===d||(A.displayName||A.name)==="GeneratorFunction")},r.mark=function(S){return Object.setPrototypeOf?Object.setPrototypeOf(S,_):(S.__proto__=_,l(S,s,"GeneratorFunction")),S.prototype=Object.create(m),S},r.awrap=function(S){return{__await:S}},x(w.prototype),l(w.prototype,a,function(){return this}),r.AsyncIterator=w,r.async=function(S,A,R,D,z){z===void 0&&(z=Promise);var U=new w(c(S,A,R,D),z);return r.isGeneratorFunction(A)?U:U.next().then(function(V){return V.done?V.value:U.next()})},x(m),l(m,s,"Generator"),l(m,n,function(){return this}),l(m,"toString",function(){return"[object Generator]"}),r.keys=function(S){var A=Object(S),R=[];for(var D in A)R.push(D);return R.reverse(),function z(){for(;R.length;){var U=R.pop();if(U in A)return z.value=U,z.done=!1,z}return z.done=!0,z}},r.values=E,I.prototype={constructor:I,reset:function(S){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!S)for(var A in this)A.charAt(0)==="t"&&i.call(this,A)&&!isNaN(+A.slice(1))&&(this[A]=void 0)},stop:function(){this.done=!0;var S=this.tryEntries[0].completion;if(S.type==="throw")throw S.arg;return this.rval},dispatchException:function(S){if(this.done)throw S;var A=this;function R(J,oe){return U.type="throw",U.arg=S,A.next=J,oe&&(A.method="next",A.arg=void 0),!!oe}for(var D=this.tryEntries.length-1;D>=0;--D){var z=this.tryEntries[D],U=z.completion;if(z.tryLoc==="root")return R("end");if(z.tryLoc<=this.prev){var V=i.call(z,"catchLoc"),L=i.call(z,"finallyLoc");if(V&&L){if(this.prev<z.catchLoc)return R(z.catchLoc,!0);if(this.prev<z.finallyLoc)return R(z.finallyLoc)}else if(V){if(this.prev<z.catchLoc)return R(z.catchLoc,!0)}else{if(!L)throw new Error("try statement without catch or finally");if(this.prev<z.finallyLoc)return R(z.finallyLoc)}}}},abrupt:function(S,A){for(var R=this.tryEntries.length-1;R>=0;--R){var D=this.tryEntries[R];if(D.tryLoc<=this.prev&&i.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var z=D;break}}z&&(S==="break"||S==="continue")&&z.tryLoc<=A&&A<=z.finallyLoc&&(z=null);var U=z?z.completion:{};return U.type=S,U.arg=A,z?(this.method="next",this.next=z.finallyLoc,h):this.complete(U)},complete:function(S,A){if(S.type==="throw")throw S.arg;return S.type==="break"||S.type==="continue"?this.next=S.arg:S.type==="return"?(this.rval=this.arg=S.arg,this.method="return",this.next="end"):S.type==="normal"&&A&&(this.next=A),h},finish:function(S){for(var A=this.tryEntries.length-1;A>=0;--A){var R=this.tryEntries[A];if(R.finallyLoc===S)return this.complete(R.completion,R.afterLoc),M(R),h}},catch:function(S){for(var A=this.tryEntries.length-1;A>=0;--A){var R=this.tryEntries[A];if(R.tryLoc===S){var D=R.completion;if(D.type==="throw"){var z=D.arg;M(R)}return z}}throw new Error("illegal catch attempt")},delegateYield:function(S,A,R){return this.delegate={iterator:E(S),resultName:A,nextLoc:R},this.method==="next"&&(this.arg=void 0),h}},r}function Ff(r,o,i,t,e,n,a){try{var s=r[n](a),l=s.value}catch(c){i(c);return}s.done?o(l):Promise.resolve(l).then(t,e)}function Bf(r){return function(){var o=this,i=arguments;return new Promise(function(t,e){var n=r.apply(o,i);function a(l){Ff(n,t,e,a,s,"next",l)}function s(l){Ff(n,t,e,a,s,"throw",l)}a(void 0)})}}function If(r,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Wv(r,o,i){return o&&If(r.prototype,o),i&&If(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function rw(r,o,i){return o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,r}function Le(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Do(r,o)}function Do(r,o){return Do=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Do(r,o)}function nw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function yo(r,o,i){return nw()?yo=Reflect.construct.bind():yo=function(e,n,a){var s=[null];s.push.apply(s,n);var l=Function.bind.apply(e,s),c=new l;return a&&Do(c,a.prototype),c},yo.apply(null,arguments)}function iw(r,o){if(!!r){if(typeof r=="string")return zf(r,o);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return zf(r,o)}}function zf(r,o){(o==null||o>r.length)&&(o=r.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=r[i];return t}function Xv(r,o){var i=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i)return(i=i.call(r)).next.bind(i);if(Array.isArray(r)||(i=iw(r))||o&&r&&typeof r.length=="number"){i&&(r=i);var t=0;return function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Df,Lf;function aw(r){return/^data:(.+?);base64,/.test(r)}Df=mt(tt.Buffer,["bin","r3bin"],!1),Df(Lf=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e){var n=e.url;return aw(n)?new st(function(a){var s=n.slice(13+RegExp.$1.length),l=Uint8Array.from(atob(s),function(c){return c.charCodeAt(0)});a(l.buffer)}):this.request(n,et(et({},e),{},{type:"arraybuffer"}))},o}(rt));var Pt;(function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT"})(Pt||(Pt={}));var Xr;(function(r){r.SCALAR="SCALAR",r.VEC2="VEC2",r.VEC3="VEC3",r.VEC4="VEC4",r.MAT2="MAT2",r.MAT3="MAT3",r.MAT4="MAT4"})(Xr||(Xr={}));var Ii;(function(r){r.TRANSLATION="translation",r.ROTATION="rotation",r.SCALE="scale",r.WEIGHTS="weights"})(Ii||(Ii={}));var zi;(function(r){r.Linear="LINEAR",r.Step="STEP",r.CubicSpine="CUBICSPLINE"})(zi||(zi={}));var Lo;(function(r){r.PERSPECTIVE="perspective",r.ORTHOGRAPHIC="orthographic"})(Lo||(Lo={}));var Of;(function(r){r.JPEG="image/jpeg",r.PNG="image/png"})(Of||(Of={}));var Ta;(function(r){r.OPAQUE="OPAQUE",r.MASK="MASK",r.BLEND="BLEND"})(Ta||(Ta={}));var Nf;(function(r){r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR"})(Nf||(Nf={}));var Uf;(function(r){r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(Uf||(Uf={}));var Vf;(function(r){r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.REPEAT=10497]="REPEAT"})(Vf||(Vf={}));var Ne=function(){function r(){}return r.floatBufferToVector2Array=function(i){for(var t=i.length,e=new Array(t/2),n=0;n<t;n+=2)e[n/2]=new Z(i[n],i[n+1]);return e},r.floatBufferToVector3Array=function(i){for(var t=i.length,e=new Array(t/3),n=0;n<t;n+=3)e[n/3]=new y(i[n],i[n+1],i[n+2]);return e},r.floatBufferToVector4Array=function(i){for(var t=i.length,e=new Array(t/4),n=0;n<t;n+=4)e[n/4]=new qe(i[n],i[n+1],i[n+2],i[n+3]);return e},r.floatBufferToColorArray=function(i,t){var e=i.length,n=new Array(e/(t?3:4));if(t)for(var a=0;a<e;a+=3)n[a/3]=new me(i[a],i[a+1],i[a+2],1);else for(var s=0;s<e;s+=4)n[s/4]=new me(i[s],i[s+1],i[s+2],i[s+3]);return n},r.decodeText=function(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);for(var t="",e=0,n=i.length;e<n;e++)t+=String.fromCharCode(i[e]);return decodeURIComponent(encodeURIComponent(t))},r.getAccessorTypeSize=function(i){switch(i){case Xr.SCALAR:return 1;case Xr.VEC2:return 2;case Xr.VEC3:return 3;case Xr.VEC4:return 4;case Xr.MAT2:return 4;case Xr.MAT3:return 9;case Xr.MAT4:return 16}},r.getComponentType=function(i){switch(i){case Pt.BYTE:return Int8Array;case Pt.UNSIGNED_BYTE:return Uint8Array;case Pt.SHORT:return Int16Array;case Pt.UNSIGNED_SHORT:return Uint16Array;case Pt.UNSIGNED_INT:return Uint32Array;case Pt.FLOAT:return Float32Array}},r.getAccessorData=function(i,t,e){var n,a=i.bufferViews,s=a[t.bufferView],l=e[s.buffer],c=t.hasOwnProperty("byteOffset")?t.byteOffset:0,u=s.hasOwnProperty("byteOffset")?s.byteOffset:0,h=c+u,f=r.getAccessorTypeSize(t.type),d=f*t.count,_=(n=s.byteStride)!=null?n:0,p=r.getComponentType(t.componentType),v;if(_){var g=f*p.BYTES_PER_ELEMENT;v=new Uint8Array(t.count*g);for(var m=new Uint8Array(l,u,s.byteLength),x=0;x<t.count;x++)for(var w=0;w<g;w++)v[x*g+w]=m[x*_+c+w]}else v=new Uint8Array(l.slice(h,h+d*p.BYTES_PER_ELEMENT));var C=new p(v.buffer);if(t.sparse)for(var T,b,M,I,E=t.sparse,B=E.count,S=E.indices,A=E.values,R=a[S.bufferView],D=a[A.bufferView],z=e[R.buffer],U=e[D.buffer],V=((T=S.byteOffset)!=null?T:0)+((b=R.byteOffset)!=null?b:0),L=R.byteLength,J=((M=A.byteOffset)!=null?M:0)+((I=D.byteOffset)!=null?I:0),oe=D.byteLength,le=r.getComponentType(S.componentType),te=new le(z,V,L/le.BYTES_PER_ELEMENT),Ae=new p(U,J,oe/p.BYTES_PER_ELEMENT),Ie=0;Ie<B;Ie++)for(var G=te[Ie],ce=0;ce<f;ce++)C[G*f+ce]=Ae[Ie*f+ce];return C},r.getBufferViewData=function(i,t){var e=i.buffer,n=i.byteOffset,a=n===void 0?0:n,s=i.byteLength,l=t[e];return l.slice(a,a+s)},r.getVertexStride=function(i,t){var e,n=i.bufferViews[(e=t.bufferView)!=null?e:0].byteStride;if(n)return n;var a=r.getAccessorTypeSize(t.type),s=r.getComponentType(t.componentType);return a*s.BYTES_PER_ELEMENT},r.createVertexElement=function(i,t,e){var n=r.getAccessorTypeSize(t.type);return new Ve(i,0,r.getElementFormat(t.componentType,n,t.normalized),e)},r.getIndexFormat=function(i){switch(i){case Pt.UNSIGNED_BYTE:return gt.UInt8;case Pt.UNSIGNED_SHORT:return gt.UInt16;case Pt.UNSIGNED_INT:return gt.UInt32}},r.getElementFormat=function(i,t,e){if(e===void 0&&(e=!1),i==Pt.FLOAT)switch(t){case 1:return fe.Float;case 2:return fe.Vector2;case 3:return fe.Vector3;case 4:return fe.Vector4}if(i==Pt.SHORT)switch(t){case 2:return e?fe.NormalizedShort2:fe.Short2;case 3:case 4:return e?fe.NormalizedShort4:fe.Short4}if(i==Pt.UNSIGNED_SHORT)switch(t){case 2:return e?fe.NormalizedUShort2:fe.UShort2;case 3:case 4:return e?fe.NormalizedUShort4:fe.UShort4}if(i==Pt.BYTE)switch(t){case 2:case 3:case 4:return e?fe.NormalizedByte4:fe.Byte4}if(i==Pt.UNSIGNED_BYTE)switch(t){case 2:case 3:case 4:return e?fe.NormalizedUByte4:fe.UByte4}},r.loadImageBuffer=function(i,t){return new Promise(function(e,n){var a=new window.Blob([i],{type:t}),s=new Image;s.onerror=function(){n(new Error("Failed to load image buffer"))},s.onload=function(){requestAnimationFrame(function(){e(s),s.onload=null,s.onerror=null,s.onabort=null})},s.crossOrigin="anonymous",s.src=URL.createObjectURL(a)})},r.isAbsoluteUrl=function(i){return/^(?:http|blob|data:|\/)/.test(i)},r.parseRelativeUrl=function(i,t){if(r.isAbsoluteUrl(t))return t;var e=t.charAt(0);return e==="."?r._formatRelativePath(t+t):i.substring(0,i.lastIndexOf("/")+1)+t},r.parseGLB=function(i){var t=4,e=1179937895,n=12,a={JSON:1313821514,BIN:5130562},s=new DataView(i),l={magic:s.getUint32(0,!0),version:s.getUint32(t,!0),length:s.getUint32(2*t,!0)};if(l.magic!==e)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+l.magic.toString(16)),null;var c=s.getUint32(n,!0),u=s.getUint32(n+t,!0);if(u!==a.JSON)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+u.toString(16)),null;for(var h=new Uint8Array(i,n+2*t,c),f=JSON.parse(r.decodeText(h)),d=[],_=n+2*t+c;_<l.length;){if(c=s.getUint32(_,!0),u=s.getUint32(_+t,!0),u!==a.BIN)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+u.toString(16)),null;var p=_+2*t,v=i.slice(p,p+c);d.push(v),_+=c+2*t}return{gltf:f,buffers:d}},r._formatRelativePath=function(i){for(var t=i.split("/"),e=0,n=t.length;e<n;e++)t[e]==".."&&(t.splice(e-1,2),e-=2);return t.join("/")},r}(),at=function(){function r(){}return r.parseEngineResource=function(i,t,e,n){var a=r._extensionParsers[i];if(a!=null&&a.length){for(var s=arguments.length,l=new Array(s>4?s-4:0),c=4;c<s;c++)l[c-4]=arguments[c];for(var u=0;u<a.length;u++){var h;(h=a[u]).parseEngineResource.apply(h,[t,e,n].concat(l))}}},r.createEngineResource=function(i,t,e){var n=r._extensionParsers[i];if(n!=null&&n.length){for(var a,s=arguments.length,l=new Array(s>3?s-3:0),c=3;c<s;c++)l[c-3]=arguments[c];return(a=n[0]).createEngineResource.apply(a,[t,e].concat(l))}},r.hasExtensionParser=function(i){var t=r._extensionParsers[i];return!!(t!=null&&t.length)},r.initialize=function(i){var t=r._extensionParsers[i];if(t!=null&&t.length)for(var e=0;e<t.length;e++)t[e].initialize()},r._addExtensionParser=function(i,t){r._extensionParsers[i]||(r._extensionParsers[i]=[]),r._extensionParsers[i].push(t)},r}();at._extensionParsers={};function yn(r){return function(o){var i=new o;at._addExtensionParser(r,i)}}var ow=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parse=function(e){var n=e.gltf,a=e.buffers,s=e.entities,l=n.animations,c=n.accessors;if(!!l){for(var u=l.length,h=new Array(u),f=new Array(u),d=0;d<u;d++){for(var _=l[d],p=_.channels,v=_.samplers,g=_.name,m=g===void 0?"AnimationClip"+d:g,x=new Lv(m),w=new Array,C=0;C<v.length;C++){var T,b=v[C],M=c[b.input],I=c[b.output],E=Ne.getAccessorData(n,M,a),B=Ne.getAccessorData(n,I,a),S=B.length/E.length,A=(T=b.interpolation)!=null?T:zi.Linear,R=void 0;switch(A){case zi.CubicSpine:R=Jr.CubicSpine;break;case zi.Step:R=Jr.Step;break;case zi.Linear:R=Jr.Linear;break}E[E.length-1],w.push({type:I.type,interpolation:R,input:E,output:B,outputSize:S})}for(var D=0;D<p.length;D++){for(var z=p[D],U=z.target,V=s[U.node],L="",J=V;J.parent;)L=L===""?""+J.name:J.name+"/"+L,J=J.parent;var oe=void 0,le=void 0,te=void 0;switch(U.path){case Ii.TRANSLATION:oe=rr,le="position",te=De.Vector3;break;case Ii.ROTATION:oe=rr,le="rotation",te=De.Quaternion;break;case Ii.SCALE:oe=rr,le="scale",te=De.Vector3;break;case Ii.WEIGHTS:oe=ta,le="blendShapeWeights",te=De.FloatArray;break}var Ae=this._addCurve(te,z,w);x.addCurveBinding(L,oe,le,Ae)}h[d]=x,f[d]={name:m,index:d}}e.animations=h,e._animationsIndices=f}},i._addCurve=function(e,n,a){var s=new Nv,l=a[n.sampler],c=l.input,u=l.output,h=l.outputSize;s.interpolation=l.interpolation;for(var f=0,d=c.length;f<d;f++){var _=f*h;if(e===De.Float){var p=new ti;p.time=c[f],p.inTangent=0,p.outTangent=0,p.value=u[_],s.addKey(p)}else if(e===De.FloatArray){var v=new ti;v.time=c[f],v.inTangent=new Float32Array(h),v.outTangent=new Float32Array(h),v.value=u.subarray(_,_+h),s.addKey(v)}else if(e===De.Vector2){var g=new ti;g.time=c[f],g.value=new Z(u[_],u[_+1]),g.inTangent=new Z,g.outTangent=new Z,s.addKey(g)}else if(e===De.Vector3){var m=new ti;m.time=c[f],m.value=new y(u[_],u[_+1],u[_+2]),m.inTangent=new y,m.outTangent=new y,s.addKey(m)}else if(e===De.Vector4){var x=new ti;x.time=c[f],x.value=new qe(u[_],u[_+1],u[_+2],u[_+3]),x.inTangent=new qe,x.outTangent=new qe,s.addKey(x)}else if(e===De.Quaternion){var w=new ti;w.time=c[f],w.value=new Me(u[_],u[_+1],u[_+2],u[_+3]),w.inTangent=new qe,w.outTangent=new qe,s.addKey(w)}}return s},o}(at),sw=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parse=function(e){var n=e.url,a=e.engine;return this._isGLB(n)?a.resourceManager.load({url:n,type:tt.Buffer}).then(Ne.parseGLB).then(function(s){var l=s.gltf,c=s.buffers;e.gltf=l,e.buffers=c}):a.resourceManager.load({url:n,type:tt.JSON}).then(function(s){return e.gltf=s,Promise.all(s.buffers.map(function(l){return a.resourceManager.load({type:tt.Buffer,url:Ne.parseRelativeUrl(n,l.uri)})})).then(function(l){e.buffers=l})})},i._isGLB=function(e){return e.substring(e.lastIndexOf(".")+1)==="glb"},o}(at),jv=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parse=function(e){var n=e.engine,a=e.gltf.nodes;if(!!a){for(var s=[],l=0;l<a.length;l++){var c=a[l],u=c.matrix,h=c.translation,f=c.rotation,d=c.scale,_=new Qr(n,c.name||""+o._defaultName+l),p=_,v=p.transform;if(u){var g=v.localMatrix;g.copyFromArray(u),v.localMatrix=g}else h&&v.setPosition(h[0],h[1],h[2]),f&&v.setRotationQuaternion(f[0],f[1],f[2],f[3]),d&&v.setScale(d[0],d[1],d[2]);s[l]=_}e.entities=s,this._buildEntityTree(e),this._createSceneRoots(e)}},i._buildEntityTree=function(e){for(var n=e.gltf.nodes,a=e.entities,s=0;s<n.length;s++){var l=n[s].children,c=a[s];if(l)for(var u=0;u<l.length;u++){var h=a[l[u]];c.addChild(h)}}},i._createSceneRoots=function(e){var n=e.engine,a=e.gltf,s=a.scene,l=s===void 0?0:s,c=a.scenes,u=e.entities;if(!!c){for(var h=[],f=0;f<c.length;f++){var d=c[f].nodes;if(!!d)if(d.length===1)h[f]=u[d[0]];else{for(var _=new Qr(n,"GLTF_ROOT"),p=0;p<d.length;p++)_.addChild(u[d[p]]);h[f]=_}}e.sceneRoots=h,e.defaultSceneRoot=h[l]}},o}(at);jv._defaultName="_GLTF_ENTITY_";var Xi=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}o._parseTextureTransform=function(e,n,a){n===void 0&&(n={});var s=n.KHR_texture_transform;s&&at.parseEngineResource("KHR_texture_transform",s,e,a)};var i=o.prototype;return i.parse=function(e){var n=e.gltf,a=e.engine,s=e.textures;if(!!n.materials){for(var l=[],c=0;c<n.materials.length;c++){var u=n.materials[c],h=u.extensions,f=h===void 0?{}:h,d=u.pbrMetallicRoughness,_=u.normalTexture,p=u.occlusionTexture,v=u.emissiveTexture,g=u.emissiveFactor,m=u.alphaMode,x=u.alphaCutoff,w=u.doubleSided,C=u.name,T=C===void 0?"":C,b=f.KHR_materials_unlit,M=f.KHR_materials_pbrSpecularGlossiness,I=f.KHR_materials_clearcoat,E=f.OASIS_materials_remap,B=null;if(b?B=at.createEngineResource("KHR_materials_unlit",b,e):M?B=at.createEngineResource("KHR_materials_pbrSpecularGlossiness",M,e):B=new fa(a),B.name=T,I&&at.parseEngineResource("KHR_materials_clearcoat",I,B,e),d){var S=d.baseColorFactor,A=d.baseColorTexture,R=d.metallicFactor,D=d.roughnessFactor,z=d.metallicRoughnessTexture;if(S&&(B.baseColor=new me(me.linearToGammaSpace(S[0]),me.linearToGammaSpace(S[1]),me.linearToGammaSpace(S[2]),S[3])),A&&(B.baseTexture=s[A.index],o._parseTextureTransform(B,A.extensions,e)),!b&&!M){var U=B;U.metallic=R!=null?R:1,U.roughness=D!=null?D:1,z&&(U.roughnessMetallicTexture=s[z.index],o._parseTextureTransform(B,z.extensions,e))}}if(!b){var V=B;if(v&&(V.emissiveTexture=s[v.index],o._parseTextureTransform(B,v.extensions,e)),g&&(V.emissiveColor=new me(me.linearToGammaSpace(g[0]),me.linearToGammaSpace(g[1]),me.linearToGammaSpace(g[2]))),_){var L=_.index,J=_.scale;V.normalTexture=s[L],o._parseTextureTransform(B,_.extensions,e),J!==void 0&&(V.normalTextureIntensity=J)}if(p){var oe=p.index,le=p.strength,te=p.texCoord;V.occlusionTexture=s[oe],o._parseTextureTransform(B,p.extensions,e),le!==void 0&&(V.occlusionTextureIntensity=le),te===On.UV1?V.occlusionTextureCoord=On.UV1:te>On.UV1&&Fe.warn("Occlusion texture uv coordinate must be UV0 or UV1.")}}if(E){var Ae,Ie;e.gltf.extensions=(Ae=e.gltf.extensions)!=null?Ae:{},e.gltf.extensions.OASIS_materials_remap=(Ie=e.gltf.extensions.OASIS_materials_remap)!=null?Ie:{},e.gltf.extensions.OASIS_materials_remap[c]=at.createEngineResource("OASIS_materials_remap",E,e)}switch(w?B.renderFace=ln.Double:B.renderFace=ln.Front,m){case Ta.OPAQUE:B.isTransparent=!1;break;case Ta.BLEND:B.isTransparent=!0;break;case Ta.MASK:B.alphaCutoff=x!=null?x:.5;break}l[c]=B}e.materials=l}},o}(at),$v=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parse=function(e){var n=this,a=e.engine,s=e.gltf,l=e.buffers;if(!!s.meshes){for(var c=[],u=function(d){for(var _=s.meshes[d],p=[],v=function(x){var w=_.primitives[x],C=w.extensions,T=C===void 0?{}:C,b=T.KHR_draco_mesh_compression;p.push(new Promise(function(M){var I=new ur(a,_.name||x+"");b?at.createEngineResource("KHR_draco_mesh_compression",b,e,w).then(function(E){return n._parseMeshFromGLTFPrimitive(I,_,w,s,function(B){for(var S=0;S<E.attributes.length;S++)if(E.attributes[S].name===B)return E.attributes[S].array;return null},function(B,S){throw"BlendShape animation is not supported when using draco."},function(){return E.index.array},a)}).then(M):n._parseMeshFromGLTFPrimitive(I,_,w,s,function(E){var B=w.attributes[E],S=s.accessors[B];return Ne.getAccessorData(s,S,l)},function(E,B){var S=w.targets[B],A=S[E];if(A){var R=s.accessors[A];return Ne.getAccessorData(s,R,l)}else return null},function(){var E=s.accessors[w.indices];return Ne.getAccessorData(s,E,l)},a).then(M)}))},g=0;g<_.primitives.length;g++)v(g);c.push(Promise.all(p))},h=0;h<s.meshes.length;h++)u(h);return Promise.all(c).then(function(f){e.meshes=f})}},i._parseMeshFromGLTFPrimitive=function(e,n,a,s,l,c,u,h){var f=a.attributes,d=a.targets,_=a.indices,p=a.mode,v,g=s.accessors,m=g[f.POSITION],x=l("POSITION"),w=Ne.floatBufferToVector3Array(x);e.setPositions(w);var C=e.bounds;if(v=m.count,m.min&&m.max)C.min.copyFromArray(m.min),C.max.copyFromArray(m.max);else{var T=o._tempVector3,b=C.min,M=C.max;b.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),M.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var I=x.length/v,E=0;E<v;E++){var B=E*I;T.copyFromArray(x,B),y.min(b,T,b),y.max(M,T,M)}}for(var S in f)if(S!=="POSITION"){var A=l(S);switch(S){case"NORMAL":var R=Ne.floatBufferToVector3Array(A);e.setNormals(R);break;case"TEXCOORD_0":var D=Ne.floatBufferToVector2Array(A);e.setUVs(D,0);break;case"TEXCOORD_1":var z=Ne.floatBufferToVector2Array(A);e.setUVs(z,1);break;case"TEXCOORD_2":var U=Ne.floatBufferToVector2Array(A);e.setUVs(U,2);break;case"TEXCOORD_3":var V=Ne.floatBufferToVector2Array(A);e.setUVs(V,3);break;case"TEXCOORD_4":var L=Ne.floatBufferToVector2Array(A);e.setUVs(L,4);break;case"TEXCOORD_5":var J=Ne.floatBufferToVector2Array(A);e.setUVs(J,5);break;case"TEXCOORD_6":var oe=Ne.floatBufferToVector2Array(A);e.setUVs(oe,6);break;case"TEXCOORD_7":var le=Ne.floatBufferToVector2Array(A);e.setUVs(le,7);break;case"COLOR_0":var te=Ne.floatBufferToColorArray(A,g[f.COLOR_0].type===Xr.VEC3);e.setColors(te);break;case"TANGENT":var Ae=Ne.floatBufferToVector4Array(A);e.setTangents(Ae);break;case"JOINTS_0":var Ie=Ne.floatBufferToVector4Array(A);e.setBoneIndices(Ie);break;case"WEIGHTS_0":var G=Ne.floatBufferToVector4Array(A);e.setBoneWeights(G);break}}if(_!==void 0){var ce=s.accessors[_],pe=u();e.setIndices(pe),e.addSubMesh(0,ce.count,p)}else e.addSubMesh(0,v,p);return d&&this._createBlendShape(e,n,d,c),e.uploadData(!0),Promise.resolve(e)},i._createBlendShape=function(e,n,a,s){for(var l=n.extras?n.extras.targetNames:null,c=0,u=a.length;c<u;c++){var h=l?l[c]:"blendShape"+c,f=s("POSITION",c),d=s("NORMAL",c),_=s("TANGENT",c),p=f?Ne.floatBufferToVector3Array(f):null,v=d?Ne.floatBufferToVector3Array(d):null,g=_?Ne.floatBufferToVector3Array(_):null,m=new kl(h);m.addFrame(1,p,v,g),e.addBlendShape(m)}},o}(at);$v._tempVector3=new y;var qv=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}o._getDefaultMaterial=function(e){return o._defaultMaterial||(o._defaultMaterial=new ha(e)),o._defaultMaterial};var i=o.prototype;return i.parse=function(e){var n=e.gltf,a=n.nodes,s=n.cameras,l=e.entities;if(!!a){for(var c=[],u=0;u<a.length;u++){var h=a[u],f=h.camera,d=h.mesh,_=h.extensions,p=_===void 0?{}:_,v=p.KHR_lights_punctual,g=l[u];if(f!==void 0&&this._createCamera(e,s[f],g),d!==void 0&&c.push(this._createRenderer(e,h,g)),v){var m=v.light,x=e.gltf.extensions.KHR_lights_punctual.lights;at.parseEngineResource("KHR_lights_punctual",x[m],g,e)}}return e.defaultSceneRoot&&this._createAnimator(e),e.gltf.extensions&&delete e.gltf.extensions.OASIS_materials_remap,Promise.all(c)}},i._createCamera=function(e,n,a){var s=n.orthographic,l=n.perspective,c=n.type,u=a.addComponent(wi);if(c===Lo.ORTHOGRAPHIC){var h=s.xmag,f=s.ymag,d=s.zfar,_=s.znear;u.isOrthographic=!0,_!==void 0&&(u.nearClipPlane=_),d!==void 0&&(u.farClipPlane=d),u.orthographicSize=Math.max(f!=null?f:0,h!=null?h:0)/2}else if(c===Lo.PERSPECTIVE){var p=l.aspectRatio,v=l.yfov,g=l.zfar,m=l.znear;p!==void 0&&(u.aspectRatio=p),v!==void 0&&(u.fieldOfView=v*180/Math.PI),g!==void 0&&(u.farClipPlane=g),m!==void 0&&(u.nearClipPlane=m)}e.cameras||(e.cameras=[]),e.cameras.push(u),u.enabled=!1},i._createRenderer=function(e,n,a){for(var s=e.engine,l=e.gltf.meshes,c=e.meshes,u=e.materials,h=e.skins,f=n.mesh,d=n.skin,_=l[f],p=_.primitives,v=n.weights||_.weights,g=[],m=function(C){var T=c[f][C],b=void 0;if(d!==void 0||v){var M=a.addComponent(ta);M.mesh=T,d!==void 0&&(M.skin=h[d]),v&&(M.blendShapeWeights=new Float32Array(v)),b=M}else b=a.addComponent(yi),b.mesh=T;var I=p[C].material,E=e.gltf.extensions&&e.gltf.extensions.OASIS_materials_remap;if(E&&E[I])g.push(E[I].then(function(D){b.setMaterial(D)}));else{var B=(u==null?void 0:u[I])||o._getDefaultMaterial(s);b.setMaterial(B)}var S=p[C].extensions,A=S===void 0?{}:S,R=A.KHR_materials_variants;R&&at.parseEngineResource("KHR_materials_variants",R,b,e)},x=0;x<p.length;x++)m(x);return Promise.all(g)},i._createAnimator=function(e){var n=e.defaultSceneRoot,a=e.animations;if(!!a){var s=n.addComponent(Ja),l=new cs,c=new us("layer"),u=new hs;if(l.addLayer(c),s.animatorController=l,c.stateMachine=u,a)for(var h=0;h<a.length;h++){var f=a[h],d=f.name,_=u.makeUniqueStateName(d);_!==d&&console.warn("AnimatorState name is existed, name: "+d+" reset to "+_);var p=u.addState(_);p.clip=f}}},o}(at);qv._defaultMaterial=void 0;var lw=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parse=function(e){var n=e.gltf,a=e.buffers,s=e.entities,l=e.defaultSceneRoot,c=n.skins;if(!!c){for(var u=[],h=0;h<c.length;h++){var f=c[h],d=f.inverseBindMatrices,_=f.skeleton,p=f.joints,v=f.name,g=v===void 0?"SKIN_"+h:v,m=p.length,x=new Sv(g);x.inverseBindMatrices.length=m;for(var w=n.accessors[d],C=Ne.getAccessorData(n,w,a),T=0;T<m;T++){var b=new ge;b.copyFromArray(C,T*16),x.inverseBindMatrices[T]=b}for(var M=0;M<m;M++)x.joints[M]=s[p[M]].name;_!==void 0?x.skeleton=s[_].name:x.skeleton=l.name,u[h]=x}e.skins=u}},o}(at),Yv=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parse=function(e){var n=this,a=e.gltf,s=e.buffers,l=e.engine,c=e.url;if(a.textures)return Promise.all(a.textures.map(function(u,h){var f=u.sampler,d=u.source,_=d===void 0?0:d,p=u.name,v=a.images[_],g=v.uri,m=v.bufferView,x=v.mimeType,w=v.name;if(g)return l.resourceManager.load({url:Ne.parseRelativeUrl(c,g),type:tt.Texture2D}).then(function(b){return b.name||(b.name=p||w||"texture_"+h),f!==void 0&&n._parseSampler(b,a.samplers[f]),b});var C=a.bufferViews[m],T=Ne.getBufferViewData(C,s);return Ne.loadImageBuffer(T,x).then(function(b){var M=new yr(l,b.width,b.height);return M.setImageSource(b),M.generateMipmaps(),M.name=p||w||"texture_"+h,f!==void 0&&n._parseSampler(M,a.samplers[f]),M})})).then(function(u){e.textures=u})},i._parseSampler=function(e,n){var a=n.magFilter,s=n.minFilter,l=n.wrapS,c=n.wrapT;(a||s)&&Fe.warn("texture use filterMode in engine"),l&&(e.wrapModeU=o._wrapMap[l]),c&&(e.wrapModeV=o._wrapMap[c])},o}(at);Yv._wrapMap={33071:qt.Clamp,33648:qt.Mirror,10497:qt.Repeat};var cw=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parse=function(e){var n=e.gltf,a=n.asset.version,s=n.extensionsUsed,l=n.extensionsRequired,c=Number(a);if(!(c>=2&&c<3))throw"Only support gltf 2.x.";if(s){Fe.info("extensionsUsed: ",s);for(var u=0;u<s.length;u++)at.hasExtensionParser(s[u])||Fe.warn("Extension "+s[u]+" is not implemented, you can customize this extension in gltf.")}if(l){Fe.info("extensionsRequired: "+l);for(var h=0;h<l.length;h++){var f=l[h];at.hasExtensionParser(f)?at.initialize(f):Fe.error("GLTF parser has not supported required extension "+f+".")}}},o}(at),nl=function(){function r(i){var t=this;this._pipes=[],i.forEach(function(e,n){t._pipes[n]=new e})}var o=r.prototype;return o.parse=function(t){var e=this,n;return new Promise(function(a,s){e._pipes.forEach(function(l){n?n=n.then(function(){return l.parse(t)}):n=l.parse(t)}),n?n.then(function(){a(t)}).catch(s):a(t)})},r}();nl.instance=new nl([sw,cw,Yv,Xi,$v,jv,lw,ow,qv]);var uw=function(r){Le(o,r);function o(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return i=r.call.apply(r,[this].concat(e))||this,i.url=void 0,i.gltf=void 0,i.buffers=void 0,i.textures=void 0,i.materials=void 0,i.meshes=void 0,i.skins=void 0,i.animations=void 0,i.entities=void 0,i.cameras=void 0,i.lights=void 0,i.sceneRoots=void 0,i.defaultSceneRoot=void 0,i.variants=void 0,i}return o}(pn),kf,Gf;kf=mt(tt.Prefab,["gltf","glb"]),kf(Gf=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=e.url;return new st(function(s,l){var c=new uw(n.engine);c.url=a,nl.instance.parse(c).then(s).catch(function(u){console.error(u),l("Error loading glTF model from "+a+" .")})})},o}(rt));var Hf,Wf;Hf=mt(tt.JSON,["json"],!1),Hf(Wf=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e){return this.request(e.url,et(et({},e),{},{type:"json"}))},o}(rt));var hw=12+13*4,fw=0;function dw(r,o){for(var i=[],t=hw+r.bytesOfKeyValueData,e=r.pixelWidth,n=r.pixelHeight,a=o?r.numberOfMipmapLevels:1,s=0;s<a;s++){var l=new Int32Array(r.buffer,t,1)[0];t+=4;for(var c=0;c<r.numberOfFaces;c++){var u=new Uint8Array(r.buffer,t,l);i.push({data:u,width:e,height:n}),t+=l,t+=3-(l+3)%4}e=Math.max(1,e*.5),n=Math.max(1,n*.5)}return i}function _w(r){if(r.byteLength>=12){var o=new Uint8Array(r,0,12);if(o[0]===171&&o[1]===75&&o[2]===84&&o[3]===88&&o[4]===32&&o[5]===49&&o[6]===49&&o[7]===187&&o[8]===13&&o[9]===10&&o[10]===26&&o[11]===10)return!0}return!1}function vw(r){switch(r){case be.RGB_S3TC_DXT1_EXT:return se.DXT1;case be.RGBA_S3TC_DXT5_EXT:return se.DXT5;case be.RGB_ETC1_WEBGL:return se.ETC1_RGB;case be.RGB8_ETC2:return se.ETC2_RGB;case be.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return se.ETC2_RGBA5;case be.RGBA8_ETC2_EAC:return se.ETC2_RGBA8;case be.RGB_PVRTC_2BPPV1_IMG:return se.PVRTC_RGB2;case be.RGBA_PVRTC_2BPPV1_IMG:return se.PVRTC_RGBA2;case be.RGB_PVRTC_4BPPV1_IMG:return se.PVRTC_RGB4;case be.RGBA_PVRTC_4BPPV1_IMG:return se.PVRTC_RGBA4;case be.RGBA_ASTC_4X4_KHR:return se.ASTC_4x4;case be.RGBA_ASTC_5X5_KHR:return se.ASTC_5x5;case be.RGBA_ASTC_6X6_KHR:return se.ASTC_6x6;case be.RGBA_ASTC_8X8_KHR:return se.ASTC_8x8;case be.RGBA_ASTC_10X10_KHR:return se.ASTC_10x10;case be.RGBA_ASTC_12X12_KHR:return se.ASTC_12x12;default:var o=be[r];throw new Error("this format is not supported in Oasis Engine: "+o)}}var Qv={parse:function(o,i,t,e){if(e===void 0&&(e=!1),!_w(o))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var n=Uint32Array.BYTES_PER_ELEMENT,a=new DataView(o,12,13*n),s=a.getUint32(0,!0),l=s===67305985,c={buffer:o,glType:a.getUint32(1*n,l),glTypeSize:a.getUint32(2*n,l),glFormat:a.getUint32(3*n,l),glInternalFormat:a.getUint32(4*n,l),glBaseInternalFormat:a.getUint32(5*n,l),pixelWidth:a.getUint32(6*n,l),pixelHeight:a.getUint32(7*n,l),pixelDepth:a.getUint32(8*n,l),numberOfArrayElements:a.getUint32(9*n,l),numberOfFaces:a.getUint32(10*n,l),numberOfMipmapLevels:a.getUint32(11*n,l),bytesOfKeyValueData:a.getUint32(12*n,l),loadType:fw};if(c.glType!==0)throw new Error("only compressed formats currently supported");if(c.numberOfMipmapLevels=Math.max(1,c.numberOfMipmapLevels),c.pixelHeight===0||c.pixelDepth!==0)throw new Error("only 2D textures currently supported");if(c.numberOfArrayElements!==0)throw new Error("texture arrays not currently supported");if(c.numberOfFaces!==i)throw new Error("number of faces expected"+i+", but found "+c.numberOfFaces);return t&&(c.mipmaps=dw(c,!0)),e&&(c.engineFormat=vw(c.glInternalFormat)),c}};function pw(r){var o=Qv.parse(r,1,!0,!0);return{mipmaps:o.mipmaps,engineFormat:o.engineFormat,internalFormat:o.glInternalFormat,width:o.pixelWidth,height:o.pixelHeight}}function gw(r){for(var o=[],i,t,e,n,a=0;a<r.length;a++){var s=Qv.parse(r[a],1,!0,!0);o.push(s.mipmaps),a===0&&(e=s.pixelWidth,n=s.pixelHeight,i=s.glInternalFormat,t=s.engineFormat)}return{mipmapsFaces:o,engineFormat:t,internalFormat:i,width:e,height:n}}var Xf,jf;Xf=mt(tt.KTXCube,[]),Xf(jf=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){Promise.all(e.urls.map(function(c){return a.request(c,et(et({},e),{},{type:"arraybuffer"}))})).then(function(c){for(var u=gw(c),h=u.width,f=u.mipmapsFaces,d=u.engineFormat,_=f[0].length>1,p=new tr(n.engine,h,d,_),v=0;v<6;v++)for(var g=f[v].length,m=0;m<g;m++){var x=f[v][m],w=x.data,C=x.width,T=x.height;p.setPixelBuffer(jt.PositiveX+v,w,m,0,0,C,T)}s(p)}).catch(function(c){l(c)})})},o}(rt));var $f,qf;$f=mt(tt.KTX,["ktx"]),$f(qf=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,et(et({},e),{},{type:"arraybuffer"})).then(function(c){for(var u=pw(c),h=u.width,f=u.height,d=u.mipmaps,_=u.engineFormat,p=d.length>1,v=new yr(n.engine,h,f,_,p),g=0;g<d.length;g++){var m=d[g],x=m.width,w=m.height,C=m.data;v.setPixelBuffer(C,g,0,0,x,w)}s(v)}).catch(function(c){l(c)})})},o}(rt));var Yf,Qf;Yf=mt(tt.Texture2D,["png","jpg","webp","jpeg"]),Yf(Qf=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,et(et({},e),{},{type:"image"})).then(function(c){var u=new yr(n.engine,c.width,c.height);if(!!u._platformTexture){if(u.setImageSource(c),u.generateMipmaps(),e.url.indexOf("data:")!==0){var h=e.url.split("/");u.name=h[h.length-1]}s(u)}}).catch(function(c){l(c)})})},o}(rt));var Jf,Kf;Jf=mt(tt.TextureCube,[""]),Jf(Kf=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){Promise.all(e.urls.map(function(c){return a.request(c,et(et({},e),{},{type:"image"}))})).then(function(c){var u=c[0],h=u.width,f=u.height;if(h!==f){console.error("The cube texture must have the same width and height");return}var d=new tr(n.engine,h);if(!!d._platformTexture){for(var _=0;_<6;_++)d.setImageSource(jt.PositiveX+_,c[_],0);d.generateMipmaps(),s(d)}}).catch(function(c){l(c)})})},o}(rt));var Zf,ed;Zf=mt(tt.Sprite,["sprite"],!1),Zf(ed=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,et(et({},e),{},{type:"json"})).then(function(c){n.getResourceByRef(c.texture).then(function(u){var h=new ls(n.engine,u);h.region=c.region,h.pivot=c.pivot,s(h)})})})},o}(rt));var td,rd;td=mt(tt.SpriteAtlas,["atlas"],!1),td(rd=function(r){Le(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t._tempRect=new $s,t._tempVec2=new Z,t}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,et(et({},e),{},{type:"json"})).then(function(c){var u=c.atlasItems,h=c.format,f=u.length;Promise.all(u.map(function(d){var _=d.img;return a.request(Ne.parseRelativeUrl(e.url,_),et(et({},e),{},{type:"image"}))})).then(function(d){for(var _=n.engine,p=a._tempRect,v=a._tempVec2,g=new Fv(_),m=0;m<f;m++){var x=d[m],w=x.width,C=x.height,T=new yr(_,w,C,h);T.setImageSource(x),T.generateMipmaps();for(var b=u[m],M=b.sprites,I=1/w,E=1/C,B=M.length-1;B>=0;B--){var S=M[B],A=S.region,R=S.atlasRegionOffset,D=S.atlasRegion,z=S.id,U=S.pivot,V=new ls(_,T,A?p.set(A.x,A.y,A.w,A.h):void 0,U?v.set(U.x,U.y):void 0,void 0,S.name);if(V.atlasRegion.set(D.x*I,D.y*E,D.w*I,D.h*E),S.atlasRotated&&(V.atlasRotated=!0),R){var L=R.x,J=R.y,oe=R.z,le=R.w;V.atlasRegionOffset.set(L*I,J*E,oe*I,le*E)}z!==void 0&&(V._assetID=z),g._addSprite(V)}}s(g)})}).catch(function(c){l(c)})})},o}(rt));var nd,id;nd=mt(tt.Env,["env"]),nd(id=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,{type:"arraybuffer"}).then(function(c){var u,h=new Float32Array(c,0,27),f=27*4,d=(u=new Uint16Array(c,f,1))===null||u===void 0?void 0:u[0],_=new tr(n.engine,d);_.filterMode=gr.Trilinear;for(var p=_.mipmapCount,v=f+2,g=0;g<p;g++)for(var m=d>>g,x=0;x<6;x++){var w=m*m*4,C=new Uint8Array(c,v,w);v+=w,_.setPixelBuffer(jt.PositiveX+x,C,g)}var T=new or,b=new oy;T.diffuseMode=ra.SphericalHarmonics,b.copyFromArray(h),T.diffuseSphericalHarmonics=b,T.specularTexture=_,T.specularTextureDecodeRGBM=!0,s(T)}).catch(function(c){l(c)})})},o}(rt));var ad,od,Se,Ei=Math.PI;ad=mt(tt.HDR,["hdr"]),ad(od=(Se=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}o._convertToCubemap=function(e,n,a,s){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=n*a*4)throw"ConvertPanoramaToCubemap: input size is wrong";var l=this._createCubemapData(s,this._faceRight,e,n,a),c=this._createCubemapData(s,this._faceLeft,e,n,a),u=this._createCubemapData(s,this._faceUp,e,n,a),h=this._createCubemapData(s,this._faceBottom,e,n,a),f=this._createCubemapData(s,this._faceFront,e,n,a),d=this._createCubemapData(s,this._faceBack,e,n,a);return[l,c,u,h,f,d]},o._createCubemapData=function(e,n,a,s,l){for(var c=new Uint8ClampedArray(e*e*4),u=this._tempVector3.set(0,0,0).add(n[1]).subtract(n[0]).scale(1/e),h=this._temp2Vector3.set(0,0,0).add(n[3]).subtract(n[2]).scale(1/e),f=1/e,d=0,_=0;_<e;_++){for(var p=this._temp3Vector3.set(0,0,0).add(n[0]),v=this._temp4Vector3.set(0,0,0).add(n[2]),g=0;g<e;g++){var m=this._temp5Vector3.set(0,0,0).add(v).subtract(p).scale(d).add(p);m.normalize();var x=this._calcProjectionSpherical(m,a,s,l);this._RGBEToLinear(x),this._linearToRGBM(x,5);var w=_*e*4+g*4;c[w]=x.r,c[w+1]=x.g,c[w+2]=x.b,c[w+3]=x.a,p.add(u),v.add(h)}d+=f}return c},o._calcProjectionSpherical=function(e,n,a,s){for(var l=Math.atan2(e.z,-e.x),c=Math.acos(e.y);l<-Ei;)l+=2*Ei;for(;l>Ei;)l-=2*Ei;var u=l/Ei,h=c/Ei;u=u*.5+.5;var f=Math.round(u*a);f<0?f=0:f>=a&&(f=a-1);var d=Math.round(h*s);d<0?d=0:d>=s&&(d=s-1);var _=s-d-1,p=_*a*4+f*4,v=n[p],g=n[p+1],m=n[p+2],x=n[p+3];return new me(v,g,m,x)},o._readStringLine=function(e,n){for(var a="",s="",l=n;l<e.length-n&&(s=String.fromCharCode(e[l]),s!=`
`);l++)a+=s;return a},o._parseHeader=function(e){var n=0,a=0,s=this._readStringLine(e,0);if(s[0]!="#"||s[1]!="?")throw"Bad HDR Format.";var l=!1,c=!1,u=0;do u+=s.length+1,s=this._readStringLine(e,u),s=="FORMAT=32-bit_rle_rgbe"?c=!0:s.length==0&&(l=!0);while(!l);if(!c)throw"HDR Bad header format, unsupported FORMAT";u+=s.length+1,s=this._readStringLine(e,u);var h=/^\-Y (.*) \+X (.*)$/g,f=h.exec(s);if(!f||f.length<3)throw"HDR Bad header format, no size";if(a=parseInt(f[2]),n=parseInt(f[1]),a<8||a>32767)throw"HDR Bad header format, unsupported size";return u+=s.length+1,{height:n,width:a,dataPosition:u}},o._readPixels=function(e,n,a){for(var s=n,l=e.byteLength,c=new Uint8Array(4*n*a),u=0,h=0,f=4*s,d=new Uint8Array(4),_=new Uint8Array(f),p=a;p>0&&h<l;){if(d[0]=e[h++],d[1]=e[h++],d[2]=e[h++],d[3]=e[h++],d[0]!=2||d[1]!=2||(d[2]<<8|d[3])!=s)throw"HDR Bad header format, wrong scan line width";for(var v=0,g=void 0;v<f&&h<l;){g=e[h++];var m=g>128;if(m&&(g-=128),g===0||v+g>f)throw"HDR Bad Format, bad scanline data (run)";if(m)for(var x=e[h++],w=0;w<g;w++)_[v++]=x;else _.set(e.subarray(h,h+g),v),v+=g,h+=g}for(var C=s,T=0;T<C;T++){var b=0;c[u]=_[T+b],b+=s,c[u+1]=_[T+b],b+=s,c[u+2]=_[T+b],b+=s,c[u+3]=_[T+b],u+=4}p--}return c},o._RGBEToLinear=function(e){var n=Math.pow(2,e.a-128)/255;e.r*=n,e.g*=n,e.b*=n,e.a=1},o._linearToRGBM=function(e,n){var a=Math.max(e.r,Math.max(e.g,e.b)),s=Math.min(a/n,1);s=Math.ceil(s*255);var l=65025/(s*n);e.r*=l,e.g*=l,e.b*=l,e.a*=s};var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){var c=n.engine;a.request(e.url,{type:"arraybuffer"}).then(function(u){for(var h=new Uint8Array(u),f=o._parseHeader(h),d=f.width,_=f.height,p=f.dataPosition,v=o._readPixels(h.subarray(p),d,_),g=_>>1,m=o._convertToCubemap(v,d,_,g),x=new tr(c,g),w=0;w<6;w++)x.setPixelBuffer(jt.PositiveX+w,m[w],0);x.generateMipmaps(),s(x)}).catch(l)})},o}(rt),Se._rightBottomBack=new y(1,-1,-1),Se._rightBottomFront=new y(1,-1,1),Se._rightUpBack=new y(1,1,-1),Se._rightUpFront=new y(1,1,1),Se._leftBottomBack=new y(-1,-1,-1),Se._leftBottomFront=new y(-1,-1,1),Se._leftUpBack=new y(-1,1,-1),Se._leftUpFront=new y(-1,1,1),Se._faceRight=[Se._rightBottomBack,Se._rightBottomFront,Se._rightUpBack,Se._rightUpFront],Se._faceLeft=[Se._leftBottomFront,Se._leftBottomBack,Se._leftUpFront,Se._leftUpBack],Se._faceUp=[Se._leftBottomFront,Se._rightBottomFront,Se._leftBottomBack,Se._rightBottomBack],Se._faceBottom=[Se._leftUpBack,Se._rightUpBack,Se._leftUpFront,Se._rightUpFront],Se._faceFront=[Se._leftBottomBack,Se._rightBottomBack,Se._leftUpBack,Se._rightUpBack],Se._faceBack=[Se._rightBottomFront,Se._leftBottomFront,Se._rightUpFront,Se._leftUpFront],Se._tempVector3=new y,Se._temp2Vector3=new y,Se._temp3Vector3=new y,Se._temp4Vector3=new y,Se._temp5Vector3=new y,Se));var xn=function(){function r(){}var o=r.prototype;return o.initialize=function(){},o.parseEngineResource=function(t,e,n){},o.createEngineResource=function(t,e){return null},r}(),sd,ld,Rs;sd=yn("KHR_draco_mesh_compression"),sd(ld=(Rs=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.initialize=function(){o._decoder||(o._decoder=new tw)},i.createEngineResource=function(e,n,a){var s=n.gltf,l=n.buffers,c=s.bufferViews,u=s.accessors,h=e.bufferView,f=e.attributes,d={},_={};for(var p in f)d[p]=f[p];for(var v in a.attributes)if(f[v]!==void 0){var g=u[a.attributes[v]];_[v]=Ne.getComponentType(g.componentType).name}var m=u[a.indices],x=Ne.getComponentType(m.componentType).name,w={attributeIDs:d,attributeTypes:_,useUniqueIDs:!0,indexType:x},C=Ne.getBufferViewData(c[h],l);return o._decoder.decode(C,w).then(function(T){return T})},o}(xn),Rs._decoder=void 0,Rs));var cd,ud;cd=yn("KHR_lights_punctual"),cd(ud=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parseEngineResource=function(e,n,a){var s=e.color,l=e.intensity,c=l===void 0?1:l,u=e.type,h=e.range,f=e.spot,d;if(u==="directional"?d=n.addComponent(Yt):u==="point"?d=n.addComponent(xr):u==="spot"&&(d=n.addComponent(Ht)),s&&d.color.set(s[0],s[1],s[2],1),d.intensity=c,h&&!(d instanceof Yt)&&(d.distance=h),f&&d instanceof Ht){var _=f.innerConeAngle,p=_===void 0?0:_,v=f.outerConeAngle,g=v===void 0?Math.PI/4:v;d.angle=p,d.penumbra=g-p}a.lights||(a.lights=[]),a.lights.push(d)},o}(xn));var hd,fd;hd=yn("KHR_materials_clearcoat"),hd(fd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parseEngineResource=function(e,n,a){var s=a.textures,l=e.clearcoatFactor,c=l===void 0?0:l,u=e.clearcoatTexture,h=e.clearcoatRoughnessFactor,f=h===void 0?0:h,d=e.clearcoatRoughnessTexture,_=e.clearcoatNormalTexture;n.clearCoat=c,n.clearCoatRoughness=f,u&&(n.clearCoatTexture=s[u.index],Xi._parseTextureTransform(n,u.extensions,a)),d&&(n.clearCoatRoughnessTexture=s[d.index],Xi._parseTextureTransform(n,d.extensions,a)),_&&(n.clearCoatNormalTexture=s[_.index],Xi._parseTextureTransform(n,_.extensions,a))},o}(xn));var dd,_d;dd=yn("KHR_materials_pbrSpecularGlossiness"),dd(_d=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.createEngineResource=function(e,n){var a=n.engine,s=n.textures,l=new Ci(a),c=e.diffuseFactor,u=e.diffuseTexture,h=e.specularFactor,f=e.glossinessFactor,d=e.specularGlossinessTexture;return c&&(l.baseColor=new me(me.linearToGammaSpace(c[0]),me.linearToGammaSpace(c[1]),me.linearToGammaSpace(c[2]),c[3])),u&&(l.baseTexture=s[u.index],Xi._parseTextureTransform(l,u.extensions,n)),h&&(l.specularColor=new me(me.linearToGammaSpace(h[0]),me.linearToGammaSpace(h[1]),me.linearToGammaSpace(h[2]))),f!==void 0&&(l.glossiness=f),d&&(l.specularGlossinessTexture=s[d.index],Xi._parseTextureTransform(l,d.extensions,n)),l},o}(xn));var vd,pd;vd=yn("KHR_materials_unlit"),vd(pd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.createEngineResource=function(e,n){var a=n.engine,s=new ss(a);return s},o}(xn));var gd,md;gd=yn("KHR_materials_variants"),gd(md=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parseEngineResource=function(e,n,a){for(var s=a.gltf.extensions.KHR_materials_variants.variants,l=a.materials,c=e.mappings,u=0;u<c.length;u++){var h=c[u],f=h.material,d=h.variants;a.variants||(a.variants=[]),a.variants.push({renderer:n,material:l[f],variants:d.map(function(_){return s[_].name})})}},o}(xn));var yd,xd;yd=yn("KHR_mesh_quantization"),yd(xd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}return o}(xn));var wd,bd;wd=yn("KHR_texture_transform"),wd(bd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.parseEngineResource=function(e,n,a){var s=e.offset,l=e.rotation,c=e.scale,u=e.texCoord;s&&(n.tilingOffset.z=s[0],n.tilingOffset.w=s[1]),c&&(n.tilingOffset.x=c[0],n.tilingOffset.y=c[1]),l&&Fe.warn("rotation in KHR_texture_transform is not supported now"),u&&Fe.warn("texCoord in KHR_texture_transform is not supported now")},o}(xn));var Sd,Cd;Sd=yn("OASIS_materials_remap"),Sd(Cd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.createEngineResource=function(e,n){var a=n.engine;return a.resourceManager.getResourceByRef(e)},o}(xn));var Ad,Pd;Ad=mt(tt.Material,["json"]),Ad(Pd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,et(et({},e),{},{type:"json"})).then(function(c){var u=n.engine,h=c.shader,f=c.shaderData,d=c.macros,_=c.renderState,p;switch(h){case"pbr":p=new fa(u);break;case"pbr-specular":p=new Ci(u);break;case"unlit":p=new ss(u);break;case"blinn-phong":p=new ha(u);break}var v=new Array,g=p.shaderData,m=function(B){var S=f[B],A=S.type,R=S.value;switch(A){case"Vector2":g.setVector2(B,new Z(R.x,R.y));break;case"Vector3":g.setVector3(B,new y(R.x,R.y,R.z));break;case"Vector4":g.setVector4(B,new qe(R.x,R.y,R.z,R.w));break;case"Color":g.setColor(B,new me(R.r,R.g,R.b,R.a));break;case"Float":g.setFloat(B,R);break;case"Texture":v.push(n.getResourceByRef(R).then(function(D){g.setTexture(B,D)}));break}};for(var x in f)m(x);for(var w=0,C=d.length;w<C;w++){var T=d[w],b=T.name,M=T.value;M==null?g.enableMacro(b):g.enableMacro(b,M)}for(var I in _)p[I]=_[I];Promise.all(v).then(function(){s(p)})})})},o}(rt));var Jv=function(){function r(i,t,e,n){t===void 0&&(t=0),n===void 0&&(n=!0),this.buffer=i,this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(i),this._littleEndian=n,this._offset=t}var o=r.prototype;return o.nextUint8=function(){var t=this._dataView.getUint8(this._offset);return this._offset+=1,t},o.nextUint16=function(){var t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t},o.nextUint32=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t},o.nextInt32=function(){var t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t},o.nextInt32Array=function(t){var e=new Int32Array(this.buffer,this._offset,t);return this._offset+=4*t,e},o.nextFloat32=function(){var t=this._dataView.getFloat32(this._offset,this._littleEndian);return this._offset+=4,t},o.nextFloat32Array=function(t){var e=new Float32Array(this.buffer,this._offset,t);return this._offset+=4*t,e},o.nextUint32Array=function(t){var e=new Uint32Array(this.buffer,this._offset,t);return this._offset+=4*t,e},o.nextUint8Array=function(t){var e=new Uint8Array(this.buffer,this._offset,t);return this._offset+=t,e},o.nextUint64=function(){var t=this._dataView.getUint32(this._offset,this._littleEndian),e=this._dataView.getUint32(this._offset+4,this._littleEndian),n=t+Math.pow(2,32)*e;return this._offset+=8,n},o.nextStr=function(){var t=this.nextUint16(),e=new Uint8Array(this.buffer,this._offset,t);return this._offset+=t,Ne.decodeText(e)},o.nextImageData=function(t){return this.buffer.slice(this._offset)},o.nextImagesData=function(t){for(var e=new Array(t),n=0;n<t;n++){var a=this._dataView.getUint32(this._offset,this._littleEndian);e[n]=a,this._offset+=4}for(var s=[],l=0;l<t;l++){var c=e[l],u=this.buffer.slice(this._offset,this._offset+c);this._offset+=c,s.push(u)}return s},o.skip=function(t){return this._offset+=t,this},o.scan=function(t,e){e===void 0&&(e=0);for(var n=this._offset,a=0;this._dataView.getUint8(this._offset)!==e&&a<t;)a++,this._offset++;return a<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,a)},Wv(r,[{key:"offset",get:function(){return this._offset}}]),r}();Jv.imageMapping={0:"image/png",1:"image/jpg",2:"image/webp",3:"ktx"};var Kv={};function Zv(r){return function(o){Kv[r]=o}}var mw=function(){function r(){this.totalLength=0,this.version=0,this.type="",this.name="",this.headerLength=0}return r.decode=function(i){var t=new DataView(i),e=t.getUint32(0,!0),n=t.getUint8(4),a=t.getUint16(5,!0),s=new Uint8Array(i,7,a),l=t.getUint16(7+a,!0),c=new Uint8Array(i,9+a,l),u=Ne.decodeText(c),h=Ne.decodeText(s),f=new r;return f.totalLength=e,f.name=u,f.type=h,f.version=n,f.headerLength=c.byteLength+s.byteLength+9,f},Wv(r,[{key:"dataLength",get:function(){return this.totalLength-this.headerLength}}]),r}(),Td,Md;Td=Zv("Mesh"),Td(Md=function(){function r(){}return r.decode=function(i,t){return new Promise(function(e){var n=new ur(i),a=t.nextStr(),s=JSON.parse(a),l=Math.ceil(t.offset/4)*4,c=new Float32Array(t.buffer,s.positions.start+l,(s.positions.end-s.positions.start)/4),u=c.length/3,h=co(c,u);if(n.setPositions(h),s.normals){var f=new Float32Array(t.buffer,s.normals.start+l,(s.normals.end-s.normals.start)/4),d=co(f,u);n.setNormals(d)}if(s.uvs){var _=new Float32Array(t.buffer,s.uvs.start+l,(s.uvs.end-s.uvs.start)/4);n.setUVs(Tn(_,u))}if(s.uv1){var p=new Float32Array(t.buffer,s.uv1.start+l,(s.uv1.end-s.uv1.start)/4);n.setUVs(Tn(p,u),1)}if(s.uv2){var v=new Float32Array(t.buffer,s.uv2.start+l,(s.uv2.end-s.uv2.start)/4);n.setUVs(Tn(v,u),2)}if(s.uv3){var g=new Float32Array(t.buffer,s.uv3.start+l,(s.uv3.end-s.uv3.start)/4);n.setUVs(Tn(g,u),3)}if(s.uv4){var m=new Float32Array(t.buffer,s.uv4.start+l,(s.uv4.end-s.uv4.start)/4);n.setUVs(Tn(m,u),4)}if(s.uv5){var x=new Float32Array(t.buffer,s.uv5.start+l,(s.uv5.end-s.uv5.start)/4);n.setUVs(Tn(x,u),5)}if(s.uv6){var w=new Float32Array(t.buffer,s.uv6.start+l,(s.uv6.end-s.uv6.start)/4);n.setUVs(Tn(w,u),6)}if(s.uv7){var C=new Float32Array(t.buffer,s.uv7.start+l,(s.uv7.end-s.uv7.start)/4);n.setUVs(Tn(C,u),7)}if(s.colors){var T=new Float32Array(t.buffer,s.colors.start+l,(s.colors.end-s.colors.start)/4);n.setColors(yw(T,u))}if(s.boneWeights){var b=new Float32Array(t.buffer,s.boneWeights.start+l,(s.boneWeights.end-s.boneWeights.start)/4);n.setBoneWeights(Fs(b,u))}if(s.boneIndices){var M=new Float32Array(t.buffer,s.boneIndices.start+l,(s.boneIndices.end-s.boneIndices.start)/4);n.setBoneIndices(Fs(M,u))}if(s.blendShapes&&s.blendShapes.forEach(function(E){var B=new kl(E.name);E.frames.forEach(function(S){var A=new Float32Array(t.buffer,S.deltaPosition.start+l,(S.deltaPosition.end-S.deltaPosition.start)/4),R=A.length/3,D=co(A,R);if(S.deltaNormals){var z=new Float32Array(t.buffer,S.deltaNormals.start+l,(S.deltaNormals.end-S.deltaNormals.start)/4);co(z,R)}if(S.deltaTangents){var U=new Float32Array(t.buffer,S.deltaTangents.start+l,(S.deltaTangents.end-S.deltaTangents.start)/4);Fs(U,R)}B.addFrame(S.weight,D)}),n.addBlendShape(B)}),s.indices){var I=null;s.indices.type===0?I=new Uint16Array(t.buffer,s.indices.start+l,(s.indices.end-s.indices.start)/2):I=new Uint32Array(t.buffer,s.indices.start+l,(s.indices.end-s.indices.start)/4),n.setIndices(I)}s.subMeshes.forEach(function(E){n.addSubMesh(E)}),n.uploadData(!1),e(n)})},r}());function yw(r,o){for(var i=new Array(o),t=0;t<o;t++)i[t]=new me(r[t*4],r[t*4+1],r[t*4+2],r[t*4+3]);return i}function Fs(r,o){for(var i=new Array(o),t=0;t<o;t++)i[t]=new qe(r[t*4],r[t*4+1],r[t*4+2],r[t*4+3]);return i}function co(r,o){for(var i=new Array(o),t=0;t<o;t++)i[t]=new y(r[t*3],r[t*3+1],r[t*3+2]);return i}function Tn(r,o){for(var i=new Array(o),t=0;t<o;t++)i[t]=new Z(r[t*2],r[t*2+1]);return i}var Ed,Rd;Ed=Zv("Texture2D"),Ed(Rd=function(){function r(){}return r.decode=function(i,t){return new Promise(function(e,n){var a=t.nextStr(),s=!!t.nextUint8(),l=t.nextUint8(),c=t.nextUint8(),u=t.nextUint8(),h=t.nextUint8(),f=t.nextUint8(),d=t.nextUint16(),_=t.nextUint16(),p=t.nextUint8(),v=t.nextUint8(),g=t.nextImagesData(v),m=new yr(i,d,_,f,s);if(m.filterMode=l,m.anisoLevel=c,m.wrapModeU=u,m.wrapModeV=h,p){var x=new Uint8Array(g[0]);if(m.setPixelBuffer(x),s){m.generateMipmaps();for(var w=1;w<v;w++){var C=new Uint8Array(g[w]);m.setPixelBuffer(C,w)}}i.resourceManager._objectPool[a]=m,e(m)}else{var T=new window.Blob([g[0]]),b=new Image;b.onload=function(){m.setImageSource(b);var M=0,I=function(){M++,M>=v&&e(m)};if(I(),s){m.generateMipmaps();for(var E=function(A){var R=new window.Blob([g[A]]),D=new Image;D.onload=function(){m.setImageSource(D,A),I()},D.src=URL.createObjectURL(R)},B=1;B<v;B++)E(B)}},b.src=URL.createObjectURL(T)}})},r}());var ep=function(){function r(){}return r.parseEntity=function(i,t){var e=this;return r.getEntityByConfig(i,t).then(function(n){var a;n.isActive=(a=i.isActive)!=null?a:!0;var s=i.position,l=i.rotation,c=i.scale;s&&n.transform.setPosition(s.x,s.y,s.z),l&&n.transform.setRotation(l.x,l.y,l.z),c&&n.transform.setScale(c.x,c.y,c.z);for(var u=[],h=0;h<i.components.length;h++){var f=i.components[h],d=f.refId?f.refId:f.class,_=void 0;d==="Animator"&&(_=n.getComponent(rt.getClass(d))),_=_||n.addComponent(rt.getClass(d));var p=e.parsePropsAndMethods(_,f,t);u.push(p)}return Promise.all(u).then(function(){return n})})},r.getEntityByConfig=function(i,t){var e=i.assetRefId;if(e)return t.resourceManager.getResourceByRef({refId:e,key:i.key});var n=new Qr(t,i.name);return Promise.resolve(n)},r.parseClassObject=function(i,t,e){var n;e===void 0&&(e=t.resourceManager);var a=rt.getClass(i.class),s=(n=i.constructParams)!=null?n:[],l=yo(a,s);return this.parsePropsAndMethods(l,i,t,e)},r.parseBasicType=function(i,t,e){var n=this;return e===void 0&&(e=t.resourceManager),Array.isArray(i)?Promise.all(i.map(function(a){return n.parseBasicType(a,t,e)})):typeof i=="object"&&i!=null?this._isClass(i)?this.parseClassObject(i,t,e):this._isRef(i)?e.getResourceByRef(i):Promise.resolve(i):Promise.resolve(i)},r.parsePropsAndMethods=function(i,t,e,n){var a=this;n===void 0&&(n=e.resourceManager);var s=[];if(t.methods)for(var l in t.methods)for(var c=t.methods[l],u=0,h=c.length;u<h;u++){var f=c[u],d=this.parseMethod(i,l,f,e,n);s.push(d)}if(t.props){var _=function(g){var m=t.props[g],x=a.parseBasicType(m,e).then(function(w){return i[g]=w});s.push(x)};for(var p in t.props)_(p)}return Promise.all(s).then(function(){return i})},r.parseMethod=function(i,t,e,n,a){var s=this;return a===void 0&&(a=n.resourceManager),Promise.all(e.map(function(l){return s.parseBasicType(l,n,a)})).then(function(l){return i[t].apply(i,l)})},r._isClass=function(i){return i.class!=null},r._isRef=function(i){return i.refId!=null},r}(),xw=function(){function r(i){this._engine=i}var o=r.prototype;return o.parse=function(t){for(var e={},n={},a=[],s=t.entities,l=Xv(s),c;!(c=l()).done;){var u=c.value;n[u.id]=u,a.push(ep.parseEntity(u,this._engine))}return Promise.all(a).then(function(h){var f=s[0].id;return h.forEach(function(d,_){e[s[_].id]=d}),r.parseChildren(n,e,f),e[f]})},r.parseChildren=function(t,e,n){var a=t[n].children;if(a&&a.length>0)for(var s=e[n],l=0;l<a.length;l++){var c=a[l],u=e[c];s.addChild(u),this.parseChildren(t,e,c)}},r}(),ww=function(){function r(){}return r.parse=function(i,t){for(var e=new Zr(i),n={},a={},s=[],l=t.entities,c=Xv(l),u;!(u=c()).done;){var h=u.value;a[h.id]=h,s.push(ep.parseEntity(h,i))}return Promise.all(s).then(function(f){var d=[];f.forEach(function(x,w){n[l[w].id]=x,l[w].parent||d.push(l[w].id)});for(var _=0,p=d;_<p.length;_++){var v=p[_];xw.parseChildren(a,n,v)}for(var g=d.map(function(x){return n[x]}),m=0;m<g.length;m++)e.addRootEntity(g[m]);return e})},r}(),Fd,Bd;Fd=mt("Mesh",["prefab"],!0),Fd(Bd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,{type:"arraybuffer"}).then(function(c){ql(c,n.engine).then(function(u){s(u)})})})},o}(rt));var Id,zd;Id=mt("EditorTexture2D",["prefab"],!0),Id(zd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s){a.request(e.url,{type:"arraybuffer"}).then(function(l){ql(l,n.engine).then(function(c){s(c)})})})},o}(rt));function ql(r,o){var i=mw.decode(r),t=new Jv(r,i.headerLength,i.dataLength);return Kv[i.type].decode(o,t).then(function(e){return e.name=i.name,e})}var Dd,Ld;Dd=mt(tt.Mesh,["mesh"]),Dd(Ld=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s){a.request(e.url,et(et({},e),{},{type:"arraybuffer"})).then(function(l){return ql(l,n.engine)}).then(function(l){s(l)})})},o}(rt));var Od,Nd;Od=mt(tt.AnimatorController,["json"],!1),Od(Nd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this;return new st(function(s,l){a.request(e.url,et(et({},e),{},{type:"json"})).then(function(){var c=Bf(xa().mark(function u(h){var f,d,_;return xa().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:f=new cs,d=h.layers,_=[],d.forEach(function(g,m){var x=g.name,w=g.blendingMode,C=g.weight,T=g.stateMachine,b=new us(x);if(b.blendingMode=w,b.weight=C,T){var M=T.states,I=b.stateMachine=new hs;M.forEach(function(E,B){var S=E.name,A=E.speed,R=E.wrapMode,D=E.clipStartNormalizedTime,z=E.clipEndNormalizedTime;E.isDefaultState;var U=E.clip,V=I.addState(S);V.speed=A,V.wrapMode=R,V.clipStartTime=D,V.clipEndTime=z,U&&_.push(new Promise(function(){var L=Bf(xa().mark(function J(oe){return xa().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.t0=oe,te.t1=m,te.t2=B,te.next=5,n.getResourceByRef(U);case 5:te.t3=te.sent,te.t4={layerIndex:te.t1,stateIndex:te.t2,clip:te.t3},(0,te.t0)(te.t4);case 8:case"end":return te.stop()}},J)}));return function(J){return L.apply(this,arguments)}}()))}),M.forEach(function(E){var B=E.name,S=E.transitions;S.forEach(function(A){var R=A.targetStateName,D=A.duration,z=A.offset,U=A.exitTime,V=I.findStateByName(B),L=I.findStateByName(R),J=new Hl;J.destinationState=L,J.duration=D,J.exitTime=U,J.offset=z,V.addTransition(J)})})}f.addLayer(b)}),Promise.all(_).then(function(g){g.forEach(function(m){var x=m.layerIndex,w=m.stateIndex,C=m.clip;f.layers[x].stateMachine.states[w].clip=C}),s(f)});case 5:case"end":return v.stop()}},u)}));return function(u){return c.apply(this,arguments)}}())})},o}(rt));var Ud,Vd;Ud=mt(tt.Scene,["prefab"],!0),Ud(Vd=function(r){Le(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;return i.load=function(e,n){var a=this,s=n.engine;return new st(function(l,c){return a.request(e.url,{type:"json"}).then(function(u){return s.resourceManager.initVirtualResources(u.files),ww.parse(s,u).then(function(h){var f=u.scene.ambient,d=Promise.resolve();f.ambientLight&&(d=n.getResourceByRef(u.scene.ambient.ambientLight).then(function(v){h.ambientLight=v,h.ambientLight.diffuseIntensity=f.diffuseIntensity,h.ambientLight.specularIntensity=f.specularIntensity}));var _=u.scene.background;h.background.mode=_.mode;var p=Promise.resolve();switch(h.background.mode){case hn.SolidColor:h.background.solidColor.copyFrom(_.color);break;case hn.Sky:_.sky&&(p=n.getResourceByRef(_.sky).then(function(v){var g=h.background.sky,m=new Vv(s);m.textureCubeMap=v.specularTexture,m.textureDecodeRGBM=!0,g.material=m,g.mesh=Cv.createCuboid(s,1,1,1)}));break;case hn.Texture:_.texture&&(p=n.getResourceByRef(_.texture).then(function(v){h.background.texture=v}));break}Promise.all([d,p]).then(function(){l(h)})})})})},o}(rt));var bw="0.8.2";console.log("oasis engine version: "+bw);for(var kd in Af)rt.registerClass(kd,Af[kd]);class Sw{constructor(o,i){re(this,"windowWidth",window.screen.width);re(this,"windowHeight",window.screen.height);re(this,"eleW",0);re(this,"eleH",0);re(this,"ele",null);re(this,"circleEle",null);re(this,"eleT",0);re(this,"eleL",0);re(this,"pointStart",new Z);re(this,"baseVector",new Z);re(this,"originVec",new Z);this.circleEle=i,this.ele=o,this.init()}init(){this.eleW=this.ele.offsetWidth,this.eleH=this.ele.offsetHeight,this.eleT=this.ele.offsetTop,this.eleL=this.ele.offsetLeft,this.baseVector.set(this.eleL,this.eleT),this.originVec.set(this.eleW/2,this.eleH/2)}touchStart(o){let i=new Z(o.x,o.y).subtract(this.baseVector.clone());return this.pointStart.set(i.x,i.y),{x:i.x,y:i.y}}touchMove(o){let i=new Z(o.x,o.y).subtract(this.baseVector.clone()),t=i.clone().subtract(this.pointStart.clone()).length(),e=i.subtract(this.originVec).normalize(),n=this.eleW/2,a=Math.atan2(e.x,e.y);if(t>n){let{x:s,y:l}=new Z(e.x*n,e.y*n).add(this.originVec),c=new Z(s,l).subtract(this.originVec).normalize();return{x:s,y:l,normal:c,deg:a}}else{let{x:s,y:l}=new Z(e.x*t,e.y*t).add(this.originVec);return{x:s,y:l,normal:e,deg:a}}}touchEnd(o){console.log(o)}}const Cw=["onTouchstart","onTouchmove","onTouchend"],Aw=Qt({__name:"JoyStick",emits:["dir","start","end"],setup(r,{emit:o}){let i=null,t=Un({x:50,y:50});Si(()=>{i=new Sw(document.querySelector(".circle"),document.querySelector(".circle_inner"))});const e=s=>{let l=s.touches[0].pageX|0,c=s.touches[0].pageY|0;if(i){let{x:u,y:h}=i.touchStart({x:l,y:c});t.x=u,t.y=h}o("start")},n=s=>{let l=s.touches[0].pageX|0,c=s.touches[0].pageY|0;if(i){let{x:u,y:h,normal:f,deg:d}=i.touchMove({x:l,y:c});t.x=u,t.y=h,o("dir",{dir:f,deg:d})}},a=s=>{t.x=50,t.y=50,o("dir",{dir:new Z(0,0),deg:0}),o("end")};return(s,l)=>(Yi(),Qi("div",{class:"circle",onTouchstart:ws(e,["self"]),onTouchmove:ws(n,["self"]),onTouchend:ws(a,["self"])},[fr("div",{class:"circle_inner",style:Xa({left:qi(t).x+"px",top:qi(t).y+"px"})},null,4)],40,Cw))}}),Pw=Ko(Aw,[["__scopeId","data-v-f96cb418"]]);var Rn;(function(r){r[r.Auto=0]="Auto",r[r.WebAssembly=1]="WebAssembly",r[r.JavaScript=2]="JavaScript"})(Rn||(Rn={}));function wn(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,il(r,o)}function il(r,o){return il=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},il(r,o)}var tp=function(){function r(i){i===void 0&&(i=0),this._elements=void 0,this.length=0,this._elements=new Array(i)}var o=r.prototype;return o.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},o.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},o.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},o.deleteByIndex=function(t){var e=this._elements,n=null,a=this.length-1;return t!==a&&(n=e[a],e[t]=n),this.length--,n},o.garbageCollection=function(){this._elements.length=this.length},r}(),oi;(function(r){r[r.SIMULATION_SHAPE=1]="SIMULATION_SHAPE",r[r.SCENE_QUERY_SHAPE=2]="SCENE_QUERY_SHAPE",r[r.TRIGGER_SHAPE=4]="TRIGGER_SHAPE"})(oi||(oi={}));var dr=function(){function r(){this._controllers=new tp,this._position=new y,this._rotation=new Me,this._scale=new y(1,1,1),this._shapeFlags=oi.SCENE_QUERY_SHAPE|oi.SIMULATION_SHAPE,this._pxMaterials=new Array(1),this._pxShape=void 0,this._pxGeometry=void 0,this._id=void 0,this._contactOffset=0}var o=r.prototype;return o.setPosition=function(t){t!==this._position&&this._position.copyFrom(t),this._setLocalPose()},o.setContactOffset=function(t){this._contactOffset=t,this._pxShape.setContactOffset(t);for(var e=this._controllers,n=0,a=e.length;n<a;n++)e.get(n)._pxController.setContactOffset(t)},o.setMaterial=function(t){this._pxMaterials[0]=t._pxMaterial,this._pxShape.setMaterials(this._pxMaterials)},o.setIsTrigger=function(t){this._modifyFlag(oi.SIMULATION_SHAPE,!t),this._modifyFlag(oi.TRIGGER_SHAPE,t),this._setShapeFlags(this._shapeFlags)},o.setIsSceneQuery=function(t){this._modifyFlag(oi.SCENE_QUERY_SHAPE,t),this._setShapeFlags(this._shapeFlags)},o.destroy=function(){this._pxShape.release()},o._setShapeFlags=function(t){this._shapeFlags=t,this._pxShape.setFlags(new ke._physX.PxShapeFlags(this._shapeFlags))},o._setLocalPose=function(){var t=r.transform;y.multiply(this._position,this._scale,t.translation),t.rotation=this._rotation,this._pxShape.setLocalPose(t)},o._initialize=function(t,e){this._id=e,this._pxMaterials[0]=t._pxMaterial,this._pxShape=ke._pxPhysics.createShape(this._pxGeometry,t._pxMaterial,!0,new ke._physX.PxShapeFlags(this._shapeFlags)),this._pxShape.setQueryFilterData(new ke._physX.PxFilterData(e,0,0,0))},o._modifyFlag=function(t,e){this._shapeFlags=e?this._shapeFlags|t:this._shapeFlags&~t},r}();dr.halfSqrt=.70710678118655;dr.transform={translation:new y,rotation:null};var Yl=function(r){wn(o,r);function o(t,e,n){var a;return a=r.call(this)||this,a._halfSize=new y,a._halfSize.set(e.x*.5,e.y*.5,e.z*.5),a._pxGeometry=new ke._physX.PxBoxGeometry(a._halfSize.x*a._scale.x,a._halfSize.y*a._scale.y,a._halfSize.z*a._scale.z),a._initialize(n,t),a._setLocalPose(),a}var i=o.prototype;return i.setSize=function(e){this._halfSize.set(e.x*.5,e.y*.5,e.z*.5),y.multiply(this._halfSize,this._scale,o._tempHalfExtents),this._pxGeometry.halfExtents=o._tempHalfExtents,this._pxShape.setGeometry(this._pxGeometry);for(var n=this._controllers,a=0,s=n.length;a<s;a++){var l=n.get(a)._pxController;l.setHalfHeight(this._halfSize.x),l.setHalfSideExtent(this._halfSize.y),l.setHalfForwardExtent(this._halfSize.z)}},i.setWorldScale=function(e){this._scale.copyFrom(e),this._setLocalPose(),y.multiply(this._halfSize,this._scale,o._tempHalfExtents),this._pxGeometry.halfExtents=o._tempHalfExtents,this._pxShape.setGeometry(this._pxGeometry)},o}(dr);Yl._tempHalfExtents=new y;var rp=function(r){wn(o,r);function o(t,e,n,a){var s;return s=r.call(this)||this,s._radius=void 0,s._halfHeight=void 0,s._upAxis=Nt.Y,s._radius=e,s._halfHeight=n*.5,s._pxGeometry=new ke._physX.PxCapsuleGeometry(s._radius,s._halfHeight),s._initialize(a,t),s._setLocalPose(),s}var i=o.prototype;return i.setRadius=function(e){switch(this._radius=e,this._upAxis){case Nt.X:this._pxGeometry.radius=this._radius*Math.max(this._scale.y,this._scale.z);break;case Nt.Y:this._pxGeometry.radius=this._radius*Math.max(this._scale.x,this._scale.z);break;case Nt.Z:this._pxGeometry.radius=this._radius*Math.max(this._scale.x,this._scale.y);break}this._pxShape.setGeometry(this._pxGeometry);for(var n=this._controllers,a=0,s=n.length;a<s;a++)n.get(a)._pxController.setRadius(e)},i.setHeight=function(e){switch(this._halfHeight=e*.5,this._upAxis){case Nt.X:this._pxGeometry.halfHeight=this._halfHeight*this._scale.x;break;case Nt.Y:this._pxGeometry.halfHeight=this._halfHeight*this._scale.y;break;case Nt.Z:this._pxGeometry.halfHeight=this._halfHeight*this._scale.z;break}this._pxShape.setGeometry(this._pxGeometry);for(var n=this._controllers,a=0,s=n.length;a<s;a++)n.get(a)._pxController.setHeight(e)},i.setUpAxis=function(e){switch(this._upAxis=e,this._upAxis){case Nt.X:this._rotation.set(0,0,0,1);break;case Nt.Y:this._rotation.set(0,0,dr.halfSqrt,dr.halfSqrt);break;case Nt.Z:this._rotation.set(0,dr.halfSqrt,0,dr.halfSqrt);break}this._setLocalPose()},i.setWorldScale=function(e){switch(this._scale.copyFrom(e),this._setLocalPose(),this._upAxis){case Nt.X:this._pxGeometry.radius=this._radius*Math.max(e.y,e.z),this._pxGeometry.halfHeight=this._halfHeight*e.x;break;case Nt.Y:this._pxGeometry.radius=this._radius*Math.max(e.x,e.z),this._pxGeometry.halfHeight=this._halfHeight*e.y;break;case Nt.Z:this._pxGeometry.radius=this._radius*Math.max(e.x,e.y),this._pxGeometry.halfHeight=this._halfHeight*e.z;break}this._pxShape.setGeometry(this._pxGeometry)},o}(dr),Nt;(function(r){r[r.X=0]="X",r[r.Y=1]="Y",r[r.Z=2]="Z"})(Nt||(Nt={}));var Tw=function(){function r(){this._id=void 0,this._pxController=void 0,this._pxManager=void 0,this._shape=void 0}var o=r.prototype;return o.move=function(t,e,n){return this._pxController.move(t,e,n)},o.setWorldPosition=function(t){this._pxController&&this._pxController.setPosition(t)},o.getWorldPosition=function(t){t.copyFrom(this._pxController.getPosition())},o.setStepOffset=function(t){this._pxController.setStepOffset(t)},o.setNonWalkableMode=function(t){this._pxController.setNonWalkableMode(t)},o.setUpDirection=function(t){this._pxController.setUpDirection(t)},o.setSlopeLimit=function(t){this._pxController.setSlopeLimit(t)},o.addShape=function(t){this._pxManager&&this._createPXController(this._pxManager,t),this._shape=t,t._controllers.add(this)},o.removeShape=function(t){this._destroyPXController(),this._shape=null,t._controllers.delete(this)},o.destroy=function(){this._destroyPXController()},o._createPXController=function(t,e){var n;if(e instanceof Yl)n=new ke._physX.PxBoxControllerDesc,n.halfHeight=e._halfSize.x,n.halfSideExtent=e._halfSize.y,n.halfForwardExtent=e._halfSize.z;else if(e instanceof rp)n=new ke._physX.PxCapsuleControllerDesc,n.radius=e._radius,n.height=e._halfHeight*2,n.climbingMode=1;else throw"unsupported shape type";n.setMaterial(e._pxMaterials[0]),this._pxController=t._getControllerManager().createController(n),this._pxController.setQueryFilterData(new ke._physX.PxFilterData(e._id,0,0,0))},o._destroyPXController=function(){this._pxController&&(this._pxController.release(),this._pxController=null)},r}(),Ql=function(){function r(){this._pxActor=void 0}var o=r.prototype;return o.addShape=function(t){this._pxActor.attachShape(t._pxShape)},o.removeShape=function(t){this._pxActor.detachShape(t._pxShape,!0)},o.setWorldTransform=function(t,e){this._pxActor.setGlobalPose(this._transform(t,e),!0)},o.getWorldTransform=function(t,e){var n=this._pxActor.getGlobalPose();t.set(n.translation.x,n.translation.y,n.translation.z),e.set(n.rotation.x,n.rotation.y,n.rotation.z,n.rotation.w)},o.destroy=function(){this._pxActor.release()},o._transform=function(t,e){var n=r._tempTransform;return n.translation=t,n.rotation=e.normalize(),n},r}();Ql._tempTransform={translation:null,rotation:null};var Di;(function(r){r[r.Discrete=0]="Discrete",r[r.Continuous=1]="Continuous",r[r.ContinuousDynamic=2]="ContinuousDynamic",r[r.ContinuousSpeculative=3]="ContinuousSpeculative"})(Di||(Di={}));var Jl=function(r){wn(o,r);function o(t,e){var n;n=r.call(this)||this;var a=n._transform(t,e);return n._pxActor=ke._pxPhysics.createRigidDynamic(a),n}var i=o.prototype;return i.setLinearDamping=function(e){this._pxActor.setLinearDamping(e)},i.setAngularDamping=function(e){this._pxActor.setAngularDamping(e)},i.setLinearVelocity=function(e){this._pxActor.setLinearVelocity(e,!0)},i.setAngularVelocity=function(e){this._pxActor.setAngularVelocity(e,!0)},i.setMass=function(e){this._pxActor.setMass(e)},i.setCenterOfMass=function(e){this._pxActor.setCMassLocalPose(e)},i.setInertiaTensor=function(e){this._pxActor.setMassSpaceInertiaTensor(e)},i.setMaxAngularVelocity=function(e){this._pxActor.setMaxAngularVelocity(e)},i.setMaxDepenetrationVelocity=function(e){this._pxActor.setMaxDepenetrationVelocity(e)},i.setSleepThreshold=function(e){this._pxActor.setSleepThreshold(e)},i.setSolverIterations=function(e){this._pxActor.setSolverIterationCounts(e,1)},i.setCollisionDetectionMode=function(e){switch(e){case Di.Continuous:this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eENABLE_CCD,!0);break;case Di.ContinuousDynamic:this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!0);break;case Di.ContinuousSpeculative:this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!0);break;case Di.Discrete:this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eENABLE_CCD,!1),this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!1),this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!1);break}},i.setIsKinematic=function(e){e?this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eKINEMATIC,!0):this._pxActor.setRigidBodyFlag(ke._physX.PxRigidBodyFlag.eKINEMATIC,!1)},i.setConstraints=function(e){this._pxActor.setRigidDynamicLockFlags(e)},i.addForce=function(e){this._pxActor.addForce({x:e.x,y:e.y,z:e.z})},i.addTorque=function(e){this._pxActor.addTorque({x:e.x,y:e.y,z:e.z})},i.move=function(e,n){if(n){this._pxActor.setKinematicTarget(e,n);return}var a=o._tempTranslation,s=o._tempRotation;this.getWorldTransform(a,s),e instanceof y?this._pxActor.setKinematicTarget(e,s):this._pxActor.setKinematicTarget(a,e)},i.sleep=function(){return this._pxActor.putToSleep()},i.wakeUp=function(){return this._pxActor.wakeUp()},o}(Ql);Jl._tempTranslation=new y;Jl._tempRotation=new Me;var ia=function(){r._init=function(){r._pxRaycastHit=new ke._physX.PxRaycastHit,r._pxFilterData=new ke._physX.PxQueryFilterData,r._pxFilterData.flags=new ke._physX.PxQueryFlags(Oo.STATIC|Oo.DYNAMIC)};function r(i,t,e,n,a,s){var l=this;this._pxControllerManager=null,this._pxScene=void 0,this._onContactEnter=void 0,this._onContactExit=void 0,this._onContactStay=void 0,this._onTriggerEnter=void 0,this._onTriggerExit=void 0,this._onTriggerStay=void 0,this._currentEvents=new tp,this._eventMap={},this._eventPool=[],this._onContactEnter=i,this._onContactExit=t,this._onContactStay=e,this._onTriggerEnter=n,this._onTriggerExit=a,this._onTriggerStay=s;var c={onContactBegin:function(d,_){var p=d.getQueryFilterData().word0,v=_.getQueryFilterData().word0;l._onContactEnter(p,v)},onContactEnd:function(d,_){var p=d.getQueryFilterData().word0,v=_.getQueryFilterData().word0;l._onContactExit(p,v)},onContactPersist:function(d,_){var p=d.getQueryFilterData().word0,v=_.getQueryFilterData().word0;l._onContactStay(p,v)},onTriggerBegin:function(d,_){var p=d.getQueryFilterData().word0,v=_.getQueryFilterData().word0,g=p<v?l._getTrigger(p,v):l._getTrigger(v,p);g.state=Fn.Enter,l._currentEvents.add(g)},onTriggerEnd:function(d,_){var p=d.getQueryFilterData().word0,v=_.getQueryFilterData().word0,g;if(p<v){var m=l._eventMap[p];g=m[v],m[v]=void 0}else{var x=l._eventMap[v];g=x[p],x[p]=void 0}g.state=Fn.Exit}},u=ke._physX.PxSimulationEventCallback.implement(c),h=ke._physX.getDefaultSceneDesc(ke._pxPhysics.getTolerancesScale(),0,u);this._pxScene=ke._pxPhysics.createScene(h)}var o=r.prototype;return o.setGravity=function(t){this._pxScene.setGravity(t)},o.addColliderShape=function(t){this._eventMap[t._id]={}},o.removeColliderShape=function(t){for(var e=this._eventPool,n=this._currentEvents,a=t._id,s=n.length-1;s>=0;s--){var l=n.get(s);(l.index1==a||l.index2==a)&&(n.deleteByIndex(s),e.push(l))}delete this._eventMap[a]},o.addCollider=function(t){this._pxScene.addActor(t._pxActor,null)},o.removeCollider=function(t){this._pxScene.removeActor(t._pxActor,!0)},o.addCharacterController=function(t){var e=t._pxManager,n=t._shape;n&&(e!==this&&(e&&t._destroyPXController(),t._createPXController(this,n)),this._pxScene.addController(t._pxController)),t._pxManager=this},o.removeCharacterController=function(t){t._shape&&this._pxScene.removeController(t._pxController),t._pxManager=null},o.update=function(t){this._simulate(t),this._fetchResults(),this._fireEvent()},o.raycast=function(t,e,n){var a=r._pxRaycastHit;e=Math.min(e,34e37);var s=this._pxScene.raycastSingle(t.origin,t.direction,e,a,r._pxFilterData);if(s&&n!=null){var l=r._tempPosition,c=r._tempNormal,u=a.position,h=a.normal;l.set(u.x,u.y,u.z),c.set(h.x,h.y,h.z),n(a.getShape().getQueryFilterData().word0,a.distance,l,c)}return s},o._getControllerManager=function(){var t=this._pxControllerManager;return t===null&&(this._pxControllerManager=t=this._pxScene.createControllerManager()),t},o._simulate=function(t){this._pxScene.simulate(t,!0)},o._fetchResults=function(t){t===void 0&&(t=!0),this._pxScene.fetchResults(t)},o._getTrigger=function(t,e){var n;return this._eventPool.length?(n=this._eventPool.pop(),n.index1=t,n.index2=e):n=new Mw(t,e),this._eventMap[t][e]=n,n},o._fireEvent=function(){for(var t=this._eventPool,e=this._currentEvents,n=e.length-1;n>=0;n--){var a=e.get(n);a.state==Fn.Enter?(this._onTriggerEnter(a.index1,a.index2),a.state=Fn.Stay):a.state==Fn.Stay?this._onTriggerStay(a.index1,a.index2):a.state==Fn.Exit&&(this._onTriggerExit(a.index1,a.index2),e.deleteByIndex(n),t.push(a))}},r}();ia._tempPosition=new y;ia._tempNormal=new y;ia._pxRaycastHit=void 0;ia._pxFilterData=void 0;var Oo;(function(r){r[r.STATIC=1]="STATIC",r[r.DYNAMIC=2]="DYNAMIC",r[r.ANY_HIT=16]="ANY_HIT",r[r.NO_BLOCK=32]="NO_BLOCK"})(Oo||(Oo={}));var Fn;(function(r){r[r.Enter=0]="Enter",r[r.Stay=1]="Stay",r[r.Exit=2]="Exit"})(Fn||(Fn={}));var Mw=function(o,i){this.state=void 0,this.index1=void 0,this.index2=void 0,this.index1=o,this.index2=i},Ew=function(){function r(i,t,e,n,a){this._pxMaterial=void 0;var s=ke._pxPhysics.createMaterial(i,t,e);s.setFrictionCombineMode(n),s.setRestitutionCombineMode(a),this._pxMaterial=s}var o=r.prototype;return o.setBounciness=function(t){this._pxMaterial.setRestitution(t)},o.setDynamicFriction=function(t){this._pxMaterial.setDynamicFriction(t)},o.setStaticFriction=function(t){this._pxMaterial.setStaticFriction(t)},o.setBounceCombine=function(t){this._pxMaterial.setRestitutionCombineMode(t)},o.setFrictionCombine=function(t){this._pxMaterial.setFrictionCombineMode(t)},o.destroy=function(){this._pxMaterial.release()},r}(),Gd;(function(r){r[r.Average=0]="Average",r[r.Minimum=1]="Minimum",r[r.Multiply=2]="Multiply",r[r.Maximum=3]="Maximum"})(Gd||(Gd={}));var Rw=function(r){wn(o,r);function o(i,t){var e;return e=r.call(this)||this,e._pxActor=ke._pxPhysics.createRigidStatic(e._transform(i,t)),e}return o}(Ql),Fw=function(r){wn(o,r);function o(t,e){var n;return n=r.call(this)||this,n._rotation.set(0,0,dr.halfSqrt,dr.halfSqrt),n._pxGeometry=new ke._physX.PxPlaneGeometry,n._initialize(e,t),n._setLocalPose(),n}var i=o.prototype;return i.setRotation=function(e){Me.rotationYawPitchRoll(e.x,e.y,e.z,this._rotation),Me.rotateZ(this._rotation,Math.PI*.5,this._rotation),this._rotation.normalize(),this._setLocalPose()},i.setWorldScale=function(e){this._scale.copyFrom(e),this._setLocalPose()},o}(dr),Bw=function(r){wn(o,r);function o(t,e,n){var a;return a=r.call(this)||this,a._radius=void 0,a._maxScale=1,a._radius=e,a._pxGeometry=new ke._physX.PxSphereGeometry(a._radius*a._maxScale),a._initialize(n,t),a._setLocalPose(),a}var i=o.prototype;return i.setRadius=function(e){this._radius=e,this._pxGeometry.radius=e*this._maxScale,this._pxShape.setGeometry(this._pxGeometry)},i.setWorldScale=function(e){this._scale.copyFrom(e),this._setLocalPose(),this._maxScale=Math.max(e.x,Math.max(e.x,e.y)),this._pxGeometry.radius=this._radius*this._maxScale,this._pxShape.setGeometry(this._pxGeometry)},o}(dr),ct=function(){function r(){this._pxJoint=void 0,this._collider=void 0,this._connectedAnchor=new y,this._breakForce=Number.MAX_VALUE,this._breakTorque=Number.MAX_VALUE}var o=r.prototype;return o.setConnectedCollider=function(t){var e;this._pxJoint.setActors((t==null?void 0:t._pxActor)||null,((e=this._collider)===null||e===void 0?void 0:e._pxActor)||null)},o.setConnectedAnchor=function(t){this._connectedAnchor.copyFrom(t),this._setLocalPose(0,t,r._defaultQuat)},o.setConnectedMassScale=function(t){this._pxJoint.setInvMassScale0(1/t)},o.setConnectedInertiaScale=function(t){this._pxJoint.setInvInertiaScale0(1/t)},o.setMassScale=function(t){this._pxJoint.setInvMassScale1(1/t)},o.setInertiaScale=function(t){this._pxJoint.setInvInertiaScale1(1/t)},o.setBreakForce=function(t){this._breakForce=t,this._pxJoint.setBreakForce(this._breakForce,this._breakTorque)},o.setBreakTorque=function(t){this._breakTorque=t,this._pxJoint.setBreakForce(this._breakForce,this._breakTorque)},o._setLocalPose=function(t,e,n){this._pxJoint.setLocalPose(t,e,n)},r}();ct._xAxis=new y(1,0,0);ct._defaultVec=new y;ct._defaultQuat=new Me;var Iw=function(r){wn(o,r);function o(i){var t;return t=r.call(this)||this,t._collider=i,t._pxJoint=ke._pxPhysics.createFixedJoint(null,ct._defaultVec,ct._defaultQuat,i._pxActor,ct._defaultVec,ct._defaultQuat),t}return o}(ct),zw=function(r){wn(o,r);function o(t){var e;return e=r.call(this)||this,e._axisRotationQuaternion=new Me,e._swingOffset=new y,e._velocity=new y,e._collider=t,e._pxJoint=ke._pxPhysics.createRevoluteJoint(null,ct._defaultVec,ct._defaultQuat,t._pxActor,ct._defaultVec,ct._defaultQuat),e}var i=o.prototype;return i.setAxis=function(e){var n=ct._xAxis,a=this._axisRotationQuaternion;n.set(1,0,0),e.normalize();var s=Math.acos(y.dot(n,e));y.cross(n,e,n),Me.rotationAxisAngle(n,s,a),this._setLocalPose(0,this._swingOffset,a)},i.setSwingOffset=function(e){this._swingOffset.copyFrom(e),this._setLocalPose(1,this._swingOffset,this._axisRotationQuaternion)},i.getAngle=function(){return this._pxJoint.getAngle()},i.getVelocity=function(){var e=this._velocity;return e.copyFrom(this._pxJoint.getVelocity()),e},i.setHardLimit=function(e,n,a){this._pxJoint.setHardLimit(e,n,a)},i.setSoftLimit=function(e,n,a,s){this._pxJoint.setSoftLimit(e,n,a,s)},i.setDriveVelocity=function(e){this._pxJoint.setDriveVelocity(e)},i.setDriveForceLimit=function(e){this._pxJoint.setDriveForceLimit(e)},i.setDriveGearRatio=function(e){this._pxJoint.setDriveGearRatio(e)},i.setHingeJointFlag=function(e,n){this._pxJoint.setRevoluteJointFlag(e,n)},o}(ct),Dw=function(r){wn(o,r);function o(t){var e;return e=r.call(this)||this,e._swingOffset=new y,e._collider=t,e._pxJoint=ke._pxPhysics.createDistanceJoint(null,ct._defaultVec,ct._defaultQuat,t._pxActor,ct._defaultVec,ct._defaultQuat),e._pxJoint.setDistanceJointFlag(1,!0),e._pxJoint.setDistanceJointFlag(2,!0),e._pxJoint.setDistanceJointFlag(4,!0),e}var i=o.prototype;return i.setSwingOffset=function(e){this._swingOffset.copyFrom(e),this._setLocalPose(1,e,ct._defaultQuat)},i.setMinDistance=function(e){this._pxJoint.setMinDistance(e)},i.setMaxDistance=function(e){this._pxJoint.setMaxDistance(e)},i.setTolerance=function(e){this._pxJoint.setTolerance(e)},i.setStiffness=function(e){this._pxJoint.setStiffness(e)},i.setDamping=function(e){this._pxJoint.setDamping(e)},o}(ct);function Lw(){return function(r){}}var Hd,Wd,pa,ke=(Hd=Lw(),Hd(Wd=(pa=function(){function r(){}return r.initialize=function(i){i===void 0&&(i=Rn.Auto);var t=new Promise(function(e){var n=document.createElement("script");document.body.appendChild(n),n.async=!0,n.onload=e;var a=function(){try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){var s=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(s instanceof WebAssembly.Module)return new WebAssembly.Instance(s)instanceof WebAssembly.Instance}}catch{}return!1}();i==Rn.Auto&&(a?i=Rn.WebAssembly:i=Rn.JavaScript),i==Rn.JavaScript?n.src="https://gw.alipayobjects.com/os/lib/oasis-engine/physics-physx/0.8.0-beta.10/libs/physx.release.js.js":i==Rn.WebAssembly&&(n.src="https://gw.alipayobjects.com/os/lib/oasis-engine/physics-physx/0.8.0-beta.10/libs/physx.release.js")});return new Promise(function(e){t.then(function(){window.PHYSX().then(function(n){r._init(n),ia._init(),console.log("PhysX loaded."),e()})})})},r.destroy=function(){this._pxFoundation.release(),this._pxPhysics.release()},r.createPhysicsManager=function(i,t,e,n,a,s){return new ia(i,t,e,n,a,s)},r.createStaticCollider=function(i,t){return new Rw(i,t)},r.createDynamicCollider=function(i,t){return new Jl(i,t)},r.createCharacterController=function(){return new Tw},r.createPhysicsMaterial=function(i,t,e,n,a){return new Ew(i,t,e,n,a)},r.createBoxColliderShape=function(i,t,e){return new Yl(i,t,e)},r.createSphereColliderShape=function(i,t,e){return new Bw(i,t,e)},r.createPlaneColliderShape=function(i,t){return new Fw(i,t)},r.createCapsuleColliderShape=function(i,t,e,n){return new rp(i,t,e,n)},r.createFixedJoint=function(i){return new Iw(i)},r.createHingeJoint=function(i){return new zw(i)},r.createSpringJoint=function(i){return new Dw(i)},r._init=function(i){r._physX=i;var t=r._physX.PX_PHYSICS_VERSION,e=new r._physX.PxDefaultErrorCallback,n=new r._physX.PxDefaultAllocator;r._pxFoundation=r._physX.PxCreateFoundation(t,n,e),this._pxPhysics=r._physX.PxCreatePhysics(t,r._pxFoundation,new r._physX.PxTolerancesScale,!1,null),r._physX.PxInitExtensions(this._pxPhysics,null)},r}(),pa._physX=void 0,pa._pxFoundation=void 0,pa._pxPhysics=void 0,pa))||Wd);function Xd(r,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Ow(r,o,i){return o&&Xd(r.prototype,o),i&&Xd(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function Nw(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,al(r,o)}function al(r,o){return al=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},al(r,o)}var Zt=function(){function r(){}return r.createCuboidWireframe=function(i,t,e,n,a,s,l){var c=i/2,u=t/2,h=e/2;n.push(new y(-c,u,-h)),n.push(new y(c,u,-h)),n.push(new y(c,u,h)),n.push(new y(-c,u,h)),n.push(new y(-c,-u,-h)),n.push(new y(c,-u,-h)),n.push(new y(c,-u,h)),n.push(new y(-c,-u,h)),n.push(new y(-c,u,-h)),n.push(new y(-c,u,h)),n.push(new y(-c,-u,h)),n.push(new y(-c,-u,-h)),n.push(new y(c,u,-h)),n.push(new y(c,u,h)),n.push(new y(c,-u,h)),n.push(new y(c,-u,-h)),n.push(new y(-c,u,h)),n.push(new y(c,u,h)),n.push(new y(c,-u,h)),n.push(new y(-c,-u,h)),n.push(new y(-c,u,-h)),n.push(new y(c,u,-h)),n.push(new y(c,-u,-h)),n.push(new y(-c,-u,-h)),s[l++]=a,s[l++]=a+1,s[l++]=a+1,s[l++]=a+2,s[l++]=a+2,s[l++]=a+3,s[l++]=a+3,s[l++]=a,s[l++]=a+4,s[l++]=a+5,s[l++]=a+5,s[l++]=a+6,s[l++]=a+6,s[l++]=a+7,s[l++]=a+7,s[l++]=a+4,s[l++]=a+8,s[l++]=a+9,s[l++]=a+9,s[l++]=a+10,s[l++]=a+10,s[l++]=a+11,s[l++]=a+11,s[l++]=a+8,s[l++]=a+12,s[l++]=a+13,s[l++]=a+13,s[l++]=a+14,s[l++]=a+14,s[l++]=a+15,s[l++]=a+15,s[l++]=a+12,s[l++]=a+16,s[l++]=a+17,s[l++]=a+17,s[l++]=a+18,s[l++]=a+18,s[l++]=a+19,s[l++]=a+19,s[l++]=a+16,s[l++]=a+20,s[l++]=a+21,s[l++]=a+21,s[l++]=a+22,s[l++]=a+22,s[l++]=a+23,s[l++]=a+23,s[l++]=a+20},r.createSphereWireframe=function(i,t,e,n,a){var s=new y;r.createCircleWireframe(i,0,s,t,e,n,a),r.createCircleWireframe(i,1,s,t,e+r.circleVertexCount,n,a+r.circleIndexCount),r.createCircleWireframe(i,2,s,t,e+r.circleVertexCount*2,n,a+r.circleIndexCount*2)},r.createConeWireframe=function(i,t,e,n,a,s){var l=new y;l.y=-t,r.createCircleWireframe(i,1,l,e,n,a,s),e.push(new y),e.push(new y(-i,-t,0)),e.push(new y(i,-t,0)),e.push(new y(0,-t,i)),e.push(new y(0,-t,-i));var c=n+r.circleVertexCount;s+=r.circleIndexCount,a[s++]=c,a[s++]=c+1,a[s++]=c,a[s++]=c+2,a[s++]=c,a[s++]=c+3,a[s++]=c,a[s++]=c+4},r.createUnboundCylinderWireframe=function(i,t,e,n,a){var s=5,l=new y;r.createCircleWireframe(i,1,l,t,e,n,a);var c=e+r.circleVertexCount;a+=r.circleIndexCount;for(var u=0;u<8;u++){var h=Q.degreeToRadian(45*u);t.push(new y(i*Math.cos(h),0,i*Math.sin(h))),t.push(new y(i*Math.cos(h),-s,i*Math.sin(h))),n[a+u*2]=c+2*u,n[a+u*2+1]=c+2*u+1}},r.createCapsuleWireframe=function(i,t,e,n,a,s){var l=r.circleIndexCount,c=r.circleVertexCount,u=new y,h=t/2;u.y=h,r.createCircleWireframe(i,1,u,e,n,a,s),u.y=-h,r.createCircleWireframe(i,1,u,e,n+c,a,s+l),r.createEllipticWireframe(i,h,2,e,n+c*2,a,s+l*2),r.createEllipticWireframe(i,h,0,e,n+c*3,a,s+l*2+r.ellipticIndexCount)},r.createCircleWireframe=function(i,t,e,n,a,s,l){for(var c=r.circleVertexCount,u=Math.PI*2,h=1/c,f=0;f<c;++f){var d=f*h,_=d*u;switch(t){case 0:n.push(new y(e.x,i*Math.cos(_)+e.y,i*Math.sin(_)+e.z));break;case 1:n.push(new y(i*Math.cos(_)+e.x,e.y,i*Math.sin(_)+e.z));break;case 2:n.push(new y(i*Math.cos(_)+e.x,i*Math.sin(_)+e.y,e.z));break}var p=f+a;f<c-1?(s[l+2*f]=p,s[l+2*f+1]=p+1):(s[l+2*f]=p,s[l+2*f+1]=a)}},r.createEllipticWireframe=function(i,t,e,n,a,s,l){for(var c=r.circleVertexCount,u=Math.PI*2,h=1/c,f=0;f<c;++f){var d=f*h,_=d*u;switch(e){case 0:n.push(new y(0,i*Math.sin(_)+t,i*Math.cos(_)));break;case 1:n.push(new y(i*Math.cos(_),t,i*Math.sin(_)));break;case 2:n.push(new y(i*Math.cos(_),i*Math.sin(_)+t,0));break}f==c/2&&(t=-t);var p=f+a;f<c-1?(s[l+2*f]=p,s[l+2*f+1]=p+1):(s[l+2*f]=p,s[l+2*f+1]=a)}},Ow(r,null,[{key:"cuboidIndexCount",get:function(){return 48}},{key:"sphereIndexCount",get:function(){return r.circleIndexCount*3}},{key:"coneIndexCount",get:function(){return r.circleIndexCount+8}},{key:"unboundCylinderIndexCount",get:function(){return r.circleIndexCount+16}},{key:"capsuleIndexCount",get:function(){return(r.circleIndexCount+r.ellipticIndexCount)*2}},{key:"circleIndexCount",get:function(){return r.circleVertexCount*2}},{key:"ellipticIndexCount",get:function(){return r.circleVertexCount*2}}]),r}();Zt.circleVertexCount=40;var jd,$d,ga,np=(jd=ca(yi),jd($d=(ga=function(r){Nw(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t._cameraPositions=[new y,new y,new y,new y,new y,new y,new y,new y],t._localPositions=[],t._globalPositions=[],t._indices=null,t._indicesCount=0,t._supportUint32Array=void 0,t._wireframeElements=[],t._renderer=void 0,t._material=void 0,t._mesh=void 0,t}o._getPositionFromPool=function(e){var n,a=o._positionPool;return e<a.length?n=a[e]:(n=new y,o._positionPool.push(n)),n};var i=o.prototype;return i.clear=function(){this._wireframeElements.length=0,this._localPositions.length=0,this._globalPositions.length=0,this._indicesCount=0,this._mesh.subMesh.count=0},i.addEntityWireframe=function(e,n){if(n===void 0&&(n=!0),n){var a=new Array;e.getComponentsIncludeChildren(wi,a);for(var s=0,l=a.length;s<l;s++)this.addCameraWireframe(a[s]);var c=a.length;e.getComponentsIncludeChildren(Ht,a);for(var u=c,h=a.length;u<h;u++)this.addSpotLightWireframe(a[u]);c=a.length,e.getComponentsIncludeChildren(Yt,a);for(var f=c,d=a.length;f<d;f++)this.addDirectLightWireframe(a[f]);c=a.length,e.getComponentsIncludeChildren(xr,a);for(var _=c,p=a.length;_<p;_++)this.addPointLightWireframe(a[_]);c=a.length,e.getComponentsIncludeChildren(rn,a);for(var v=c,g=a.length;v<g;v++)this.addCollideWireframe(a[v])}else{var m=e.getComponent(wi);m&&this.addCameraWireframe(m);var x=e.getComponent(Ht);x&&this.addSpotLightWireframe(x);var w=e.getComponent(Yt);w&&this.addDirectLightWireframe(w);var C=e.getComponent(xr);C&&this.addPointLightWireframe(C);var T=e.getComponent(rn);T&&this.addCollideWireframe(T)}},i.addCameraWireframe=function(e){var n=e.entity.transform,a=e.projectionMatrix.clone();a.invert();var s=this._localPositions,l=s.length;this._wireframeElements.push(new Qn(n,l));for(var c=o._ndcPosition,u=0;u<4;u++){var h=this._cameraPositions[u];h.copyFrom(c[u]),h.transformCoordinate(a),s.push(h)}for(var f=0;f<4;f++){var d=this._cameraPositions[f+4];d.copyFrom(c[f]),d.z=1,d.transformCoordinate(a),s.push(d)}this._growthIndexMemory(24);var _=this._indices;_[this._indicesCount++]=l,_[this._indicesCount++]=l+1,_[this._indicesCount++]=l+1,_[this._indicesCount++]=l+2,_[this._indicesCount++]=l+2,_[this._indicesCount++]=l+3,_[this._indicesCount++]=l+3,_[this._indicesCount++]=l,_[this._indicesCount++]=l,_[this._indicesCount++]=l+4,_[this._indicesCount++]=l+1,_[this._indicesCount++]=l+5,_[this._indicesCount++]=l+2,_[this._indicesCount++]=l+6,_[this._indicesCount++]=l+3,_[this._indicesCount++]=l+7,_[this._indicesCount++]=l+4,_[this._indicesCount++]=l+5,_[this._indicesCount++]=l+5,_[this._indicesCount++]=l+6,_[this._indicesCount++]=l+6,_[this._indicesCount++]=l+7,_[this._indicesCount++]=l+7,_[this._indicesCount++]=l+4},i.addSpotLightWireframe=function(e){var n=e.distance,a=Math.tan(e.angle/2)*n,s=this._localPositions,l=s.length,c=Zt.coneIndexCount;this._growthIndexMemory(c);var u=this._indices;Zt.createConeWireframe(a,n,s,l,u,this._indicesCount),this._indicesCount+=c,this._rotateAroundX(l),this._wireframeElements.push(new Qn(e.entity.transform,l))},i.addPointLightWireframe=function(e){var n=this._localPositions,a=n.length,s=Zt.sphereIndexCount;this._growthIndexMemory(s);var l=this._indices;Zt.createSphereWireframe(e.distance,n,a,l,this._indicesCount),this._indicesCount+=s,this._wireframeElements.push(new Qn(e.entity.transform,a))},i.addDirectLightWireframe=function(e){var n=this._localPositions,a=n.length,s=Zt.unboundCylinderIndexCount;this._growthIndexMemory(s);var l=this._indices;Zt.createUnboundCylinderWireframe(1,n,a,l,this._indicesCount),this._indicesCount+=s,this._rotateAroundX(a),this._wireframeElements.push(new Qn(e.entity.transform,a))},i.addCollideWireframe=function(e){for(var n=e.shapes,a=0,s=n.length;a<s;a++){var l=n[a];l instanceof Il?this.addBoxColliderShapeWireframe(l):l instanceof zl?this.addSphereColliderShapeWireframe(l):l instanceof vv&&this.addCapsuleColliderShapeWireframe(l)}},i.addBoxColliderShapeWireframe=function(e){var n=e.collider.entity.transform,a=n.lossyWorldScale,s=e.size,l=this._localPositions,c=l.length,u=Zt.cuboidIndexCount;this._growthIndexMemory(u);var h=this._indices;Zt.createCuboidWireframe(a.x*s.x,a.y*s.y,a.z*s.z,l,c,h,this._indicesCount),this._localTranslate(c,e.position),this._indicesCount+=u,this._wireframeElements.push(new Qn(n,c))},i.addSphereColliderShapeWireframe=function(e){var n=e.collider.entity.transform,a=n.lossyWorldScale,s=e.radius,l=this._localPositions,c=l.length,u=Zt.sphereIndexCount;this._growthIndexMemory(u);var h=this._indices;Zt.createSphereWireframe(Math.max(a.x,a.y,a.z)*s,l,c,h,this._indicesCount),this._localTranslate(c,e.position),this._indicesCount+=u,this._wireframeElements.push(new Qn(n,c))},i.addCapsuleColliderShapeWireframe=function(e){var n=e.collider.entity.transform,a=n.lossyWorldScale,s=Math.max(a.x,a.y,a.z),l=e.radius,c=e.height,u=e.upAxis,h=this._localPositions,f=h.length,d=Zt.capsuleIndexCount;this._growthIndexMemory(d);var _=this._indices;switch(Zt.createCapsuleWireframe(s*l,s*c,h,f,_,this._indicesCount),u){case mi.X:this._rotateAroundZ(f);break;case mi.Z:this._rotateAroundX(f)}this._localTranslate(f,e.position),this._indicesCount+=d,this._wireframeElements.push(new Qn(n,f))},i.onAwake=function(){var e=this.engine,n=new ur(e),a=new ss(e),s=this.entity.getComponent(yi),l=e._hardwareRenderer.canIUse(he.elementIndexUint);n._enableVAO=!1,n.addSubMesh(0,this._indicesCount,kn.Lines),s.mesh=n,s.setMaterial(a),this._mesh=n,this._material=a,this._renderer=s,this._indices=l?new Uint32Array(128):new Uint16Array(128),this._supportUint32Array=l},i.onEnable=function(){this._renderer.enabled=!0},i.onDisable=function(){this._renderer.enabled=!1},i.onUpdate=function(e){var n=this._mesh,a=this._localPositions,s=this._globalPositions,l=this._wireframeElements,c=a.length;s.length=c;for(var u=0,h=!1,f=0,d=l.length;f<d;f++){var _=l[f],p=_.transformRanges,v=f<d-1?l[f+1].transformRanges:c;if(_.updateFlag.flag){var g=_.transform,m=o._tempMatrix;ge.rotationTranslation(g.worldRotationQuaternion,g.worldPosition,m);for(var x=p;x<v;x++){var w=a[u],C=o._getPositionFromPool(u);y.transformCoordinate(w,m,C),s[u]=C,u++}_.updateFlag.flag=!1,h=!0}else u+=v-p}h&&(n.setPositions(s),n.setIndices(this._indices),n.uploadData(!1),n.subMesh.count=this._indicesCount)},i._growthIndexMemory=function(e){var n=this._indices,a=this._indicesCount+e;if(a>n.length){var s=this._supportUint32Array?4294967295:65535;if(a>s)throw Error("The vertex count is over limit.");var l=this._supportUint32Array?new Uint32Array(a):new Uint16Array(a);l.set(n),this._indices=l}},i._localTranslate=function(e,n){for(var a=this._localPositions,s=e;s<a.length;s++){var l=a[s];l.add(n)}},i._rotateAroundX=function(e){for(var n=this._localPositions,a=e;a<n.length;a++){var s=n[a],l=s.y,c=s.z;s.z=l,s.y=-c}},i._rotateAroundZ=function(e){for(var n=this._localPositions,a=e;a<n.length;a++){var s=n[a],l=s.x,c=s.y;s.y=l,s.x=-c}},o}(mn),ga._positionPool=[],ga._ndcPosition=[new y(-1,1,-1),new y(1,1,-1),new y(1,-1,-1),new y(-1,-1,-1)],ga._tempMatrix=new ge,ga))||$d),Qn=function(o,i){this.transform=o,this.transformRanges=i,this.updateFlag=void 0,this.updateFlag=o.registerWorldChangeFlag()};const Uw={class:"mask"},Vw=H_('<div class="wave-progress" data-v-a5e37ed7><div id="num_box" data-v-a5e37ed7><div class="num_box" data-v-a5e37ed7><div id="num" style="font-size:25px;" data-v-a5e37ed7>0</div><div style="font-size:15px;" data-v-a5e37ed7>%</div></div><div style="font-size:12px;line-height:1.1;" data-v-a5e37ed7>\u52A0\u8F7D\u4E2D...</div></div><div class="wave" data-v-a5e37ed7></div><div id="wave-mask" data-v-a5e37ed7></div></div><div class="circle_1" data-v-a5e37ed7><div class="circle_3" data-v-a5e37ed7></div><div class="circle_2" data-v-a5e37ed7></div></div>',2),kw={class:"process_bar",style:{display:"none"}},Gw={class:"process_progrom"},Hw={class:"point_group"},Ww=H_('<div class="point" style="left:27%;top:3%;transform:scale(1);" data-v-a5e37ed7></div><div class="point" style="right:27%;top:3%;transform:scale(1);" data-v-a5e37ed7></div><div class="point" style="left:27%;bottom:2%;transform:scale(1.1);" data-v-a5e37ed7></div><div class="point" style="right:27%;bottom:2%;transform:scale(1.3);" data-v-a5e37ed7></div><div class="point" style="left:27%;top:40%;transform:scale(1);" data-v-a5e37ed7></div><div class="point" style="right:27%;top:50%;transform:scale(1.3);" data-v-a5e37ed7></div><div class="point" style="left:27%;top:35%;transform:scale(1.1);" data-v-a5e37ed7></div><div class="point" style="right:27%;top:40%;transform:scale(0.8);" data-v-a5e37ed7></div><div class="point" style="top:30%;left:10%;width:20px;height:20px;" data-v-a5e37ed7></div><div class="point" style="top:40%;right:10%;width:20px;height:20px;" data-v-a5e37ed7></div><div class="point" style="top:12%;left:30%;transform:scale(0.75);" data-v-a5e37ed7></div><div class="point" style="top:10%;right:30%;transform:scale(0.6);" data-v-a5e37ed7></div><div class="point" style="left:27%;bottom:22%;transform:scale(0.7);" data-v-a5e37ed7></div><div class="point" style="right:17%;bottom:24%;transform:scale(0.9);" data-v-a5e37ed7></div><div class="point" style="left:27%;bottom:32%;transform:scale(1);" data-v-a5e37ed7></div><div class="point" style="right:27%;bottom:34%;transform:scale(1.1);" data-v-a5e37ed7></div><div class="point" style="right:50%;top:50%;transform:translateX(-50%) scale(1.3);" data-v-a5e37ed7></div>',17),Xw=[Ww],jw=Qt({__name:"process-bar",props:{url:{type:String},barpercent:{type:Number}},setup(r){const o=r;let i=Mt(0);return ki(()=>o.barpercent,(t,e)=>{i.value=e*100}),(t,e)=>(Yi(),Qi("div",Uw,[Vw,fr("div",kw,[fr("div",Gw,[fr("div",{class:"percent",style:Xa({width:qi(i)+"%"})},null,4)])]),fr("div",Hw,[(Yi(),Qi(hr,null,Bg([1,2],n=>fr("div",{key:n,class:"item"},Xw)),64))])]))}}),$w=Ko(jw,[["__scopeId","data-v-a5e37ed7"]]);class qw{constructor(o,i,t){re(this,"engine",null);re(this,"rootEntity",null);re(this,"scence");re(this,"camera");re(this,"wireframe",null);re(this,"loadScence");re(this,"loadingEntity");re(this,"particle");this.scence=new Zr(o.engine),this.engine=i,this.rootEntity=this.scence.createRootEntity(t),this.loadScence=Ma.getInstance(o),this.loadScence.addScence(t,this.scence),this.wireframe=this.rootEntity.addComponent(np)}loading(){this.loadingEntity=this.rootEntity.addComponent(Yw),this.particle&&this.rootEntity.addChild(this.particle)}hidden(){this.loadingEntity&&(this.particle=this.rootEntity.findByName("particle"),console.log(this.particle),this.rootEntity.removeChild(this.rootEntity.findByName("particle")))}addInstance(o,i){this.loadScence.addInstance(o,i)}async loadSource(o,i){let t=document.createElement("div");t.setAttribute("loading","1"),document.body.append(t);const e=j_({name:"root",data(){return{progress:0}},render(){return l0($w,{percent:this.progress})}});return e.mount(t),await this.engine.resourceManager.load(o).onProgress(n=>{let a=document.querySelector(".percent"),s=document.getElementById("num"),l=document.getElementById("wave-mask");a&&(a.style.width=n*100+"%",console.log(`\u5F53\u524D\u52A0\u8F7D\u8FDB\u5EA6\u4E3A ${n}`),s.innerHTML=n*100+"",l.style.top=100-n*100+"%",n>0&&(l.style.opacity="1")),i&&i(n),n==1&&e.unmount()})}}class Yw extends mn{constructor(){super(...arguments);re(this,"particles");re(this,"spriteSheet",[{x:0,y:0,w:100,h:95,offX:0,offY:0,sourceW:100,sourceH:95},{x:100,y:0,w:48,h:46,offX:0,offY:0,sourceW:48,sourceH:46},{x:148,y:0,w:97,h:90,offX:0,offY:0,sourceW:97,sourceH:90},{x:245,y:0,w:148,h:128,offX:0,offY:0,sourceW:148,sourceH:128},{x:393,y:0,w:118,h:249,offX:0,offY:0,sourceW:118,sourceH:249},{x:100,y:90,w:124,h:94,offX:0,offY:0,sourceW:124,sourceH:94},{x:0,y:184,w:249,h:185,offX:0,offY:0,sourceW:249,sourceH:185},{x:0,y:95,w:86,h:83,offX:0,offY:0,sourceW:86,sourceH:83}])}onStart(){const i=this.entity.createChild("particle");this.particles=i.addComponent(Wl);let t=this.particles;this.engine.resourceManager.load({url:"https://gw.alipayobjects.com/mdn/rms_d27172/afts/img/A*kxloQYq2YDEAAAAAAAAAAAAAARQnAQ",type:tt.Texture2D}).then(e=>{t.maxCount=500,t.startTimeRandomness=5,t.position=new y(0,0,0),t.positionRandomness=new y(.5,0,.5),t.velocity=new y(0,20,0),t.velocityRandomness=new y(5,20,5),t.acceleration=new y(0,-10,0),t.accelerationRandomness=new y(2,4,5),t.rotateVelocity=1,t.rotateVelocityRandomness=1,t.size=.1,t.texture=e,t.start()})}}const Oi=class{constructor(o){re(this,"sceneManager",null);re(this,"scenceMap",{});re(this,"instanceMap",{});this.sceneManager=o}addScence(o,i){this.scenceMap[o]=i}addInstance(o,i){this.instanceMap[o]=i}toScence(o){for(let i in this.scenceMap)this.scenceMap[i].isActive=!1;this.scenceMap[o].isActive=!0,this.sceneManager.activeScene=this.scenceMap[o],this.instanceMap[o]&&this.instanceMap[o].loadSrc()}static getInstance(o){return Oi.instance||(Oi.instance=new Oi(o)),Oi.instance}};let Ma=Oi;re(Ma,"instance");function qd(r,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Qw(r,o,i){return o&&qd(r.prototype,o),i&&qd(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function Jw(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,ol(r,o)}function ol(r,o){return ol=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ol(r,o)}var Yd=Q.zeroTolerance,Bs=function(){function r(i,t,e){this.radius=i,this.phi=t,this.theta=e,this.radius=i!==void 0?i:1,this.phi=t!==void 0?t:0,this.theta=e!==void 0?e:0}var o=r.prototype;return o.set=function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},o.makeSafe=function(){return this.phi=Q.clamp(this.phi,Yd,Math.PI-Yd),this},o.setFromVec3=function(t){return this.radius=t.length(),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Q.clamp(t.y/this.radius,-1,1))),this},o.setToVec3=function(t){var e=this.radius,n=this.phi,a=this.theta,s=Math.sin(n)*e;return t.set(s*Math.sin(a),e*Math.cos(n),s*Math.cos(a)),this},r}();Q.zeroTolerance;var We;(function(r){r[r.None=0]="None",r[r.ROTATE=1]="ROTATE",r[r.ZOOM=2]="ZOOM",r[r.PAN=4]="PAN",r[r.All=7]="All"})(We||(We={}));function Kl(){return function(r){}}var Qd,Jd,Kw=(Qd=Kl(),Qd(Jd=function(){function r(){}return r.onUpdateHandler=function(i){return i.isKeyHeldDown(yt.ArrowLeft)||i.isKeyHeldDown(yt.ArrowRight)||i.isKeyHeldDown(yt.ArrowUp)||i.isKeyHeldDown(yt.ArrowDown)?We.PAN:We.None},r.onUpdateDelta=function(i,t){var e=i.keyPanSpeed,n=i.input;t.x=t.y=0,n.isKeyHeldDown(yt.ArrowLeft)&&(t.x+=e),n.isKeyHeldDown(yt.ArrowRight)&&(t.x-=e),n.isKeyHeldDown(yt.ArrowUp)&&(t.y+=e),n.isKeyHeldDown(yt.ArrowDown)&&(t.y-=e)},r}())||Jd),Kd,Zd,Jn,cr;(function(r){r[r.Moving=0]="Moving",r[r.Distance=1]="Distance"})(cr||(cr={}));var Zw=(Kd=Kl(),Kd(Zd=(Jn=function(){function r(){}return r.onUpdateHandler=function(i){++this._frameIndex;var t=i.pointers;switch(t.length){case 1:i.isPointerHeldDown(gi.Secondary)?this._updateType(We.PAN,cr.Moving):i.isPointerHeldDown(gi.Auxiliary)?this._updateType(We.ZOOM,cr.Moving):i.isPointerHeldDown(gi.Primary)?this._updateType(We.ROTATE,cr.Moving):this._updateType(We.None,cr.Moving);break;case 2:this._updateType(We.ZOOM,cr.Distance);break;case 3:this._updateType(We.PAN,cr.Moving);break;default:this._updateType(We.None,cr.Moving);break}return this._handlerType},r.onUpdateDelta=function(i,t){var e=this._frameIndex;switch(this._deltaType){case cr.Moving:if(this._lastUsefulFrameIndex===e-1){var n=i.input.pointerMovingDelta;t.x=n.x,t.y=n.y}else t.x=0,t.y=0;break;case cr.Distance:var a=i.input.pointers,s=a[0],l=a[1],c=Z.distance(s.position,l.position);this._lastUsefulFrameIndex===e-1?t.set(0,this._distanceOfPointers-c,0):t.set(0,0,0),this._distanceOfPointers=c;break}this._lastUsefulFrameIndex=e},r._updateType=function(i,t){(this._handlerType!==i||this._deltaType!==t)&&(this._handlerType=i,this._deltaType=t,this._lastUsefulFrameIndex=-1)},r}(),Jn._deltaType=cr.Moving,Jn._handlerType=We.None,Jn._frameIndex=0,Jn._lastUsefulFrameIndex=-1,Jn._distanceOfPointers=0,Jn))||Zd),e_,t_,eb=(e_=Kl(),e_(t_=function(){function r(){}return r.onUpdateHandler=function(i){var t=i.wheelDelta;return t.x===0&&t.y===0&&t.z===0?We.None:We.ZOOM},r.onUpdateDelta=function(i,t){t.copyFrom(i.input.wheelDelta)},r}())||t_),_s=function(r){Jw(o,r);function o(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t=r.call.apply(r,[this].concat(n))||this,t.canvas=void 0,t.input=void 0,t.inputDevices=[Kw,Zw,eb],t.camera=void 0,t.cameraTransform=void 0,t.target=new y,t.up=new y(0,1,0),t.autoRotate=!1,t.autoRotateSpeed=Math.PI,t.enableKeys=!1,t.enableDamping=!0,t.rotateSpeed=1,t.zoomSpeed=1,t.keyPanSpeed=7,t.dampingFactor=.1,t.zoomFactor=.2,t.minDistance=.1,t.maxDistance=1/0,t.minZoom=0,t.maxZoom=1/0,t.minPolarAngle=0,t.maxPolarAngle=Math.PI,t.minAzimuthAngle=-1/0,t.maxAzimuthAngle=1/0,t._spherical=new Bs,t._sphericalDelta=new Bs,t._sphericalDump=new Bs,t._zoomFrag=0,t._scale=1,t._panOffset=new y,t._tempVec3=new y,t._enableHandler=We.All,t}var i=o.prototype;return i.onAwake=function(){var e=this.engine,n=this.entity;this.canvas=e.canvas,this.input=e.inputManager,this.camera=n.getComponent(wi),this.cameraTransform=n.transform},i.onUpdate=function(e){this._updateInputDelta(e),this._updateTransform()},i._updateInputDelta=function(e){for(var n=We.None,a=this._tempVec3,s=this._enableHandler,l=this.inputDevices,c=this.input,u=l.length-1;u>=0;u--){var h=l[u],f=h.onUpdateHandler(c);if(f&s)switch(n|=f,h.onUpdateDelta(this,a),f){case We.ROTATE:this._rotate(a);break;case We.ZOOM:this._zoom(a);break;case We.PAN:this._pan(a);break}}var d=this._sphericalDump,_=this._sphericalDelta;if(this.autoRotate){var p=this.autoRotateSpeed/1e3*e;this._sphericalDelta.theta-=p}this.enableDamping&&(s&We.ZOOM&&n^We.ZOOM&&(this._zoomFrag*=1-this.zoomFactor),s&We.ROTATE&&n^We.ROTATE&&(_.theta=d.theta*=1-this.dampingFactor,_.phi=d.phi*=1-this.dampingFactor))},i._rotate=function(e){var n=2*Math.PI*e.x/this.canvas.width*this.rotateSpeed;this._sphericalDelta.theta-=n;var a=2*Math.PI*e.y/this.canvas.height*this.rotateSpeed;this._sphericalDelta.phi-=a,this.enableDamping&&(this._sphericalDump.theta=-n,this._sphericalDump.phi=-a)},i._zoom=function(e){e.y>0?this._scale/=Math.pow(.95,this.zoomSpeed):e.y<0&&(this._scale*=Math.pow(.95,this.zoomSpeed))},i._pan=function(e){var n=this.cameraTransform,a=n.worldMatrix.elements,s=this.canvas.height,l=y.distance(n.position,this.target)*(this.camera.fieldOfView/2)*(Math.PI/180),c=-2*e.x*(l/s),u=2*e.y*(l/s);this._panOffset.x+=a[0]*c+a[4]*u,this._panOffset.y+=a[1]*c+a[5]*u,this._panOffset.z+=a[2]*c+a[6]*u},i._updateTransform=function(){var e=this.cameraTransform,n=this.target,a=this._tempVec3,s=this._spherical,l=this._sphericalDelta,c=this._panOffset;y.subtract(e.position,n,a),s.setFromVec3(a),s.theta+=l.theta,s.phi+=l.phi,s.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,s.theta)),s.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s.phi)),s.makeSafe(),this._scale!==1&&(this._zoomFrag=s.radius*(this._scale-1)),s.radius+=this._zoomFrag,s.radius=Math.max(this.minDistance,Math.min(this.maxDistance,s.radius)),s.setToVec3(a),y.add(n.add(c),a,e.position),e.lookAt(n,this.up),this._zoomFrag=0,this._scale=1,l.set(0,0,0),c.set(0,0,0)},Qw(o,[{key:"enableRotate",get:function(){return(this._enableHandler&We.ROTATE)!==0},set:function(e){e?this._enableHandler|=We.ROTATE:this._enableHandler&=~We.ROTATE}},{key:"enableZoom",get:function(){return(this._enableHandler&We.ZOOM)!==0},set:function(e){e?this._enableHandler|=We.ZOOM:this._enableHandler&=~We.ZOOM}},{key:"enablePan",get:function(){return(this._enableHandler&We.PAN)!==0},set:function(e){e?this._enableHandler|=We.PAN:this._enableHandler&=~We.PAN}}]),o}(mn),Ea={Linear:{None:function(r){return r}},Quadratic:{In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}},Cubic:{In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}},Quartic:{In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}},Quintic:{In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}},Sinusoidal:{In:function(r){return 1-Math.cos(r*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.cos(Math.PI*r))}},Exponential:{In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}},Circular:{In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}},Elastic:{In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}},Back:{In:function(r){var o=1.70158;return r*r*((o+1)*r-o)},Out:function(r){var o=1.70158;return--r*r*((o+1)*r+o)+1},InOut:function(r){var o=2.5949095;return(r*=2)<1?.5*(r*r*((o+1)*r-o)):.5*((r-=2)*r*((o+1)*r+o)+2)}},Bounce:{In:function(r){return 1-Ea.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?Ea.Bounce.In(r*2)*.5:Ea.Bounce.Out(r*2-1)*.5+.5}}},wa;typeof self>"u"&&typeof process<"u"&&process.hrtime?wa=function(){var r=process.hrtime();return r[0]*1e3+r[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?wa=self.performance.now.bind(self.performance):Date.now!==void 0?wa=Date.now:wa=function(){return new Date().getTime()};var si=wa,ip=function(){function r(){this._tweens={},this._tweensAddedDuringUpdate={}}return r.prototype.getAll=function(){var o=this;return Object.keys(this._tweens).map(function(i){return o._tweens[i]})},r.prototype.removeAll=function(){this._tweens={}},r.prototype.add=function(o){this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o},r.prototype.remove=function(o){delete this._tweens[o.getId()],delete this._tweensAddedDuringUpdate[o.getId()]},r.prototype.update=function(o,i){o===void 0&&(o=si()),i===void 0&&(i=!1);var t=Object.keys(this._tweens);if(t.length===0)return!1;for(;t.length>0;){this._tweensAddedDuringUpdate={};for(var e=0;e<t.length;e++){var n=this._tweens[t[e]],a=!i;n&&n.update(o,a)===!1&&!i&&delete this._tweens[t[e]]}t=Object.keys(this._tweensAddedDuringUpdate)}return!0},r}(),Li={Linear:function(r,o){var i=r.length-1,t=i*o,e=Math.floor(t),n=Li.Utils.Linear;return o<0?n(r[0],r[1],t):o>1?n(r[i],r[i-1],i-t):n(r[e],r[e+1>i?i:e+1],t-e)},Bezier:function(r,o){for(var i=0,t=r.length-1,e=Math.pow,n=Li.Utils.Bernstein,a=0;a<=t;a++)i+=e(1-o,t-a)*e(o,a)*r[a]*n(t,a);return i},CatmullRom:function(r,o){var i=r.length-1,t=i*o,e=Math.floor(t),n=Li.Utils.CatmullRom;return r[0]===r[i]?(o<0&&(e=Math.floor(t=i*(1+o))),n(r[(e-1+i)%i],r[e],r[(e+1)%i],r[(e+2)%i],t-e)):o<0?r[0]-(n(r[0],r[0],r[1],r[1],-t)-r[0]):o>1?r[i]-(n(r[i],r[i],r[i-1],r[i-1],t-i)-r[i]):n(r[e?e-1:0],r[e],r[i<e+1?i:e+1],r[i<e+2?i:e+2],t-e)},Utils:{Linear:function(r,o,i){return(o-r)*i+r},Bernstein:function(r,o){var i=Li.Utils.Factorial;return i(r)/i(o)/i(r-o)},Factorial:function(){var r=[1];return function(o){var i=1;if(r[o])return r[o];for(var t=o;t>1;t--)i*=t;return r[o]=i,i}}(),CatmullRom:function(r,o,i,t,e){var n=(i-r)*.5,a=(t-o)*.5,s=e*e,l=e*s;return(2*o-2*i+n+a)*l+(-3*o+3*i-2*n-a)*s+n*e+o}}},Zl=function(){function r(){}return r.nextId=function(){return r._nextId++},r._nextId=0,r}(),ap=new ip,tb=function(){function r(o,i){i===void 0&&(i=ap),this._object=o,this._group=i,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Ea.Linear.None,this._interpolationFunction=Li.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Zl.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return r.prototype.getId=function(){return this._id},r.prototype.isPlaying=function(){return this._isPlaying},r.prototype.isPaused=function(){return this._isPaused},r.prototype.to=function(o,i){return this._valuesEnd=Object.create(o),i!==void 0&&(this._duration=i),this},r.prototype.duration=function(o){return this._duration=o,this},r.prototype.start=function(o){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=o!==void 0?typeof o=="string"?si()+parseFloat(o):o:si(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},r.prototype._setupProperties=function(o,i,t,e){for(var n in t){var a=o[n],s=Array.isArray(a),l=s?"array":typeof a,c=!s&&Array.isArray(t[n]);if(!(l==="undefined"||l==="function")){if(c){var u=t[n];if(u.length===0)continue;u=u.map(this._handleRelativeValue.bind(this,a)),t[n]=[a].concat(u)}if((l==="object"||s)&&a&&!c){i[n]=s?[]:{};for(var h in a)i[n][h]=a[h];e[n]=s?[]:{},this._setupProperties(a,i[n],t[n],e[n])}else typeof i[n]>"u"&&(i[n]=a),s||(i[n]*=1),c?e[n]=t[n].slice().reverse():e[n]=i[n]||0}}},r.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},r.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},r.prototype.pause=function(o){return o===void 0&&(o=si()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=o,this._group&&this._group.remove(this),this)},r.prototype.resume=function(o){return o===void 0&&(o=si()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=o-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},r.prototype.stopChainedTweens=function(){for(var o=0,i=this._chainedTweens.length;o<i;o++)this._chainedTweens[o].stop();return this},r.prototype.group=function(o){return this._group=o,this},r.prototype.delay=function(o){return this._delayTime=o,this},r.prototype.repeat=function(o){return this._initialRepeat=o,this._repeat=o,this},r.prototype.repeatDelay=function(o){return this._repeatDelayTime=o,this},r.prototype.yoyo=function(o){return this._yoyo=o,this},r.prototype.easing=function(o){return this._easingFunction=o,this},r.prototype.interpolation=function(o){return this._interpolationFunction=o,this},r.prototype.chain=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return this._chainedTweens=o,this},r.prototype.onStart=function(o){return this._onStartCallback=o,this},r.prototype.onUpdate=function(o){return this._onUpdateCallback=o,this},r.prototype.onRepeat=function(o){return this._onRepeatCallback=o,this},r.prototype.onComplete=function(o){return this._onCompleteCallback=o,this},r.prototype.onStop=function(o){return this._onStopCallback=o,this},r.prototype.update=function(o,i){if(o===void 0&&(o=si()),i===void 0&&(i=!0),this._isPaused)return!0;var t,e,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(o>n)return!1;i&&this.start(o)}if(this._goToEnd=!1,o<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),e=(o-this._startTime)/this._duration,e=this._duration===0||e>1?1:e;var a=this._easingFunction(e);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,e),e===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[t]=="string"&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo&&this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=o+this._repeatDelayTime:this._startTime=o+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},r.prototype._updateProperties=function(o,i,t,e){for(var n in t)if(i[n]!==void 0){var a=i[n]||0,s=t[n],l=Array.isArray(o[n]),c=Array.isArray(s),u=!l&&c;u?o[n]=this._interpolationFunction(s,e):typeof s=="object"&&s?this._updateProperties(o[n],a,s,e):(s=this._handleRelativeValue(a,s),typeof s=="number"&&(o[n]=a+(s-a)*e))}},r.prototype._handleRelativeValue=function(o,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?o+parseFloat(i):parseFloat(i)},r.prototype._swapEndStartRepeatValues=function(o){var i=this._valuesStartRepeat[o],t=this._valuesEnd[o];typeof t=="string"?this._valuesStartRepeat[o]=this._valuesStartRepeat[o]+parseFloat(t):this._valuesStartRepeat[o]=this._valuesEnd[o],this._valuesEnd[o]=i},r}(),rb="18.6.4",nb=Zl.nextId,nn=ap,ib=nn.getAll.bind(nn),ab=nn.removeAll.bind(nn),ob=nn.add.bind(nn),sb=nn.remove.bind(nn),lb=nn.update.bind(nn),Wa={Easing:Ea,Group:ip,Interpolation:Li,now:si,Sequence:Zl,nextId:nb,Tween:tb,VERSION:rb,getAll:ib,removeAll:ab,add:ob,remove:sb,update:lb};class cb extends qw{constructor(i,t){super(i,t,"model_scence_2");re(this,"windowEntity",null);re(this,"cameraEntity",null);re(this,"orbit");super.addInstance("model_scence_2",this),this.initCamera(),this.initLight(),this.loadSrc()}initCamera(){let{rootEntity:i}=this;if(i){const t=i.createChild("camera");t.transform.position=new y(0,20,0),this.cameraEntity=t;let e=t.addComponent(wi);e.cullingMask=Tt.Layer0,e.farClipPlane=1e3,e.fieldOfView=70,this.camera=t;let n=this.orbit=t.addComponent(_s);n.enableRotate=!1,n.enableZoom=!1,n.maxZoom=2,n.minZoom=2,n.enablePan=!1}}resetCamera(){this.orbit.maxPolarAngle=90*Math.PI/180,this.orbit.enableRotate=!0,this.camera.transform.position=new y(14,17,0)}initLight(){let{rootEntity:i}=this;if(i){const t=i.createChild("lightNode");let e=t.addComponent(Yt);t.transform.position.set(0,14,0),t.transform.setRotation(-90,0,0),e.color.set(1,1,1,1);const n=i.createChild("pointLight");let a=n.addComponent(xr);a.intensity=.5,n.transform.position=new y(10,14,0),t.transform.lookAt(new y(0,0,0))}{const t=i.createChild("dir_light"),e=i.createChild("dir_light2");t.addComponent(Yt),e.addComponent(Yt),t.transform.setRotation(30,0,0),e.transform.setRotation(-30,180,0)}}async loadSrc(){let{engine:i,rootEntity:t}=this,e="";e="./asset/car/0704/car.gltf";let n="";n="./asset/car/ring/environment.gltf";let a=[e,n],[s,l]=await this.loadSource([...a]),c=s.defaultSceneRoot.clone(),u=new y(1,1,1);c.transform.scale=u,console.log(c.name),t.findByName("car")&&t.removeChild(t.findByName("car")),t.addChild(c),t.findByName("environment")||t.addChild(l.defaultSceneRoot);let h=c.getComponent(Ja);c.addComponent(hb),this.setAnimation(h,s),c.findByName("pSphere4 (5)").isActive=!1,c.findByName("pSphere4").isActive=!1,c.findByName("pSphere3 (5)").isActive=!1,c.findByName("pSphere3").isActive=!1,this.resetCamera()}setAnimation(i,t){const e=t.animations,n=new cs;e.forEach(a=>{const s=new us(a.name),l=new hs;n.addLayer(s),s.stateMachine=l;const c=l.addState(a.name);c.clip=a,a.name!=="hot"&&(c.wrapMode=na.Once)}),i.animatorController=n,i.play("hot")}createBack(){let{engine:i,rootEntity:t}=this,e="";e="./asset/back.png",i.resourceManager.load({url:e,type:tt.Texture2D}).then(n=>{let a=new Qr(this.engine,"sprite_back");const s=a.addComponent(Dl),l=new Il;l.setSize(1,.5,.1),s.addShape(l),this.camera.addChild(a),a.transform.position=new y(-3.4,6.5,-10),a.addComponent(ub);const c=a.addComponent(Bv),u=c.sprite=new ls(i,n);c.drawMode=sn.Sliced;let h=n.width/n.height;u.width=h*.4,u.height=.4,this.camera})}}class ub extends mn{constructor(){super(...arguments);re(this,"camera");re(this,"loadScence")}onAwake(){this.loadScence=Ma.getInstance()}onPointerClick(){this.loadScence.toScence("index_scence");let i=document.querySelector(".point"),t=document.querySelector(".inner_car");t&&(t.style.display="none"),i&&(i.style.left="100000px",i.style.top="100000px",i.style.opacity="0",i.style.pointerEvents="none");{let e=document.querySelector(".circle");e&&(e.style.display="block")}}}class hb extends mn{constructor(i){super(i);re(this,"rightFontDoor");re(this,"camera");re(this,"wireframe");re(this,"animator");re(this,"orbit");re(this,"originCamerPos");re(this,"originCamerRoate");re(this,"animationCurrent");re(this,"animationCurrentObj",{c_o:!1,d_o:!1,a_o:!1,b_o:!1});this.wireframe=this.entity.addComponent(np),this.createButton()}onAwake(){this.setCollider()}onEnable(){console.log(12),this.animator=this.entity.getComponent(Ja),this.camera=this.entity.parent.findByName("camera").getComponent(wi),this.orbit=this.entity.parent.findByName("camera").getComponent(_s),this.createCarButton()}setCollider(){["pSphere3 (1)","pSphere3 (2)","pSphere3 (3)","pSphere3 (4)"].forEach(t=>{let e=this.entity.findByName(t);const n=new zl;n.radius=4,n.position=new y(0,0,0),e.addComponent(Dl).addShape(n)})}onUpdate(){Wa.update();const{inputManager:i}=this.engine;if(i.isPointerDown()){let t=i.pointerPosition;const e=1;let n=new Rl;this.camera.screenPointToRay(new Z(t.x,t.y).scale(e),n);const a=new Bl;this.engine.physicsManager.raycast(n,Number.MAX_VALUE,Tt.Everything,a)&&(console.log(a.entity.name),a.entity.name==="pSphere3 (1)"&&(this.animationCurrentObj.c_o?(this.animator.play("c_c"),this.animationCurrentObj.c_o=!1):(this.animator.play("c_o"),this.animationCurrentObj.c_o=!0)),a.entity.name==="pSphere3 (3)"&&(this.animationCurrentObj.d_o?(this.animator.play("d_c"),this.animationCurrentObj.d_o=!1):(this.animator.play("d_o"),this.animationCurrentObj.d_o=!0)),a.entity.name==="pSphere3 (2)"&&(this.animationCurrentObj.a_o?(this.animator.play("a_c"),this.animationCurrentObj.a_o=!1):(this.animator.play("a_o"),this.animationCurrentObj.a_o=!0)),a.entity.name==="pSphere3 (4)"&&(this.animationCurrentObj.b_o?(this.animator.play("b_c"),this.animationCurrentObj.b_o=!1):(this.animator.play("b_o"),this.animationCurrentObj.b_o=!0)))}}innerCar(){let i=new y;this.entity.transform.getWorldForward(i);let t=new y(.8068933486938477,2.1422691345214844,-6.121748447418213).add(new y(0,1,3));this.tweenMove(this.camera.entity.transform.position.clone(),t,e=>{this.camera.entity.transform.position=e})(),this.tweenMove(this.orbit.target.clone(),new y(t.clone().x+.1,t.clone().y,t.clone().z),e=>{this.orbit.target=e})(),this.camera.fieldOfView=110,this.orbit.maxPolarAngle=Math.PI}createButton(){document.querySelector(".inner_car")&&document.querySelector(".inner_car").remove();let i=document.createElement("div");i.className="inner_car",document.body.append(i),i.style=`
    position: absolute;
    right: 0px;
    top: 20px;
    width: 85px;
    line-height: 34px;
    background-color: #00000066;
    border-top-left-radius: 5px;
    border-bottom-left-radius: 5px;
    text-align: center;
    color: rgb(255, 255, 255);
    font-size: 14px;
    
    `,i.innerText="\u8F66\u5185",i.onclick=()=>{if(i.hasAttribute("data-id")){this.tweenMove(this.camera.entity.transform.position.clone(),this.originCamerPos,e=>{this.camera.entity.transform.position=e})(),this.camera.fieldOfView=70,this.orbit.maxPolarAngle=Math.PI,this.orbit.maxPolarAngle=90*Math.PI/180,this.orbit.target=new y(0,0,0),i.removeAttribute("data-id"),i.innerText="\u8F66\u5185",document.querySelectorAll(".point").forEach(e=>{let n=e;n.style.pointerEvents="none",n.style.opacity="0"}),console.log("\u8F66\u5916");let t=this.entity.parent.findByName("sprite_back");t.isActive=!0}else{this.innerCar(),i.innerText="\u8F66\u5916",i.setAttribute("data-id","1"),this.originCamerRoate=this.camera.entity.transform.rotationQuaternion.clone(),this.originCamerPos=this.camera.entity.transform.position.clone(),document.querySelectorAll(".point").forEach((e,n)=>{if(n!=1){let a=e;a.style.pointerEvents="all",a.style.opacity="1"}});let t=this.entity.parent.findByName("sprite_back");t.isActive=!1,this.orbit.maxPolarAngle=Math.PI}}}tweenMove(i,t,e,n=500){return()=>{new Wa.Tween(i).to(t,n).onUpdate(()=>{e(i)}).start()}}createCarButton(){document.querySelectorAll(".point").forEach(t=>{t.remove()});let i={"pSphere3 (1)":new y(0,1,-3),"pSphere3 (2)":new y(0,1,3),"pSphere3 (3)":new y(0,1,-3),"pSphere3 (4)":new y(0,1,4)};for(let t in i){let e=this.entity.findByName(t);if(e){let n=e.addComponent(fb);n.setCamera(this.camera),n.setPos(e.transform.worldPosition.clone().add(i[t])),n.setOrb(this.orbit)}}}}class fb extends mn{constructor(i){super(i);re(this,"screen",new y);re(this,"widthRatio");re(this,"heightRatio");re(this,"camera");re(this,"dom");re(this,"orb");this.widthRatio=this.engine.canvas.width/this.engine.canvas._webCanvas.clientWidth,this.heightRatio=this.engine.canvas.height/this.engine.canvas._webCanvas.clientHeight,this.dom=document.createElement("div"),this.dom.className="point",this.dom.setAttribute("style",` 
          pointer-events: none;
          opacity:0;
          width:15px;
          height:15px;
          position:absolute;
          top:-1000px;
          left:-1000px;
          background: #dde405;
          border-radius:50%;
          color:#333333`),this.dom.onclick=()=>{this.moveCameraTo(),this.camera.fieldOfView=110,this.orb.maxPolarAngle=Math.PI,document.querySelectorAll(".point").forEach(t=>{t==this.dom?(this.dom.style.opacity="0",this.dom.style.pointerEvents="none"):(t.style.opacity="1",t.style.pointerEvents="all")})},document.body.appendChild(this.dom)}moveCameraTo(){this.tweenMove(this.camera.entity.transform.position.clone(),this.screen,i=>{this.camera.entity.transform.position=i})(),this.tweenMove(this.orb.target.clone(),new y(this.screen.x+.1,this.screen.y,this.screen.z),i=>{this.orb.target=i})()}tweenMove(i,t,e,n=500){return()=>{new Wa.Tween(i).to(t,n).onUpdate(()=>{e(i)}).start()}}onStart(){}setCamera(i){this.camera=i}setPos(i){this.screen=i}setOrb(i){this.orb=i}screenToViewPoint(i){console.log(i);let t=new y;const e=1;let n=new Rl;this.camera.screenPointToRay(new Z(this.engine.canvas.width/2,this.engine.canvas.height/2).scale(e),n),n.getPoint(1,this.screen);let a=new y;y.transformToVec3(this.screen,this.camera.projectionMatrix.clone().invert(),a),this.camera.worldToScreenPoint(a,this.screen),this.dom.style.left=`${this.screen.x/this.widthRatio}px`,this.dom.style.top=`${this.screen.y/this.heightRatio}px`,console.log(t)}hiddenDom(){let i=this.screen.clone(),t=this.camera.entity.transform.position.clone(),e=this.camera.entity.getComponent(_s).target.clone();y.dot(i.subtract(t),e.clone().subtract(t))>0?this.dom.style.display="block":this.dom.style.display="none"}onUpdate(){if(!this.camera)return;let i=this.screen;var t=new y;this.camera.worldToScreenPoint(i,t),this.dom.style.left=`${t.x/this.widthRatio}px`,this.dom.style.top=`${t.y/this.heightRatio}px`,this.hiddenDom()}}var sl=(r=>(r.Run="Run",r.Idle="Idle",r.Jump="Jump_In",r.Fall="Fall",r.Landing="Landing",r))(sl||{});class db{constructor(o,i){re(this,"engine",null);re(this,"rootEntity",null);re(this,"npc",null);re(this,"animator",null);re(this,"video");re(this,"camera",null);re(this,"wireframe",null);re(this,"sceneList",[]);re(this,"indexScens",null);re(this,"modelScens",null);re(this,"modelScens2",null);ke.initialize().then(()=>{i&&i()})}initEngine(o){let i=this.createScence(o).sceneManager;this.engine=i.engine,this.engine.physicsManager.initialize(ke),this.initScences(i),document.addEventListener("visibilitychange",()=>{document.visibilityState=="visible"&&(console.log("visible"),this.engine.resume()),document.visibilityState=="hidden"&&(console.log("hidden"),this.engine.pause())}),this.engine.run(),window.removeEventListener("blur",this.engine.inputManager._onBlur)}initScences(o){this.modelScens2=new cb(o,this.engine),o.activeScene=this.modelScens2.scence}createScence(o){const i=document.getElementById(o);let t=new Vx(i);const e=new Yx,n=new Or(t,e),a=window.devicePixelRatio,s=3/3;return t.width=window.innerWidth*a/s,t.height=window.innerHeight*a/s,t.setScale(s,s),{sceneManager:n.sceneManager,engine:n}}}class _b extends mn{constructor(){super(...arguments);re(this,"_camera");re(this,"_character");re(this,"_controller");re(this,"canMove",!1);re(this,"_displacement",new y);re(this,"_forward",new y);re(this,"_cross",new y);re(this,"_fallAccumulateTime",0);re(this,"_yAxisMove",new y(0,0,0));re(this,"dir",new Z);re(this,"deg",0);re(this,"isPc",!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));re(this,"speed",.05);re(this,"orb",null);re(this,"quaternion",new y);re(this,"_predictPosition",new y);re(this,"_rotMat",new ge);re(this,"_rotation",new Me);re(this,"_newRotation",new Me);re(this,"_up",new y(0,1,0));re(this,"_isInit",!1);re(this,"lenDirNormal",new y);re(this,"len",0);re(this,"currentPos");re(this,"animator");re(this,"flag",!0)}onEnable(){this.currentPos?this.entity.transform.position=this.currentPos:this.currentPos=this.entity.transform.position}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}onAwake(){console.log(232323+"onAwake"),this._controller=this.entity.getComponent(_v)}targetCamera(i){this._camera=i,this.orb=this._camera&&this._camera.getComponent(_s),this.cameraDis()}targetCharacter(i){this._character=i,this.orb.target=this._character.transform.position.clone()}controlMove({dir:i,deg:t}){this.canMove=i.length()>0,this.dir.set(i.x,i.y).normalize(),this.deg=t}controlStart(){this._camera&&(this._isInit=!0),this._fallAccumulateTime=0}cameraDis(){this.lenDirNormal=this._camera.transform.worldPosition.clone().subtract(this.entity.transform.worldPosition.clone()).normalize(),this.len==0&&(this.len=this._camera.transform.worldPosition.clone().subtract(this.entity.transform.worldPosition.clone()).length())}controalEnd(){this._isInit=!1}onUpdate(i){const t=this.engine.inputManager;if(this.animator==null&&(this.animator=this.entity.findByName("RootNode").getComponent(Ja)),this.isPc==!1){this.mobilePlayMove();return}if(t.isKeyHeldDown()){this._camera.transform.getWorldForward(this._forward),this.orb.target=this.entity.transform.worldPosition.clone(),this._forward.y=0,this._forward.normalize(),this._cross.set(this._forward.z,0,-this._forward.x);const e=.04,n=this._displacement;t.isKeyHeldDown(yt.KeyW)&&y.scale(this._forward,e,n),t.isKeyHeldDown(yt.KeyS)&&y.scale(this._forward,-e,n),t.isKeyHeldDown(yt.KeyA)&&y.scale(this._cross,e,n),t.isKeyHeldDown(yt.KeyD)&&y.scale(this._cross,-e,n),t.isKeyDown(yt.Space)&&n.set(0,.05,0),this.animator&&this.flag&&(this.flag=!1,this.animator.play("Run"))}else this._displacement.set(0,0,0),this.flag==!1&&(this.flag=!0,this.animator.play("Idle"))}onPhysicsUpdate(){const i=this.engine.physicsManager,t=i.gravity,e=i.fixedTimeStep,n=this._controller;this._isInit==!1?this._fallAccumulateTime=0:this._fallAccumulateTime+=e,this._isInit=!0,n.move(this._displacement,1e-4,e);const a=this._character.transform,s=this._yAxisMove;if(s.set(0,t.y*e*this._fallAccumulateTime,0),n.move(s,1e-4,e)&Eo.Down&&(this._fallAccumulateTime=0),this._displacement.x!=0||this._displacement.z!=0){this._predictPosition.copyFrom(a.worldPosition),this._predictPosition.subtract(this._displacement),ge.lookAt(a.worldPosition,this._predictPosition,this._up,this._rotMat),this._rotMat.getRotation(this._rotation).invert(),a.rotationQuaternion=this._rotation,this.cameraDis();let c=this.entity.transform.worldPosition.clone(),u=new y;y.scale(this.lenDirNormal,this.len,u),this._camera.transform.worldPosition=new y(c.x,c.y,c.z).add(u),this.currentPos=this.entity.transform.position.clone()}}mobilePlayMove(){if(this.canMove){if(this.orb){this.orb.target=this.entity.transform.worldPosition.clone();let e=this.orb._spherical.theta,n=Math.cos(this.deg+e),a=Math.sin(this.deg+e),s=new y(a,0,n);this._forward=s}else this._forward=new y(this.dir.x,0,this.dir.y);this._forward.y=0,this._forward.normalize();const i=.05,t=this._displacement;y.scale(this._forward,i,t)}else this._displacement.set(0,0,0)}}const ec=r=>(ug("data-v-ab5a5802"),r=r(),hg(),r),vb=ec(()=>fr("canvas",{id:"canvas"},null,-1)),pb=ec(()=>fr("div",{id:"loading"},null,-1)),gb=ec(()=>fr("div",{id:"loading_process"},null,-1)),mb=Qt({__name:"index",setup(r){let o=null,i=null,t=Mt(),e=Mt(!0);Mt(!0);let n=Mt(!1),a=Mt(h("src")==="wx");const s=d=>{i&&i.controlMove(d)},l=()=>{i==null&&(i=o.indexScens.npc.getComponent(_b)),i&&i.controlStart(),o&&o.indexScens.animator.play(sl.Run)},c=()=>{o&&o.indexScens.animator.play(sl.Idle),i&&i.controalEnd()},u=()=>{};Si(()=>{o=new db("canvas",()=>{n.value=!0,f(),a.value&&f()})});function h(d){for(var _=window.location.search.substring(1),p=_.split("&"),v=0;v<p.length;v++){var g=p[v].split("=");if(g[0]==d)return g[1]}return!1}const f=()=>{o&&(o.initEngine("canvas"),e.value=!1)};return(d,_)=>(Yi(),Qi("div",null,[vb,de(Pw,{onDir:s,onStart:l,onEnd:c}),de(iy,{ref_key:"dialog",ref:t,onOnload:u},null,512),pb,gb]))}}),yb=Ko(mb,[["__scopeId","data-v-ab5a5802"]]),xb=Qt({__name:"App",setup(r){return(o,i)=>(Yi(),Qi("div",null,[de(yb)]))}});j_(xb).mount("#app");console.log({BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0})});export default wb();
//# sourceMappingURL=index.73a726c7.js.map
